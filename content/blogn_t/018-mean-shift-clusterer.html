<!--
nabijaczleweli.xyz (c) by nabijaczleweli@nabijaczleweli.xyz
​
nabijaczleweli.xyz is licensed under a
Creative Commons Attribution 4.0 International License.
​
You should have received a copy of the license along with this
work. If not, see <https://creativecommons.org/licenses/by/4.0/>.
-->
 <!-- RSS_PUB_DATE: "TODO" -->
<!DOCTYPE html> 
 <html lang="en-GB"> 
 <head> 
 <meta charset="utf-8"> 
 <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
 <meta name="viewport" content="width=device-width,initial-scale=1"> 
 <meta name="author" content="nabijaczleweli"> 
 <meta name="description" content="018. Mean-shift clustering"> 
 <title>018. Mean-shift clustering — blognꞌt — nabijaczleweli</title> 
 
 <link href="/content/assets/common.css" rel="stylesheet"> 
 <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-touch-icon-57x57.png"> 
 <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-touch-icon-60x60.png"> 
 <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-touch-icon-72x72.png"> 
 <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-touch-icon-76x76.png"> 
 <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-touch-icon-114x114.png"> 
 <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-touch-icon-120x120.png"> 
 <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-touch-icon-144x144.png"> 
 <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-touch-icon-152x152.png"> 
 <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon-180x180.png"> 
 <link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32"> 
 <link rel="icon" type="image/png" href="/assets/favicons/android-chrome-192x192.png" sizes="192x192"> 
 <link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96"> 
 <link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16"> 
 <link rel="manifest" href="/assets/favicons/manifest.json"> 
 <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5"> 
 <link rel="shortcut icon" href="/assets/favicons/favicon.ico"> 
 <link rel="alternate" href="/content/feed.xml" type="application/rss+xml"> 
 <meta name="apple-mobile-web-app-title" content="nabijaczleweli"> 
 <meta name="application-name" content="nabijaczleweli"> 
 <meta name="msapplication-TileColor" content="#da532c"> 
 <meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png"> 
 <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml"> 
 <meta name="color-scheme" content="dark light"> 
 <script> 
 (function() { 
 let m = navigator.userAgent.match(/Firefox\/([0-9]+)/); 
 if(m && parseInt(m[1]) < 96) 
 document.addEventListener("DOMContentLoaded", function() { 
 Array.from(document.querySelectorAll('style.dark-invert')).forEach(function(e) { e.remove(); }); 
 Array.from(document.getElementsByClassName("dark-invert")).forEach(function(e) { e.classList.remove("dark-invert"); }); 
 Array.from(document.querySelectorAll('source[media="(prefers-color-scheme: dark)"]')).forEach(function(e) { e.remove(); }); 
 }); 
 })(); 
 </script> 
 <link href="/content/assets/heading.css" rel="stylesheet"> 
 <link href="/kaschism/assets/column.css" rel="stylesheet"> 
 <link href="/content/assets/blogn_t.css" rel="stylesheet"> 
 <link href="/content/assets/contents.css" rel="stylesheet"> 
 <link href="../writing/Roboto-font.css" rel="stylesheet"> 
 <link href="../writing/the_taste_of_mi/Merriweather-font.css" rel="stylesheet"> 
 <link href="//fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet"> 
 <link href="../writing/the_taste_of_mi/MathJax-font.css" rel="stylesheet"> 
 <link href="/content/assets/prism-twilight.min.css?" rel="stylesheet"> 
 <script src="/content/assets/syllable.js"></script> 
 <script src="/content/assets/pluralize.js"></script> 
 <script src="/content/assets/word_count.js"></script> 
 <script defer src="/content/assets/MathJax3-config.js"></script> 
 <script id="MathJax-script" defer src="//cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <style>mjx-c::before { display: inline-block !important; /* https://github.com/mathjax/MathJax/issues/3355#issuecomment-2787780830 */ }</style> 
 </head> 
 <body>
<style>
.continued, .continuing {
 margin-bottom: 0;
}
.continuation, .continuing {
 margin-top: 0;
}
code, samp {
 font-family: "Droid Sans Mono", monospace;
}
h1, h2, h3, h4, h5, h6, summary {
 font-family: "Merriweather", serif;
}
h1:hover a.hash-link,
h2:hover a.hash-link,
h3:hover a.hash-link,
h4:hover a.hash-link,
h5:hover a.hash-link,
h6:hover a.hash-link,
summary:hover a.hash-link {
 visibility: visible;
 opacity: 1;
}
h1 a.hash-link,
h2 a.hash-link,
h3 a.hash-link,
h4 a.hash-link,
h5 a.hash-link,
h6 a.hash-link,
summary a.hash-link {
 float: left;
 visibility: hidden;
 opacity: 0;
 padding-right: calc(1em / 5.5);
 margin-left: calc(-1em / 1.1);
  transition: all 0.5s;
}
h1 a.hash-link, h2 a.hash-link, h3 a.hash-link, h4 a.hash-link, h5 a.hash-link, h6 a.hash-link, summary a.hash-link,
a .fa, a .far, a .fab, a [class*="icon"], a [class*="devicon"],
a.fa, a.far, a.fab, a[class*="icon"], a[class*="devicon"] {
 color: inherit;
 text-decoration: none;
}
.indented {
 text-indent: 1em;
}

samp.path {
 font-style: italic;
}
ol.alphalist {
 counter-reset: alphalist;
}
ol.alphalist > li {
 list-style: none;
 counter-increment: alphalist;
}
ol.alphalist > li::marker {
 content: counter(alphalist, lower-latin) ")\a0";
}
pre {
 font-family: "Droid Sans Mono", monospace !important;
}
code[class*="language-"] small, pre[class*="language-"] small {
 tab-size: 5.3;
}
table.perf tr:nth-child(5n+2), table.perf tr:nth-child(5n+4) {
 background-color: #80808020;
}
table.perf {
 margin-left: 1em;
 text-align: right;
}
table.perf.left {
 margin-left: initial;
}
table.perf th:nth-child(1) {
 text-align: left;
 padding-right: 0.5em;
}
table.perf tr:nth-child(5), table.perf tr.spc {
 height: 0.5em;
}
table.perf tr.hspc {
 height: 0.25em;
}
/* Ideally we'd drop .label restrixion but http://bugzilla.mozilla.org/show_bug.cgi?id=1960124  */
table.perf tfoot.label {
 text-align: center;
 font-size: smaller;
 display: table-caption;
 caption-side: bottom;
 width: 100%;
}
table.perf tfoot.slowdown-didnt td {
 text-align: initial;
 padding-left: 1em;
}
table.perf tfoot.slowdown-didnt strong {
 width: 0.7em;
 display: inline-block;
}
table.memtype {
 margin-left: 1em;
 margin-bottom: 0.5em;
}
table.memtype td:nth-child(1) {
 text-align: right;
}
table.memtype td[colspan] {
 text-align: initial;
}
table.memtype td:nth-child(n+2) {
 font-family: "Droid Sans Mono", monospace;
 white-space: pre-wrap;
}
table.memtype caption {
 font-weight: bold;
}
#oklab-container *:nth-child(2),
.mathnospace > * {
 margin-top: 0 !important;
}
.mathnospace.real > * {
 margin-bottom: 0 !important;
}
html {
 --r: #500;
 --g: #050;
 --b: #005;
}
figure img {
 width: 100%;
}
.three-by-each > figure {
 vertical-align: top;
 display: inline-block;
 width: calc((100% - (0.5% * 3)) / 3 - 1.5%);
 margin-left: 1.5%;
 margin-right: 0;
}
.three-by-each.directly > figure {
 width: calc(100% / 3);
 margin-left: 0;
}
figcaption {
 text-align: center;
}
.three-by-each#amogus img {
  max-width: 200px;
  margin-left: auto;
  margin-right: auto;
  display: block;
  margin-bottom: 4px; /* block removes this? */
}
.sharp img {
 image-rendering: crisp-edges;
}
.continuation > figure, .continuing > figure {
 margin-top: 0;
}
.continued > figure, .continuing > figure {
 margin-bottom: 0;
}
.one-by-each figure {
 margin-left: 0;
 margin-right: 0;
}
.side-by-each > figure {
 vertical-align: top;
 display: inline-block;
 width: calc((100% - (0.5% * 2)) / 2 - 1.5%);
 margin-left: 1.5%;
 margin-right: 0;
}
.side-by-each > figure:nth-child(2) {
 margin-left: 0;
}
#videos_side_by_each video {
 display: block;
}
#Pvol tr > *:nth-child(1),
.Ppop tr > *:nth-child(1) {
 font-family: "Droid Sans Mono", monospace;
}
#Pvol tr > *:nth-child(2) {
 text-align: right;
}
#Pvol tr > *:nth-child(3) {
 text-align: left;
 padding-left: 0.5em;
}
#Pvol,
.Ppop {
 margin-left: 1em;
}
.Ppop tr > *:nth-child(2),
.Ppop tr > *:nth-child(4) {
 padding-left: 0.5em;
}
.Ppop tr > *:nth-child(3),
.Ppop tr > *:nth-child(5) {
 text-align: right;
}
.maths-by-each > div {
 display: inline-block;
}
.maths-by-each > div:nth-child(1) {
 margin-right: 0.5em;
}
.maths-by-each tr {
 font-family: "Droid Sans Mono", monospace;
 white-space: pre;
 text-align: left;
}
.maths-by-each th,
.maths-by-each td {
 padding: 0;
}
.maths-by-each .r {
 text-align: right;
}
iframe {
 border: 0;
}
blockquote {
 white-space: pre-wrap;
}
blockquote date {
 opacity: 50%;
 font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;
}
blockquote hr {
 color: transparent;
  margin-top: 0.2em;
  margin-bottom: 0.2em;
}
blockquote strong {
 font-weight: 500;
}
.singles > figure {
 width: 100%;
 margin-left: auto;
 margin-right: auto;
}
@media all and (min-device-width: 600px) {
 .singles > figure {
  width: 80%;
 }
}
@media all and (min-device-width: 800px) {
 .singles > figure {
  width: 60%;
 }
}
.codecontinued > pre {
 margin-top: 0;
 margin-bottom: 0;
 padding-top: 0.5em;
 padding-bottom: 0.5em;
}
@font-face {
 font-family: "RobotoSlab-Regular+tabdig";
  src: url("/content/assets/RobotoSlab-Regular+tabdig.ttf") format("truetype");
}
</style>
<style class="dark-invert">
@media (prefers-color-scheme: dark) {
 html {
  --r: #FAA;
  --g: #AFA;
  --b: #AAF;
 }
}
@media not (prefers-color-scheme: dark) {
 html {
  --r: #500;
  --g: #050;
  --b: #005;
 }
}
@media ((prefers-contrast: more) or (prefers-reduced-transparency: reduce) or (forced-colors: active) or (monochrome)) {
 body {
  --r: initial;
  --g: initial;
  --b: initial;
 }
}
</style>
<div class="roboto writing"> 
 <p></p> 
 <h2 id="go-back" class="merriweather"><a class="go-back-link left" href=".">↩</a> <samp>018. Mean-shift clustering</samp> <a class="go-back-link right" href=".">↩</a></h2> 
 <h4 id="post-date"><span style="white-space: nowrap">Tue, 29 Apr 2025 16:32:56 +0200</span></h4> 
 <!--BLOGN_T_TOC_PLACEHOLDER-->
<div style='position: relative;'><details id='contents'><summary><h2>Contents</h2></summary><ol>
<ol>
<li><a href='#problem-statement'>Problem statement</a></li>
<ol>
<ol>
<li><a href='#demo-palette'>[​[​palette, r=0.1: D=p \circ ((\mathrm{CC}_{16}, \mathrm{4E}_{16}, \mathrm{FF}_{16}), (\mathrm{FF}_{16}, \mathrm{2D}_{16}, \mathrm{FF}_{16}), (\mathrm{FF}_{16}, \mathrm{2C}_{16}, \mathrm{A6}_{16}))​]​]</a></li>
<li><a href='#demo-mulfreq'>[​[​*freq, r=0.1: D=p \circ \begin{pmatrix}(\mathrm{CC}_{16}, \mathrm{4E}_{16}, \mathrm{FF}_{16}) & (\mathrm{FF}_{16}, \mathrm{2D}_{16}, \mathrm{FF}_{16})\\(\mathrm{FF}_{16}, \mathrm{2C}_{16}, \mathrm{A6}_{16}) & (\mathrm{FF}_{16}, \mathrm{2C}_{16}, \mathrm{A6}_{16})\end{pmatrix}​]​]</a></li>
</ol>
</ol>
<li><a href='#base-case'>Base case</a></li>
<li><a href='#vulkanisation'>rubber to the road</a></li>
<li><a href='#baseline'>base-line</a></li>
<li><a href='#memory-types'>memory types</a></li>
<li><a href='#branchless'>who up branchin they execution</a></li>
<li><a href='#grid'>Hitting the griddy? In this economy?</a></li>
<ol>
<li><a href='#grid-bbox'>box bondage 🥺</a></li>
<li><a href='#grid-grid'>he do b hittin it doe</a></li>
<li><a href='#grid-impl'>The grid-based mean-shift clustering shader implementation,</a></li>
</ol>
<li><a href='#cicada-grid'>Failure: GPU-side grid-cell-to-index-list mapping</a></li>
<li><a href='#oneshot'>processed piece-meal.</a></li>
<li><a href='#expand_rgb'>straight up "bussing it" and by "it", haha, well. let's<!--'--> justr say. My rgbs.</a></li>
<li><a href='#GAAP'>our very own Enron scandal.</a></li>
<li><a href='#known_rgbs-DEVICE_LOCAL'>Do NOT tell americans about your allocations. Worst mistake of my life.</a></li>
<li><a href='#gilbert'>You do not under any circumstances have to hand it to Scott Adams</a></li>
<li><a href='#ellipsoid-vs-prism'>Totally ellipsoidal, man!</a></li>
<li><a href='#sum_cells'>commutativity can be your angle....</a></li>
<ol>
<li><a href='#sum_cells+ulp'>or yuor devil</a></li>
</ol>
<li><a href='#occupancy'>re-tuning the piece-meal iteration count</a></li>
<li><a href='#grid-size-again'>Grid size re-evaluation</a></li>
<li><a href='#gxyz-unnest'>Failure: un-nesting iteration of points-in-cell from iteration of cells-in-bounding-box</a></li>
<li><a href='#gxyz-xyz'>Failure: [​[​l&lt;a&lt;b​]​]</a></li>
<li><a href='#groups_accumulator-mutex'>parallelising is points-in-cell <samp>assign_cell.hlsl</samp> <q>grouping</q> post-processing</a></li>
<li><a href='#groupshared'>de-parallelising <samp>find_bbox.hlsl</samp></a></li>
<li><a href='#moral'>Moral</a></li>
<li><a href='#network-effect'>Network effect</a></li>
<ol>
<ol>
<li><a href='#network-effect-vulkanalia'>KyleMayes/vulkanalia<span style="font-weight: initial;">:</span></a></li>
<li><a href='#network-effect-rust'>rust-lang/rust<span style="font-weight: initial;">:</span></a></li>
<li><a href='#network-effect-sourcehut'>~sircmpwn/sourcehut<span style="font-weight: initial;">:</span></a></li>
<li><a href='#network-effect-mathjax'>mathjax/MathJax<span style="font-weight: initial;">:</span></a></li>
<li><a href='#network-effect-blender'>blender/blender<span style="font-weight: initial;">:</span></a></li>
</ol>
</ol>
</ol>
</ol>
</details></div>
<p class="indented continued">
In <a href="//youtu.be/HuW9qJbL0xM"><cite>Mean Shift Clustering</cite>, Gneiss Name, 2025 ▶</a>,
he describes a model for parametric palette reduction that appears, to me, to be best-in-class.
It's<!--'--> a good <del>paper</del> video, and this is not a replacement therefor —
this instead serves
</p>
<ol class="alphalist">
 <li>to <del>rigorously</del> describe the core algorithm in text,</li>
 <li>to provide a general implementation — <a href="//sr.ht/~nabijaczleweli/mean-shift-clusterer">download</a>, run, instruxions in README,</li>
 <li>to describe the optimisations that can be applied to this problem</li>
 <li>(also those that shouldn't<!--'--> because they lose),</li>
 <li>as a commentary on the state of Vulkan development "on-boarding" (I hadn't<!--'--> written a GPU program before this).</li>
</ol>
<p class="indented continued">
Compare the measured performance on my AMD Radeon RX 5700 XT THICC II/i7-2600/DDR3-1600 vs
an AMD Radeon RX 6500 XT (RADV NAVI24)/5800X3D/DDR4-3600 (weighted average <span class="roboto-unscale math-font-normal">14%</span> faster)
and a laptop with an iGPU (Intel(R) Iris(R) Xe Graphics (ADL GT2)/i5-1235U/SDDDR4 3200 MHz (0.3 ns)) (average <span class="roboto-unscale math-font-normal">3×</span> slower):
</p>
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">79.46ms</span></td> <td><span class="roboto-unscale math-font-normal">3.35s</span></td> <td><span class="roboto-unscale math-font-normal">36.33s</span></td></tr>
 <tr><th>6500 XT </th> <td><span class="roboto-unscale math-font-normal">91.24ms</span></td> <td><span class="roboto-unscale math-font-normal">4.00s</span></td> <td><span class="roboto-unscale math-font-normal">31.47s</span></td></tr>
 <tr><th>i5-1235U iGPU</th> <td><span class="roboto-unscale math-font-normal">365.38ms</span></td> <td><span class="roboto-unscale math-font-normal">17.85s</span></td> <td><span class="roboto-unscale math-font-normal">118.90s</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">1.11s</span></td> <td><span class="roboto-unscale math-font-normal">43.16s</span></td> <td><span class="roboto-unscale math-font-normal">24.48s</span></td></tr>
 <tr><th>6500 XT </th> <td><span class="roboto-unscale math-font-normal">1.01s</span></td> <td><span class="roboto-unscale math-font-normal">37.24s</span></td> <td><span class="roboto-unscale math-font-normal">19.59s</span></td></tr>
 <tr><th>i5-1235U iGPU</th> <td><span class="roboto-unscale math-font-normal">4.41s</span></td> <td><span class="roboto-unscale math-font-normal">165.40s</span></td> <td><span class="roboto-unscale math-font-normal">60.20s</span></td></tr>
</table>
<p class="continuing">
(colour count is (clearly) not the only factor affecting speed;
 measurements from <a href="//lfs.nabijaczleweli.xyz/0026-mean-shift-clusterer/test.tar.gz">the test dataset</a>).
(All time figures are mean of at least <span class="roboto-unscale math-font-normal">5</span> measurements, usually more.)
</p>
<p class="indented continuing">
A CPU implementation processes that <span class="roboto-unscale math-font-normal"><!--'-->16'755</span>-colour image in <span class="roboto-unscale math-font-normal">5.5s</span> (on the i7-2600 which has 8 CPUs).
The others are a "don't even dream about it" scale.
</p>
<p class="indented continuation">
A naive GPU implementation
processes it in <span class="roboto-unscale math-font-normal">160ms</span>,
times out after <span class="roboto-unscale math-font-normal">8s</span> after processing <span class="roboto-unscale math-font-normal">~50/242'931<!--'--></span> colours,
and times out after <span class="roboto-unscale math-font-normal">8s</span> after processing <span class="roboto-unscale math-font-normal">~150/1'103'347</span> colours
(measured from <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/f39afc33ecb09cae66629b00d8a1461d0895f8be"><samp>f39afc3</samp></a>).
This can be analysed as a <span class="roboto-unscale math-font-normal">2×</span>/<span class="roboto-unscale math-font-normal">1080×</span>/<span class="roboto-unscale math-font-normal">2450×</span> improvement and that is basically real.
</p>
<p class="indented">
I would like to thank Cicada, <a href="//mastodon.social/@zopsicle">rightfold</a>, ratchetfreak
and to acknowledge the prior art of shaderposting by <a href="//youtube.com/@SebastianLague">Sebastian Lague</a>, <a href="//youtube.com/@Acerola_t">Acerola</a>,
and their ilk. This drew heavily on my largely-faded memory of techniques described thereby.
I would like to thank <a href="//hoel.kervadec.science/">Dr. Hoel Kervadec</a>, <a href="//orlp.net" id="orlp">Orson R. L. Peters</a>
and <a href="//sites.google.com/view/jadeedenstarmaster">Jade </a><a href="//mathstodon.xyz/@JadeMasterMath">Master</a> for their notational insights.
</p>
<script>
 if(Math.random() < 0.5)
  orlp.innerText = "orlp";
</script>
<h2 id="problem-statement" ><a class="hash-link" href="#problem-statement">#</a> Problem statement</h2>
<ol style="padding-left: 1em;" start="-3">
 <li>With operator [​[​\circ​]​] as an element-wise application: [​[​\forall{i} : (f \circ A)_{i} = f(A_{i})​]​],</li>
 <li>with operator [​[​\odot​]​] as the Hadamard product: [​[​\forall{i} : (A \odot B)_{i} = A_{i}B_{i}​]​],</li>
 <li>with [​[​[]​]​] as the Iverson bracket: [​[​[x] = (1\text{ if }x\text{ otherwise }0)​]​],</li>
 <li>with [​[​\bar{\ }​]​] as the set of preceding naturals: [​[​\bar{n} = [0, n ) \cap \mathbb{Z}​]​],</li>
 <li>let colour [​[​C = ([0, 255] \cap \mathbb{Z})^3​]​],</li>
 <li>given input [​[​n​]​]-dimensional image [​[​I \in (C_i)_{i \in \mathbb{N}_+^n}​]​],</li>
 <li>construct a map [​[​f: C \to C​]​] such that</li>
 <li>the output image [​[​O​]​] is given by [​[​O = f \circ I​]​].</li>
</ol>
<p class="continued">
Map [​[​f​]​] depends on deciding on a convex coordinate space for processing
[​[​P \subset \mathbb{R}^3​]​]
with mapping [​[​p : C \to P \text{ & } p^{-1} : P \to C​]​] such that [​[​p^{-1}(p(x)) = x​]​];
the original paper uses Oklab for this, described in
<a href="//bottosson.github.io/posts/oklab/"><cite>A perceptual color space for image processing</cite>, Björn Ottosson, 2020</a>,
which appears to be best-in-class due to its favourable properties for image processing.
This gives [​[​P = [0, 1] \times [\frac{-1}{2}, \frac{1}{2}] \times [\frac{-1}{2}, \frac{1}{2}]​]​] and
</p>
<details id="oklab-container">
 <summary>Oklab [​[​p\text{ & }p^{-1}​]​]</summary>
[​![​
\begin{align}
\text{Let}\\
<!--"-->  c'&= \frac{c}{255}\\<!--"-->
<!--"-->	l &= c' \cdot (+0.4122214708, +0.5363325363, +0.0514459929)\\<!--"-->
<!--"-->  m &= c' \cdot (+0.2119034982, +0.6806995451, +0.1073969566)\\<!--"-->
<!--"-->  s &= c' \cdot (+0.0883024619, +0.2817188376, +0.6299787005)\\<!--"-->
<!--"-->	(l', m', s') &= (\sqrt[3]{l}, \sqrt[3]{m}, \sqrt[3]{s})\\<!--"-->
\text{then}\\
<!--"-->p(c) = ((l', m', s') &\cdot (+0.2104542553, +0.7936177850, -0.0040720468),\\<!--"-->
<!--"-->        (l', m', s') &\cdot (+1.9779984951, -2.4285922050, +0.4505937099),\\<!--"-->
<!--"-->        (l', m', s') &\cdot (+0.0259040371, +0.7827717662, -0.8086757660))\\<!--"-->
\end{align}
​]!​]
[​![​
\begin{align}
\text{Let}\\
<!--"-->	l' &= p \cdot (1, +0.3963377774, +0.2158037573)\\<!--"-->
<!--"-->  m' &= p \cdot (1, -0.1055613458, -0.0638541728)\\<!--"-->
<!--"-->  s' &= p \cdot (1, -0.0894841775, -1.2914855480)\\<!--"-->
<!--"-->	(l, m, s) &= (l'^3, m'^3, s'^3)\\<!--"-->
         \color{var(--r)}r\color{initial}' &= (l, m, s) \cdot (+4.0767416621, -3.3077115913, +0.2309699292)\\<!--'-->
         \color{var(--g)}g\color{initial}' &= (l, m, s) \cdot (-1.2684380046, +2.6097574011, -0.3413193965)\\<!--'-->
         \color{var(--b)}b\color{initial}' &= (l, m, s) \cdot (-0.0041960863, -0.7034186147, +1.7076147010)\\<!--'-->
\text{then}\\
p^{-1}(p) &= (\lfloor 255 \color{var(--r)}r\color{initial}'<!--'--> \rceil, \lfloor 255 \color{var(--g)}g\color{initial}'<!--'--> \rceil, \lfloor 255 \color{var(--b)}b\color{initial}' \rceil)\\<!--'-->
\end{align}
​]!​]
</details>
<p class="continued">
Then [​[​f​]​] depends on radius [​[​r​]​] (with a functional range of [​[​[0, \sqrt{3}]​]​] in Oklab),
and deciding on variation [​[​palette​]​] or [​[​*freq​]​]:
[​[​*freq​]​] ends up on the center of mass by weighting by how many times it occurs in [​[​I​]​],
[​[​palette​]​] ends up directly at the mean (as-if all colours had the same weight).
With this given:
</p>
<div class="mathnospace">
[​![​
\begin{align}
<!--"-->f(c) &= p^{-1}(q_t)\\<!--"-->
<!--"-->\text{with}\ &q_0=p(c)\\<!--"-->
<!--"-->\text{find}\ &t=\text{the first iteration}\in \mathbb{N}_+\ \text{where}\ q_t = q_{t-1}\\<!--"-->
<!--"-->\text{where}\ \\<!--"-->
<!--"-->	D &= \begin{cases}<!--"-->
<!--"-->		p \circ I & \text{if}\ *freq\\<!--"-->
<!--"-->		p \circ ((x_i)_{\large{i \in \{x|x \in I\}}}) & \text{if}\ palette\\<!--"-->
<!--"-->	\end{cases}\\<!--"-->
<!--"-->	M_t &= (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ D\\<!--"-->
<!--"-->	q_t &= \frac{\sum\limits_{k \in dom D} (M_{t-1} \odot D)_k}{\sum\limits_{k \in dom D} (M_{t-1})_k}\\<!--"-->
\end{align}
​]!​]
</div>
<!-- https://tex.stackexchange.com/a/22134 -->
<p class="indented">
<!-- This can be generalised to transparent images ([​[​C \times ([0, 255] \cap \mathbb{Z})​]​]) by replicating the alpha channel directly: -->
This can be generalised to transparent images ([​[​C \times {\mkern 1.5mu\overline{\mkern-1.5mu{256}\mkern-1.5mu}\mkern 1.5mu}​]​]) by replicating the alpha channel directly:
[​[​I_i = (\color{var(--r)}r\color{initial}, \color{var(--g)}g\color{initial}, \color{var(--b)}b\color{initial}) \to O_i = (\color{var(--r)}r\color{initial}'<!--'-->, \color{var(--g)}g\color{initial}'<!--'-->, \color{var(--b)}b\color{initial}'<!--'-->, a)​]​]
where
[​[​(\color{var(--r)}r\color{initial}'<!--'-->, \color{var(--g)}g\color{initial}'<!--'-->, \color{var(--b)}b\color{initial}'<!--'-->) = f((\color{var(--r)}r\color{initial}, \color{var(--g)}g\color{initial}, \color{var(--b)}b\color{initial}))​]​].
Fully-transparent pixels should be discarded altogether.
</p>
<p class="indented continued">
Seeing as [​[​D​]​] is constant for either variation,
it follows trivially that [​[​q_t = q_{t-1} \Leftrightarrow M_t = M_{t-1}​]​]
("the point didn't move between iterations" is equivalent to "the same points are within <!--"-->[​[​r​]​]<!--"--> as last iteration").
</p>
<p class="indented continuing">
It may be more convenient computationally to consider [​[​D = p \circ Multiset(I)​]​] with [​[​palette​]​] reducing the multiplicity of each element to <span class="roboto-unscale math-font-normal">1</span>.
God only knows how to notate this.
</p>
<p class="indented continuing">
It is illustrative at this point to draw out a demonstration.
To this end, the following results can be observed (enlarged to show texture):
</p>
<div class="three-by-each sharp continuation" id="amogus">
    <figure> <a href="/content/assets/blogn_t/018.01-2x2-100x.png"><img alt="a 2x2 image, the top row has two distinct purples, the bottom row is a third colour" src="/content/assets/blogn_t/018.01-2x2-100x.png" /></a> <figcaption>[​[​I​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.02-2x2.png.r=0.1-100x.png"><img alt="a 2x2 image, all the same colour, a different purple" src="/content/assets/blogn_t/018.02-2x2.png.r=0.1-100x.png" /></a> <figcaption>[​[​<!--"-->O(<!--"-->​]​][​[​r=0.1,​]​] [​[​<!--"-->palette)<!--"-->​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.03-2x2.png.r=0.1-mul-freq-100x.png"><img alt="the same, but another different shade" src="/content/assets/blogn_t/018.03-2x2.png.r=0.1-mul-freq-100x.png" /></a> <figcaption>[​[​<!--"-->O(<!--"-->​]​][​[​r=0.1,​]​] [​[​<!--"-->*freq)<!--"-->​]​]</figcaption> </figure>
</div>
<p class="continuing">
For demonstrative simplicity, the source colours are all sampled from
<a href="/content/assets/blogn_t/018.04-l=0.797447133.png">the Oklab plane at <span class="roboto-unscale math-font-normal">l=0.797447133</span></a>.
Due to <a href="//101010.pl/@nabijaczleweli/114197241319014485">quantisation unavoidable since [​[​|P| \gg |C|​]​]</a>
and them not <em>naturally</em> falling on that plane out of [​[​p​]​],
the intermediate [​[​q_t​]​]s aren't<!--'--> on that plane (but remain relatively close),
and those have been projected onto it (but this is why the points don't<!--'--> seem to follow a perfect geometric mean in 2D).
</p>
<h4 id="demo-palette" class="continued"><a class="hash-link" href="#demo-palette">#</a> [​[​palette, r=0.1: D=p \circ ((\mathrm{CC}_{16}, \mathrm{4E}_{16}, \mathrm{FF}_{16}), (\mathrm{FF}_{16}, \mathrm{2D}_{16}, \mathrm{FF}_{16}), (\mathrm{FF}_{16}, \mathrm{2C}_{16}, \mathrm{A6}_{16}))​]​]</h4>
<div class="three-by-each continuation">
    <figure> <a href="/content/assets/blogn_t/018.05-l=0.797447133-start.png"><img alt="three points highlighted at #CC4EFF (top left), #FF2DFF (top right), #FF2CA6 (bottom right), and an equal radius highlighted around each of them; the spacing is such that the radius of the top-right point includes all three points, but the others only include themselves and the top-right point " src="/content/assets/blogn_t/018.05-l=0.797447133-start.png" /></a> <figcaption>[​[​q_0​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.06-l=0.797447133-%27.png"><img alt="the same, but new temporary points have migrated to #E63DFF, #EE38DF, #FF2DD0 (same order), and they're now meaningfully closer to each other. radiuses around them include all points" src="/content/assets/blogn_t/018.06-l=0.797447133-%27.png" /></a> <figcaption>[​[​q_1 \leftarrow q_0​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.07-l=0.797447133-%27%27.png"><img alt="the same, but they've all migrated to #EE38DF" src="/content/assets/blogn_t/018.07-l=0.797447133-%27%27.png" /></a> <figcaption>[​[​q_2 \leftarrow q_1 \leftarrow q_0​]​]: top-right is done here since it saw the same points as last iteration</figcaption> </figure>
</div>
<h4 id="demo-mulfreq" class="continued"><a class="hash-link" href="#demo-mulfreq">#</a> [​[​*freq, r=0.1: D=p \circ \begin{pmatrix}(\mathrm{CC}_{16}, \mathrm{4E}_{16}, \mathrm{FF}_{16}) & (\mathrm{FF}_{16}, \mathrm{2D}_{16}, \mathrm{FF}_{16})\\(\mathrm{FF}_{16}, \mathrm{2C}_{16}, \mathrm{A6}_{16}) & (\mathrm{FF}_{16}, \mathrm{2C}_{16}, \mathrm{A6}_{16})\end{pmatrix}​]​]</h4>
<div class="three-by-each">
    <figure> <a href="/content/assets/blogn_t/018.08-l=0.797447133-mul-freq-start.png"><img alt="the same three original points as before, but bottom-right has is now annotated 2x" src="/content/assets/blogn_t/018.08-l=0.797447133-mul-freq-start.png" /></a> <figcaption>[​[​q_0​]​]: this is similar to the [​[​palette​]​] case, but [​[​p((\mathrm{FF}_{16}, \mathrm{2D}_{16}, \mathrm{FF}_{16}))​]​] is represented twice</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.09-l=0.797447133-mul-freq-%27.png"><img alt="temporary points have migrated to #E63DFF, #335D0, #FF2DC1: this is similar but the latter two are meaningfully closer to the bottom-right point" src="/content/assets/blogn_t/018.09-l=0.797447133-mul-freq-%27.png" /></a> <figcaption>[​[​q_1 \leftarrow q_0​]​]: top-left is the same, others are significantly closer to the doubled bottom-right</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.09-l=0.797447133-mul-freq-%27%27.png"><img alt="they've all migrated to #F335D0" src="/content/assets/blogn_t/018.09-l=0.797447133-mul-freq-%27%27.png" /></a> <figcaption>[​[​q_2 \leftarrow q_1 \leftarrow q_0​]​]</figcaption> </figure>
</div>
<p class="indented">
In both cases [​[​t​]​] ends up being <span class="roboto-unscale math-font-normal">1</span> for [​[​f((\mathrm{FF}_{16}, \mathrm{2D}_{16}, \mathrm{FF}_{16}))​]​] (top-right) and <span class="roboto-unscale math-font-normal">2</span> for the others.
A constant [​[​t​]​], smaller than would converge, <a href="//101010.pl/@nabijaczleweli/114048671396518223">may be used</a> to achieve more-visually-pleasing output,
but does not accomplish the functionality described by the original <del>paper</del> video.
</p>
<h2 id="base-case" ><a class="hash-link" href="#base-case">#</a> Base case</h2>
<p class="indented continued">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/a8d4d4bc0a37338d2020c9a00bc49e00fdd3ffd6#src/main.rs">A scaffolding for the implementation</a>
is obtained trivially by copy-pasting <a href="//docs.rs/sdl2/0.37.0/sdl2/">the <samp>sdl2</samp> documentation examples</a>,
mashing them together hap-hazardly until a basic GUI appears,
and then never touching them again unless they're<!--'--> broken.
The SDL2 experience is not a good one on a good day, and the QoI that falls out of this is even worse, but whatever.
</p>
<p class="indented continuation">
More importantly, the pixel layout format is somehow even worse and unpredictable
and you <em>will</em> observe some rows'<!--'--> colour data being wrong on odd-sized images because
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/c3b9041444b45a53c9d635d5b24f6f6449541ff0">
 <var>row-pitch-in-bytes</var> is not always <var>pixel-stride-in-bytes · image-width</var></a>,
which appears undocumented in the bindings, barely-documented upstream, and the pixel format is a <code>&[u8]</code> and a "go to hell".
Additionally, it's<!--'--> either <var>per-channel bytes</var> or <var>int with channels allocated from LSB</var>,
and the int is in native byte order which makes
<samp>RGB24</samp> [​[​[\color{var(--r)}r\color{initial}, \color{var(--g)}g\color{initial}, \color{var(--b)}b\color{initial}]​]​] but
<samp>RGBA32</samp> either [​[​[a, \color{var(--b)}b\color{initial}, \color{var(--g)}g\color{initial}, \color{var(--r)}r\color{initial}]​]​] or [​[​[\color{var(--r)}r\color{initial}, \color{var(--g)}g\color{initial}, \color{var(--b)}b\color{initial}, a]​]​] depending on host endianness,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/033474de4dae728b61165db93930c4b073adbf66">so you need to explicitly pick the opposite</a>:
<samp>ABGR32</samp> on little-endian to get [​[​[\color{var(--r)}r\color{initial}, \color{var(--g)}g\color{initial}, \color{var(--b)}b\color{initial}, a]​]​] and vice versa.
That's<!--'--> enough on SDL2.
</p>
<p class="indented continued">
The core insights informing the implementation is that [​[​f​]​] does not depend on the pixel position — just its colour —
and that [​[​D​]​] is constant for a given [​[​I​]​].
This means that computing [​[​O​]​] can take place in three distinct steps:
analysis by computing [​[​D​]​], pre-computing [​[​f​]​] for each distinct element in [​[​D​]​], mapping the pixels directly into [​[​O​]​].
The analysis step can happen just once per [​[​I​]​], regardless of variant and [​[​r​]​] selection.
</p>
<p class="indented continuing">
Since [​[​|C| = 2^{24}​]​] (or, equivalently, [​[​C \equiv {\color{var(--r)}r\color{initial}}{\color{var(--r)}r\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--b)}b\color{initial}}{\color{var(--b)}b\color{initial}}_{16}​]​]),
and computer memory is many orders of magnitude larger than <span class="roboto-unscale math-font-normal">16Mi · any-reasonable-primitive-size</span>,
a map from any colour can easily take the form of a look-up table of size 2<sup>24</sup>.
For example, the multiplicity map of [​[​D​]​] (<samp>frequencies</samp>) and the final map [​[​f​]​] (<samp>outputs</samp>)
are of types
<code>[u32; 0xFFFFFF + 1]</code>
and
<code>[[u8; 3]; 0xFFFFFF + 1]</code>
totalling a mere <span class="roboto-unscale math-font-normal">112MiB</span>.
Extending this methodology to higher colour bit depths may require slower-but-more-memory-conscious collection types
<!-- (10-bit colour ([​[​C = ([0, 1023] \cap \mathbb{Z})^3​]​]) would grow them to to <span class="roboto-unscale math-font-normal">7GiB</span>). -->
(10-bit colour ([​[​C = {\mkern 1.5mu\overline{\mkern-1.5mu{1024}\mkern-1.5mu}\mkern 1.5mu}^3​]​]) would grow them to to <span class="roboto-unscale math-font-normal">7GiB</span>).
A 32-bit integer for the multiplicity of each colour means that an entire <span class="roboto-unscale math-font-normal">4096<sup>2</sup></span> image would need to be the same colour to overflow,
which isn't a case we care about. <!--'-->
</p>
<p class="indented continuing">
Thus, <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/a8d4d4bc0a37338d2020c9a00bc49e00fdd3ffd6/item/src/main.rs#L146">the analysis step</a>
(with [​[​p​]​] as <samp>linear_srgb_to_oklab</samp>)
[CW gore @ link, initially building in "debug" (underoptimised 🙄) mode made the counting appear to be faster in parallel with atomics —
 <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/1dd11acc9e037a9ec6d551f3274d3025c6761d61">this is not the case</a> —
 this sample has been reduced to the final single-threaded <code>+=</code> model, the rest are temporally accurate]:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0u32</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> rgb <span class="token keyword">in</span> image<span class="token punctuation">.</span>pixel_data<span class="token punctuation">.</span><span class="token function">chunks_exact</span><span class="token punctuation">(</span>pixel_stride<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->frequencies<span class="token punctuation">[</span><span class="token punctuation">(</span>r <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>g <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Lab</span> <span class="token punctuation">{</span> l<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">f32</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> known_rgbs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token operator">=</span> frequencies<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span><span class="token string">_</span><span class="token punctuation">,</span> freq<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> freq <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> freq<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">f32</span><span class="token punctuation">,</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token operator">=</span>
<!--"-->			<!--"--><span class="token punctuation">(</span><span class="token punctuation">(</span>rgb <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rgb <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rgb <span class="token operator">>></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> lab <span class="token operator">=</span> <span class="token function">linear_srgb_to_oklab</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> g <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">,</span> b <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> lab<span class="token punctuation">,</span> freq<span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">}</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuation">
yields in <samp>known_rgbs</samp> a sequence of work items [​[​({\color{var(--r)}r\color{initial}}{\color{var(--r)}r\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--b)}b\color{initial}}{\color{var(--b)}b\color{initial}}_{16}, p(I_{\color{var(--r)}r\color{initial},\color{var(--g)}g\color{initial},\color{var(--b)}b\color{initial}}), \text{multiplicity of}\ \color{var(--r)}r\color{initial},\color{var(--g)}g\color{initial},\color{var(--b)}b\color{initial})​]​].
</p>
<p class="indented continued">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/a8d4d4bc0a37338d2020c9a00bc49e00fdd3ffd6/item/src/main.rs#L278">The pre-computation step</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> radiussy <span class="token operator">=</span> <span class="token number">0.02</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> outputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span> <span class="token punctuation">{</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> radiussy_squared <span class="token operator">=</span> radiussy <span class="token operator">*</span> radiussy<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> lab<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> center <span class="token operator">=</span> lab<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">loop</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>newcenter_count<span class="token punctuation">,</span> <span class="token keyword">mut</span> newcenter<span class="token punctuation">)</span> <span class="token operator">=</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span><span class="token string">_</span><span class="token punctuation">,</span> lab<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
<!--"-->				<!--"--><span class="token keyword">let</span> distance_squared <span class="token operator">=</span> <span class="token punctuation">(</span>lab<span class="token punctuation">.</span>l <span class="token operator">-</span> center<span class="token punctuation">.</span>l<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>lab<span class="token punctuation">.</span>a <span class="token operator">-</span> center<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>lab<span class="token punctuation">.</span>b <span class="token operator">-</span> center<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->				<!--"-->distance_squared <span class="token operator">&lt;=</span> radiussy_squared
<!--"-->			<!--"--><span class="token punctuation">}</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span> <span class="token punctuation">{</span> l<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>cnt<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">_</span><span class="token punctuation">,</span> lab<span class="token punctuation">,</span> freq<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
<!--"-->				<!--"--><span class="token attribute attr-name">#[cfg(palette)]</span>
<!--"-->				<!--"--><span class="token punctuation">(</span>cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
<!--"-->				<!--"--> <span class="token class-name">Lab</span> <span class="token punctuation">{</span>
<!--"-->				<!--"--> <!--"-->	<!--"-->l<span class="token punctuation">:</span> acc<span class="token punctuation">.</span>l <span class="token operator">+</span> lab<span class="token punctuation">.</span>l<span class="token punctuation">,</span>
<!--"-->				<!--"--> <!--"-->	<!--"-->a<span class="token punctuation">:</span> acc<span class="token punctuation">.</span>a <span class="token operator">+</span> lab<span class="token punctuation">.</span>a<span class="token punctuation">,</span>
<!--"-->				<!--"--> <!--"-->	<!--"-->b<span class="token punctuation">:</span> acc<span class="token punctuation">.</span>b <span class="token operator">+</span> lab<span class="token punctuation">.</span>b<span class="token punctuation">,</span>
<!--"-->				<!--"--> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<!--"-->				<!--"--><span class="token attribute attr-name">#[cfg(mul_freq)]</span>
<!--"-->				<!--"--><span class="token punctuation">(</span>cnt <span class="token operator">+</span> freq<span class="token punctuation">,</span>
<!--"-->				<!--"--> <span class="token class-name">Lab</span> <span class="token punctuation">{</span>
<!--"-->				<!--"--> <!--"-->	<!--"-->l<span class="token punctuation">:</span> acc<span class="token punctuation">.</span>l <span class="token operator">+</span> lab<span class="token punctuation">.</span>l <span class="token operator">*</span> freq<span class="token punctuation">,</span>
<!--"-->				<!--"--> <!--"-->	<!--"-->a<span class="token punctuation">:</span> acc<span class="token punctuation">.</span>a <span class="token operator">+</span> lab<span class="token punctuation">.</span>a <span class="token operator">*</span> freq<span class="token punctuation">,</span>
<!--"-->				<!--"--> <!--"-->	<!--"-->b<span class="token punctuation">:</span> acc<span class="token punctuation">.</span>b <span class="token operator">+</span> lab<span class="token punctuation">.</span>b <span class="token operator">*</span> freq<span class="token punctuation">,</span>
<!--"-->				<!--"--> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"-->newcenter<span class="token punctuation">.</span>l <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"-->newcenter<span class="token punctuation">.</span>a <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"-->newcenter<span class="token punctuation">.</span>b <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span> newcenter <span class="token operator">==</span> center <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
is a very direct implementation of the [​[​q_t​]​] search, with [​[​t​]​] being the iteration count of the <samp>loop</samp>
(the only and obvious optimisation is not computing the square root).
All elements of [​[​D​]​] are evaluated every time.
The variant is selected at compile-time but could easily be an <samp>if</samp>,
and the outer-most loop parallelises trivially;
for <a href="/assets/nabijaczleweli.png">the first test image</a>:
</p>
<!--
1x
19.862381693s: 16755 RGBs
19.635268019s: 16755 RGBs
19.681535421s: 16755 RGBs
19.706973828s: 16755 RGBs
19.698092784s: 16755 RGBs
11.569449702s: 16755 RGBs * freq
11.412430505s: 16755 RGBs * freq
11.500412643s: 16755 RGBs * freq
11.551236633s: 16755 RGBs * freq
11.633254004s: 16755 RGBs * freq
8х
6.280777871s: 16755 RGBs
6.158563819s: 16755 RGBs
6.015339657s: 16755 RGBs
6.032053383s: 16755 RGBs
6.005366782s: 16755 RGBs
3.929331083s: 16755 RGBs * freq
3.871752355s: 16755 RGBs * freq
3.976319931s: 16755 RGBs * freq
4.052781254s: 16755 RGBs * freq
4.037341682s: 16755 RGBs * freq
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>not parallel</th> <td><span class="roboto-unscale math-font-normal">19.717s</span></td> <td><span class="roboto-unscale math-font-normal">11.533s</span></td> <td><span class="roboto-unscale math-font-normal">58.49%</span></td></tr>
 <tr><th><span class="roboto-unscale math-font-normal">8×</span> parallel</th> <td><span class="roboto-unscale math-font-normal">6.098s</span></td> <td><span class="roboto-unscale math-font-normal">3.974s</span></td> <td><span class="roboto-unscale math-font-normal">65.16%</span></td></tr>
 <tr><th>(parallel speed-up)</th> <td><span class="roboto-unscale math-font-normal">3.233×</span></td> <td><span class="roboto-unscale math-font-normal">2.903×</span></td> <td><span class="roboto-unscale math-font-normal">-6.66 p.p.</span></td></tr>
</table>
<p class="continuing">
the speed-up is less than half of expected, I'd<!--'--> blame this on low memory bandwidth and overall decrodedness of the i7-2600.
I'd<!--'--> thought that [​[​*freq​]​] converged <span class="roboto-unscale math-font-normal">~40%</span> faster due to the specific data contained in the test image, which makes direct comparison of the two difficult;
henceforth, images annotated <span class="roboto-unscale math-font-normal"><sub>d</sub></span> are the
<a href="https://git.sr.ht/~nabijaczleweli/oklab-flat/tree/trunk/item/src/bin/degen.rs">"degenerate" versions of their base case</a>,
with every colour appearing once,
making [​[​*freq​]​] equivalent to [​[​palette​]​]:
</p>
<!--
degen 1x
9.924232353s: 16551 RGBs
10.492369263s: 16551 RGBs
9.484612649s: 16551 RGBs
9.537081779s: 16551 RGBs
9.624147168s: 16551 RGBs
6.840440946s: 16551 RGBs *freq
6.787024879s: 16551 RGBs *freq
6.797846284s: 16551 RGBs *freq
6.679883337s: 16551 RGBs *freq
7.15964931s: 16551 RGBs *freq
degen 8x
3.040476807s: 16551 RGBs
3.039609561s: 16551 RGBs
2.883380031s: 16551 RGBs
2.824054437s: 16551 RGBs
2.834521759s: 16551 RGBs
2.043803313s: 16551 RGBs * freq
1.971462992s: 16551 RGBs * freq
1.864271946s: 16551 RGBs * freq
1.932857118s: 16551 RGBs * freq
2.246469286s: 16551 RGBs * freq
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>not parallel</th> <td><span class="roboto-unscale math-font-normal">9.812s</span></td> <td><span class="roboto-unscale math-font-normal">6.853s</span></td> <td><span class="roboto-unscale math-font-normal">69.84%</span></td></tr>
 <tr><th><span class="roboto-unscale math-font-normal">8×</span> parallel</th> <td><span class="roboto-unscale math-font-normal">2.924s</span></td> <td><span class="roboto-unscale math-font-normal">2.012s</span></td> <td><span class="roboto-unscale math-font-normal">68.79%</span></td></tr>
 <tr><th>(parallel speed-up)</th> <td><span class="roboto-unscale math-font-normal">3.355×</span></td> <td><span class="roboto-unscale math-font-normal">3.406×</span></td> <td><span class="roboto-unscale math-font-normal">-1.05 p.p.</span></td></tr>
</table>
<p class="continuing">
One would expect (more floating-point operations executed, more data loaded) [​[​*freq​]​] to be, at best, the same speed as [​[​palette​]​],
but the optimiser <a href="//github.com/rust-lang/rust/issues/138953"><em>actually</em> makes the [​[​palette​]​] implementation <span class="roboto-unscale math-font-normal">30%</span> worse</a>.
Science cannot explain this.
</p>
<p class="indented continued">
And <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/a8d4d4bc0a37338d2020c9a00bc49e00fdd3ffd6/item/src/main.rs#L358">the output mapping step</a>
(with [​[​p^{-1}​]​] as <samp>oklab_to_linear_srgb</samp>):
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">for</span> <span class="token punctuation">(</span>to_rgb<span class="token punctuation">,</span> from_rgb<span class="token punctuation">)</span> <span class="token keyword">in</span> image_processed<span class="token punctuation">.</span>pixel_data<span class="token punctuation">.</span><span class="token function">chunks_exact_mut</span><span class="token punctuation">(</span>pixel_stride<span class="token punctuation">)</span>
<!--"-->                     <!--"--><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>image<!--"-->          <!--"--><span class="token punctuation">.</span>pixel_data<span class="token punctuation">.</span><span class="token function">chunks_exact</span><!--"-->    <!--"--><span class="token punctuation">(</span>pixel_stride<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>from_rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> from_rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> from_rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> rgb <span class="token operator">=</span> <span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>outputs<span class="token punctuation">[</span><span class="token punctuation">(</span>r <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>g <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>r <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>g <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>b <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continued">
This, well, works.
It's<!--'--> not "fast" but since
<a href="//101010.pl/@nabijaczleweli/114230202476246959">practically every Minecraft texture has </a><a
 href="//paste.sr.ht/~nabijaczleweli/dba1e5492c6430f2a3f062819cbbda5eabe558af#Minecraft%201.20.4%20texture%20distinct%20colour%20counts"><span class="roboto-unscale math-font-normal">&lt;100</span></a><a
 href="//101010.pl/@nabijaczleweli/114230202476246959"> distinct colours</a>
I expect the original author to have finished here since at that scale each iteration is basically instant.
But since each [​[​f(c)​]​] inspects each distinct element of [​[​D​]​] [​[​t​]​] times,
the total complexity is [​[​\propto (\overline{Set(D)})^2 t_{avg}​]​]
which for more colourful images this simply won't<!--'--> do.
</p>
<div class="three-by-each sharp continuation">
    <figure> <a href="/assets/nabijaczleweli.png"><img alt="my avatar, full-colour" src="/assets/nabijaczleweli.png" /></a> <figcaption>[​[​I​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.10-nabijaczleweli.png.r=0.02.png"><img alt="my avatar, most of the detail has been replaced with flat colours" src="/content/assets/blogn_t/018.10-nabijaczleweli.png.r=0.02.png" /></a> <figcaption>[​[​<!--"-->O(<!--"-->​]​][​[​r=0.02,​]​] [​[​<!--"-->palette)<!--"-->​]​]<br /> [​[​\Sigma t = 440133​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.11-nabijaczleweli.png.r=0.02-mul-freq.png"><img alt="my avatar, more detail has been preserved" src="/content/assets/blogn_t/018.11-nabijaczleweli.png.r=0.02-mul-freq.png" /></a> <figcaption>[​[​<!--"-->O(<!--"-->​]​][​[​r=0.02,​]​] [​[​<!--"-->*freq)<!--"-->​]​]<br /> [​[​\Sigma t = 358543​]​]</figcaption> </figure>
</div>
<p class="continuation">
To wit: the unified Minecraft Alpha v1.2.2 block texture atlas has <span class="roboto-unscale math-font-normal">400</span> distinct colours and converges
in [​[​\Sigma t = 423378​]​]/[​[​\Sigma t = 664403​]​],
respectively with the same settings, in <span class="roboto-unscale math-font-normal">&lt;1ms</span>.
</p>
<!-- 003. cinque.png
174.198394ms: mapping
179.728784ms: mapping
177.643832ms: mapping
175.186384ms: mapping
174.823245ms: mapping
-->
<p class="continued indented" id="RgbStuffedInLab">
Output mapping is a little sub-optimal for large images, since it re-computes [​[​p'<!--'-->​]​] for every pixel every time
(<a href="//nabijaczleweli.bandcamp.com/album/cinque">a large (<span class="roboto-unscale math-font-normal">2160<sup>2</sup></span>) image</a> takes <span class="roboto-unscale math-font-normal">176ms</span> to map).
By <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/4df2b1ce034c3afd5d080a2fc341aa5096724356/item/src/main.rs#L465">in situ applying [​[​p'<!--'-->​]​]</a>
to turn <samp>[Lab; 0xFFFFFF + 1]</samp> into <samp>[[u8; 3 + <var>padding</var>]; 0xFFFFFF + 1]</samp>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">type</span> <span class="token type-definition class-name">RgbStuffedInLab</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Lab</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">let</span> to_rgb<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">RgbStuffedInLab</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">transmute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>r <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>g <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>b <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> outputs_rgb<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">RgbStuffedInLab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">transmute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>outputs<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>to_rgb<span class="token punctuation">,</span> from_rgb<span class="token punctuation">)</span> <span class="token keyword">in</span> image_processed<span class="token punctuation">.</span>pixel_data<span class="token punctuation">.</span><span class="token function">chunks_exact_mut</span><span class="token punctuation">(</span>pixel_stride<span class="token punctuation">)</span>
<!--"-->                     <!--"--><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>image<!--"-->          <!--"--><span class="token punctuation">.</span>pixel_data<span class="token punctuation">.</span><span class="token function">chunks_exact</span><span class="token punctuation">(</span>pixel_stride<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>from_rgb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> from_rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> from_rgb<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->to_rgb<span class="token punctuation">.</span><span class="token function">copy_from_slice</span><span class="token punctuation">(</span>outputs_rgb<span class="token punctuation">[</span><span class="token punctuation">(</span>r <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>g <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<!-- 003. cinque.png
15.487267ms: mapping
18.842751ms: mapping
15.430215ms: mapping
15.56243ms: mapping
15.294076ms: mapping
-->
<p class="continuation">
This drops to <span class="roboto-unscale math-font-normal">16ms</span>, and correspondingly less on smaller images — immaterial on the scale of <em>seconds</em>.
</p>
<p class="indented continued">
The data flow, at this point, can be analysed trivially as
</p>
<div class="singles continuation">
<figure> <a href="/content/assets/blogn_t/018.12-graphml-cpu+interstitial.png"><img alt="" src="/content/assets/blogn_t/018.12-graphml-cpu+interstitial.png" /></a> <figcaption></figcaption> </figure>
</div>
<p class="indented continued">
This allows one, like goodyear, to put the
</p>
<h2 id="vulkanisation" class="continuation"><a class="hash-link" href="#vulkanisation">#</a> rubber to the road</h2>
<p class="indented continued">
When looking for bindings, I was looking for something strongly-typed and with reasonable documentation.
To that end, I evaluated <a href="//crates.io/crates/wgpu">wgpu</a> —
first by <a href="//github.com/gfx-rs/wgpu/pull/7164">fixing the broken links to the examples</a>,
then by getting whiplash from <a href="//sotrh.github.io/learn-wgpu/">the "Learn" document</a> which simultanously covers
"what is Rust",
"this implements the WebGPU API to look like the Vulkan API and translates Some how to Some back-end",
"how to create a Rust crate",
"you <em>must</em> have a window handle and use our logger", and
<span style="padding: 2px; border-radius: 4px; background: #f63; color: #00020a;">"use this specific version of an intermediate dependency otherwise it all explodes"</span>.
No googleable compute shaders seem to be extant for it, either.
</p>
<p class="indented continuing">
After a few less remarkable ones, I'd<!--'--> settled on <a href="//crates.io/crates/vulkanalia">vulkanalia</a> because,
in <small><small><small><small>reverse</small></small></small></small> order of import:
</p>
<ol>
 <li><a href="//en.wiktionary.org/wiki/kanalia">he he kanalia</a>,</li>
 <li>it appeared to competently implement both a direct Vulkan binding
     and a <span class="roboto-unscale math-font-normal">10%</span> more structured and <span class="roboto-unscale math-font-normal">40%</span> less verbose "builder" scheme that supposedly avoided dangling references
     (in retrospect, it's<!--'--> done that quite well),
     thus allowing easy adaptation of other Vulkan posts,</li>
 <li>it has a direct port —
     <a href="//kylemayes.github.io/vulkanalia/"><cite>Vulkan Tutorial (Rust)</cite>, Kyle Mayes, trans., Alexander Overvoorde, &a.</a>
     — of <a href="//vulkan-tutorial.com">the upstream Vulkan tutorial</a>, which is basically best-in-class.</li>
</ol>
<p class="continuing">
Admittedly, the tutorial also wants to make a window and render but this can be strategically ignored, and which bits are strictly for windowing is relatively obvious.
The port doesn't<!--'--> include <a href="//vulkan-tutorial.com/Compute_Shader">the Compute Shader sexion</a>, but, counter to the rest of the text,
I've<!--'--> found it to be quite poor.
To this end, <a href="//bakedbits.dev/posts/vulkan-compute-example/"><cite>A Simple Vulkan Compute Example in C++</cite>, Baked Bits, 2021</a>
performs quite well, working out from "you have a functioning vulkan context" holistically through to "you are executing the shader".
</p>
<p class="indented continuing">
As part of the <cite>Example</cite>, a shader compilation method is specified with <samp>dxc</samp>,
which doesn't<!--'--> appear to be distributed by any-one (defined here-in as "Debian or MSYS2").
The standard and universal solution appears to be <samp>glslc</samp>, which, contranomenclaturally, actually compiles GLSL <em>and</em> HLSL,
and also has a C-style preprocessor.
<a href="//101010.pl/@nabijaczleweli/114039954494668708">Not</a> a <em>great</em> one, but, better yet, a good-enough one.
This allows
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/fb07db58ab5361aac08ee681e1500c2ae2cba7f6/item/build.rs">a simple <samp>build.rs</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> processes <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> f <span class="token keyword">in</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">read_dir</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>r<span class="token closure-punctuation punctuation">|</span></span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token closure-punctuation punctuation">|</span></span> p<span class="token punctuation">.</span><span class="token function">extension</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"hlsl"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"cargo::rerun-if-changed={}"</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->proceses<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span><span class="token class-name">Command</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"glslc"</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token string">"-fshader-stage=compute"</span><span class="token punctuation">,</span> <span class="token string">"-g"</span><span class="token punctuation">,</span> <span class="token string">"-O"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token string">"-o"</span><span class="token punctuation">,</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var_os</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">file_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with_extension</span><span class="token punctuation">(</span><span class="token string">"spv"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">for</span> proc <span class="token keyword">in</span> processes
<!--"-->		<!--"-->proc<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exit_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
which is equivalent to a <code>glslc -fshader-stage=compute -g -O -o $(OUT_DIR)/$(subst .hlsl,.spv,$@) $&lt;</code>
rule for every file matching <code>src/*.hlsl</code>.
<samp>-fshader-stage</samp> could've<!--'--> been substituted by replacing <samp>.hlsl</samp> with <samp>.comp</samp>,
and thankfully, in contrast to the devilish DXC cmdline, <samp>-O</samp> and <samp>-g</samp> are like in normal compilers
(though, with the "targeting IR" compilation model, <samp>-g</samp> has an apt side-effect of including the full source
 <em>and</em> <a href="//registry.khronos.org/SPIR-V/specs/unified1/SPIRV.html#OpLine">per-instruction line number annotations</a> in the shader binary!
 this is convenient when you need to figure out if <a href="//github.com/google/shaderc/issues/1484">the optimiser is fucking you</a>, but irrelevant most of the time).
Overall, the tooling is pretty mature, just the subject matter largely hateful.
</p>
<p class="indented continuing">
What is relevant but not immediately obvious is that DXC
<a href="//github.com/microsoft/DirectXShaderCompiler/blob/eb169591adbc1403f09fb769d5c8f98e929e6f62/lib/DxcSupport/HLSLOptions.cpp#L510">requires</a>
the entry point to be specified explicitly (as <samp>Main</samp> in the <cite>Example</cite>),
but glslc <a href="//manpages.debian.org/unstable/glslc/glslc.1.en.html#-fentry-point=%3Cname%3E">defaults to <samp>main</samp></a>,
and this needs to agree with both the source <em>and</em>
<a href="//docs.rs/vulkanalia/latest/vulkanalia/vk/struct.PipelineShaderStageCreateInfoBuilder.html#method.name">
 <samp>vk::PipelineShaderStage<wbr>CreateInfoBuilder::name</samp></a>.
HLSL in general has, to me, a similar stench to DXC, what with the Microsoft.
I haven't<!--'--> yet been able to produce GLSL by any means other than decompilation, and, while uniquely Microsofty, documentation for HLSL "exists" and "is useable".
Ah well.
</p>
<p class="indented continuing">
More confusingly,
<a href="//docs.rs/vulkanalia/latest/vulkanalia/vk/struct.ShaderModuleCreateInfoBuilder.html#implementations">
 <samp>vk::ShaderModuleCreateInfo::code</samp> and <samp>::code_size</samp></a>
takes, separately, an array of <samp>u32</samp>s and a length of that array <em>in <samp>u32</samp>s</em> (not bytes!).
This array <em>must</em> be aligned, even on amd64 where misalignment doesn't<!--'--> usually trap.
As an added bonus from a testing perspective, you do just get a SIGBUS, but not on Win32, because the linker always aligns the shader (well, did for me).
Nothing an
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/08ea621fc2ff1f4de6b2291aac5998b1d4ec8538/item/src/msc_gpu.rs#L12">
 <code>include_typed!(u32, ".../shader.spv")</code></a>
macro can't<!--'--> fix, but the Cargo compilation model and the way the implementation works being "magic" did not help.
<!-- For an unclear reason, <a href="//crates.io/crates/include_bytes_aligned">include_bytes_aligned</a> didn't work, either (though I can't reproduce this anymore).
     It actually did! I think. Maybe. Fuck knows. -->
Some would say that Rust is <a href="//thephd.dev/implementing-embed-c-and-c++">not any better than C++</a> at this
(but, well, I would be able to slap a <code>[[alignas(std::uint32_t)]]</code> on it there, so this is actually kind of an L).
</p>
<p class="indented continuing">
The terminology is a little sneaky as well: what Vulkan calls a "pipeline" is actually just a shader in human language, and a "command buffer" is a pipeline.
One may also that think "command buffers"… buffer command<em>s</em>.
They don't<!--'-->, you can only put one pipeline (though an arbitrarily complex one!) in there at a time.
Most-everything else scans relatively sanely.
</p>
<p class="indented continuing">
I had been a little slow on the up-take on validation layers
(largely owing to the fact that the MSYS2 package didn't make them work and I didn't really want to fuck my whole shit up by installing something random;
 this is of course not an issue for users of normal distributions).
My concern was misplaced: the <a href="//vulkan.lunarg.com/sdk/home">upstream LunarG Vulkan SDK</a> Just Worked and didn't<!--'--> interfere with anything else.
The validation layers are, frankly, a marvel of a dynamic analysis suite (and they let you have <code>printf</code>-from-shader).
</p>
<p class="indented continuing">
What's<!--'--> a bit less of a wonder is the non-<code>printf</code> debugging sitch.
If you're rendering you use RenderDoc, but that doesn't capture compute pipelines.
Well it claims it does, experimentally, but I haven't<!--'--> managed to have that happen.
Vendor-specific tooling — in my case the Radeon Developer Panel — is presumably the only option,
but I haven't<!--'--> gotten it to work on my computer <em>and</em> with my GPU <em>and</em> with Vulkan.
Some part of the fire triangle's<!--'--> always failed to materialise for me.
</p>
<p class="indented continuation">
The <cite>Example</cite>'s seemingly-only fault is that it does not use memory barriers, and it's true that it seems to work fine without them,
but more complex programs (however they're<!--'--> defined, this one definitely fits!) do actually need them,
even in coherent memory and if no concurrent access occurs and everything is fence-synchronised.
These have been elided from the samples here because they're<!--'--> pretty verbose.
</p>
<p class="indented continued">
With this pre-amble/summary in mind and no fan-fare,
<cite>Example</cite>'s<!--'--> shader
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/717eb7c43782a031f821a8cc1df10f2f847ac0e5/item/src/main.rs#L105">works</a>.
Since <samp>known_rgbs</samp> could have anywhere [​[​\in [1, 2^{24}]​]​] elements (but is very unlikely to have actually that many),
a <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/a1543607b56281407859e802ba6c208935c59962/item/src/posterise_gpu.rs#L223">way to bump the buffers</a>
is nice.
</p>
<p class="indented continuing">
In
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/6f2d73df4c6088b9131b243299df2e7e11410c25">a</a>
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/b0fde746c954ad247215bb02c3b13f66fd88e67e">few</a>
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/5b770e4c68e212ee2b1507391ae9193c85e0e0a0">simple</a>
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/d738830007083b44ae75ba6654094d063dccec69">steps</a>
it can be expanded and adapted to implement
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/d738830007083b44ae75ba6654094d063dccec69/item/src/posterise.hlsl">the pre-computation step</a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->  <!--"-->known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float</span> radiussy<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->  <!--"-->iter_limit<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">known_rgbs_pack</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->   <!--"-->rgb<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">float3</span><span class="token operator">></span><!--"-->          <!--"-->outputs<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->  <!--"-->known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float</span> radiussy<!--"-->       <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>radiussy<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->  <!--"-->iter_limit<!--"-->     <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iter_limit<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>

<!--"-->	<!--"-->known_rgbs_pack <span class="token keyword">this</span> <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> center <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter <span class="token operator">&lt;</span> iter_limit<span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> newcenter<!--"-->     <!--"--><span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> known_rgbs_len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">length</span><span class="token punctuation">(</span>lab <span class="token operator">-</span> center<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->				<!--"-->newcenter_count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<!--"-->				<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> lab<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>

<!--"-->		<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">bool</span> same <span class="token operator">=</span> newcenter <span class="token operator">==</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/d738830007083b44ae75ba6654094d063dccec69/item/src/posterise_gpu.rs#L306">As driven by</a>
(initially the nomenclature was derived from posterisation instead of mean-shift clustering; this is be corrected later):
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">static</span> <span class="token constant">SHADER_DATA</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">ParamsT</span> <span class="token punctuation">{</span>
<!--"-->	<!--"-->known_rgbs_len<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->iter_limit<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">KnownRgbsPack</span> <span class="token punctuation">{</span>
<!--"-->	<!--"-->lab<span class="token punctuation">:</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->rgb<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->device<span class="token punctuation">:</span> <span class="token namespace">vulkanalia<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->compute_pipeline<span class="token punctuation">:</span> <span class="token namespace">vulkanalia<span class="token punctuation">::</span></span><span class="token class-name">Pipeline</span><span class="token punctuation">,</span>

<!--"-->	<!--"-->memory_type_index<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span><!--"-->                 <!--"--><span class="token comment">// HOST_VISIBLE &amp; HOST_COHERENT</span>
<!--"-->	<!--"-->buffer_outputs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->           <!--"--><span class="token comment">// [[vk::binding(0)]] <abbr title="StructuredBuffer">SB</abbr>&lt;float3><!--"-->          <!--"-->outputs;</span>
<!--"-->	<!--"-->buffer_params<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->            <!--"--><span class="token comment">// [[vk::binding(1)]] <abbr title="StructuredBuffer">SB</abbr>&lt;params_t><!--"-->        <!--"-->params;</span>
<!--"-->	<!--"-->buffer_known_rgbs_bundle<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span> <span class="token comment">// [[vk::binding(2)]] <abbr title="StructuredBuffer">SB</abbr>&lt;known_rgbs_pack> known_rgbs_bundle;</span>

<!--"-->	<!--"-->buffer_outputs_map<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->buffer_params_map<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token keyword">mut</span> <span class="token class-name">ParamsT</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>

<!--"-->	<!--"--><span class="token keyword">let</span> vk_shader_module <span class="token operator">=</span> vk_device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleCreateInfo</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">code_size</span><span class="token punctuation">(</span><span class="token constant">SHADER_DATA</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token constant">SHADER_DATA</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->dev<span class="token punctuation">.</span>compute_pipeline <span class="token operator">=</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> pipeline_shader_create_info <span class="token operator">=</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineShaderStageCreateInfo</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">stage</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">ShaderStageFlags</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span>vk_shader_module<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">b"main\0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> compute_pipeline_create_info <span class="token operator">=</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">ComputePipelineCreateInfo</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token punctuation">.</span><span class="token function">stage</span><span class="token punctuation">(</span>pipeline_shader_create_info<span class="token punctuation">)</span> <span class="token comment">/*...*/</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->vk_device<span class="token punctuation">.</span><span class="token function">create_compute_pipelines</span><span class="token punctuation">(</span>vk_pipeline_cache<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>compute_pipeline_create_info<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">swap_remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>

<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_outputs <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token class-name">BufferBundle</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_outputs_map <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">*</span>ret<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>buffer_outputs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_params <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token class-name">BufferBundle</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">ParamsT</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_params_map <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">*</span>ret<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>buffer_params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map <span class="token operator">=</span> <span class="token class-name">ParamsT</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->known_rgbs_len<span class="token punctuation">:</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		<!--"-->radiussy<span class="token punctuation">:</span> radiussy<span class="token punctuation">,</span>
<!--"-->		<!--"-->iter_limit<span class="token punctuation">:</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span>
<!--"-->	<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">let</span> buffer_known_rgbs_bundle_map <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_bundle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">KnownRgbsPack</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>buffer_known_rgbs_bundle_map<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> lab<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dest_lab<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->dest_lab <span class="token operator">=</span> <span class="token class-name">KnownRgbsPack</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->rgb<span class="token punctuation">:</span> rgb<span class="token punctuation">,</span>
<!--"-->			<!--"-->lab<span class="token punctuation">:</span> lab<span class="token punctuation">,</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">unmap_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">.</span>buffer_memory<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>descriptor_set <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">update_descriptor_sets</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">WriteDescriptorSet</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">begin_command_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_descriptor_sets</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>pipeline_layout<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>descriptor_set<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// cmd_pipeline_barrier(HOST -> COMPUTE_SHADER: (self.buffer_params, self.buffer_known_rgbs_bundle): HOST_WRITE -> SHADER_READ)</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* x */</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* y */</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* z */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// cmd_pipeline_barrier(COMPUTE_SHADER -> HOST: self.buffer_outputs: SHADER_WRITE -> HOST_READ)</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">end_command_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">reset_fences</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>fence<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">queue_submit</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>compute_queue<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">SubmitInfo</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">command_buffers</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fence<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">wait_for_fences</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>fence<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token punctuation">::</span><span class="token constant">MAX</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs <span class="token punctuation">{</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continued">
The <cite>Example</cite> mapped and unmapped the buffers every time at point of use, which seems to have no up-side:
<code>params</code> and <code>outputs</code> are always mapped.
</p>
<p class="indented continuing">
It uses [​[​\text{numthreads} = (1, 1, 1), \text{dispatch}(k, 1, 1)​]​], which is fine for its application.
On expert advice for "why is this so damn slow still",
I'd<!--'--> naively upgraded to [​[​\text{numthreads} = (64, 1, 1), \text{dispatch}(k, 1, 1)​]​]
(where [​[​k ={\ }​]​]<samp>known_rgbs.len()</samp>),
which exposes a glaring bug: the "threads" dispatched in each dimension are
[​[​\prod_{x \in \text{numthreads} \odot \text{dispatch}} [0, x )\ (\text{all in}\ \mathbb{Z})​]​],
so, in this case,
[​[​[0, 64n ) \times [0, 1 ) \times [0, 1 )​]​]
instead of the desired
[​[​[0, \mathbin{\approx}k ) \times [0, 1 )^2​]​]
(which took even longer, hence why <samp>iter_limit</samp> to avoid spinning forever in uninitialised memory out of bounds).
</p>
<p class="indented continuing">
I've<!--'--> only <em>just now</em> realised
<a href="//vulkan-tutorial.com/Compute_Shader"><cite>Vulkan Tutorial, Compute Shader</cite>, Alexander Overvoorde &a.</a>
describes this
(hint: it's not <cite>Running compute commands, Dispatch</cite>! it's actually <cite>Compute Space</cite>!)
and I don't<!--'--> think it does a great job of it:
the description is incredibly wordy and disconnected from where the other "<!--"--><span class="roboto-unscale math-font-normal">256</span><!--"-->" is,
defines only the edge-case when [​[​k \bmod 64 = 0​]​],
and the shader is not prepared for the ignore-if-past-the-end situation.
Also, the way this maps to the variables/globals is not referenced at all.
</p>
<p class="indented continuing">
I've<!--'--> found
<a href="//learn.microsoft.com/en-us/windows/win32/direct3dhlsl/sm5-attributes-numthreads"><cite>Direct3D / HLSL / numthreads</cite>, Microsoft Learn</a>
to surprisingly be the best here, and the explanatory figure, while more schizo, actually more informative.
The correct implementation is
[​[​\text{numthreads} = (64, 1, 1), \text{dispatch}(\lceil\frac{k}{64}\rceil, 1, 1)​]​]
which yields
[​[​[1, k+\varepsilon ) \times [0, 1 )^2​]​]
where
[​[​\varepsilon \in [0, 64 )​]​].
The former can be conveniently
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/c775fb81e66c09b29dbc191d4aee55ec14124340">
 expressed builtinly as <code><small><small>known_rgbs.len()</small></small>.div_ceil(64)</code></a>
and the latter rejected with
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> current_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuing">
this appears canonical, but honestly I haven't<!--'--> found a model would satisfactorily define the appx. 10 different views into the job dispatch matrix.
(Personal failing.)
</p>
<p class="indented continuation">
Why <span class="roboto-unscale math-font-normal">64</span> specifically? I measured and everything else is worse. Something to do with compute unit sizes or whatever? Unclear.
</p>
<p class="indented continued">
That bit about the <cite>Example</cite> having one fault? Not true actually. It doesn't<!--'--> mention fence resetting.
If you're like me, god forbid, and don't intently read through <span class="roboto-unscale math-font-normal">60%</span> of the <cite>Vulkan Tutorial</cite>
(since you're<!--'--> actually reading <cite>Vulkan Tutorial (Rust)</cite> which only mentions it in <cite>Rendering and presentation</cite>),
and be directed to consume
<a href="//docs.vulkan.org/guide/latest/synchronization_examples.html"><cite>Vulkan Guide / Using Vulkan / Synchronization / Synchronization Examples</cite></a>
in its entirety; it's instructive and honestly the best piece of documentation mentioned so far, but still doesn't mention that
you indeed have missed the need for the <samp>reset_fences()</samp> call and this was worth two hours.
</p>
<p class="indented continuation">
The fence overall is unnecessary if not scheduling multiple shaders at once, and can be replaced with a <samp>queue_wait_idle()</samp> call,
but if you're waiting on it and it's already completed once then it'll<!--'--> just not block again.
</p>
<p class="indented continued">
One may note the mismatch of <samp>outputs</samp> being <samp><abbr title="StructuredBuffer">SB</abbr>&lt;float3></samp> but then also <samp>[[f32; 4]; …]</samp>,
as well as <samp>params</samp> also being in a <samp><abbr title="StructuredBuffer">SB</abbr></samp> even though there's<!--'--> only one of them, ever.
This is due to a confluence of two HLSL oddities:
</p>
<ul>
 <li>arrays have either a <span class="roboto-unscale math-font-normal">4</span>-byte or a <span class="roboto-unscale math-font-normal">16</span>-byte alignment</li>
 <li>globals not part of a <abbr title="StructuredBuffer">SB</abbr> are collected and encapsulated into a single global you can't<!--'--> control</li>
</ul>
<p class="continuing">
thus, <samp><abbr title="StructuredBuffer">SB</abbr>&lt;float3></samp> is actually <samp><abbr title="StructuredBuffer">SB</abbr>&lt;(float3, <var>4 unused bytes</var>)</samp>,
which also means that <samp>known_rgbs_bundle</samp> is packed optimally.
Arrays whose elements are <span class="roboto-unscale math-font-normal">1</span>/<span class="roboto-unscale math-font-normal">2</span> scalars (<span class="roboto-unscale math-font-normal">4</span>/<span class="roboto-unscale math-font-normal">8</span> bytes) are <span class="roboto-unscale math-font-normal">4</span>-byte-aligned.
Larger arrays are <span class="roboto-unscale math-font-normal">16</span>-byte-aligned.
Structures are, functionally, arrays of their elements as well:
<samp>struct { float3, float3 }</samp> has a padding scalar between them, which you can use if you want
(this explains the goofy lay-out of <samp>params_t</samp> later).
This, AIUI, corresponds to <a href="//www.khronos.org/opengl/wiki/Interface_Block_(GLSL)#Memory_layout">GLSL <code>std430</code>/<code>std140</code> layouts</a>,
except determined automagically and you have to validate the layout yourself sometimes. Fun!
</p>
<p class="indented continued">
This is a direct port of the CPU implementation above (sans square distance optimisation), and only of [​[​palette​]​].
The hawk-<del>tuah'd<!--'--></del>eyed reader has spotted that <samp>center</samp> is redundant,
and so is <samp>bool same</samp>, except the assignment from <samp>bool3</samp> acts like an <samp>all()</samp>
(every operator is piece-wise, and <code>==</code> is no exception;
 some-how for other types this is obvious to me, but for <samp>bool<var>n</var></samp> it's<!--'--> consistently failed to internalise.
 Personal failing 2).
With the dispatching fixed
(all times measured hence include copying <samp>buffer_outputs_map</samp> to <samp>outputs</samp>):
</p>
<!--
133.89395ms: MSC 16755 RGBs @ r=0.02
132.278692ms: MSC 16755 RGBs @ r=0.02
132.397927ms: MSC 16755 RGBs @ r=0.02
132.768914ms: MSC 16755 RGBs @ r=0.02
132.847398ms: MSC 16755 RGBs @ r=0.02
133.231666ms: MSC 16755 RGBs @ r=0.02
132.880603ms: MSC 16755 RGBs @ r=0.02
133.29385ms: MSC 16755 RGBs @ r=0.02
132.134101ms: MSC 16755 RGBs @ r=0.02
132.594136ms: MSC 16755 RGBs @ r=0.02
132.340574ms: MSC 16755 RGBs @ r=0.02
132.387664ms: MSC 16755 RGBs @ r=0.02
132.431132ms: MSC 16755 RGBs @ r=0.02
132.790648ms: MSC 16755 RGBs @ r=0.02
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th>±σ</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">132.734ms</span></td> <td><span class="roboto-unscale math-font-normal">464µs</span></td></tr>
 <tr><th>(speed-up vs <span class="roboto-unscale math-font-normal">8×</span>)</th> <td><span class="roboto-unscale math-font-normal">40.782×</span></td> <td></td></tr>
</table>
<p class="indented continued">
The memory lay-out is largely replicated directly as well (this is not fast or good, but it <em>is</em> drop-in):
<code>outputs</code> is fixed-size since it's<!--'--> a scatter output, but
<code>known_rgbs_bundle</code> is only as big as <code>known_rgbs</code> (distinct colours in [​[​I​]​]),
so it can be bumped if the new size required is larger than the last size.
Since
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/d738830007083b44ae75ba6654094d063dccec69/item/src/posterise_gpu.rs#L277">
 reallocating means "free, allocate"</a>,
it can't<!--'--> be mapped for any longer.
At least we get the real allocated size as SOP, so if there's<!--'--> any rounding up (there is), we are aware and can skip extraneous allocations.
</p>
<p class="indented continuation">
This could, in principle, function as Just A Faster Implementation,
but my Win32 amdgpu-equivalent driver kills the shader and returns <code>TIMEOUT</code> if it takes longer than <span class="roboto-unscale math-font-normal">~8s</span>
(which is honestly better than any alternative
 and we see how many values were fully-computed since <samp>outputs</samp> was updated by the threads that did manage to finish).
</p>
<!-- TODO: "if you don't care about theory or baseline, optimisations and visualisations start here:" -->
<p class="indented continued">
By observing that <code>length(v)</code> [​[​= \sqrt{v_x^2 + v_y^2 + v_z^2} = \sqrt{v_xv_x + v_yv_y + v_zv_z} = \sqrt{v \cdot v} =​]​] <samp>sqrt(dot(v, v))</samp>
(though it actually lowers directly into <samp>OpExtInst %float (OpExtInstImport "GLSL.std.450") Length %v</samp>
 instead of <samp>OpExtInst %float %… Sqrt %(OpDot %float %v %v)</samp>),
the obvious optimisation
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/c775fb81e66c09b29dbc191d4aee55ec14124340/item/src/posterise.hlsl#L37">can be restored</a>
(with dispatching fixed likewise):
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->  <!--"-->known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float</span> radiussy_squared<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->  <!--"-->iter_limit<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<!--"-->			<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre>
</div>
<!--
131.509551ms: MSC 16755 RGBs @ r=0.02
130.764257ms: MSC 16755 RGBs @ r=0.02
128.677796ms: MSC 16755 RGBs @ r=0.02
128.893324ms: MSC 16755 RGBs @ r=0.02
128.664212ms: MSC 16755 RGBs @ r=0.02
128.670249ms: MSC 16755 RGBs @ r=0.02
128.26817ms: MSC 16755 RGBs @ r=0.02
128.932868ms: MSC 16755 RGBs @ r=0.02
128.632819ms: MSC 16755 RGBs @ r=0.02
128.684135ms: MSC 16755 RGBs @ r=0.02
128.405215ms: MSC 16755 RGBs @ r=0.02
128.015211ms: MSC 16755 RGBs @ r=0.02
128.892419ms: MSC 16755 RGBs @ r=0.02
128.797635ms: MSC 16755 RGBs @ r=0.02
127.827756ms: MSC 16755 RGBs @ r=0.02
128.304998ms: MSC 16755 RGBs @ r=0.02
-->
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">128.871ms</span></td></tr>
 <tr><th>(speed-up vs previous)</th> <td><span class="roboto-unscale math-font-normal">2.91%</span></td></tr>
</table>
<p class="continued">
Now all it takes for the
</p>
<h2 id="baseline" class="continuing"><a class="hash-link" href="#baseline">#</a> base-line</h2>
<p class="continuation">
port is implementing [​[​*freq​]​].
<samp>glslc</samp>'s<!--'--> preprocessor implementation allows a de-duplicated implementation, much like the <code>#[cfg]</code>s prior;
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/f39afc33ecb09cae66629b00d8a1461d0895f8be/item/src/posterise_kernel.hlsl.inc"><samp>posterise_kernel.hlsl.inc</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->  <!--"-->known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float</span> radiussy_squared<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">int</span><!--"-->   <!--"-->iter_limit<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">known_rgbs_pack</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->   <!--"-->rgb<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">float3</span><span class="token operator">></span><!--"-->          <!--"-->outputs<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span>
</small>KNOWN_RGBS_FREQS

<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->  <!--"-->known_rgbs_len<!--"-->   <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float</span> radiussy_squared <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>radiussy_squared<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->  <!--"-->iter_limit<!--"-->       <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iter_limit<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"-->known_rgbs_pack <span class="token keyword">this</span> <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> center <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iter_limit<span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> newcenter<!--"-->     <!--"--><span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> known_rgbs_len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->				<!--"-->FREQ_LOAD
<!--"-->				<!--"-->newcenter_count <span class="token operator">+=</span> FREQ<span class="token punctuation">;</span>
<!--"-->				<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> lab TIMES_FREQ<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>

<!--"-->		<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">bool</span> same <span class="token operator">=</span> newcenter <span class="token operator">==</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continued">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/f39afc33ecb09cae66629b00d8a1461d0895f8be/item/src/posterise.hlsl"><samp>posterise.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">KNOWN_RGBS_FREQS</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_LOAD</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ</span><!--"-->             <!--"--><span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">TIMES_FREQ</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"posterise_kernel.hlsl.inc"</span></span>
</code></pre>
</div>
<p class="continued">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/f39afc33ecb09cae66629b00d8a1461d0895f8be/item/src/posterise_mul.hlsl"><samp>posterise_mul.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">KNOWN_RGBS_FREQS</span> <span class="token expression"><span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint4</span><span class="token operator">></span> known_rgbs_freqs<span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_LOAD</span><!--"-->        <!--"--><span class="token expression"><span class="token keyword">uint</span> freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ</span><!--"-->             <!--"--><span class="token expression">freq</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">TIMES_FREQ</span><!--"-->       <!--"--><span class="token expression"><span class="token operator">*</span> freq</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"posterise_kernel.hlsl.inc"</span></span>
</code></pre>
</div>
<p class="continued">These expand to</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> known_rgbs_len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->newcenter_count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">and</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> known_rgbs_len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">uint</span> freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->newcenter_count <span class="token operator">+=</span> freq<span class="token punctuation">;</span>
<!--"-->		<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> lab <span class="token operator">*</span> freq<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuation">respectively.</p>
<p class="indented continued">
<samp>known_rgbs_freqs</samp> being an array of <samp>uint4</samp>s is unfortunate and unnecessary,
but the minutiae of automagic layout bull shit were not obvious to me at the time.
This is functionally-equivalent to an array of <samp>uint</samp>s being indexed by <samp>i</samp> directly.
</p>
<p class="indented continuing">
By storing the population data separately with the same indexing, the optimal zero-padding layout is preserved
(adding it into a <samp>known_rgbs_pack</samp> would mean <code>{ (float3, uint), (uint, 3 4-byte padding primitives) }</code>),
and the population can be only loaded when necessary, which minimises performance impact.
</p>
<p class="indented continuation">
Since the uniforms
(<samp>[[vk::binding]]</samp>-tagged <samp>StructuredBuffer</samp>s;
 it's<!--'--> unclear why some literature calls them "uniforms", Vulkan calls them <q>bindings</q> or <q>bound descriptor sets</q> and the like universally AFAICT)
use a global indexing system defined by the host,
any shader can use any subset of them.
This will be (ab)used extensively, and every shader will be <em>given</em> all of them,
but will pick out and <samp>RW</samp>-mark only the ones it cares about.
Nominally, Vulkan only has <a href="//docs.vulkan.org/spec/latest/chapters/limits.html#:~:text=4%20(Vulkan%20Core)"><span class="roboto-unscale math-font-normal">4</span></a> bindings in baseline,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/2508571dbb073202d12a7fed0a2e21554f3729cb/item/src/posterise_gpu.rs#L320">
 but you just ask for however-many you need</a>
and abort; it may be nice to
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/2508571dbb073202d12a7fed0a2e21554f3729cb/item/src/posterise_gpu.rs#L212">check before-hand</a>,
but the value is marginal since all GPUs mentioned heretofore support <span class="roboto-unscale math-font-normal">32</span>.
</p>
<p class="indented continued">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/f39afc33ecb09cae66629b00d8a1461d0895f8be/item/src/posterise_gpu.rs#L371">The driver</a>
requires minimal modification,
functionally duplicating most of it
(this can
 <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/270a63db8c15961d2e83012032f5832971ec8e83">be</a>
 <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/eb2cd3843efe5f0545031748ec855ccb551495fc">instrumented</a>
 <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/8534e8f9ac5b5ab9bc91b320a8b55a98bccd83c6">well</a>
 with <code>[Т; N].map()</code>;
 suffers a bit with Rust's<!--'--> lack of C-style auto-incrementing self-referential enums. ah well):
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->device<span class="token punctuation">:</span> <span class="token namespace">vulkanalia<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->compute_pipeline<span class="token punctuation">:</span> <span class="token namespace">vulkanalia<span class="token punctuation">::</span></span><span class="token class-name">Pipeline</span><span class="token punctuation">,</span><!--"-->     <!--"--><span class="token comment">// posterise.hlsl</span>
<!--"-->	<!--"-->compute_pipeline_mul<span class="token punctuation">:</span> <span class="token namespace">vulkanalia<span class="token punctuation">::</span></span><span class="token class-name">Pipeline</span><span class="token punctuation">,</span> <span class="token comment">// posterise_mul.hlsl</span>

<!--"-->	<!--"-->memory_type_index<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span><!--"-->                 <!--"--><span class="token comment">// HOST_VISIBLE &amp; HOST_COHERENT</span>
<!--"-->	<!--"-->buffer_outputs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->           <!--"--><span class="token comment">// [[vk::binding(0)]] <abbr title="StructuredBuffer">SB</abbr>&lt;float3><!--"-->          <!--"-->outputs;</span>
<!--"-->	<!--"-->buffer_params<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->            <!--"--><span class="token comment">// [[vk::binding(1)]] <abbr title="StructuredBuffer">SB</abbr>&lt;params_t><!--"-->        <!--"-->params;</span>
<!--"-->	<!--"-->buffer_known_rgbs_bundle<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span> <span class="token comment">// [[vk::binding(2)]] <abbr title="StructuredBuffer">SB</abbr>&lt;known_rgbs_pack> known_rgbs_bundle;</span>
<!--"-->	<!--"-->buffer_known_rgbs_freqs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->  <!--"--><span class="token comment">// [[vk::binding(3)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint4><!--"-->           <!--"-->known_rgbs_freqs;</span>

<!--"-->	<!--"-->buffer_outputs_map<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->buffer_params_map<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token keyword">mut</span> <span class="token class-name">ParamsT</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">if</span> freq_weighting <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map <span class="token operator">=</span> <span class="token class-name">ParamsT</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->known_rgbs_len<span class="token punctuation">:</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		<!--"-->radiussy<span class="token punctuation">:</span> radiussy<span class="token punctuation">,</span>
<!--"-->		<!--"-->iter_limit<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
<!--"-->	<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">let</span> buffer_known_rgbs_bundle_map <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_bundle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">KnownRgbsPack</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>buffer_known_rgbs_bundle_map<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> lab<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dest_lab<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->dest_lab <span class="token operator">=</span> <span class="token class-name">KnownRgbsPack</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->rgb<span class="token punctuation">:</span> rgb<span class="token punctuation">,</span>
<!--"-->			<!--"-->lab<span class="token punctuation">:</span> lab<span class="token punctuation">,</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">unmap_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">.</span>buffer_memory<span class="token punctuation">)</span><span class="token punctuation">;</span>
</small>
<!--"-->	<!--"--><span class="token keyword">if</span> freq_weighting <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> buffer_known_rgbs_freqs_map <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>buffer_known_rgbs_freqs_map<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">_</span><span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">,</span> freq<span class="token punctuation">)</span><span class="token punctuation">,</span> dest_freq<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->dest_freq <span class="token operator">=</span> freq<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">unmap_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">.</span>buffer_memory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>descriptor_set <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">update_descriptor_sets</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">WriteDescriptorSet</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token comment">/* … */</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span>
<!--"-->		<!--"--><span class="token keyword">if</span> freq_weighting <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline_mul <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// cmd_pipeline_barrier(HOST -> COMPUTE_SHADER: also self.buffer_known_rgbs_freqs: HOST_WRITE -> SHADER_READ)</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token comment">/* x */</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* y */</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* z */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">queue_submit</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>compute_queue<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">SubmitInfo</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">command_buffers</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>fence<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">wait_for_fences</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>fence<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token punctuation">::</span><span class="token constant">MAX</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs <span class="token punctuation">{</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
</small><span class="token punctuation">}</span>
</code></pre>
</div>
<!--
128.144106ms: MSC 16755 RGBs @ r=0.02
128.177613ms: MSC 16755 RGBs @ r=0.02
128.442344ms: MSC 16755 RGBs @ r=0.02
128.811218ms: MSC 16755 RGBs @ r=0.02
128.832952ms: MSC 16755 RGBs @ r=0.02
128.842008ms: MSC 16755 RGBs @ r=0.02
128.992032ms: MSC 16755 RGBs @ r=0.02
129.257972ms: MSC 16755 RGBs @ r=0.02
130.182874ms: MSC 16755 RGBs @ r=0.02
117.729005ms: MSC 16755 RGBs @ r=0.02 * freq
118.237942ms: MSC 16755 RGBs @ r=0.02 * freq
118.579045ms: MSC 16755 RGBs @ r=0.02 * freq
118.659038ms: MSC 16755 RGBs @ r=0.02 * freq
118.93192ms: MSC 16755 RGBs @ r=0.02 * freq
119.173711ms: MSC 16755 RGBs @ r=0.02 * freq
119.270306ms: MSC 16755 RGBs @ r=0.02 * freq
119.304416ms: MSC 16755 RGBs @ r=0.02 * freq
119.886404ms: MSC 16755 RGBs @ r=0.02 * freq
-->
<!-- degen
130.761842ms: MSC 16551 RGBs @ r=0.02
129.650089ms: MSC 16551 RGBs @ r=0.02
128.817557ms: MSC 16551 RGBs @ r=0.02
131.554226ms: MSC 16551 RGBs @ r=0.02
129.37781ms: MSC 16551 RGBs @ r=0.02
129.660654ms: MSC 16551 RGBs @ r=0.02
129.700801ms: MSC 16551 RGBs @ r=0.02
129.202732ms: MSC 16551 RGBs @ r=0.02
140.024439ms: MSC 16551 RGBs @ r=0.02
152.30685ms: MSC 16551 RGBs @ r=0.02 * freq
152.046344ms: MSC 16551 RGBs @ r=0.02 * freq
151.280825ms: MSC 16551 RGBs @ r=0.02 * freq
151.888169ms: MSC 16551 RGBs @ r=0.02 * freq
152.333414ms: MSC 16551 RGBs @ r=0.02 * freq
151.681395ms: MSC 16551 RGBs @ r=0.02 * freq
151.656642ms: MSC 16551 RGBs @ r=0.02 * freq
151.70011ms: MSC 16551 RGBs @ r=0.02 * freq
-->
<p></p>
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">128.854ms</span></td> <td><span class="roboto-unscale math-font-normal">118.864ms</span></td> <td><span class="roboto-unscale math-font-normal">92.25%</span></td></tr>
 <tr><th>(speed-up vs previous)</th> <td><span class="roboto-unscale math-font-normal">&lt;0.015%</span></td></tr>
 <tr><th>(speed-up vs <span class="roboto-unscale math-font-normal">8×</span>) </th> <td><span class="roboto-unscale math-font-normal">42.010×</span></td> <td><span class="roboto-unscale math-font-normal">33.047×</span></td> <td><span class="roboto-unscale math-font-normal">-27.09 p.p.</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">130.972ms</span></td> <td><span class="roboto-unscale math-font-normal">151.862ms</span></td> <td><span class="roboto-unscale math-font-normal">115.95%</span></td></tr>
 <tr><th>(speed-up vs <span class="roboto-unscale math-font-normal">8×</span>) </th> <td><span class="roboto-unscale math-font-normal">42.450×</span></td> <td><span class="roboto-unscale math-font-normal">28.986×</span></td> <td><span class="roboto-unscale math-font-normal">-47.16 p.p.</span></td></tr>
</table>
<p class="continuation">
[​[​*freq​]​] being <span class="roboto-unscale math-font-normal">16%</span> slower than [​[​palette​]​] finally matches the expectation based on complexity;
[​[​palette​]​] hasn't changed, and it's dead-on the same.
</p>
<!--
117.440089ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
117.696671ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
118.312466ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels => ~326 levels
118.807216ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
119.192994ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
119.252763ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
119.534398ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
119.787056ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
119.788564ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
119.887575ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
120.217509ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
120.359986ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
120.446017ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
120.492504ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
120.628945ms: MSC 16755 RGBs @ r=0.02 * freq
120.653395ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
120.856548ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
121.619651ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels => ~326 levels
122.005429ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
122.273783ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
123.074016ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
125.817326ms: MSC 16755 RGBs @ r=0.02 * freq
126.925757ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
128.349937ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.486075ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.497245ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.497848ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.650891ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.651495ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.696774ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.779484ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
128.967543ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.012218ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.066251ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.070477ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.140208ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.199976ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.230463ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
129.538361ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
130.615702ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
130.9885ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
131.493211ms: MSC 16755 RGBs @ r=0.02 * freq => ~326 levels
133.880627ms: MSC 16755 RGBs @ r=0.02 => ~374 levels
1.408633879s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.413820146s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.414813267s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.502014467s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.539915183s: MSC 27868 RGBs @ r=0.02 => ~375 levels
358.723033ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
359.591486ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
359.63284ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
360.937181ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
360.940803ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
361.194366ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
362.09542ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
362.569944ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
362.780945ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
362.858222ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
363.61227ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
364.650972ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
364.657311ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
365.616625ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
365.648319ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
367.043218ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
369.707439ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
549.411719ms: MSC 27868 RGBs @ r=0.02 * freq => ~314 levels
4.069722261s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
4.071719371s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
4.074846346s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
4.082433009s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
4.09511176s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
5.049841115s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
5.05223155s: MSC 84860 RGBs @ r=0.02 * freq => ~246 levels
6.408489287s: MSC 84860 RGBs @ r=0.02 => ~253 levels
6.439148971s: MSC 84860 RGBs @ r=0.02 => ~253 levels
6.512570835s: MSC 84860 RGBs @ r=0.02 => ~253 levels
6.589172199s: MSC 84860 RGBs @ r=0.02 => ~253 levels
7.081478827s: MSC 84860 RGBs @ r=0.02 => ~253 levels
10.029253013s: MSC 242931 RGBs @ r=0.02 => ~164 levels
11.406315287s: MSC 242931 RGBs @ r=0.02 => ~47 levels
12.132425055s: MSC 242931 RGBs @ r=0.02 * freq => ~119 levels
13.11694051s: MSC 242931 RGBs @ r=0.02
8.12245339s: MSC 242931 RGBs @ r=0.02 * freq => ~102 levels
8.131820126s: MSC 242931 RGBs @ r=0.02 * freq => ~101 levels
8.213075576s: MSC 242931 RGBs @ r=0.02 => ~47 levels
8.396321586s: MSC 242931 RGBs @ r=0.02 * freq => ~102 levels
8.441057031s: MSC 242931 RGBs @ r=0.02 * freq => ~257 levels
8.597974153s: MSC 242931 RGBs @ r=0.02
8.210028897s: MSC 328666 RGBs @ r=0.02 * freq => ~78 levels
8.256442083s: MSC 328666 RGBs @ r=0.02 * freq => ~80 levels
8.27315822s: MSC 328666 RGBs @ r=0.02 => ~0 levels
8.395476981s: MSC 328666 RGBs @ r=0.02 * freq => ~80 levels
8.495603853s: MSC 328666 RGBs @ r=0.02 * freq => ~80 levels
8.706273298s: MSC 328666 RGBs @ r=0.02 => ~0 levels
8.857629543s: MSC 328666 RGBs @ r=0.02 => ~0 levels
9.169807174s: MSC 328666 RGBs @ r=0.02 => ~0 levels
8.322882214s: MSC 1103347 RGBs @ r=0.02 => ~167 levels
8.323038577s: MSC 1103347 RGBs @ r=0.02 * freq => ~1588 levels
8.33273253s: MSC 1103347 RGBs @ r=0.02 * freq => ~1614 levels
8.349162503s: MSC 1103347 RGBs @ r=0.02 => ~167 levels
8.496501586s: MSC 1103347 RGBs @ r=0.02 * freq => ~1605 levels
8.597345377s: MSC 1103347 RGBs @ r=0.02 * freq => ~1657 levels
8.851706433s: MSC 1103347 RGBs @ r=0.02 => ~183 levels
9.036816735s: MSC 1103347 RGBs @ r=0.02 * freq => ~1669 levels
9.726707452s: MSC 1103347 RGBs @ r=0.02 => ~272 levels
9.73934515s: MSC 1103347 RGBs @ r=0.02 => ~276 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02
 Time (mean ± σ): 129.332636 ms ± 1.262236 ms
 Range (min … max): 128.349937 ms … 133.880627 ms 19 runs
 levels = 374
Benchmark 3: MSC 84860 RGBs @ r=0.02
 Time (mean ± σ): 6606.172024 ms ± 245.740472 ms
 Range (min … max): 6408.489287 ms … 7081.478827 ms 5 runs
 levels = 253
Benchmark 4: MSC 328666 RGBs @ r=0.02
 Time (mean ± σ): 8751.717059 ms ± 322.916590 ms
 Range (min … max): 8273.158220 ms … 9169.807174 ms 4 runs
 levels = 0
Benchmark 2: MSC 27868 RGBs @ r=0.02
 Time (mean ± σ): 1455.839388 ms ± 54.549054 ms
 Range (min … max): 1408.633879 ms … 1539.915183 ms 5 runs
 levels = 375
Benchmark 6: MSC 242931 RGBs @ r=0.02
 Time (mean ± σ): 10272.711708 ms ± 1815.533727 ms
 Range (min … max): 8213.075576 ms … 13116.940510 ms 5 runs
 levels AVG = 105.50
Benchmark 5: MSC 1103347 RGBs @ r=0.02
 Time (mean ± σ): 8997.960750 ms ± 629.091902 ms
 Range (min … max): 8322.882214 ms … 9739.345150 ms 5 runs
 levels AVG = 224.50
Benchmark 1: MSC 16755 RGBs @ r=0.02 * freq
 Time (mean ± σ): 121.106828 ms ± 3.065921 ms
 Range (min … max): 117.440089 ms … 131.493211 ms 24 runs
 levels = 326
Benchmark 3: MSC 84860 RGBs @ r=0.02 * freq
 Time (mean ± σ): 4356.557916 ms ± 439.296687 ms
 Range (min … max): 4069.722261 ms … 5052.231550 ms 7 runs
 levels = 246
Benchmark 4: MSC 328666 RGBs @ r=0.02 * freq
 Time (mean ± σ): 8339.387954 ms ± 113.096385 ms
 Range (min … max): 8210.028897 ms … 8495.603853 ms 4 runs
 levels AVG = 79
Benchmark 2: MSC 27868 RGBs @ r=0.02 * freq
 Time (mean ± σ): 373.426229 ms ± 42.770536 ms
 Range (min … max): 358.723033 ms … 549.411719 ms 18 runs
 levels = 314
Benchmark 6: MSC 242931 RGBs @ r=0.02 * freq
 Time (mean ± σ): 9044.815438 ms ± 1549.368505 ms
 Range (min … max): 8122.453390 ms … 12132.425055 ms 5 runs
 levels AVG = 144.75
Benchmark 5: MSC 1103347 RGBs @ r=0.02 * freq
 Time (mean ± σ): 8557.286961 ms ± 260.977141 ms
 Range (min … max): 8323.038577 ms … 9036.816735 ms 5 runs
 levels AVG = 1626.60
-->
<!-- correct:
75.320871ms: MSC 16755 RGBs @ r=0.02 => ~373 levels "00.png"
57.042002ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels "00.png"
3.044225602s: MSC 84860 RGBs @ r=0.02 => ~245 levels "B.png"
3.24351943s: MSC 84860 RGBs @ r=0.02 * freq => ~239 levels "B.png"
31.683639787s: MSC 242931 RGBs @ r=0.02 => ~155 levels "CDSCN9810.JPG"
21.704893795s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels "CDSCN9810.JPG"
962.487778ms: MSC 27868 RGBs @ r=0.02 => ~375 levels "0image.png"
303.43454ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels "0image.png"
39.544885922s: MSC 328666 RGBs @ r=0.02 => ~220 levels "DSCN9773.JPG"
29.72736913s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels "DSCN9773.JPG"
12.044628586s: MSC 615718 RGBs @ r=0.02 => ~6505 levels "x002. fluorescent heart.png"
3.875955502s: MSC 615718 RGBs @ r=0.02 * freq => ~5075 levels "x002. fluorescent heart.png"
-->
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">129.33ms</span></td> <td><span class="roboto-unscale math-font-normal">6.606s</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~106</span>/<span class="roboto-unscale math-font-normal">155</span>]</td> <td><span class="roboto-unscale math-font-normal">1.262ms</span>/<span class="roboto-unscale math-font-normal">245.740ms</span></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">121.11ms</span></td> <td><span class="roboto-unscale math-font-normal">4.357s</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~145</span>/<span class="roboto-unscale math-font-normal">152</span>]</td> <td><span class="roboto-unscale math-font-normal">3.066ms</span>/<span class="roboto-unscale math-font-normal">439.297ms</span></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">1.456s</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">0</span>/<span class="roboto-unscale math-font-normal">220</span>]</td> <td>[time-out; <span class="roboto-unscale math-font-normal">~225</span>/<span class="roboto-unscale math-font-normal">6505</span>]</td> <td><span class="roboto-unscale math-font-normal">54.549ms</span></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">373.43ms</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~79</span>/<span class="roboto-unscale math-font-normal">132</span>]</td> <td>[time-out; <span class="roboto-unscale math-font-normal">~1627</span>/<span class="roboto-unscale math-font-normal">5075</span>]</td> <td><span class="roboto-unscale math-font-normal">42.771ms</span></td></tr>
 <tfoot class="label"><tr><td colspan=4> Computation of cells labelled <q>time-out</q> was terminated by the driver after like <span class="roboto-unscale math-font-normal">8-11s</span>; progress corresponds to <em>how many distinct output colours</em> <span style="white-space: nowrap;">([​[​\overline{Set(O)}​]​])</span> were produced vs. a correct implementation; this is a very vague proxy measured for a very vague amount of time. </td></tr></tfoot>
</table>
<div class="singles">
<figure> <a href="/content/assets/blogn_t/018.13-graphml-baseline.png"><img alt="" src="/content/assets/blogn_t/018.13-graphml-baseline.png" /></a> <figcaption></figcaption> </figure>
</div>
<p class="indented continued">
So far, all buffers have been allocated in <samp>HOST_VISIBLE & HOST_COHERENT</samp> memory like in the <cite>Example</cite>, which was basically fine,
but proper usage of
</p>
<h2 id="memory-types" class="continuing"><a class="hash-link" href="#memory-types">#</a> memory types</h2>
<p class="continuation">
is required to achieve best performance with the widest device support matrix.
<a href="//registry.khronos.org/vulkan/specs/latest/man/html/vkGetPhysicalDeviceMemoryProperties.html">
 <code>vk_instance.<wbr>get_physical_device_memory_properties<wbr>(physical_device)</code></a>
yields a list of memory types, already sorted by preference.
Thus, "a <!--"-->[​[​Q​]​]<!--"--> memory" is commonly taken to mean "the first memory type that satisfies predicate <!--"-->[​[​Q​]​]<!--"-->",
and since memory features are typified by <a href="//registry.khronos.org/vulkan/specs/latest/man/html/VkMemoryPropertyFlagBits.html">bitmask</a>,
the predicate is mostly expressed as a conjunction of desired bits.
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/91d951285a89f501ffa9b08fc1ed6392012813ef/item/src/posterise_gpu.rs#L130">
 Listing the memory types on the GPUs in question</a>
yields:
</p>
<table class="memtype">
 <caption>AMD Radeon RX 5700 XT THICC II [<a href="//en.wikipedia.org/wiki/Radeon_RX_5000_series#Desktop"><span class="roboto-unscale math-font-normal">8GiB</span></a> on device, <span class="roboto-unscale math-font-normal">16GiB</span> on host]</caption>
 <tr><td><span class="roboto-unscale math-font-normal">7920MiB</span></td> <td><!--"-->DEVICE_LOCAL<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">7909MiB</span></td> <td><!--"-->HOST_VISIBLE | HOST_COHERENT<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">256MiB</span></td> <td><!--"-->DEVICE_LOCAL | HOST_VISIBLE  | HOST_COHERENT<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">7909MiB</span></td> <td><!--"-->HOST_VISIBLE | HOST_COHERENT | HOST_CACHED<!--"--></td></tr>
 <tr><td colspan=2>(these repeat with <samp>| DEVICE_COHERENT_AMD | DEVICE_UNCACHED_AMD</samp> set)</td></tr>
</table>
<table class="memtype">
 <caption>AMD Radeon RX 6500 XT (RADV NAVI24) [<a href="//en.wikipedia.org/wiki/Radeon_RX_6000_series#Desktop"><span class="roboto-unscale math-font-normal">4GiB</span></a> on device, <span class="roboto-unscale math-font-normal">64GiB</span> on host]</caption>
 <tr><td><span class="roboto-unscale math-font-normal">4080MiB</span></td> <td><!--"-->DEVICE_LOCAL<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">4080MiB</span></td> <td><!--"-->DEVICE_LOCAL<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">32110MiB</span></td> <td><!--"-->HOST_VISIBLE | HOST_COHERENT<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">4080MiB</span></td> <td><!--"-->DEVICE_LOCAL | HOST_VISIBLE  | HOST_COHERENT<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">4080MiB</span></td> <td><!--"-->DEVICE_LOCAL | HOST_VISIBLE  | HOST_COHERENT<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">32110MiB</span></td> <td><!--"-->HOST_VISIBLE | HOST_COHERENT | HOST_CACHED<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">32110MiB</span></td> <td><!--"-->HOST_VISIBLE | HOST_COHERENT | HOST_CACHED<!--"--></td></tr>
 <tr><td colspan=2>(these repeat, after uniquification, with <samp>| DEVICE_COHERENT_AMD | DEVICE_UNCACHED_AMD</samp> set)</td></tr>
</table>
<table class="memtype">
 <caption>Intel(R) Iris(R) Xe Graphics (ADL GT2) [unified <span class="roboto-unscale math-font-normal">64GiB</span>]</caption>
 <tr><td><span class="roboto-unscale math-font-normal">32007MiB</span></td> <td><!--"-->DEVICE_LOCAL<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">32007MiB</span></td> <td><!--"-->DEVICE_LOCAL | HOST_VISIBLE | HOST_COHERENT<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">32007MiB</span></td> <td><!--"-->DEVICE_LOCAL | HOST_VISIBLE | HOST_COHERENT | HOST_CACHED<!--"--></td></tr>
 <tr><td><span class="roboto-unscale math-font-normal">32007MiB</span></td> <td><!--"-->DEVICE_LOCAL | PROTECTED<!--"--></td></tr>
 <tr><td colspan=2>(these, minus the <samp>| PROTECTED</samp> one, repeat verbatim)</td></tr>
</table>
<p class="indented continued">
For the purposes of writing the shaders, I was targeting the 5700 XT in my desktop; conveniently, this is also the most restrictive device.
It appears that GPUs can only see up to <span class="roboto-unscale math-font-normal">32GiB</span> of host memory (or, indeed, memory at all), regardless of how much is actually attached
(I can come up with excuses for the discrete 6500 XT, but the Intel iGPU? no clue).
It's likewise unclear to me why the 6500 XT doubles up on some memory types (it's not the heap flags, those are also the same
 (<samp>DEVICE_LOCAL</samp> and empty, resp.)).
Doesn't really matter or affect funxionality in any way, it's just a little goofy.
</p>
<p class="indented continuing">
All three input buffers are accessed constantly (and written directly by the host),
so they need to be in <samp>DEVICE_LOCAL & HOST_VISIBLE & HOST_COHERENT</samp> memory
(taking up [​[​\operatorname{sizeof}(\texttt{params}) + k (\operatorname{sizeof}(\texttt{}\text{(}\texttt{float3}\text{, }\texttt{uint}\text{)}) + \operatorname{sizeof}(\texttt{uint}))​]​], so <span class="roboto-unscale math-font-normal">20B</span> per unique colour).
This is a precious resource, so <samp>outputs</samp> can't<!--'--> fit here
([​[​2^{24} \operatorname{sizeof}(\texttt{float4})​]​] is the whole [​[​256\text{MiB}​]​]!),
but from the perspective of the GPU, <samp>outputs</samp> is write-once write-only,
and the last iteration of [​[​f​]​], functionally, <em>uploads</em> the result,
so it doesn't need to be <samp>DEVICE_LOCAL</samp> anyway, since the latency or speed don't matter.
</p>
<p class="indented continuing">
Fall-backs are implemented from more specific to more generic memory types
(<samp>DEVICE_LOCAL & HOST_VISIBLE & HOST_COHERENT</samp> → <samp>HOST_VISIBLE & HOST_COHERENT</samp>),
but I haven't<!--'--> encountered a device where this fall-back is taken.
Using these improved memory types yields
</p>
<!-- [src\main.rs:163:27] possible.swap_remove(i as usize) = ".\\00.png"
125.517616ms: MSC 16755 RGBs @ r=0.02
123.671737ms: MSC 16755 RGBs @ r=0.02
123.64457ms: MSC 16755 RGBs @ r=0.02
123.724261ms: MSC 16755 RGBs @ r=0.02
123.976013ms: MSC 16755 RGBs @ r=0.02
124.240745ms: MSC 16755 RGBs @ r=0.02
124.781076ms: MSC 16755 RGBs @ r=0.02
131.536719ms: MSC 16755 RGBs @ r=0.02
125.544783ms: MSC 16755 RGBs @ r=0.02
124.545926ms: MSC 16755 RGBs @ r=0.02
128.92985ms: MSC 16755 RGBs @ r=0.02
126.948738ms: MSC 16755 RGBs @ r=0.02
124.866201ms: MSC 16755 RGBs @ r=0.02
125.02679ms: MSC 16755 RGBs @ r=0.02
124.692933ms: MSC 16755 RGBs @ r=0.02
124.973964ms: MSC 16755 RGBs @ r=0.02
125.079314ms: MSC 16755 RGBs @ r=0.02
123.238869ms: MSC 16755 RGBs @ r=0.02
133.355731ms: MSC 16755 RGBs @ r=0.02
124.083777ms: MSC 16755 RGBs @ r=0.02
124.503967ms: MSC 16755 RGBs @ r=0.02
114.615312ms: MSC 16755 RGBs @ r=0.02 * freq
113.506276ms: MSC 16755 RGBs @ r=0.02 * freq
136.348983ms: MSC 16755 RGBs @ r=0.02 * freq
116.460888ms: MSC 16755 RGBs @ r=0.02 * freq
116.035567ms: MSC 16755 RGBs @ r=0.02 * freq
115.519385ms: MSC 16755 RGBs @ r=0.02 * freq
115.895804ms: MSC 16755 RGBs @ r=0.02 * freq
115.00441ms: MSC 16755 RGBs @ r=0.02 * freq
114.984185ms: MSC 16755 RGBs @ r=0.02 * freq
114.924115ms: MSC 16755 RGBs @ r=0.02 * freq
115.280613ms: MSC 16755 RGBs @ r=0.02 * freq
115.023427ms: MSC 16755 RGBs @ r=0.02 * freq
115.94531ms: MSC 16755 RGBs @ r=0.02 * freq
114.887288ms: MSC 16755 RGBs @ r=0.02 * freq
115.743063ms: MSC 16755 RGBs @ r=0.02 * freq
115.551684ms: MSC 16755 RGBs @ r=0.02 * freq
114.823293ms: MSC 16755 RGBs @ r=0.02 * freq
-->
<!-- [src\main.rs:163:27] possible.swap_remove(i as usize) = ".\\00.png.degen.png"
124.584262ms: MSC 16551 RGBs @ r=0.02
124.278176ms: MSC 16551 RGBs @ r=0.02
137.961221ms: MSC 16551 RGBs @ r=0.02
126.276192ms: MSC 16551 RGBs @ r=0.02
126.349846ms: MSC 16551 RGBs @ r=0.02
127.131061ms: MSC 16551 RGBs @ r=0.02
126.790563ms: MSC 16551 RGBs @ r=0.02
126.909194ms: MSC 16551 RGBs @ r=0.02
126.559941ms: MSC 16551 RGBs @ r=0.02
135.233004ms: MSC 16551 RGBs @ r=0.02
127.957858ms: MSC 16551 RGBs @ r=0.02
125.457546ms: MSC 16551 RGBs @ r=0.02
125.94656ms: MSC 16551 RGBs @ r=0.02
126.001197ms: MSC 16551 RGBs @ r=0.02
148.003221ms: MSC 16551 RGBs @ r=0.02 * freq
146.599569ms: MSC 16551 RGBs @ r=0.02 * freq
147.949792ms: MSC 16551 RGBs @ r=0.02 * freq
149.149387ms: MSC 16551 RGBs @ r=0.02 * freq
148.267652ms: MSC 16551 RGBs @ r=0.02 * freq
148.321081ms: MSC 16551 RGBs @ r=0.02 * freq
147.861347ms: MSC 16551 RGBs @ r=0.02 * freq
149.7842ms: MSC 16551 RGBs @ r=0.02 * freq
149.032868ms: MSC 16551 RGBs @ r=0.02 * freq
148.328929ms: MSC 16551 RGBs @ r=0.02 * freq
148.249842ms: MSC 16551 RGBs @ r=0.02 * freq
156.658474ms: MSC 16551 RGBs @ r=0.02 * freq
149.57169ms: MSC 16551 RGBs @ r=0.02 * freq
149.130672ms: MSC 16551 RGBs @ r=0.02 * freq
149.632062ms: MSC 16551 RGBs @ r=0.02 * freq
148.581285ms: MSC 16551 RGBs @ r=0.02 * freq
148.820661ms: MSC 16551 RGBs @ r=0.02 * freq
148.279122ms: MSC 16551 RGBs @ r=0.02 * freq
149.427702ms: MSC 16551 RGBs @ r=0.02 * freq
149.250208ms: MSC 16551 RGBs @ r=0.02 * freq
146.624926ms: MSC 16551 RGBs @ r=0.02 * freq
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">125.566ms</span></td> <td><span class="roboto-unscale math-font-normal">116.503ms</span></td> <td><span class="roboto-unscale math-font-normal">92.78%</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">3.288ms</span></td> <td><span class="roboto-unscale math-font-normal">2.361ms</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">2.55%</span></td> <td><span class="roboto-unscale math-font-normal">1.99%</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">127.674ms</span></td> <td><span class="roboto-unscale math-font-normal">148.930ms</span></td> <td><span class="roboto-unscale math-font-normal">116.65%</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">3.298ms</span></td> <td><span class="roboto-unscale math-font-normal">2.931ms</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">2.52%</span></td> <td><span class="roboto-unscale math-font-normal">1.93%</span></td></tr>
</table>
<h2 id="branchless" ><a class="hash-link" href="#branchless">#</a> who up branchin they execution</h2>
<p class="indented continued">
If there's half of one potential thing I know about the GPU execution model, it's that branches are either expensive or not real or some mixture of the two.
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/ad9926e0813ebbcc31b5c22f30e97d1b54ffedd1/item/src/posterise_mul.hlsl">[​[​palette​]​]'s<!--'--> branch</a>
can be flattened out;
so can
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/ad9926e0813ebbcc31b5c22f30e97d1b54ffedd1/item/src/posterise_mul.hlsl">[​[​*freq​]​]'s<!--'--></a>
(but shouldn't, it's worse),
with a trivial change
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/ad9926e0813ebbcc31b5c22f30e97d1b54ffedd1/item/src/posterise_kernel.hlsl.inc#L36">to the common kernel</a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">KNOWN_RGBS_FREQS</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">BRANCHLESS_ADD</span><!--"-->   <!--"--><span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_LOAD</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ</span><!--"-->             <!--"--><span class="token expression">matched</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"posterise_kernel.hlsl.inc"</span></span>
</code></pre>
</div>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">KNOWN_RGBS_FREQS</span> <span class="token expression"><span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint4</span><span class="token operator">></span> known_rgbs_freqs<span class="token punctuation">;</span> </span><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE &amp; HOST_COHERENT</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">BRANCHLESS_ADD</span><!--"-->   <!--"--><span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_LOAD</span><!--"-->        <!--"--><span class="token expression"><span class="token keyword">uint</span> freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ</span><!--"-->             <!--"--><span class="token expression">freq</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"posterise_kernel.hlsl.inc"</span></span>
</code></pre>
</div>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> known_rgbs_len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#if</span> <span class="token expression"><span class="token operator">!</span>BRANCHLESS_ADD</span></span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive keyword">#endif</span></span>
<!--"-->	<!--"--><span class="token punctuation">{</span>
<!--"-->		<!--"-->FREQ_LOAD
<!--"-->		<!--"-->newcenter_count <span class="token operator">+=</span> FREQ<span class="token punctuation">;</span>
<!--"-->		<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> FREQ <span class="token operator">*</span> lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
which expand to, effectively,
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
</small>newcenter_count <span class="token operator">+=</span> matched<span class="token punctuation">;</span>
newcenter<!--"-->       <!--"--><span class="token operator">+=</span> matched <span class="token operator">*</span> lab<span class="token punctuation">;</span>
</code></pre>
</div>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
</small><span class="token keyword">if</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint</span> freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->newcenter_count <span class="token operator">+=</span> freq<span class="token punctuation">;</span>
<!--"-->	<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> freq <span class="token operator">*</span> lab<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
yielding
</p>
<!-- [src\main.rs:163:27] possible.swap_remove(i as usize) = ".\\00.png"
122.393961ms: MSC 16755 RGBs @ r=0.02
122.446786ms: MSC 16755 RGBs @ r=0.02
122.586247ms: MSC 16755 RGBs @ r=0.02
122.619149ms: MSC 16755 RGBs @ r=0.02
122.779135ms: MSC 16755 RGBs @ r=0.02
122.824414ms: MSC 16755 RGBs @ r=0.02
122.873014ms: MSC 16755 RGBs @ r=0.02
122.946667ms: MSC 16755 RGBs @ r=0.02
129.279102ms: MSC 16755 RGBs @ r=0.02
112.17356ms: MSC 16755 RGBs @ r=0.02 * freq
112.993414ms: MSC 16755 RGBs @ r=0.02 * freq
113.165172ms: MSC 16755 RGBs @ r=0.02 * freq
113.405454ms: MSC 16755 RGBs @ r=0.02 * freq
113.535555ms: MSC 16755 RGBs @ r=0.02 * freq
113.63366ms: MSC 16755 RGBs @ r=0.02 * freq
113.761952ms: MSC 16755 RGBs @ r=0.02 * freq
113.889035ms: MSC 16755 RGBs @ r=0.02 * freq
114.302584ms: MSC 16755 RGBs @ r=0.02 * freq
-->
<!-- [src\main.rs:163:27] possible.swap_remove(i as usize) = ".\\00.png.degen.png"
123.490017ms: MSC 16551 RGBs @ r=0.02
123.555521ms: MSC 16551 RGBs @ r=0.02
123.745089ms: MSC 16551 RGBs @ r=0.02
123.754145ms: MSC 16551 RGBs @ r=0.02
123.804556ms: MSC 16551 RGBs @ r=0.02
123.84742ms: MSC 16551 RGBs @ r=0.02
123.913528ms: MSC 16551 RGBs @ r=0.02
124.097059ms: MSC 16551 RGBs @ r=0.02
146.378004ms: MSC 16551 RGBs @ r=0.02 * freq
146.508709ms: MSC 16551 RGBs @ r=0.02 * freq
146.518368ms: MSC 16551 RGBs @ r=0.02 * freq
146.570892ms: MSC 16551 RGBs @ r=0.02 * freq
146.616775ms: MSC 16551 RGBs @ r=0.02 * freq
146.671411ms: MSC 16551 RGBs @ r=0.02 * freq
147.022174ms: MSC 16551 RGBs @ r=0.02 * freq
150.334794ms: MSC 16551 RGBs @ r=0.02 * freq
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">123.416ms</span></td> <td><span class="roboto-unscale math-font-normal">113.429ms</span></td> <td><span class="roboto-unscale math-font-normal">91.91%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">1.71%</span></td> <td><span class="roboto-unscale math-font-normal">2.64%</span></td> <td><span class="roboto-unscale math-font-normal">0.87 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">4.22%</span></td> <td><span class="roboto-unscale math-font-normal">4.57%</span></td> <td><span class="roboto-unscale math-font-normal">0.34 p.p.</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">123.776ms</span></td> <td><span class="roboto-unscale math-font-normal">147.078ms</span></td> <td><span class="roboto-unscale math-font-normal">118.83%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">3.05%</span></td> <td><span class="roboto-unscale math-font-normal">1.24%</span></td> <td><span class="roboto-unscale math-font-normal">-2.18 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">5.49%</span></td> <td><span class="roboto-unscale math-font-normal">3.15%</span></td> <td><span class="roboto-unscale math-font-normal">-2.89 p.p.</span></td></tr>
</table>
<p class="continued">
For reference, "worse" means, giving [​[​*freq​]​] <samp>BRANCHLESS_ADD</samp> = <samp>1</samp> and <samp>FREQ</samp> = <samp>matched * freq</samp>:
</p>
<!-- matched * freq
[src\main.rs:163:27] possible.swap_remove(i as usize) = ".\\00.png"
114.437818ms: MSC 16755 RGBs @ r=0.02 * freq
114.758092ms: MSC 16755 RGBs @ r=0.02 * freq
114.857102ms: MSC 16755 RGBs @ r=0.02 * freq
115.756043ms: MSC 16755 RGBs @ r=0.02 * freq
116.719583ms: MSC 16755 RGBs @ r=0.02 * freq
115.576436ms: MSC 16755 RGBs @ r=0.02 * freq
128.980864ms: MSC 16755 RGBs @ r=0.02 * freq
116.097146ms: MSC 16755 RGBs @ r=0.02 * freq
116.048546ms: MSC 16755 RGBs @ r=0.02 * freq
115.145077ms: MSC 16755 RGBs @ r=0.02 * freq
116.339238ms: MSC 16755 RGBs @ r=0.02 * freq
115.539911ms: MSC 16755 RGBs @ r=0.02 * freq
116.745845ms: MSC 16755 RGBs @ r=0.02 * freq
118.025432ms: MSC 16755 RGBs @ r=0.02 * freq
115.237447ms: MSC 16755 RGBs @ r=0.02 * freq
115.994211ms: MSC 16755 RGBs @ r=0.02 * freq
((114.437818+114.758092+114.857102+115.756043+116.719583+115.576436+128.980864+116.097146+116.048546+115.145077+116.339238+115.539911+116.745845+118.025432+115.237447+115.994211)/16)
[src\main.rs:163:27] possible.swap_remove(i as usize) = ".\\00.png.degen.png"
156.987502ms: MSC 16551 RGBs @ r=0.02 * freq
147.093413ms: MSC 16551 RGBs @ r=0.02 * freq
148.650411ms: MSC 16551 RGBs @ r=0.02 * freq
148.120343ms: MSC 16551 RGBs @ r=0.02 * freq
147.61533ms: MSC 16551 RGBs @ r=0.02 * freq
148.564381ms: MSC 16551 RGBs @ r=0.02 * freq
146.480032ms: MSC 16551 RGBs @ r=0.02 * freq
148.253464ms: MSC 16551 RGBs @ r=0.02 * freq
149.445512ms: MSC 16551 RGBs @ r=0.02 * freq
148.260407ms: MSC 16551 RGBs @ r=0.02 * freq
150.607676ms: MSC 16551 RGBs @ r=0.02 * freq
147.72883ms: MSC 16551 RGBs @ r=0.02 * freq
147.211139ms: MSC 16551 RGBs @ r=0.02 * freq
147.987826ms: MSC 16551 RGBs @ r=0.02 * freq
147.651252ms: MSC 16551 RGBs @ r=0.02 * freq
147.814257ms: MSC 16551 RGBs @ r=0.02 * freq
((156.987502+147.093413+148.650411+148.120343+147.61533+148.564381+146.480032+148.253464+149.445512+148.260407+150.607676+147.72883+147.211139+147.987826+147.651252+147.814257)/16)
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th> <th style="padding-left: 1em;"><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">116.641ms</span></td> <td><span class="roboto-unscale math-font-normal">94.51%</span></td> <td ><span class="roboto-unscale math-font-normal">148.654ms</span></td> <td><span class="roboto-unscale math-font-normal">101.07%</span></td></tr>
 <tr><th>(speed-up vs not that) </th> <td><span class="roboto-unscale math-font-normal">-2.83%</span></td> <td><span class="roboto-unscale math-font-normal">2.60 p.p.</span></td> <td ><span class="roboto-unscale math-font-normal">-1.07%</span></td> <td><span class="roboto-unscale math-font-normal">-17.75 p.p.</span></td></tr>
</table>
<h2 id="grid" ><a class="hash-link" href="#grid">#</a> Hitting the griddy? In this economy?</h2>
<p class="indented continued">
Any particle system, which this is, is improved by spatially partitioning constituent particles,
and iterating only those whose partitions fall within the radius of influence.
This applies basically-straight-forwardly to this problem,
except that since the underlying set of [​[​Multiset(D)​]​] is constant,
the elements of [​[​D​]​] can be assigned to constant cells
(or, equivalently but more importantly, cells can be said to contain a constant subset of [​[​D​]​],
 where no two cells share any elements and the union of all cells is [​[​D​]​])
a priori,
but each iteration of [​[​q_t​]​] moves around, so the cell it's<!--'--> found in will differ.
</p>
<p class="indented continuing">
For optimal (well, "in any way meaningful") occupancy, we must additionally observe a nigh-universal factoid about the shape of the data:
</p>
<div class="one-by-each continuation">
 <figure> <a href="/content/assets/blogn_t/018.14-unscaled+scaled-ortho-front.png"><img alt="Coloured point clouds labelled α, β, γ, δ, ε, in two rows: the bottom with a bounding box around the cloud which itself takes up like a twentieth of the visible volume, the top with the bounded bit blown up" src="/content/assets/blogn_t/018.14-unscaled+scaled-ortho-front.png" /></a> <figcaption>Bottom: [​[​D​]​], bounds of data out-lined; top: bounding box scaled to <span class="roboto-unscale math-font-normal">1<sup>3</sup></span>; front view</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.15-unscaled+scaled-ortho-top.png"><img alt="The same, from a different angle" src="/content/assets/blogn_t/018.15-unscaled+scaled-ortho-top.png" /></a> <figcaption>Top view</figcaption> </figure>
</div>
<div id="videos_side_by_each">
 <video width="100%" autoplay controls><source src="/content/assets/blogn_t/018.16-unscaled+scaled-0001-0599-colourful+vhrHst19.mp4" type="video/mp4" /></video>
 <video width="100%" autoplay controls><source src="/content/assets/blogn_t/018.17-unscaled+scaled-0001-0599-random+vhrHst19.mp4.mp4" type="video/mp4" /></video>
</div>
<script>
 {
  let machine_seeking = false;
  let done_barrier = false;
  videos_side_by_each.children[0].playbackRate = videos_side_by_each.children[1].playbackRate = 0.7;
  for(let i = 0; i != 2; ++i) {
   let curr = videos_side_by_each.children[i];
   let opp = videos_side_by_each.children[1 - i];
   curr.addEventListener("seeked", function() {
    if(!machine_seeking)
     opp.currentTime = curr.currentTime;
    machine_seeking = !machine_seeking;
   });
   curr.addEventListener("ended", function() {
    if(done_barrier++) {
     done_barrier = false;
     curr.play();
     opp.play();
    }
   });
   curr.addEventListener("pause", function() {
    if(!curr.ended)
     opp.pause();
   });
   curr.addEventListener("play", function() {
    opp.play();
   });
   curr.addEventListener("ratechange", function() {
    opp.playbackRate = curr.playbackRate;
   });
  }
 }
</script>
<!--
α CDSCN9810.JPG
β B.png
γ 0image.png
δ 003. cinque.png
ε 00.png
-->
<p class="indented continued">
As is hopefully obvious from the figures, the range of [​[​P​]​] actually used by any given input tends to be quite narrow,
so subdividing [​[​P​]​] directly will yield poor occupancy.
Indeed, for the datasets visualised above:
</p>
<table id="Pvol">
 <tr><th></th> <th>volume</th> <th colspan=5>bounding box</th></tr>
 <tr><td style="color: #4b8494;">α</td> <td><span class="roboto-unscale math-font-normal">≈0.041316</span></td> <td>[​[​[0.13635494, 1.0]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.13823886, 0.02675569]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.16005541, 0.12989232]​]​]</td></tr>
 <tr><td style="color: #94a088;">β</td> <td><span class="roboto-unscale math-font-normal">≈0.026181</span></td> <td>[​[​[0.27619627, 0.9986911]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.15646803, 0.04568255]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.037055194, 0.1422047]​]​]</td></tr>
 <tr><td style="color: #735d56;">γ</td> <td><span class="roboto-unscale math-font-normal">≈0.034417</span></td> <td>[​[​[0.0, 0.9665335]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.06452984, 0.12635213]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.10584019, 0.08071107]​]​]</td></tr>
 <tr><td style="color: #15090d;" class="dark-invert">δ</td> <td><span class="roboto-unscale math-font-normal">≈0.107448</span></td> <td>[​[​[0.0, 0.68679345]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.18539383, 0.20771612]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.2556958, 0.14228153]​]​]</td></tr>
 <tr><td style="color: #b57688;">ε</td> <td><span class="roboto-unscale math-font-normal">≈0.057179</span></td> <td>[​[​[0.31232694, 1.0]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.03692481, 0.27541596]​]​]</td> <td>[​[​\times​]​]</td> <td>[​[​[-0.09577876, 0.17043555]​]​]</td></tr>
</table>
<p class="continuation">
so, with Oklab [​[​P​]​]'s<!--'--> volume being <span class="roboto-unscale math-font-normal">1</span>, the average bounds are just <span class="roboto-unscale math-font-normal">5.33%</span> of that!
</p>
<p class="indented continued">
For a cartesian grid of dimension [​[​G \in \mathbb{N}_+​]​] we can define a bijective map [​[​g : P \to [0, G )^3​]​] such that
</p>
<div class="mathnospace real">
[​![​
\begin{align}
<!--"-->g(p)      &= \min (G \frac{p - B_m}{B_r}, G-\varepsilon)\\<!--"-->
<!--"-->g^{-1}(g) &= \frac{g}{G}B_r + B_m\\<!--"-->
\text{where}\\
<!--"-->  D_i       &= \{x_i | x \in D\}\\<!--"-->
<!--"-->  B_m       &= (\min D_1, \min D_2, \min D_3)\\<!--"-->
<!--"-->  B_M       &= (\max D_1, \max D_2, \max D_3)\\<!--"-->
<!--"-->  B_r       &= B_M - B_m\\<!--"-->
\end{align}
​]!​]
</div>
<p class="continuation">
a bare definition of [​[​g​]​] (without [​[​\min​]​]) would also include [​[​{G}^3​]​] in the codomain
for points on the far extrema of the bounding box;
we abuse the fact that we don't<!--'--> <em>actually</em> use [​[​g^{-1}(g(p))​]​] as data, just as optimisation metadata,
to make it much more useful (the error induced is imperceptible after quantisation later):
<!-- the grid cell each [​[​p​]​] falls in is given by [​[​\operatorname{trunc}(g(p)) \in ([0, G ) \cap \mathbb{Z})^3​]​]. -->
the grid cell each [​[​p​]​] falls in is given by [​[​\operatorname{trunc}(g(p)) \in \bar{G}^3​]​].
<!-- The points within each cell [​[​h : ([0, G ) \cap \mathbb{Z})^3 \to \mathcal{P}(D)​]​] can then be obtained by computing -->
The points within each cell [​[​h : \bar{G}^3 \to \mathcal{P}(D)​]​] can then be obtained by computing
[​[​h(x) = \{p | p \in D \wedge \operatorname{trunc}(g(p)) = x\}​]​];
the desired properties
[​[​h(x) \cap h(y) \ne \varnothing \Leftrightarrow x = y \text{ & } \bigcup (h \circ {\operatorname{trunc}} \circ g \circ D) = D​]​]
are preserved under these mappings.
</p>
<div class="three-by-each directly continuation">
    <figure> <a href="/content/assets/blogn_t/018.18-grid-ortho-G=100-x.png"><img alt="Blown up point cloud α overlaid with a 100x100 grid" src="/content/assets/blogn_t/018.18-grid-ortho-G=100-x.png" /></a> <figcaption>[​[​G = 100​]​], orthographic projection along [​[​x​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.19-grid-ortho-G=100-y.png"><img alt="The same, alongside different axis" src="/content/assets/blogn_t/018.19-grid-ortho-G=100-y.png" /></a> <figcaption>[​[​y​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.20-grid-ortho-G=100-z.png"><img alt="Likewise" src="/content/assets/blogn_t/018.20-grid-ortho-G=100-z.png" /></a> <figcaption>[​[​z​]​]</figcaption> </figure>
</div>
<div class="singles continuation">
 <figure> <a href="/content/assets/blogn_t/018.21-grid-ortho-G=10-persp.png"><img alt="Point cloud α in 3D overlaid with a 10x10x10 grid" src="/content/assets/blogn_t/018.21-grid-ortho-G=10-persp.png" /></a> <figcaption>[​[​G = 10​]​] (it's<!--'--> <a href="//101010.pl/@nabijaczleweli/114263550582075495">practically impossible</a> to get a useful non-axial non-ortho render at [​[​100​]​])</figcaption> </figure>
</div>
<h3 id="grid-bbox" ><a class="hash-link" href="#grid-bbox">#</a> box bondage 🥺</h3>
<p class="indented continued">
Computing [​[​(B_m, B_M)​]​] is more-usefully analysed as a [​[​(\min, \max)​]​] fold
over [​[​D​]​] starting at [​[​(+\infty^3, -\infty^3)​]​].
To this end, [​[​\min​]​] and [​[​\max​]​] are available as atomics —
HLSL calls them
<a href="//learn.microsoft.com/en-us/windows/win32/direct3dhlsl/interlockedmin"><samp>InterlockedMin</samp></a>/<a href="//learn.microsoft.com/en-us/windows/win32/direct3dhlsl/interlockedmax">-<samp>Max</samp></a>
even though no locking, inter- or otherwise, takes place;
<a href="//registry.khronos.org/OpenGL-Refpages/gl4/html/atomicMin.xhtml">GLSL nomenclature</a> is reasonable,
so this is an unforced error on Microsoft's<!--'--> part —
but only on integers, which coordinates in [​[​D​]​] aren't<!--'-->.
</p>
<p class="indented continuing">
But they are IEEE754 <samp>float</samp>s, which have a well-behaved structure when interpreted as-if they were integers.
Indeed, if [​[​P​]​] were in the form [​[​[0, x]^3​]​], no further processing would be required,
since positive <samp>float</samp>s compare the same as <samp>uint</samp>s
(other relations can be drawn, cf.
 <a href="//stackoverflow.com/a/46995665/2851815"><cite>No. Two floating point values (IEEE 754 binary64) cannot compare</cite>, chux, 2015</a>).
But it isn't<!--'-->, so we desire a bijection [​[​u : float \to uint \text{ or } int​]​] monotonic in [​[​(-\infty, +\infty)​]​],
ideally something <del>I don't<!-- '--> have to derive because that sucks</del> battle-tested.
The literature provides
<a href="//github.com/kripken/bullet/blob/7e5c986/src/BulletMultiThreaded/GpuSoftBodySolvers/DX11/HLSL/ComputeBounds.hlsl#L51">
 <cite>Bullet 2.81, GPU Soft Body Solvers, DX11</cite>, Erwin Coumans &a., 2012</a>
(and <a href="//github.com/kripken/bullet/blob/7e5c986/src/BulletMultiThreaded/GpuSoftBodySolvers/DX11/btSoftBodySolver_DX11.cpp#L1178-L1179">[​[​u^{-1}​]​]</a>),
for 32-bit <samp>float</samp>s and <samp>uint</samp>s
(notationally, this is where real math (Wikipedia lists operators in [​[​\LaTeX​]​]) ends and "computer science" (Wikipedia l. op. in <samp>Courier</samp>) begins):
</p>
<div class="mathnospace" style="text-align: center;">
<pre>u(f)<!--" -->   = asuint(f) ^ ((~(asuint(f) >> 31) + 1) | 0x8000`0000) <!--"-->
u<sup style="display: inline-block; width: 1.43em;">-1</sup>(u)<!--"--> = asfloat(u ^ (( (       u  >> 31) - 1) | 0x8000`0000))<!--"-->
</pre>
<span style="display: inline-block;">(with logical <code>>></code> and wrap-around <code>+</code>/<code>-</code>;</span>
<span style="display: inline-block;"> <code>asuint()</code>/<code>asfloat()</code> like in HLSL or Rust <code>f32::to_bits()</code>/<code>f32::from_bits()</code>)</span>
</div>
<p class="indented continued">
Within the [​[​(-\infty, +\infty)​]​] domain,
IEEE754 <samp>float</samp>s consist of [​[​(1\ \text{sign bit})(31\ \text{bits of distance from}\ 0\ \text{in natural }\texttt{uint}\text{ sort order})​]​].
There's more stuff in there but it's not relevant here; <a href="//float.exposed"><span id="google">Google</span> float \infty to learn more</a>.
The [​[​l​]​] axis from example <samp style="color: #94a088;">β</samp> can thus be transcoded as
</p>
<script>
{
 let googles = ["Google", "DDG", "Baidu", "Kagi", "Startpage"];
 google.innerText = googles[Math.floor(Math.random() * googles.length)];
}
</script>
<div class="maths-by-each">
 <div>
  <table>
   <caption>
    <a href="//float.exposed/0xbe203928"><samp>f</samp> = <span class="roboto-unscale math-font-normal">−0.15646803</span></a><br />
    <samp>asuint(f)</samp> = <samp>0xBE20`3928</samp><br />
                             <samp>0b1<small><small>011`1110`0010`0000`0011`1001`0010`1000</small></small></samp><br />
    [​[​u(f)​]​]
   </caption>
   <tr><th>asuint(f) </th> <th> ^ </th> <th>(</th> <th>(</th> <th>~</th> <th>(</th> <th>asuint(f) </th> <th> >> 31</th> <th>)</th> <th> + 1)</th> <th> | 0x8000`0000</th> <th>)</th></tr>
   <tr><td>0xBE20`3928</td> <td> ^ </td> <td>(</td> <td>(</td> <td>~</td> <td>(</td> <td>0xBE20`3928</td> <td> >> 31</td> <td>)</td> <td> + 1)</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0xBE20`3928</td> <td> ^ </td> <td>(</td> <td>(</td> <td>~</td> <td>(</td> <td colspan=2 class=r>1</td> <td>)</td> <td> + 1)</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0xBE20`3928</td> <td> ^ </td> <td>(</td> <td>(</td> <td colspan=5 class=r>0xFFFF`FFFE</td> <td> + 1)</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0xBE20`3928</td> <td> ^ </td> <td colspan=2>(</td> <td colspan=5 class=r>0xFFFF`FFFF</td> <td></td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0xBE20`3928</td> <td> ^ </td> <td></td> <td colspan=6 class=r>0xFFFF`FFFF</td> <td colspan=3></td></tr>
   <tr><td colspan=11>0x41DF`C6D7</td> <td>∎</td></tr>
  </table>
  <p></p>
  <table>
   <caption>
    <samp>u<sup style="display: inline-block; width: 1.43em;">-1</sup>(u(f))</samp>
   </caption>
   <tr><th>asfloat(</th> <th>u </th> <th> ^ </th> <th>(</th> <th>(</th> <th>(u </th> <th> >> 31)</th> <th> - 1)</th> <th> | 0x8000`0000)</th> <th>)</th></tr>
   <tr><td>asfloat(</td> <td>0x41DF`C6D7</td> <td> ^ </td> <td>(</td> <td>(</td> <td>(0x41DF`C6D7</td> <td> >> 31)</td> <td> - 1)</td> <td> | 0x8000`0000)</td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td>0x41DF`C6D7</td> <td> ^ </td> <td>(</td> <td>(</td> <td colspan=2 class=r> 0</td> <td> - 1)</td> <td> | 0x8000`0000)</td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td>0x41DF`C6D7</td> <td> ^ </td> <td>(</td> <td colspan=4 class=r>0xFFFF`FFFF</td> <td> | 0x8000`0000)</td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td>0x41DF`C6D7</td> <td colspan=2> ^ </td> <td colspan=4 class=r>0xFFFF`FFFF</td> <td></td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td colspan=8>0xBE20`3928</td> <td>)</td></tr>
   <tr><td colspan=9><span class="roboto-unscale math-font-normal">−0.15646803</span></td> <td>∎</td></tr>
  </table>
 </div>
 <div>
  <table>
   <caption>
    <a href="//float.exposed/0x3d3b1da0"><samp>f</samp> = <span class="roboto-unscale math-font-normal">0.04568255</span></a><br />
    <samp>asuint(f)</samp> = <samp>0x3D3B`1DA0</samp><br />
                             <samp>0b0<small><small>011`1101`0011`1011`0001`1101`1010`0000</small></small></samp><br />
    [​[​u(f)​]​]
   </caption>
   <tr><th>asuint(f) </th> <th> ^ </th> <th>(</th> <th>(</th> <th>~</th> <th>(</th> <th>asuint(f) </th> <th> >> 31</th> <th>)</th> <th> + 1)</th> <th> | 0x8000`0000</th> <th>)</th></tr>
   <tr><td>0x3D3B`1DA0</td> <td> ^ </td> <td>(</td> <td>(</td> <td>~</td> <td>(</td> <td>0x3D3B`1DA0</td> <td> >> 31</td> <td>)</td> <td> + 1)</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0x3D3B`1DA0</td> <td> ^ </td> <td>(</td> <td>(</td> <td>~</td> <td>(</td> <td colspan=2 class=r>0</td> <td>)</td> <td> + 1)</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0x3D3B`1DA0</td> <td> ^ </td> <td>(</td> <td>(</td> <td colspan=5 class=r>0xFFFF`FFFF</td> <td> + 1)</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0x3D3B`1DA0</td> <td> ^ </td> <td colspan=2>(</td> <td colspan=6 class=r>0</td> <td> | 0x8000`0000</td> <td>)</td></tr>
   <tr><td>0x3D3B`1DA0</td> <td> ^ </td> <td colspan=9 class=r>0x8000`0000</td> <td></td></tr>
   <tr><td colspan=11>0xBD3B`1DA0</td> <td>∎</td></tr>
  </table>
  <p></p>
  <table class="notmath">
   <caption>
    <samp>u<sup style="display: inline-block; width: 1.43em;">-1</sup>(u(f))</samp>
   </caption>
   <tr><th>asfloat(</th> <th>u </th> <th> ^ </th> <th>(</th> <th>(</th> <th>(u </th> <th> >> 31)</th> <th> - 1)</th> <th> | 0x8000`0000)</th> <th>)</th></tr>
   <tr><td>asfloat(</td> <td>0xBD3B`1DA0</td> <td> ^ </td> <td>(</td> <td>(</td> <td>(0xBD3B`1DA0</td> <td> >> 31)</td> <td> - 1)</td> <td> | 0x8000`0000)</td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td>0xBD3B`1DA0</td> <td> ^ </td> <td>(</td> <td>(</td> <td colspan=2 class=r> 1</td> <td> - 1)</td> <td> | 0x8000`0000)</td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td>0xBD3B`1DA0</td> <td> ^ </td> <td>(</td> <td colspan=4 class=r>0</td> <td> | 0x8000`0000)</td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td>0xBD3B`1DA0</td> <td colspan=2> ^ </td> <td colspan=5 class=r>0x8000`0000 </td> <td>)</td></tr>
   <tr><td>asfloat(</td> <td colspan=8>0x3D3B`1DA0</td> <td>)</td></tr>
   <tr><td colspan=9><span class="roboto-unscale math-font-normal">0.04568255</span></td> <td>∎</td></tr>
  </table>
 </div>
</div>
<p class="continued">
This reveals some core insights:
</p>
<ul>
 <li>[​[​\begin{align} \text{If}\ sgn(f) \text{:}\\ u(f) &= f \oplus \mathrm{FFFFFFFF}_{16} = \neg f\\ u^{-1}(u) &= u \oplus \mathrm{FFFFFFFF}_{16} = \neg u\\ \text{Otherwise:}\\ u(f) &= f \oplus \mathrm{80000000}_{16}\\ u^{-1}(u) &= u \oplus \mathrm{80000000}_{16} \end{align}​]​]</li>
 <li>the sign bit is always flipped, yielding the top bit set for positive <span class="roboto-unscale math-font-normal">f</span>s and clear for negative <span class="roboto-unscale math-font-normal">f</span>s, inducing a clear partition:<br />
     <span class="roboto-unscale math-font-normal">u(<span style="width: 0.7em; display: inline-block;"> </span>0.0)</span> = <samp>0x8000`0000</samp> = <samp>0b1<small><small>000`0000`0000`0000`0000`0000`0000`0000</small></small></samp><br />
     <span class="roboto-unscale math-font-normal">u(<span style="width: 0.7em; display: inline-block;">−</span>0.0)</span> = <samp>0x7FFF`FFFF</samp> = <samp>0b0<small><small>111`1111`1111`1111`1111`1111`1111`1111</small></small></samp><br />
     but this means that the condition is mirrored between <samp>u</samp> and <samp>u<sup style="display: inline-block; width: 1.43em;">-1</sup></samp></li>
 <li>since the remaining bits are "distance from zero", so more negative numbers are larger, they are flipped so more negative numbers are smaller</li>
 <li>functionally, this is basically most of a (sign + magnitude) ↔ (two's<!--'--> complement) implementation
     (just missing the <code>+ 1</code> at the end for negative numbers)</li>
 <li>both major optimisers
     (and, accd'g<!--'--> to <a href="//git.sr.ht/~nabijaczleweli/f32-fromto-u32/tree">my measurements</a>, all three GPU driver optimisers) turn
     <samp style="white-space: nowrap;">~(f >> 31) + 1</samp> into
     <samp style="white-space: nowrap;">f >><sub>arithmetic</sub> 31</samp>
     (since the desired state equvalent to the top bit being copied to every other bit, which a sign-extension all the way down will do);
     this reduces <samp>u</samp> from (lsr31,neg,add,or,xor) to (asr31,or,xor) which is unbeatable</li>
 <li>this could be more clearly (but less goodly since it induces a branch) be expressed ideologically as</li>
</ul>
<div class="mathnospace" style="text-align: center;">
<pre>u(f)<!--" -->   = asuint(f) ^ (0xFFFF`FFFF if (asuint(f) & 0x8000`0000) else 0x8000`0000)<!--"-->
u<sup style="display: inline-block; width: 1.43em;">-1</sup>(u)<!--"--> = asfloat(u ^ (0xFFFF`FFFF if not    (u  & 0x8000`0000) else 0x8000`0000)<!--"--></pre>
</div>
<p class="indented continued">
[​[​B_m​]​] and [​[​B_M​]​]/[​[​B_r​]​] can be allocated directly, minding the free scalars in each 4-primitive block.
Since the reduxion wants to do atomic operations on integers (and no aliasing is possible),
these must be declared as <samp>uint3</samp>s for that shader, and may be <samp>float3</samp> in others;
theoretically it's<!--'--> possible to keep <samp>known_rgbs_pack::lab</samp> as a <samp>float3</samp>
and bit-cast with <code>asuint()</code> but there's<!--'--> no reason to do this.
So, lifting the declaration to
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/0697ea1f075b0952bcbffde090b848b95084c9c8%5E/item/src/shader.h">a common <samp>shader.h</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float</span><!--"-->   <!--"-->radiussy_squared<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">int</span><!--"-->     <!--"-->iter_limit<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->_padding1<span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token class-name">point_t</span> bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->_padding2<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token class-name">point_t</span> bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->_padding3<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">bbox_max</span> <span class="token expression">bbox_range<!--"-->  <!--"--></span><span class="token comment">// find_bbox.hlsl only</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">known_rgbs_pack</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token class-name">point_t</span> lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->rgb<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuing">
thus,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/0697ea1f075b0952bcbffde090b848b95084c9c8/item/src/find_bbox.hlsl"><samp>find_bbox.hlsl</samp></a>
can <code>typedef</code> <code>point_t</code> one way, and everything else — the other
(also note how <cite>Bullet 2.81</cite> does it a little goofy and applies <samp>u</samp> per-component; there is no reason to do this):
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">typedef</span> <span class="token keyword">uint3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>
<small style='display: block; line-height: initial;'>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>

</small><span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">uint3</span> tmp <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->	<!--"-->tmp <span class="token operator">^=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>tmp <span class="token operator">>></span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80000000</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token function">InterlockedMin</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token function">InterlockedMin</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token function">InterlockedMin</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">.</span>z<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token function">InterlockedMax</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_max<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token function">InterlockedMax</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_max<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token function">InterlockedMax</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_max<span class="token punctuation">.</span>z<span class="token punctuation">,</span> tmp<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
and <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/0697ea1f075b0952bcbffde090b848b95084c9c8/item/src/posterise_gpu.rs#L467">the driver</a>
just needs to supply the integral equivalent of [​[​(+\infty^3, -\infty^3)​]​]
and post-process with <samp>u<sup style="display: inline-block; width: 1.43em;">-1</sup></samp>
(this is where a real enum would've<!--'--> been nice):
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">FIND_BBOX</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SHADER_COUNT</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">FIND_BBOX</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token constant">SHADER_DATA</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">SHADER_COUNT</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise_mul.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/find_bbox.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->compute_pipeline<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">Pipeline</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token comment">// [SHADER_COUNT]</span>
<span class="token punctuation">}</span>

<small style='display: block; line-height: initial;'><span class="token attribute attr-name">#[repr(C)]</span>
</small><span class="token keyword">struct</span> <span class="token type-definition class-name">ParamsT</span> <span class="token punctuation">{</span>
<!--"-->	<!--"-->known_rgbs_len<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->radiussy_squared<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->iter_limit<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->_padding1<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>

<!--"-->	<!--"-->bbox_min<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->_padding2<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>

<!--"-->	<!--"-->bbox_range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->_padding3<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map <span class="token operator">=</span> <span class="token class-name">ParamsT</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->known_rgbs_len<span class="token punctuation">:</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		<!--"-->radiussy<span class="token punctuation">:</span> radiussy<span class="token punctuation">,</span>
<!--"-->		<!--"-->iter_limit<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
<!--"-->		<!--"-->bbox_min<span class="token punctuation">:</span><!--"-->                     <!--"--><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">::</span><span class="token function">from_bits</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->bbox_range <span class="token comment">/* as bbox_max */</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">::</span><span class="token function">from_bits</span><span class="token punctuation">(</span><span class="token number">0x00000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->_padding1<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> _padding2<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> _padding3<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->	<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>

<!--"-->	<!--"--><span class="token comment">// find_bbox.hlsl</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">FIND_BBOX</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">fn</span> <span class="token function-definition function">become_float3</span><span class="token punctuation">(</span>bbox<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->bbox<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">f32</span><span class="token punctuation">::</span>to_bits<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>bu<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">f32</span><span class="token punctuation">::</span><span class="token function">from_bits</span><span class="token punctuation">(</span>bu <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bu <span class="token operator">>></span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrapping_sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> bbox_min <span class="token operator">=</span> <span class="token function">become_float3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> bbox_range <span class="token operator">=</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">let</span> bbox_max <span class="token operator">=</span> <span class="token function">become_float3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">[</span>bbox_max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bbox_max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bbox_max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<!--"-->   <!--"--><span class="token operator">=</span> bbox_min<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_range <span class="token operator">=</span> bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"--><span class="token comment">// ... posterise.hlsl/posterise_mul.hlsl &amp;c.</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<!--
102.331µs: cmdbussy 16755
293.409µs: cmdbussy 16755
102.029µs: cmdbussy 16755
108.067µs: cmdbussy 16755
106.255µs: cmdbussy 16755
95.992µs: cmdbussy 16755
111.99µs: cmdbussy 16755
81.804µs: cmdbussy 16755
66.107µs: cmdbussy 16755
136.743µs: cmdbussy 16755
72.748µs: cmdbussy 16755
66.108µs: cmdbussy 16755
115.915µs: cmdbussy 16755
90.86µs: cmdbussy 16755
349.252µs: cmdbussy 16755
89.652µs: cmdbussy 16755
95.388µs: cmdbussy 16755
121.348µs: cmdbussy 16755
172.06µs: cmdbussy 16755
153.647µs: cmdbussy 16755
94.482µs: cmdbussy 16755
197.719µs: cmdbussy 16755
152.742µs: cmdbussy 16755
116.518µs: cmdbussy 16755
254.167µs: cmdbussy 16755
83.917µs: cmdbussy 16755
77.579µs: cmdbussy 16755
229.112µs: cmdbussy 16755
192.888µs: cmdbussy 16755
139.158µs: cmdbussy 16755
105.048µs: cmdbussy 16755
87.237µs: cmdbussy 16755
182.927µs: cmdbussy 27868
94.482µs: cmdbussy 27868
150.327µs: cmdbussy 27868
864.227µs: cmdbussy 27868
117.424µs: cmdbussy 27868
181.418µs: cmdbussy 27868
873.887µs: cmdbussy 27868
167.834µs: cmdbussy 27868
245.413µs: cmdbussy 27868
231.829µs: cmdbussy 27868
195.606µs: cmdbussy 27868
94.18µs: cmdbussy 27868
140.063µs: cmdbussy 27868
285.258µs: cmdbussy 27868
193.493µs: cmdbussy 27868
884.452µs: cmdbussy 27868
853.662µs: cmdbussy 27868
936.07µs: cmdbussy 27868
874.188µs: cmdbussy 27868
216.434µs: cmdbussy 27868
270.165µs: cmdbussy 27868
911.317µs: cmdbussy 27868
282.542µs: cmdbussy 27868
877.509µs: cmdbussy 27868
177.796µs: cmdbussy 27868
197.417µs: cmdbussy 27868
179.003µs: cmdbussy 27868
884.149µs: cmdbussy 27868
148.516µs: cmdbussy 27868
107.462µs: cmdbussy 84860
124.367µs: cmdbussy 84860
131.611µs: cmdbussy 84860
132.215µs: cmdbussy 84860
123.159µs: cmdbussy 84860
206.473µs: cmdbussy 84860
91.463µs: cmdbussy 84860
121.046µs: cmdbussy 84860
83.314µs: cmdbussy 84860
107.764µs: cmdbussy 84860
129.8µs: cmdbussy 84860
123.461µs: cmdbussy 84860
134.026µs: cmdbussy 84860
124.669µs: cmdbussy 84860
141.874µs: cmdbussy 84860
133.121µs: cmdbussy 84860
135.536µs: cmdbussy 84860
123.159µs: cmdbussy 84860
83.616µs: cmdbussy 84860
147.912µs: cmdbussy 84860
124.064µs: cmdbussy 84860
93.577µs: cmdbussy 84860
205.266µs: cmdbussy 84860
109.576µs: cmdbussy 84860
103.237µs: cmdbussy 84860
112.594µs: cmdbussy 84860
124.367µs: cmdbussy 84860
143.082µs: cmdbussy 84860
109.274µs: cmdbussy 84860
105.652µs: cmdbussy 84860
103.237µs: cmdbussy 84860
96.596µs: cmdbussy 84860
85.125µs: cmdbussy 84860
92.068µs: cmdbussy 84860
146.705µs: cmdbussy 84860
116.518µs: cmdbussy 84860
101.727µs: cmdbussy 84860
91.162µs: cmdbussy 84860
87.842µs: cmdbussy 84860
92.37µs: cmdbussy 84860
80.596µs: cmdbussy 84860
95.086µs: cmdbussy 84860
74.861µs: cmdbussy 84860
101.123µs: cmdbussy 84860
76.069µs: cmdbussy 84860
77.88µs: cmdbussy 84860
80.898µs: cmdbussy 84860
71.239µs: cmdbussy 84860
104.745µs: cmdbussy 84860
86.634µs: cmdbussy 242931
112.594µs: cmdbussy 242931
142.176µs: cmdbussy 242931
950.861µs: cmdbussy 242931
123.763µs: cmdbussy 242931
160.288µs: cmdbussy 242931
123.159µs: cmdbussy 242931
132.215µs: cmdbussy 242931
112.896µs: cmdbussy 242931
106.557µs: cmdbussy 242931
169.042µs: cmdbussy 242931
148.818µs: cmdbussy 242931
161.495µs: cmdbussy 242931
97.803µs: cmdbussy 242931
142.478µs: cmdbussy 242931
116.82µs: cmdbussy 242931
118.632µs: cmdbussy 242931
223.377µs: cmdbussy 242931
237.866µs: cmdbussy 242931
151.232µs: cmdbussy 242931
625.456µs: cmdbussy 242931
134.932µs: cmdbussy 242931
141.572µs: cmdbussy 242931
163.608µs: cmdbussy 328666
103.84µs: cmdbussy 328666
209.794µs: cmdbussy 328666
135.535µs: cmdbussy 328666
135.233µs: cmdbussy 328666
147.006µs: cmdbussy 328666
198.926µs: cmdbussy 328666
152.138µs: cmdbussy 328666
115.009µs: cmdbussy 328666
135.837µs: cmdbussy 328666
137.346µs: cmdbussy 328666
141.572µs: cmdbussy 328666
254.77µs: cmdbussy 328666
483.883µs: cmdbussy 328666
237.262µs: cmdbussy 328666
129.499µs: cmdbussy 328666
115.008µs: cmdbussy 328666
105.047µs: cmdbussy 328666
135.837µs: cmdbussy 328666
342.008µs: cmdbussy 1103347
408.417µs: cmdbussy 1103347
379.438µs: cmdbussy 1103347
365.856µs: cmdbussy 1103347
280.126µs: cmdbussy 1103347
343.216µs: cmdbussy 1103347
326.613µs: cmdbussy 1103347
212.812µs: cmdbussy 1103347
314.841µs: cmdbussy 1103347
335.367µs: cmdbussy 1103347
396.041µs: cmdbussy 1103347
381.552µs: cmdbussy 1103347
307.898µs: cmdbussy 1103347
451.282µs: cmdbussy 1103347
Benchmark 1: cmdbussy 84860
 Time (mean ± σ): 0.112502 ms ± 0.028234 ms
 Range (min … max): 0.071239 ms … 0.206473 ms 49 runs
Benchmark 2: cmdbussy 16755
 Time (mean ± σ): 0.133196 ms ± 0.066718 ms
 Range (min … max): 0.066107 ms … 0.349252 ms 32 runs
Benchmark 3: cmdbussy 328666
 Time (mean ± σ): 0.170376 ms ± 0.084738 ms
 Range (min … max): 0.103840 ms … 0.483883 ms 19 runs
Benchmark 4: cmdbussy 242931
 Time (mean ± σ): 0.196551 ms ± 0.191894 ms
 Range (min … max): 0.086634 ms … 0.950861 ms 23 runs
Benchmark 5: cmdbussy 1103347
 Time (mean ± σ): 0.346105 ms ± 0.056867 ms
 Range (min … max): 0.212812 ms … 0.451282 ms 14 runs
Benchmark 6: cmdbussy 27868
 Time (mean ± σ): 0.403848 ms ± 0.325802 ms
 Range (min … max): 0.094180 ms … 0.936070 ms 29 runs
Summary
  'cmdbussy 84860' ran
    1.183946 ± 0.527637 times faster than 'cmdbussy 16755'
    1.514433 ± 0.391494 times faster than 'cmdbussy 328666'
    1.747091 ± 0.966910 times faster than 'cmdbussy 242931'
    3.076440 ± -1.055178 times faster than 'cmdbussy 1103347'
    3.589704 ± 0.445448 times faster than 'cmdbussy 27868'
-->
<p class="indented continued">
This takes anywhere between <span class="roboto-unscale math-font-normal">120-400µs</span> on the images in the test dataset on the 5700 XT,
but variance is so high at this scale that this is barely correlated with the input size (amount of distinct colours).
Functionally this is as good as instant.
Bench-marking on
<a href="//git.sr.ht/~nabijaczleweli/f32-fromto-u32/tree/trunk/item/gpu/AMD Radeon RX 5700 XT explicit asr forced.log">orders-of-magnitude</a>
more data shows throughput of around <span class="roboto-unscale math-font-normal">414'419'783 <span class="roboto"><samp>uint3</samp></span>/s</span>.
The next generation
(<a href="//git.sr.ht/~nabijaczleweli/f32-fromto-u32/tree/trunk/item/gpu/NVIDIA GeForce RTX 4070 SUPER 8x.log">NVIDIA RTX 4070 SUPER</a>/<a href="//git.sr.ht/~nabijaczleweli/f32-fromto-u32/tree/trunk/item/gpu/AMD Radeon RX 6500 XT (RADV NAVI24) explicit asr forced.log">AMD Radeon RX 6500 XT (RADV NAVI24)</a>)
gets <span class="roboto-unscale math-font-normal">8'221'135'253<!--'--></span>/<span class="roboto-unscale math-font-normal">8'383'953'229<!--'--></span>!
</p>
<h3 id="grid-grid" ><a class="hash-link" href="#grid-grid">#</a> he do b hittin it doe</h3>
<p class="indented continued">
With all the parameters to grid [​[​g​]​] figured out, we can compute "which points live in each grid cell" [​[​h​]​].
This is relatively trivial, except the GPU has no structured programming capabilities,
so the natural <samp>uint3 → Vec&lt;indices of known_rgbs/[​[​D​]​]></samp> mapping is inexpressible.
The obvious-to-me solution is partitioning all indices by the grid cell they belong to,
then the map becomes <samp>uint3 → [begin, end)</samp> <del>iterators</del>indices;
this seems canonical.
The <a href="#demo-palette">original example</a>
(if we force [​[​B_m = (0,\frac{-1}{2},\frac{-1}{2}); B_r = (1,1,1)​]​] and specify [​[​G=10​]​])
</p>
<div class="three-by-each directly continuation">
    <figure> <a href="/content/assets/blogn_t/018.22-grid-alloc-ortho-y.png"><img alt="Blown up three-point cloud overlaid with a 10x10 grid" src="/content/assets/blogn_t/018.22-grid-alloc-ortho-y.png" /></a> <figcaption>Orthographic projection along [​[​y​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.23-grid-alloc-ortho-x.png"><img alt="The same, alongside different axis" src="/content/assets/blogn_t/018.23-grid-alloc-ortho-x.png" /></a> <figcaption>[​[​x​]​]</figcaption> </figure><!--
 --><figure> <a href="/content/assets/blogn_t/018.24-grid-alloc-ortho-z.png"><img alt="Likewise" src="/content/assets/blogn_t/018.24-grid-alloc-ortho-z.png" /></a> <figcaption>[​[​z​]​]</figcaption> </figure>
</div>
<div class="singles continuation">
 <figure> <a href="/content/assets/blogn_t/018.25-grid-alloc-persp.png"><img alt="The three-point cloud in 3D overlaid with a 10x10x10 grid" src="/content/assets/blogn_t/018.25-grid-alloc-persp.png" /></a> <figcaption><div class="mathnospace real"> [​![​ \begin{align} g(D_1) &= (7.91765, 6.23666, 3.89675)\\ g(D_2) &= (7.7292, 6.95024, 3.75878)\\ g(D_3) &= (7.5225, 6.89196, 4.36107) \end{align} ​]!​] </div></figcaption> </figure>
</div>
<p class="indented continued">
Thus, the grid cells occupied are, resp. [​[​(7, 6, 3)​]​], [​[​(7, 6, 3)​]​], and [​[​(7, 6, 4)​]​].
The backing storage can then be [​[​(1, 2, 3)​]​],
and the map can take the form
</p>
<div class="mathnospace real">
[​![​
<!--"-->g_{xyz} \mapsto \begin{cases}<!--"-->
<!--"-->	[1, 3) & \text{if}\ g_{xyz} = (7, 6, 3)\\<!--"-->
<!--"-->	[3, 4) & \text{if}\ g_{xyz} = (7, 6, 4)\\<!--"-->
<!--"-->	[1, 1) & \text{otherwise}\\<!--"-->
<!--"-->\end{cases}\\<!--"-->
​]!​]
</div>
<p class="continuing">
since all other cells are empty.
(The backing storage could also be [​[​(3, 2, 1)​]​], and the map return [​[​[2, 4<!--(-->)​]​]/[​[​[1, 1<!--(-->)​]​].)
</p>
<p class="indented continuing">
Realistically, both the map and backing storage are "a big array" — of
<samp>uint2</samp>s with dimension [​[​G^3​]​] and
<samp>uint</samp>s with dimension [​[​\overline{Set(D)}​]​] respectively.
It's<!--'--> theoretically possible to implement [​[​h​]​] by collecting the points for each grid cell coordinate separately, like the definition,
but this would be [​[​O(n^2)​]​], so pre-calculating the grid cell coordinates for each point, then collecting them, is [​[​O(n)​]​].
To that end, with [​[​g​]​] as <samp>lab_to_gridpos</samp> and [​[​G​]​] as <samp>GRID_SIZE</samp>,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/shader.h#L9"><samp>shader.h</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">GRID_SIZE</span> <span class="token expression"><span class="token number">100</span></span></span>
<span class="token keyword">struct</span> <span class="token class-name">groupdesc_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint</span> start_idx<span class="token punctuation">,</span> end_idx<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token class-name">groupdesc_t</span> group_ranges<span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">float3</span> <span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span><span class="token keyword">float3</span> pos<span class="token punctuation">,</span> <span class="token keyword">float3</span> bbox_min<span class="token punctuation">,</span> <span class="token keyword">float3</span> bbox_range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"-->pos <span class="token operator">=</span> <span class="token punctuation">(</span>pos <span class="token operator">-</span> bbox_min<span class="token punctuation">)</span> <span class="token operator">/</span> bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">return</span> <span class="token keyword">min</span><span class="token punctuation">(</span>pos <span class="token operator">*</span> GRID_SIZE<span class="token punctuation">,</span> GRID_SIZE <span class="token operator">-</span> <span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
<samp>groupdesc_t</samp> has the same lay-out as <samp>uint2</samp>, and putting it in an array like this doesn't<!--'--> induce additional padding.
The total size of <samp>params_t</samp>, and, thus, usage of precious <samp>DEVICE_LOCAL & HOST_VISIBLE & HOST_COHERENT</samp> memory,
grows by [​[​G^3 \operatorname{sizeof}(\texttt{uint2}) = 8\text{MB}​]​], which is good to know but otherwise negligible.
</p>
<p class="indented continuing">
[​[​g​]​]'s<!--'--> [​[​\varepsilon = 0.001​]​] is just as good as any other value (so long as it actually exists around [​[​G​]​]);
the optimiser lowers this to a constant.
The pre-computation can thus be [​[​\operatorname{trunc} \circ g​]​] directly in
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/assign_cell.hlsl#L22"><samp>assign_cell.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>
<small style='display: block; line-height: initial;'>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->outputs<span class="token punctuation">;</span><!--"-->            <!--"--><span class="token comment">// HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>

</small><span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_min<!--"-->       <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_range<!--"-->     <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_range<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->	    <!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">uint3</span> gridpos <span class="token operator">=</span> <span class="token keyword">trunc</span><span class="token punctuation">(</span><span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	              <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	              <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>z <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
this <del>ab</del>uses <samp>outputs</samp> as an output buffer —
this is fine, since the size used is [​[​\texttt{known_rgbs.len()} \cdot \operatorname{sizeof}(\texttt{uint})​]​],
and the allocation is [​[​2^{24} \operatorname{sizeof}(\texttt{float4})​]​],
which is guaranteed to be at least <span class="roboto-unscale math-font-normal">4×</span> larger.
Obviously the packing would need to be changed for [​[​G > \mathrm{FF}_{16}​]​].
This will not pose an issue.
</p>
<p class="indented continuing">
Shaders can include <samp>shader.h</samp> to have one source of truth for [​[​G​]​], but the Rust driver can't.<!--'-->
This is emulated in
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/build.rs#L5"><samp>build.rs</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> grid_size <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token string">"src/shader.h"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>l<span class="token closure-punctuation punctuation">|</span></span> l<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"#define GRID_SIZE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var_os</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"grid_size.rs"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>grid_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ... glslc</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
So, with, [​[​h​]​] as <samp>groups_data</samp>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">ASSIGN_CELL</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">FIND_BBOX</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// &amp;c.</span>

<span class="token keyword">const</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token macro property">include!</span><span class="token punctuation">(</span><span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/grid_size.rs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token attribute attr-name">#[repr(C)]</span>
</small><span class="token keyword">struct</span> <span class="token type-definition class-name">GroupDesc</span> <span class="token punctuation">{</span>
<!--"-->	<!--"-->start_idx<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->end_idx<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><span class="token attribute attr-name">#[repr(C)]</span>
</small><span class="token keyword">struct</span> <span class="token type-definition class-name">ParamsT</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->group_ranges<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">GroupDesc</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">SHADER_MAX_BINDING</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->buffer_outputs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->           <!--"--><span class="token comment">// [[vk::binding(0)]] <abbr title="StructuredBuffer">SB</abbr>&lt;float3><!--"-->          <!--"-->outputs;<!--"-->           <!--"-->[HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_params<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->            <!--"--><span class="token comment">// [[vk::binding(1)]] <abbr title="StructuredBuffer">SB</abbr>&lt;params_t><!--"-->        <!--"-->params;<!--"-->            <!--"-->[DEVICE_LOCAL &amp; HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_known_rgbs_bundle<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span> <span class="token comment">// [[vk::binding(2)]] <abbr title="StructuredBuffer">SB</abbr>&lt;known_rgbs_pack> known_rgbs_bundle; [DEVICE_LOCAL &amp; HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_known_rgbs_freqs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->  <!--"--><span class="token comment">// [[vk::binding(3)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint><!--"-->            <!--"-->known_rgbs_freqs;<!--"-->  <!--"-->[DEVICE_LOCAL &amp; HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_groups_data<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->       <!--"--><span class="token comment">// [[vk::binding(4)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint><!--"-->            <!--"-->groups_data;<!--"-->       <!--"-->[DEVICE_LOCAL]</span>

<!--"-->	<!--"-->groups_accumulator<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token keyword">let</span> physical_device_properties <span class="token operator">=</span> vk_instance<span class="token punctuation">.</span><span class="token function">get_physical_device_properties</span><span class="token punctuation">(</span>physical_device<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token constant">SHADER_MAX_BINDING</span> <span class="token operator">&lt;</span> physical_device_properties<span class="token punctuation">.</span>limits<span class="token punctuation">.</span>max_bound_descriptor_sets<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">let</span> output_memory_type_index <span class="token operator">=</span> memory_types<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>memory_type<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->memory_type<span class="token punctuation">.</span>property_flags<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">MemoryPropertyFlags</span><span class="token punctuation">::</span><span class="token constant">HOST_VISIBLE</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
<!--"-->			<!--"-->memory_type<span class="token punctuation">.</span>property_flags<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">MemoryPropertyFlags</span><span class="token punctuation">::</span><span class="token constant">HOST_COHERENT</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"No output memory type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> input_memory_type_index <span class="token operator">=</span> memory_types<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>memory_type<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->memory_type<span class="token punctuation">.</span>property_flags<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">MemoryPropertyFlags</span><span class="token punctuation">::</span><span class="token constant">DEVICE_LOCAL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
<!--"-->			<!--"-->memory_type<span class="token punctuation">.</span>property_flags<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">MemoryPropertyFlags</span><span class="token punctuation">::</span><span class="token constant">HOST_VISIBLE</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
<!--"-->			<!--"-->memory_type<span class="token punctuation">.</span>property_flags<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">MemoryPropertyFlags</span><span class="token punctuation">::</span><span class="token constant">HOST_COHERENT</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span>output_memory_type_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> input_memory_type_index <span class="token operator">=</span> memory_types<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>memory_type<span class="token closure-punctuation punctuation">|</span></span> memory_type<span class="token punctuation">.</span>property_flags<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">MemoryPropertyFlags</span><span class="token punctuation">::</span><span class="token constant">DEVICE_LOCAL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span>output_memory_type_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// vk::BufferUsageFlags::STORAGE_BUFFER<!--"-->              <!--"-->| ::TRANSFER_SRC ⬎<!--"-->       <!--"-->⬐ ::TRANSFER_DST</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_outputs<!--"-->           <!--"--><span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>output_memory_type_index<span class="token punctuation">,</span><!--"-->  <!--"--><span class="token boolean">true</span><span class="token punctuation">,</span><!--"-->  <!--"--><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_params<!--"-->            <!--"--><span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>input_memory_type_index<span class="token punctuation">,</span><!--"-->   <!--"--><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_known_rgbs_bundle <span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>input_memory_type_index<span class="token punctuation">,</span><!--"-->   <!--"--><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_known_rgbs_freqs<!--"-->  <!--"--><span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>input_memory_type_index<span class="token punctuation">,</span><!--"-->   <!--"--><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_groups_data<!--"-->       <!--"--><span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>private_memory_type_index<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->ret<span class="token punctuation">.</span>groups_accumulator <span class="token operator">=</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token class-name">MaybeUninit</span><span class="token operator">&lt;</span><span class="token string">_</span><span class="token operator">>></span><span class="token punctuation">::</span><span class="token function">assume_init</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new_uninit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		<!--"--><span class="token keyword">for</span> ga <span class="token keyword">in</span> ret<span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span>ga <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token string">_</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_groups_data<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span>known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span> freq_weighting <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span>known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>

<!--"-->	<!--"--><span class="token comment">// memset(self.buffer_params.buffer, 0, *); ⇔ self.buffer_params_map = mem::zeroed();</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_fill_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token constant">WHOLE_SIZE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>known_rgbs_len<!--"-->   <!--"--><span class="token operator">=</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<!--"-->         <!--"--><span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">::</span><span class="token function">from_bits</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token comment">// bbox_range/bbox_max<!--"-->          <!--"-->already = 0x00000000 from memset()</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>radiussy_squared <span class="token operator">=</span> radiussy <span class="token operator">*</span> radiussy<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>iter_limit<!--"-->       <!--"--><span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token comment">// ... through find_bbox.hlsl &amp;c.</span>

<!--"-->	<!--"--><span class="token comment">// assign_cell.hlsl</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">ASSIGN_CELL</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// grouping</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_groupcoords<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">for</span> group <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->group<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> groupcoord<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs_groupcoords<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>groupcoord <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		                 <!--"--><span class="token punctuation">(</span>groupcoord <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">,</span>
<!--"-->		                 <!--"--><span class="token punctuation">(</span>groupcoord <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"--><span class="token comment">// copying</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> known_rgbs_groups<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">_</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>gr_z<span class="token punctuation">,</span> ga_z<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->	               <!--"--><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><!--"-->    <!--"--><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">if</span> ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">let</span> start <span class="token operator">=</span> cur<span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token comment">// memcpy(known_rgbs_groups,<!--"-->               <!--"-->ga_z.as_ptr(), ga_z.len())</span>
<!--"-->			<!--"-->known_rgbs_groups<span class="token punctuation">.</span><span class="token function">copy_from_nonoverlapping</span><span class="token punctuation">(</span>ga_z<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"-->cur <span class="token operator">+=</span> ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"-->known_rgbs_groups <span class="token operator">=</span> known_rgbs_groups<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token operator">*</span>gr_z <span class="token operator">=</span> <span class="token class-name">GroupDesc</span> <span class="token punctuation">{</span>
<!--"-->				<!--"-->start_idx<span class="token punctuation">:</span> start<span class="token punctuation">,</span>
<!--"-->				<!--"-->end_idx<span class="token punctuation">:</span> cur<span class="token punctuation">,</span>
<!--"-->			<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span>cur <span class="token operator">==</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// memcpy(self.buffer_groups_data, self.buffer_outputs, known_rgbs * mem::size_of::&lt;u32>());</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_copy_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_groups_data<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span>
<!--"-->	                            <!--"--><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">BufferCopy</span> <span class="token punctuation">{</span>
<!--"-->	                              	<!--"-->src_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->	                              	<!--"-->dst_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->	                              	<!--"-->size<span class="token punctuation">:</span> known_rgbs <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->	                              <!--"--><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// ... posterise.hlsl/posterise_mul.hlsl &amp;c.</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continued">
This is the first time more than the aforementioned <span class="roboto-unscale math-font-normal">4</span> bindings are used;
checking this a priori potentially avoids a more confusing error later, but this will never be triggered on real implementations.
</p>
<p class="indented continuing">
<samp>groups_data</samp> is, from the perspective of the host, write-only/write-once for each image,
so it can live in <code>DEVICE_LOCAL</code> memory and be uploaded via <samp>outputs</samp>
(AIUI this technique is called the "staging buffer";
 bounds used same as <samp>find_bbox.hlsl</samp>'s<!--'-->).
This also means that they need to be allocated with the right <samp>TRANSFER_<var>direction</var></samp> flags.
</p>
<p class="indented continuing">
<samp>groups_accumulator</samp> is a similar size to the [​[​8\text{MB}​]​] —
[​[​G^3 \cdot \operatorname{sizeof}(\texttt{Vec&lt;_>}) = G^3 \cdot 3 \operatorname{sizeof}(\texttt{usize}) = 24\text{MB}_\text{LP64} \vee 12\text{MB}_\text{ILP32}​]​]
would blow any stack and it's<!--'--> impossible to use objects too large to spill in Rust (I tried!),
so it needs to go in an additional allocation and then be initialised piece-meal.
<samp>Vec</samp>s can't<!--'--> be all-<samp>0</samp> so is it in principle UB to <samp>assume_init(new_uninit())</samp>, then force-initialise them? Maybe.
Is this a real concern? no.
</p>
<p class="indented continuing">
Like-wise due to its size, <samp>params</samp> can no longer be cleared by re-assignment (it'd<!--'--> be a <samp>memcpy(mapping ← stack)</samp>),
and it makes no sense to clear it with an actual <samp>memset()</samp>, effectively uploading [​[​8\text{MB}​]​] of zeroes to <samp>DEVICE_LOCAL</samp> memory.
Thus, a device-side memset — <a href="//registry.khronos.org/vulkan/specs/latest/man/html/vkCmdFillBuffer.html"><samp>vkCmdFillBuffer()</samp></a> —
is dispatched, working exactly as you'd<!--'--> expect (except it sets whole <samp>uint</samp>s instead of bytes),
and completing too quickly to measure above the fixed submission overhead of a couple dozen μs.
From the point of buffer usage, this is a transfer from a null page, hence <samp>TRANSFER_DST</samp>.
</p>
<p class="indented continuing">
Collecting the indices in each cell (<q>grouping</q>) is expensive but can't<!--'--> be meaningfully sped up.
Neither can <q>copying</q> the data, beyond only copying the index ranges for non-empty cells
(after the memset, the default value is [​[​[0, 0 ) = \varnothing​]​] which is what we'd<!--'--> be writing anyway),
but that is relatively quick:
</p>
<!--
67.013µs: cmdbussy 16755 assign_cell.hlsl
69.428µs: cmdbussy 16755 assign_cell.hlsl
64.297µs: cmdbussy 16755 assign_cell.hlsl
70.333µs: cmdbussy 16755 assign_cell.hlsl
84.823µs: cmdbussy 16755 assign_cell.hlsl
83.917µs: cmdbussy 16755 assign_cell.hlsl
64.598µs: cmdbussy 16755 assign_cell.hlsl
67.919µs: cmdbussy 16755 assign_cell.hlsl
81.502µs: cmdbussy 16755 assign_cell.hlsl
74.862µs: cmdbussy 16755 assign_cell.hlsl
74.257µs: cmdbussy 16755 assign_cell.hlsl
104.142µs: cmdbussy 16755 assign_cell.hlsl
65.202µs: cmdbussy 16755 assign_cell.hlsl
67.919µs: cmdbussy 16755 assign_cell.hlsl
89.351µs: cmdbussy 16755 assign_cell.hlsl
70.636µs: cmdbussy 16755 assign_cell.hlsl
81.805µs: cmdbussy 16755 assign_cell.hlsl
84.521µs: cmdbussy 16755 assign_cell.hlsl
64.599µs: cmdbussy 16755 assign_cell.hlsl
67.919µs: cmdbussy 16755 assign_cell.hlsl
104.746µs: cmdbussy 16755 assign_cell.hlsl
67.013µs: cmdbussy 16755 assign_cell.hlsl
74.862µs: cmdbussy 16755 assign_cell.hlsl
67.617µs: cmdbussy 16755 assign_cell.hlsl
67.013µs: cmdbussy 16755 assign_cell.hlsl
88.144µs: cmdbussy 16755 assign_cell.hlsl
65.202µs: cmdbussy 16755 assign_cell.hlsl
80.295µs: cmdbussy 16755 assign_cell.hlsl
65.504µs: cmdbussy 16755 assign_cell.hlsl
69.428µs: cmdbussy 16755 assign_cell.hlsl
89.049µs: cmdbussy 16755 assign_cell.hlsl
66.712µs: cmdbussy 16755 assign_cell.hlsl
71.843µs: cmdbussy 16755 assign_cell.hlsl
90.558µs: cmdbussy 16755 assign_cell.hlsl
71.239µs: cmdbussy 16755 assign_cell.hlsl
87.54µs: cmdbussy 16755 assign_cell.hlsl
69.127µs: cmdbussy 16755 assign_cell.hlsl
70.334µs: cmdbussy 16755 assign_cell.hlsl
109.576µs: cmdbussy 16755 assign_cell.hlsl
73.956µs: cmdbussy 16755 assign_cell.hlsl
73.051µs: cmdbussy 16755 assign_cell.hlsl
73.352µs: cmdbussy 16755 assign_cell.hlsl
92.671µs: cmdbussy 16755 assign_cell.hlsl
70.937µs: cmdbussy 16755 assign_cell.hlsl
99.916µs: cmdbussy 16755 assign_cell.hlsl
85.125µs: cmdbussy 16755 assign_cell.hlsl
59.467µs: cmdbussy 16755 assign_cell.hlsl
76.974µs: cmdbussy 16755 assign_cell.hlsl
73.352µs: cmdbussy 16755 assign_cell.hlsl
73.956µs: cmdbussy 16755 assign_cell.hlsl
68.221µs: cmdbussy 16755 assign_cell.hlsl
78.182µs: cmdbussy 16755 assign_cell.hlsl
75.465µs: cmdbussy 16755 assign_cell.hlsl
94.784µs: cmdbussy 16755 assign_cell.hlsl
66.711µs: cmdbussy 16755 assign_cell.hlsl
66.41µs: cmdbussy 16755 assign_cell.hlsl
66.711µs: cmdbussy 16755 assign_cell.hlsl
88.143µs: cmdbussy 16755 assign_cell.hlsl
60.674µs: cmdbussy 16755 assign_cell.hlsl
69.73µs: cmdbussy 16755 assign_cell.hlsl
82.408µs: cmdbussy 16755 assign_cell.hlsl
91.162µs: cmdbussy 16755 assign_cell.hlsl
63.994µs: cmdbussy 16755 assign_cell.hlsl
66.711µs: cmdbussy 16755 assign_cell.hlsl
67.918µs: cmdbussy 16755 assign_cell.hlsl
97.199µs: cmdbussy 16755 assign_cell.hlsl
74.56µs: cmdbussy 16755 assign_cell.hlsl
83.314µs: cmdbussy 16755 assign_cell.hlsl
81.2µs: cmdbussy 16755 assign_cell.hlsl
86.031µs: cmdbussy 16755 assign_cell.hlsl
108.066µs: cmdbussy 16755 assign_cell.hlsl
64.9µs: cmdbussy 16755 assign_cell.hlsl
75.767µs: cmdbussy 16755 assign_cell.hlsl
63.994µs: cmdbussy 16755 assign_cell.hlsl
87.237µs: cmdbussy 16755 assign_cell.hlsl
66.711µs: cmdbussy 16755 assign_cell.hlsl
74.56µs: cmdbussy 16755 assign_cell.hlsl
85.125µs: cmdbussy 16755 assign_cell.hlsl
101.124µs: cmdbussy 16755 assign_cell.hlsl
84.521µs: cmdbussy 27868 assign_cell.hlsl
106.859µs: cmdbussy 27868 assign_cell.hlsl
102.331µs: cmdbussy 27868 assign_cell.hlsl
80.898µs: cmdbussy 27868 assign_cell.hlsl
86.031µs: cmdbussy 27868 assign_cell.hlsl
103.236µs: cmdbussy 27868 assign_cell.hlsl
99.916µs: cmdbussy 27868 assign_cell.hlsl
97.199µs: cmdbussy 27868 assign_cell.hlsl
77.276µs: cmdbussy 27868 assign_cell.hlsl
90.256µs: cmdbussy 27868 assign_cell.hlsl
106.859µs: cmdbussy 27868 assign_cell.hlsl
86.935µs: cmdbussy 27868 assign_cell.hlsl
89.652µs: cmdbussy 27868 assign_cell.hlsl
80.597µs: cmdbussy 27868 assign_cell.hlsl
70.032µs: cmdbussy 27868 assign_cell.hlsl
84.219µs: cmdbussy 27868 assign_cell.hlsl
83.011µs: cmdbussy 27868 assign_cell.hlsl
100.218µs: cmdbussy 27868 assign_cell.hlsl
90.558µs: cmdbussy 27868 assign_cell.hlsl
87.539µs: cmdbussy 27868 assign_cell.hlsl
103.84µs: cmdbussy 27868 assign_cell.hlsl
90.256µs: cmdbussy 27868 assign_cell.hlsl
98.105µs: cmdbussy 27868 assign_cell.hlsl
105.651µs: cmdbussy 27868 assign_cell.hlsl
115.009µs: cmdbussy 27868 assign_cell.hlsl
81.804µs: cmdbussy 27868 assign_cell.hlsl
91.162µs: cmdbussy 27868 assign_cell.hlsl
102.331µs: cmdbussy 27868 assign_cell.hlsl
106.859µs: cmdbussy 27868 assign_cell.hlsl
78.786µs: cmdbussy 27868 assign_cell.hlsl
93.879µs: cmdbussy 27868 assign_cell.hlsl
118.631µs: cmdbussy 27868 assign_cell.hlsl
84.823µs: cmdbussy 27868 assign_cell.hlsl
78.484µs: cmdbussy 27868 assign_cell.hlsl
106.255µs: cmdbussy 27868 assign_cell.hlsl
116.519µs: cmdbussy 27868 assign_cell.hlsl
78.785µs: cmdbussy 27868 assign_cell.hlsl
135.234µs: cmdbussy 27868 assign_cell.hlsl
121.348µs: cmdbussy 27868 assign_cell.hlsl
106.859µs: cmdbussy 27868 assign_cell.hlsl
74.257µs: cmdbussy 27868 assign_cell.hlsl
124.971µs: cmdbussy 27868 assign_cell.hlsl
113.801µs: cmdbussy 27868 assign_cell.hlsl
76.975µs: cmdbussy 27868 assign_cell.hlsl
90.86µs: cmdbussy 27868 assign_cell.hlsl
85.728µs: cmdbussy 27868 assign_cell.hlsl
133.12µs: cmdbussy 27868 assign_cell.hlsl
111.085µs: cmdbussy 27868 assign_cell.hlsl
124.367µs: cmdbussy 27868 assign_cell.hlsl
106.255µs: cmdbussy 27868 assign_cell.hlsl
74.257µs: cmdbussy 27868 assign_cell.hlsl
86.031µs: cmdbussy 27868 assign_cell.hlsl
110.481µs: cmdbussy 27868 assign_cell.hlsl
86.03µs: cmdbussy 27868 assign_cell.hlsl
94.483µs: cmdbussy 27868 assign_cell.hlsl
143.384µs: cmdbussy 27868 assign_cell.hlsl
92.37µs: cmdbussy 27868 assign_cell.hlsl
103.538µs: cmdbussy 27868 assign_cell.hlsl
73.352µs: cmdbussy 27868 assign_cell.hlsl
91.162µs: cmdbussy 27868 assign_cell.hlsl
86.031µs: cmdbussy 27868 assign_cell.hlsl
71.239µs: cmdbussy 27868 assign_cell.hlsl
84.219µs: cmdbussy 27868 assign_cell.hlsl
74.861µs: cmdbussy 27868 assign_cell.hlsl
76.069µs: cmdbussy 27868 assign_cell.hlsl
89.049µs: cmdbussy 27868 assign_cell.hlsl
97.501µs: cmdbussy 27868 assign_cell.hlsl
92.671µs: cmdbussy 27868 assign_cell.hlsl
78.786µs: cmdbussy 27868 assign_cell.hlsl
80.295µs: cmdbussy 27868 assign_cell.hlsl
83.917µs: cmdbussy 27868 assign_cell.hlsl
100.52µs: cmdbussy 27868 assign_cell.hlsl
76.068µs: cmdbussy 27868 assign_cell.hlsl
79.691µs: cmdbussy 27868 assign_cell.hlsl
125.876µs: cmdbussy 27868 assign_cell.hlsl
89.351µs: cmdbussy 27868 assign_cell.hlsl
100.217µs: cmdbussy 27868 assign_cell.hlsl
72.749µs: cmdbussy 27868 assign_cell.hlsl
115.009µs: cmdbussy 27868 assign_cell.hlsl
102.935µs: cmdbussy 27868 assign_cell.hlsl
137.045µs: cmdbussy 27868 assign_cell.hlsl
76.975µs: cmdbussy 27868 assign_cell.hlsl
75.163µs: cmdbussy 27868 assign_cell.hlsl
75.466µs: cmdbussy 27868 assign_cell.hlsl
107.16µs: cmdbussy 27868 assign_cell.hlsl
74.559µs: cmdbussy 27868 assign_cell.hlsl
85.125µs: cmdbussy 27868 assign_cell.hlsl
101.123µs: cmdbussy 27868 assign_cell.hlsl
71.843µs: cmdbussy 27868 assign_cell.hlsl
108.67µs: cmdbussy 27868 assign_cell.hlsl
100.821µs: cmdbussy 27868 assign_cell.hlsl
76.371µs: cmdbussy 27868 assign_cell.hlsl
83.011µs: cmdbussy 27868 assign_cell.hlsl
98.708µs: cmdbussy 27868 assign_cell.hlsl
107.764µs: cmdbussy 84860 assign_cell.hlsl
131.309µs: cmdbussy 84860 assign_cell.hlsl
127.989µs: cmdbussy 84860 assign_cell.hlsl
107.462µs: cmdbussy 84860 assign_cell.hlsl
106.556µs: cmdbussy 84860 assign_cell.hlsl
111.387µs: cmdbussy 84860 assign_cell.hlsl
125.574µs: cmdbussy 84860 assign_cell.hlsl
114.405µs: cmdbussy 84860 assign_cell.hlsl
123.159µs: cmdbussy 84860 assign_cell.hlsl
177.494µs: cmdbussy 84860 assign_cell.hlsl
148.516µs: cmdbussy 84860 assign_cell.hlsl
110.481µs: cmdbussy 84860 assign_cell.hlsl
129.498µs: cmdbussy 84860 assign_cell.hlsl
106.858µs: cmdbussy 84860 assign_cell.hlsl
107.462µs: cmdbussy 84860 assign_cell.hlsl
108.368µs: cmdbussy 84860 assign_cell.hlsl
131.31µs: cmdbussy 84860 assign_cell.hlsl
115.31µs: cmdbussy 84860 assign_cell.hlsl
127.687µs: cmdbussy 84860 assign_cell.hlsl
118.632µs: cmdbussy 84860 assign_cell.hlsl
150.629µs: cmdbussy 84860 assign_cell.hlsl
144.289µs: cmdbussy 84860 assign_cell.hlsl
111.386µs: cmdbussy 84860 assign_cell.hlsl
106.255µs: cmdbussy 84860 assign_cell.hlsl
136.743µs: cmdbussy 84860 assign_cell.hlsl
117.725µs: cmdbussy 84860 assign_cell.hlsl
106.255µs: cmdbussy 84860 assign_cell.hlsl
102.632µs: cmdbussy 84860 assign_cell.hlsl
116.217µs: cmdbussy 84860 assign_cell.hlsl
161.194µs: cmdbussy 84860 assign_cell.hlsl
110.782µs: cmdbussy 84860 assign_cell.hlsl
127.687µs: cmdbussy 84860 assign_cell.hlsl
108.368µs: cmdbussy 84860 assign_cell.hlsl
104.746µs: cmdbussy 84860 assign_cell.hlsl
105.048µs: cmdbussy 84860 assign_cell.hlsl
107.463µs: cmdbussy 84860 assign_cell.hlsl
105.953µs: cmdbussy 84860 assign_cell.hlsl
124.97µs: cmdbussy 84860 assign_cell.hlsl
112.594µs: cmdbussy 84860 assign_cell.hlsl
131.611µs: cmdbussy 84860 assign_cell.hlsl
111.689µs: cmdbussy 84860 assign_cell.hlsl
116.82µs: cmdbussy 84860 assign_cell.hlsl
111.085µs: cmdbussy 84860 assign_cell.hlsl
125.272µs: cmdbussy 84860 assign_cell.hlsl
138.856µs: cmdbussy 84860 assign_cell.hlsl
130.404µs: cmdbussy 84860 assign_cell.hlsl
136.743µs: cmdbussy 84860 assign_cell.hlsl
106.859µs: cmdbussy 84860 assign_cell.hlsl
141.573µs: cmdbussy 84860 assign_cell.hlsl
125.876µs: cmdbussy 84860 assign_cell.hlsl
119.537µs: cmdbussy 84860 assign_cell.hlsl
109.274µs: cmdbussy 84860 assign_cell.hlsl
148.516µs: cmdbussy 84860 assign_cell.hlsl
130.102µs: cmdbussy 84860 assign_cell.hlsl
107.462µs: cmdbussy 84860 assign_cell.hlsl
123.159µs: cmdbussy 84860 assign_cell.hlsl
107.462µs: cmdbussy 84860 assign_cell.hlsl
111.688µs: cmdbussy 84860 assign_cell.hlsl
128.894µs: cmdbussy 84860 assign_cell.hlsl
107.161µs: cmdbussy 84860 assign_cell.hlsl
121.348µs: cmdbussy 84860 assign_cell.hlsl
132.215µs: cmdbussy 84860 assign_cell.hlsl
139.761µs: cmdbussy 84860 assign_cell.hlsl
107.462µs: cmdbussy 84860 assign_cell.hlsl
108.67µs: cmdbussy 84860 assign_cell.hlsl
110.783µs: cmdbussy 84860 assign_cell.hlsl
133.121µs: cmdbussy 84860 assign_cell.hlsl
114.405µs: cmdbussy 84860 assign_cell.hlsl
111.084µs: cmdbussy 84860 assign_cell.hlsl
132.517µs: cmdbussy 84860 assign_cell.hlsl
142.478µs: cmdbussy 84860 assign_cell.hlsl
108.972µs: cmdbussy 84860 assign_cell.hlsl
105.349µs: cmdbussy 84860 assign_cell.hlsl
111.99µs: cmdbussy 84860 assign_cell.hlsl
106.255µs: cmdbussy 84860 assign_cell.hlsl
105.349µs: cmdbussy 84860 assign_cell.hlsl
125.574µs: cmdbussy 84860 assign_cell.hlsl
128.592µs: cmdbussy 84860 assign_cell.hlsl
146.403µs: cmdbussy 84860 assign_cell.hlsl
116.82µs: cmdbussy 84860 assign_cell.hlsl
118.028µs: cmdbussy 84860 assign_cell.hlsl
125.876µs: cmdbussy 84860 assign_cell.hlsl
144.29µs: cmdbussy 84860 assign_cell.hlsl
125.574µs: cmdbussy 84860 assign_cell.hlsl
115.311µs: cmdbussy 84860 assign_cell.hlsl
111.99µs: cmdbussy 84860 assign_cell.hlsl
111.085µs: cmdbussy 84860 assign_cell.hlsl
111.085µs: cmdbussy 84860 assign_cell.hlsl
111.689µs: cmdbussy 84860 assign_cell.hlsl
114.406µs: cmdbussy 84860 assign_cell.hlsl
130.706µs: cmdbussy 84860 assign_cell.hlsl
106.255µs: cmdbussy 84860 assign_cell.hlsl
138.252µs: cmdbussy 84860 assign_cell.hlsl
114.103µs: cmdbussy 84860 assign_cell.hlsl
118.329µs: cmdbussy 84860 assign_cell.hlsl
117.423µs: cmdbussy 84860 assign_cell.hlsl
134.026µs: cmdbussy 84860 assign_cell.hlsl
112.292µs: cmdbussy 84860 assign_cell.hlsl
113.801µs: cmdbussy 84860 assign_cell.hlsl
116.518µs: cmdbussy 84860 assign_cell.hlsl
141.271µs: cmdbussy 84860 assign_cell.hlsl
126.781µs: cmdbussy 84860 assign_cell.hlsl
112.896µs: cmdbussy 84860 assign_cell.hlsl
121.65µs: cmdbussy 84860 assign_cell.hlsl
111.386µs: cmdbussy 84860 assign_cell.hlsl
113.5µs: cmdbussy 84860 assign_cell.hlsl
112.292µs: cmdbussy 84860 assign_cell.hlsl
115.914µs: cmdbussy 84860 assign_cell.hlsl
109.575µs: cmdbussy 84860 assign_cell.hlsl
112.896µs: cmdbussy 84860 assign_cell.hlsl
111.386µs: cmdbussy 84860 assign_cell.hlsl
143.082µs: cmdbussy 84860 assign_cell.hlsl
137.95µs: cmdbussy 84860 assign_cell.hlsl
137.045µs: cmdbussy 84860 assign_cell.hlsl
114.707µs: cmdbussy 84860 assign_cell.hlsl
142.177µs: cmdbussy 84860 assign_cell.hlsl
122.555µs: cmdbussy 84860 assign_cell.hlsl
137.045µs: cmdbussy 84860 assign_cell.hlsl
119.235µs: cmdbussy 84860 assign_cell.hlsl
109.877µs: cmdbussy 84860 assign_cell.hlsl
130.706µs: cmdbussy 84860 assign_cell.hlsl
105.953µs: cmdbussy 84860 assign_cell.hlsl
140.969µs: cmdbussy 84860 assign_cell.hlsl
143.384µs: cmdbussy 84860 assign_cell.hlsl
121.65µs: cmdbussy 84860 assign_cell.hlsl
126.48µs: cmdbussy 84860 assign_cell.hlsl
128.29µs: cmdbussy 84860 assign_cell.hlsl
110.481µs: cmdbussy 84860 assign_cell.hlsl
201.643µs: cmdbussy 242931 assign_cell.hlsl
252.054µs: cmdbussy 242931 assign_cell.hlsl
216.736µs: cmdbussy 242931 assign_cell.hlsl
219.151µs: cmdbussy 242931 assign_cell.hlsl
243.903µs: cmdbussy 242931 assign_cell.hlsl
220.358µs: cmdbussy 242931 assign_cell.hlsl
218.849µs: cmdbussy 242931 assign_cell.hlsl
223.981µs: cmdbussy 242931 assign_cell.hlsl
206.775µs: cmdbussy 242931 assign_cell.hlsl
230.018µs: cmdbussy 242931 assign_cell.hlsl
210.095µs: cmdbussy 242931 assign_cell.hlsl
229.112µs: cmdbussy 242931 assign_cell.hlsl
231.225µs: cmdbussy 242931 assign_cell.hlsl
235.149µs: cmdbussy 242931 assign_cell.hlsl
226.396µs: cmdbussy 242931 assign_cell.hlsl
227.905µs: cmdbussy 242931 assign_cell.hlsl
212.51µs: cmdbussy 242931 assign_cell.hlsl
231.829µs: cmdbussy 242931 assign_cell.hlsl
201.341µs: cmdbussy 242931 assign_cell.hlsl
251.148µs: cmdbussy 242931 assign_cell.hlsl
240.281µs: cmdbussy 242931 assign_cell.hlsl
232.735µs: cmdbussy 242931 assign_cell.hlsl
212.812µs: cmdbussy 242931 assign_cell.hlsl
202.247µs: cmdbussy 242931 assign_cell.hlsl
228.81µs: cmdbussy 242931 assign_cell.hlsl
219.151µs: cmdbussy 242931 assign_cell.hlsl
247.526µs: cmdbussy 242931 assign_cell.hlsl
223.98µs: cmdbussy 242931 assign_cell.hlsl
241.187µs: cmdbussy 242931 assign_cell.hlsl
253.865µs: cmdbussy 242931 assign_cell.hlsl
246.62µs: cmdbussy 242931 assign_cell.hlsl
208.586µs: cmdbussy 242931 assign_cell.hlsl
217.641µs: cmdbussy 242931 assign_cell.hlsl
201.341µs: cmdbussy 242931 assign_cell.hlsl
203.756µs: cmdbussy 242931 assign_cell.hlsl
211.302µs: cmdbussy 242931 assign_cell.hlsl
216.736µs: cmdbussy 242931 assign_cell.hlsl
214.925µs: cmdbussy 242931 assign_cell.hlsl
231.829µs: cmdbussy 242931 assign_cell.hlsl
223.98µs: cmdbussy 242931 assign_cell.hlsl
210.397µs: cmdbussy 242931 assign_cell.hlsl
249.337µs: cmdbussy 242931 assign_cell.hlsl
247.526µs: cmdbussy 242931 assign_cell.hlsl
236.96µs: cmdbussy 242931 assign_cell.hlsl
225.792µs: cmdbussy 242931 assign_cell.hlsl
288.579µs: cmdbussy 328666 assign_cell.hlsl
256.582µs: cmdbussy 328666 assign_cell.hlsl
259.902µs: cmdbussy 328666 assign_cell.hlsl
264.43µs: cmdbussy 328666 assign_cell.hlsl
251.148µs: cmdbussy 328666 assign_cell.hlsl
259.298µs: cmdbussy 328666 assign_cell.hlsl
265.637µs: cmdbussy 328666 assign_cell.hlsl
314.237µs: cmdbussy 328666 assign_cell.hlsl
279.221µs: cmdbussy 328666 assign_cell.hlsl
286.466µs: cmdbussy 328666 assign_cell.hlsl
254.468µs: cmdbussy 328666 assign_cell.hlsl
269.562µs: cmdbussy 328666 assign_cell.hlsl
253.864µs: cmdbussy 328666 assign_cell.hlsl
269.562µs: cmdbussy 328666 assign_cell.hlsl
260.506µs: cmdbussy 328666 assign_cell.hlsl
267.75µs: cmdbussy 328666 assign_cell.hlsl
265.033µs: cmdbussy 328666 assign_cell.hlsl
260.807µs: cmdbussy 328666 assign_cell.hlsl
281.938µs: cmdbussy 328666 assign_cell.hlsl
272.882µs: cmdbussy 328666 assign_cell.hlsl
293.711µs: cmdbussy 328666 assign_cell.hlsl
291.295µs: cmdbussy 328666 assign_cell.hlsl
260.506µs: cmdbussy 328666 assign_cell.hlsl
260.506µs: cmdbussy 328666 assign_cell.hlsl
308.804µs: cmdbussy 328666 assign_cell.hlsl
253.261µs: cmdbussy 328666 assign_cell.hlsl
278.618µs: cmdbussy 328666 assign_cell.hlsl
284.654µs: cmdbussy 328666 assign_cell.hlsl
293.711µs: cmdbussy 328666 assign_cell.hlsl
279.825µs: cmdbussy 328666 assign_cell.hlsl
281.636µs: cmdbussy 328666 assign_cell.hlsl
276.504µs: cmdbussy 328666 assign_cell.hlsl
287.673µs: cmdbussy 328666 assign_cell.hlsl
274.391µs: cmdbussy 328666 assign_cell.hlsl
281.033µs: cmdbussy 328666 assign_cell.hlsl
294.314µs: cmdbussy 328666 assign_cell.hlsl
285.862µs: cmdbussy 328666 assign_cell.hlsl
301.861µs: cmdbussy 328666 assign_cell.hlsl
281.334µs: cmdbussy 328666 assign_cell.hlsl
271.071µs: cmdbussy 328666 assign_cell.hlsl
282.541µs: cmdbussy 328666 assign_cell.hlsl
258.091µs: cmdbussy 328666 assign_cell.hlsl
284.051µs: cmdbussy 328666 assign_cell.hlsl
290.993µs: cmdbussy 328666 assign_cell.hlsl
290.994µs: cmdbussy 328666 assign_cell.hlsl
272.58µs: cmdbussy 328666 assign_cell.hlsl
250.846µs: cmdbussy 328666 assign_cell.hlsl
258.694µs: cmdbussy 328666 assign_cell.hlsl
258.09µs: cmdbussy 328666 assign_cell.hlsl
709.976µs: cmdbussy 1103347 assign_cell.hlsl
722.655µs: cmdbussy 1103347 assign_cell.hlsl
787.856µs: cmdbussy 1103347 assign_cell.hlsl
727.182µs: cmdbussy 1103347 assign_cell.hlsl
716.919µs: cmdbussy 1103347 assign_cell.hlsl
724.466µs: cmdbussy 1103347 assign_cell.hlsl
753.142µs: cmdbussy 1103347 assign_cell.hlsl
758.274µs: cmdbussy 1103347 assign_cell.hlsl
743.181µs: cmdbussy 1103347 assign_cell.hlsl
754.651µs: cmdbussy 1103347 assign_cell.hlsl
762.198µs: cmdbussy 1103347 assign_cell.hlsl
797.818µs: cmdbussy 1103347 assign_cell.hlsl
732.616µs: cmdbussy 1103347 assign_cell.hlsl
715.41µs: cmdbussy 1103347 assign_cell.hlsl
752.236µs: cmdbussy 1103347 assign_cell.hlsl
740.766µs: cmdbussy 1103347 assign_cell.hlsl
720.542µs: cmdbussy 1103347 assign_cell.hlsl
733.521µs: cmdbussy 1103347 assign_cell.hlsl
735.332µs: cmdbussy 1103347 assign_cell.hlsl
731.408µs: cmdbussy 1103347 assign_cell.hlsl
717.825µs: cmdbussy 1103347 assign_cell.hlsl
730.503µs: cmdbussy 1103347 assign_cell.hlsl
712.391µs: cmdbussy 1103347 assign_cell.hlsl
713.296µs: cmdbussy 1103347 assign_cell.hlsl
718.429µs: cmdbussy 1103347 assign_cell.hlsl
737.446µs: cmdbussy 1103347 assign_cell.hlsl
739.256µs: cmdbussy 1103347 assign_cell.hlsl
741.974µs: cmdbussy 1103347 assign_cell.hlsl
745.596µs: cmdbussy 1103347 assign_cell.hlsl
726.276µs: cmdbussy 1103347 assign_cell.hlsl
733.22µs: cmdbussy 1103347 assign_cell.hlsl
753.142µs: cmdbussy 1103347 assign_cell.hlsl
754.954µs: cmdbussy 1103347 assign_cell.hlsl
735.937µs: cmdbussy 1103347 assign_cell.hlsl
725.069µs: cmdbussy 1103347 assign_cell.hlsl
4.186807ms: 16755 grouping
4.152999ms: 16755 grouping
4.148773ms: 16755 grouping
4.198579ms: 16755 grouping
4.101683ms: 16755 grouping
5.09752ms: 16755 grouping
4.082061ms: 16755 grouping
4.621486ms: 16755 grouping
4.224238ms: 16755 grouping
4.712649ms: 16755 grouping
4.729854ms: 16755 grouping
4.051272ms: 16755 grouping
4.440068ms: 16755 grouping
4.693933ms: 16755 grouping
4.168092ms: 16755 grouping
4.641711ms: 16755 grouping
4.130359ms: 16755 grouping
4.716573ms: 16755 grouping
4.635674ms: 16755 grouping
4.911876ms: 16755 grouping
5.34565ms: 16755 grouping
5.018735ms: 16755 grouping
4.706611ms: 16755 grouping
4.848787ms: 16755 grouping
4.5101ms: 16755 grouping
4.412297ms: 16755 grouping
4.971947ms: 16755 grouping
5.184758ms: 16755 grouping
5.089672ms: 16755 grouping
4.916102ms: 16755 grouping
4.57832ms: 16755 grouping
4.081458ms: 16755 grouping
4.705102ms: 16755 grouping
4.981606ms: 16755 grouping
4.239633ms: 16755 grouping
4.91097ms: 16755 grouping
4.560208ms: 16755 grouping
4.885313ms: 16755 grouping
4.869917ms: 16755 grouping
4.860259ms: 16755 grouping
4.536361ms: 16755 grouping
4.794151ms: 16755 grouping
4.501949ms: 16755 grouping
5.267468ms: 16755 grouping
5.050431ms: 16755 grouping
5.036847ms: 16755 grouping
4.998511ms: 16755 grouping
4.94659ms: 16755 grouping
4.924856ms: 16755 grouping
4.80532ms: 16755 grouping
4.76155ms: 16755 grouping
4.076327ms: 16755 grouping
4.869917ms: 16755 grouping
5.009981ms: 16755 grouping
5.194116ms: 16755 grouping
4.789925ms: 16755 grouping
5.084842ms: 16755 grouping
4.801093ms: 16755 grouping
4.200089ms: 16755 grouping
4.950212ms: 16755 grouping
4.845165ms: 16755 grouping
4.736194ms: 16755 grouping
5.024168ms: 16755 grouping
5.184456ms: 16755 grouping
4.99519ms: 16755 grouping
4.32355ms: 16755 grouping
4.929385ms: 16755 grouping
4.354642ms: 16755 grouping
5.252073ms: 16755 grouping
4.658917ms: 16755 grouping
4.832185ms: 16755 grouping
4.617864ms: 16755 grouping
6.799411ms: 16755 grouping
6.778884ms: 16755 grouping
6.842275ms: 16755 grouping
9.93846ms: 16755 grouping
6.333338ms: 16755 grouping
9.850618ms: 16755 grouping
5.399381ms: 16755 grouping
5.89564ms: 16755 grouping
9.945704ms: 16755 grouping
8.057868ms: 16755 grouping
8.948356ms: 16755 grouping
6.921363ms: 16755 grouping
5.540652ms: 16755 grouping
4.621788ms: 16755 grouping
4.755513ms: 16755 grouping
4.749777ms: 16755 grouping
4.844561ms: 16755 grouping
4.497421ms: 16755 grouping
4.817695ms: 16755 grouping
4.835808ms: 16755 grouping
4.269819ms: 16755 grouping
4.841241ms: 16755 grouping
4.533645ms: 16755 grouping
4.840939ms: 16755 grouping
4.829166ms: 16755 grouping
4.882294ms: 16755 grouping
4.859654ms: 16755 grouping
4.832185ms: 16755 grouping
6.62252ms: 16755 grouping
6.961208ms: 16755 grouping
5.402702ms: 16755 grouping
15.11869ms: 16755 grouping
5.987103ms: 16755 grouping
6.579958ms: 16755 grouping
5.574158ms: 16755 grouping
5.27109ms: 16755 grouping
6.202934ms: 16755 grouping
6.297115ms: 16755 grouping
5.186871ms: 16755 grouping
4.764568ms: 16755 grouping
4.472669ms: 16755 grouping
3.996937ms: 16755 grouping
4.913688ms: 16755 grouping
4.488668ms: 16755 grouping
4.727742ms: 16755 grouping
4.817998ms: 16755 grouping
5.028395ms: 16755 grouping
4.875351ms: 16755 grouping
4.489876ms: 16755 grouping
5.319992ms: 16755 grouping
4.925762ms: 16755 grouping
4.755512ms: 16755 grouping
4.923951ms: 16755 grouping
5.566914ms: 16755 grouping
5.607061ms: 16755 grouping
5.075183ms: 16755 grouping
4.552663ms: 16755 grouping
5.502617ms: 16755 grouping
4.288233ms: 16755 grouping
4.843354ms: 16755 grouping
4.63507ms: 16755 grouping
4.82494ms: 16755 grouping
4.420749ms: 16755 grouping
4.74374ms: 16755 grouping
4.534551ms: 16755 grouping
4.904028ms: 16755 grouping
31.002295ms: 242931 grouping
23.239345ms: 242931 grouping
23.876271ms: 242931 grouping
24.259634ms: 242931 grouping
23.572297ms: 242931 grouping
25.766522ms: 242931 grouping
23.477815ms: 242931 grouping
23.818918ms: 242931 grouping
24.35472ms: 242931 grouping
24.043803ms: 242931 grouping
23.375484ms: 242931 grouping
23.831898ms: 242931 grouping
23.307868ms: 242931 grouping
23.831294ms: 242931 grouping
23.507397ms: 242931 grouping
23.362202ms: 242931 grouping
23.687005ms: 242931 grouping
23.249609ms: 242931 grouping
23.9297ms: 242931 grouping
23.880799ms: 242931 grouping
23.690928ms: 242931 grouping
23.683382ms: 242931 grouping
24.723594ms: 242931 grouping
23.808352ms: 242931 grouping
23.496229ms: 242931 grouping
24.142512ms: 242931 grouping
23.666478ms: 242931 grouping
24.838905ms: 242931 grouping
23.855744ms: 242931 grouping
24.4812ms: 242931 grouping
23.337148ms: 242931 grouping
23.834011ms: 242931 grouping
24.497199ms: 242931 grouping
23.083585ms: 242931 grouping
23.539394ms: 242931 grouping
23.888647ms: 242931 grouping
24.284387ms: 242931 grouping
23.712964ms: 242931 grouping
23.323564ms: 242931 grouping
23.526414ms: 242931 grouping
24.547307ms: 242931 grouping
23.363712ms: 242931 grouping
23.822238ms: 242931 grouping
23.37156ms: 242931 grouping
24.184773ms: 242931 grouping
23.74798ms: 242931 grouping
24.893843ms: 242931 grouping
23.959584ms: 242931 grouping
24.526479ms: 242931 grouping
24.999193ms: 242931 grouping
23.855744ms: 242931 grouping
24.131343ms: 242931 grouping
24.81053ms: 242931 grouping
23.282511ms: 242931 grouping
24.387623ms: 242931 grouping
24.044407ms: 242931 grouping
23.421971ms: 242931 grouping
23.626632ms: 242931 grouping
23.882006ms: 242931 grouping
25.121748ms: 242931 grouping
24.861544ms: 242931 grouping
40.273642ms: 328666 grouping
32.836401ms: 328666 grouping
34.446223ms: 328666 grouping
32.622985ms: 328666 grouping
31.442106ms: 328666 grouping
32.243244ms: 328666 grouping
32.137895ms: 328666 grouping
32.55235ms: 328666 grouping
31.918442ms: 328666 grouping
32.041601ms: 328666 grouping
32.979784ms: 328666 grouping
31.362113ms: 328666 grouping
32.110728ms: 328666 grouping
31.920555ms: 328666 grouping
32.386025ms: 328666 grouping
31.638617ms: 328666 grouping
32.779349ms: 328666 grouping
32.517635ms: 328666 grouping
34.259673ms: 328666 grouping
32.066353ms: 328666 grouping
32.008095ms: 328666 grouping
32.553255ms: 328666 grouping
32.843343ms: 328666 grouping
32.465111ms: 328666 grouping
32.180758ms: 328666 grouping
32.374856ms: 328666 grouping
32.827042ms: 328666 grouping
32.569858ms: 328666 grouping
32.566839ms: 328666 grouping
33.285569ms: 328666 grouping
32.328973ms: 328666 grouping
36.42009ms: 328666 grouping
31.894595ms: 328666 grouping
31.809169ms: 328666 grouping
32.333501ms: 328666 grouping
32.434623ms: 328666 grouping
32.562915ms: 328666 grouping
31.976701ms: 328666 grouping
31.379621ms: 328666 grouping
32.109821ms: 328666 grouping
32.223925ms: 328666 grouping
32.398099ms: 328666 grouping
32.661925ms: 328666 grouping
32.922733ms: 328666 grouping
31.854749ms: 328666 grouping
32.104992ms: 328666 grouping
124.406731ms: 1103347 grouping
94.263229ms: 1103347 grouping
95.339664ms: 1103347 grouping
92.735211ms: 1103347 grouping
93.426169ms: 1103347 grouping
93.326555ms: 1103347 grouping
93.837606ms: 1103347 grouping
94.439818ms: 1103347 grouping
95.061953ms: 1103347 grouping
95.870033ms: 1103347 grouping
94.88627ms: 1103347 grouping
92.674838ms: 1103347 grouping
92.842975ms: 1103347 grouping
96.041188ms: 1103347 grouping
98.641717ms: 1103347 grouping
91.812121ms: 1103347 grouping
92.319247ms: 1103347 grouping
93.263164ms: 1103347 grouping
92.984849ms: 1103347 grouping
93.617248ms: 1103347 grouping
94.130712ms: 1103347 grouping
92.353357ms: 1103347 grouping
94.804767ms: 1103347 grouping
94.179915ms: 1103347 grouping
92.346112ms: 1103347 grouping
91.973918ms: 1103347 grouping
94.020231ms: 1103347 grouping
93.876244ms: 1103347 grouping
97.851749ms: 1103347 grouping
92.322869ms: 1103347 grouping
92.107944ms: 1103347 grouping
96.401308ms: 1103347 grouping
91.824497ms: 1103347 grouping
94.074566ms: 1103347 grouping
94.643573ms: 1103347 grouping
94.086942ms: 1103347 grouping
92.644652ms: 1103347 grouping
96.606271ms: 1103347 grouping
92.041535ms: 1103347 grouping
93.385116ms: 1103347 grouping
94.047399ms: 1103347 grouping
94.395746ms: 1103347 grouping
94.208291ms: 1103347 grouping
92.29057ms: 1103347 grouping
93.086577ms: 1103347 grouping
92.609637ms: 1103347 grouping
94.390313ms: 1103347 grouping
93.306029ms: 1103347 grouping
94.147918ms: 1103347 grouping
94.218554ms: 1103347 grouping
91.908113ms: 1103347 grouping
92.826675ms: 1103347 grouping
94.254173ms: 1103347 grouping
93.167777ms: 1103347 grouping
2.800663ms: 16755 copied
2.610792ms: 16755 copied
2.726104ms: 16755 copied
2.740593ms: 16755 copied
2.743309ms: 16755 copied
3.056037ms: 16755 copied
2.79372ms: 16755 copied
2.906012ms: 16755 copied
2.742102ms: 16755 copied
2.768364ms: 16755 copied
2.651544ms: 16755 copied
2.86828ms: 16755 copied
2.708897ms: 16755 copied
2.921709ms: 16755 copied
2.832057ms: 16755 copied
2.896051ms: 16755 copied
2.776816ms: 16755 copied
2.73365ms: 16755 copied
2.731537ms: 16755 copied
2.687767ms: 16755 copied
2.672976ms: 16755 copied
2.757799ms: 16755 copied
2.58272ms: 16755 copied
2.714029ms: 16755 copied
2.676599ms: 16755 copied
2.90903ms: 16755 copied
2.997476ms: 16755 copied
2.999288ms: 16755 copied
2.821793ms: 16755 copied
2.604453ms: 16755 copied
2.695917ms: 16755 copied
2.767458ms: 16755 copied
2.704671ms: 16755 copied
2.779231ms: 16755 copied
2.6932ms: 16755 copied
2.8716ms: 16755 copied
2.861035ms: 16755 copied
2.661505ms: 16755 copied
2.700445ms: 16755 copied
2.701049ms: 16755 copied
2.721877ms: 16755 copied
2.742706ms: 16755 copied
2.717349ms: 16755 copied
2.827831ms: 16755 copied
2.903598ms: 16755 copied
2.667844ms: 16755 copied
3.174668ms: 16755 copied
3.006834ms: 16755 copied
2.648526ms: 16755 copied
2.675692ms: 16755 copied
2.684447ms: 16755 copied
2.859223ms: 16755 copied
2.641281ms: 16755 copied
2.83266ms: 16755 copied
2.696219ms: 16755 copied
2.654865ms: 16755 copied
2.926539ms: 16755 copied
2.73365ms: 16755 copied
2.781646ms: 16755 copied
2.712822ms: 16755 copied
2.699841ms: 16755 copied
2.656072ms: 16755 copied
2.65577ms: 16755 copied
2.861941ms: 16755 copied
2.687767ms: 16755 copied
2.656373ms: 16755 copied
2.701955ms: 16755 copied
2.713727ms: 16755 copied
2.690484ms: 16755 copied
2.697427ms: 16755 copied
2.688975ms: 16755 copied
2.762025ms: 16755 copied
4.217597ms: 16755 copied
4.246575ms: 16755 copied
3.549579ms: 16755 copied
4.54904ms: 16755 copied
4.060327ms: 16755 copied
4.003879ms: 16755 copied
3.797708ms: 16755 copied
3.305676ms: 16755 copied
3.012872ms: 16755 copied
5.510768ms: 16755 copied
4.915499ms: 16755 copied
4.609714ms: 16755 copied
2.771081ms: 16755 copied
2.858017ms: 16755 copied
2.682636ms: 16755 copied
2.643092ms: 16755 copied
2.648827ms: 16755 copied
2.746931ms: 16755 copied
2.649129ms: 16755 copied
2.707992ms: 16755 copied
2.631923ms: 16755 copied
2.669957ms: 16755 copied
2.779533ms: 16755 copied
2.623471ms: 16755 copied
2.622565ms: 16755 copied
2.640677ms: 16755 copied
2.647318ms: 16755 copied
2.657883ms: 16755 copied
4.729855ms: 16755 copied
4.721402ms: 16755 copied
3.405592ms: 16755 copied
4.054592ms: 16755 copied
3.96192ms: 16755 copied
3.813104ms: 16755 copied
3.509733ms: 16755 copied
2.85379ms: 16755 copied
4.763059ms: 16755 copied
3.356388ms: 16755 copied
2.988118ms: 16755 copied
2.640375ms: 16755 copied
2.665429ms: 16755 copied
2.727613ms: 16755 copied
2.704068ms: 16755 copied
2.810322ms: 16755 copied
2.787079ms: 16755 copied
2.658486ms: 16755 copied
3.097694ms: 16755 copied
2.635546ms: 16755 copied
3.005626ms: 16755 copied
2.966686ms: 16755 copied
2.675692ms: 16755 copied
2.656374ms: 16755 copied
2.846546ms: 16755 copied
3.302053ms: 16755 copied
3.982146ms: 16755 copied
2.886693ms: 16755 copied
2.854092ms: 16755 copied
3.957695ms: 16755 copied
2.718557ms: 16755 copied
2.639771ms: 16755 copied
2.647922ms: 16755 copied
2.720369ms: 16755 copied
2.653657ms: 16755 copied
2.688974ms: 16755 copied
2.814549ms: 16755 copied
2.667542ms: 16755 copied
4.938742ms: 242931 copied
4.425881ms: 242931 copied
4.84426ms: 242931 copied
4.573792ms: 242931 copied
4.913989ms: 242931 copied
4.677028ms: 242931 copied
4.555077ms: 242931 copied
4.788717ms: 242931 copied
5.048318ms: 242931 copied
4.608809ms: 242931 copied
4.441276ms: 242931 copied
4.542701ms: 242931 copied
4.877162ms: 242931 copied
4.391167ms: 242931 copied
4.575301ms: 242931 copied
4.435541ms: 242931 copied
4.616958ms: 242931 copied
4.938138ms: 242931 copied
4.271328ms: 242931 copied
4.493498ms: 242931 copied
4.523382ms: 242931 copied
4.816791ms: 242931 copied
4.425579ms: 242931 copied
5.048016ms: 242931 copied
4.662238ms: 242931 copied
4.548135ms: 242931 copied
4.386035ms: 242931 copied
5.208605ms: 242931 copied
4.819205ms: 242931 copied
4.633863ms: 242931 copied
4.837921ms: 242931 copied
4.383318ms: 242931 copied
4.520364ms: 242931 copied
4.364905ms: 242931 copied
4.634164ms: 242931 copied
4.667369ms: 242931 copied
4.511911ms: 242931 copied
5.027187ms: 242931 copied
4.523683ms: 242931 copied
4.965608ms: 242931 copied
4.474783ms: 242931 copied
4.686085ms: 242931 copied
4.40143ms: 242931 copied
4.662842ms: 242931 copied
4.903424ms: 242931 copied
4.69665ms: 242931 copied
4.775737ms: 242931 copied
5.7918ms: 242931 copied
5.527068ms: 242931 copied
5.204983ms: 242931 copied
4.540889ms: 242931 copied
4.802602ms: 242931 copied
4.452746ms: 242931 copied
5.00334ms: 242931 copied
4.56051ms: 242931 copied
4.734382ms: 242931 copied
4.49712ms: 242931 copied
4.377281ms: 242931 copied
4.617864ms: 242931 copied
4.718988ms: 242931 copied
5.826816ms: 242931 copied
5.955408ms: 328666 copied
6.752321ms: 328666 copied
7.967309ms: 328666 copied
5.805686ms: 328666 copied
5.49658ms: 328666 copied
5.531597ms: 328666 copied
6.112074ms: 328666 copied
6.242176ms: 328666 copied
5.521031ms: 328666 copied
6.122337ms: 328666 copied
6.115697ms: 328666 copied
5.728711ms: 328666 copied
5.905602ms: 328666 copied
6.302549ms: 328666 copied
6.148298ms: 328666 copied
5.783046ms: 328666 copied
5.634229ms: 328666 copied
5.712713ms: 328666 copied
5.457942ms: 328666 copied
5.746823ms: 328666 copied
5.555141ms: 328666 copied
6.130185ms: 328666 copied
5.998575ms: 328666 copied
5.860323ms: 328666 copied
5.530691ms: 328666 copied
6.198708ms: 328666 copied
5.788781ms: 328666 copied
5.7432ms: 328666 copied
5.716335ms: 328666 copied
6.269344ms: 328666 copied
5.974728ms: 328666 copied
5.848852ms: 328666 copied
5.501108ms: 328666 copied
6.001593ms: 328666 copied
5.76916ms: 328666 copied
5.964162ms: 328666 copied
6.254552ms: 328666 copied
5.974123ms: 328666 copied
5.936089ms: 328666 copied
5.593477ms: 328666 copied
5.657472ms: 328666 copied
6.02212ms: 328666 copied
5.690979ms: 328666 copied
5.745012ms: 328666 copied
5.997367ms: 328666 copied
6.115998ms: 328666 copied
9.019294ms: 1103347 copied
9.097175ms: 1103347 copied
8.644987ms: 1103347 copied
8.568012ms: 1103347 copied
8.356709ms: 1103347 copied
8.666419ms: 1103347 copied
8.66823ms: 1103347 copied
8.611782ms: 1103347 copied
8.389311ms: 1103347 copied
9.014464ms: 1103347 copied
9.578038ms: 1103347 copied
9.090533ms: 1103347 copied
8.392631ms: 1103347 copied
9.671615ms: 1103347 copied
11.274495ms: 1103347 copied
8.415271ms: 1103347 copied
9.399035ms: 1103347 copied
8.691172ms: 1103347 copied
8.647402ms: 1103347 copied
8.633818ms: 1103347 copied
8.758788ms: 1103347 copied
9.068497ms: 1103347 copied
8.713208ms: 1103347 copied
8.50432ms: 1103347 copied
10.335406ms: 1103347 copied
8.719546ms: 1103347 copied
9.127059ms: 1103347 copied
8.577069ms: 1103347 copied
9.214296ms: 1103347 copied
8.511866ms: 1103347 copied
9.674332ms: 1103347 copied
8.952281ms: 1103347 copied
8.752751ms: 1103347 copied
9.052197ms: 1103347 copied
8.7283ms: 1103347 copied
8.552014ms: 1103347 copied
8.865647ms: 1103347 copied
8.906096ms: 1103347 copied
8.971902ms: 1103347 copied
8.651325ms: 1103347 copied
8.825499ms: 1103347 copied
8.534204ms: 1103347 copied
8.643779ms: 1103347 copied
8.693284ms: 1103347 copied
8.737356ms: 1103347 copied
8.8581ms: 1103347 copied
9.408695ms: 1103347 copied
8.531789ms: 1103347 copied
8.732829ms: 1103347 copied
9.27497ms: 1103347 copied
9.015973ms: 1103347 copied
8.515186ms: 1103347 copied
9.166301ms: 1103347 copied
8.479567ms: 1103347 copied
252.658µs: memcpy 16755 [67020 B]
245.111µs: memcpy 16755 [67020 B]
237.263µs: memcpy 16755 [67020 B]
246.017µs: memcpy 16755 [67020 B]
288.579µs: memcpy 16755 [67020 B]
264.128µs: memcpy 16755 [67020 B]
236.055µs: memcpy 16755 [67020 B]
238.771µs: memcpy 16755 [67020 B]
251.751µs: memcpy 16755 [67020 B]
239.073µs: memcpy 16755 [67020 B]
237.866µs: memcpy 16755 [67020 B]
248.733µs: memcpy 16755 [67020 B]
270.165µs: memcpy 16755 [67020 B]
300.955µs: memcpy 16755 [67020 B]
242.394µs: memcpy 16755 [67020 B]
267.448µs: memcpy 16755 [67020 B]
305.181µs: memcpy 16755 [67020 B]
247.827µs: memcpy 16755 [67020 B]
264.128µs: memcpy 16755 [67020 B]
238.772µs: memcpy 16755 [67020 B]
238.168µs: memcpy 16755 [67020 B]
238.772µs: memcpy 16755 [67020 B]
257.488µs: memcpy 16755 [67020 B]
237.866µs: memcpy 16755 [67020 B]
235.15µs: memcpy 16755 [67020 B]
279.221µs: memcpy 16755 [67020 B]
253.562µs: memcpy 16755 [67020 B]
257.487µs: memcpy 16755 [67020 B]
247.224µs: memcpy 16755 [67020 B]
239.375µs: memcpy 16755 [67020 B]
242.998µs: memcpy 16755 [67020 B]
295.521µs: memcpy 16755 [67020 B]
236.357µs: memcpy 16755 [67020 B]
237.564µs: memcpy 16755 [67020 B]
248.129µs: memcpy 16755 [67020 B]
236.055µs: memcpy 16755 [67020 B]
276.504µs: memcpy 16755 [67020 B]
243.601µs: memcpy 16755 [67020 B]
235.452µs: memcpy 16755 [67020 B]
254.77µs: memcpy 16755 [67020 B]
239.376µs: memcpy 16755 [67020 B]
238.168µs: memcpy 16755 [67020 B]
237.263µs: memcpy 16755 [67020 B]
239.979µs: memcpy 16755 [67020 B]
254.468µs: memcpy 16755 [67020 B]
235.753µs: memcpy 16755 [67020 B]
254.77µs: memcpy 16755 [67020 B]
273.787µs: memcpy 16755 [67020 B]
235.754µs: memcpy 16755 [67020 B]
231.527µs: memcpy 16755 [67020 B]
234.848µs: memcpy 16755 [67020 B]
295.219µs: memcpy 16755 [67020 B]
236.659µs: memcpy 16755 [67020 B]
245.111µs: memcpy 16755 [67020 B]
238.47µs: memcpy 16755 [67020 B]
236.055µs: memcpy 16755 [67020 B]
243.299µs: memcpy 16755 [67020 B]
248.733µs: memcpy 16755 [67020 B]
275.297µs: memcpy 16755 [67020 B]
245.413µs: memcpy 16755 [67020 B]
234.244µs: memcpy 16755 [67020 B]
239.678µs: memcpy 16755 [67020 B]
238.168µs: memcpy 16755 [67020 B]
245.413µs: memcpy 16755 [67020 B]
236.055µs: memcpy 16755 [67020 B]
238.168µs: memcpy 16755 [67020 B]
235.451µs: memcpy 16755 [67020 B]
242.998µs: memcpy 16755 [67020 B]
253.261µs: memcpy 16755 [67020 B]
252.657µs: memcpy 16755 [67020 B]
232.131µs: memcpy 16755 [67020 B]
246.922µs: memcpy 16755 [67020 B]
316.954µs: memcpy 16755 [67020 B]
261.11µs: memcpy 16755 [67020 B]
2.648223ms: memcpy 16755 [67020 B]
546.066µs: memcpy 16755 [67020 B]
16.097624ms: memcpy 16755 [67020 B]
7.920823ms: memcpy 16755 [67020 B]
172.363µs: memcpy 16755 [67020 B]
262.015µs: memcpy 16755 [67020 B]
838.267µs: memcpy 16755 [67020 B]
265.637µs: memcpy 16755 [67020 B]
285.862µs: memcpy 16755 [67020 B]
263.524µs: memcpy 16755 [67020 B]
244.507µs: memcpy 16755 [67020 B]
245.714µs: memcpy 16755 [67020 B]
247.224µs: memcpy 16755 [67020 B]
243.299µs: memcpy 16755 [67020 B]
249.639µs: memcpy 16755 [67020 B]
233.037µs: memcpy 16755 [67020 B]
242.696µs: memcpy 16755 [67020 B]
240.885µs: memcpy 16755 [67020 B]
250.243µs: memcpy 16755 [67020 B]
240.582µs: memcpy 16755 [67020 B]
239.677µs: memcpy 16755 [67020 B]
242.092µs: memcpy 16755 [67020 B]
241.79µs: memcpy 16755 [67020 B]
246.318µs: memcpy 16755 [67020 B]
244.507µs: memcpy 16755 [67020 B]
250.846µs: memcpy 16755 [67020 B]
517.993µs: memcpy 16755 [67020 B]
396.645µs: memcpy 16755 [67020 B]
11.085832ms: memcpy 16755 [67020 B]
2.295651ms: memcpy 16755 [67020 B]
360.119µs: memcpy 16755 [67020 B]
14.363736ms: memcpy 16755 [67020 B]
259.298µs: memcpy 16755 [67020 B]
246.016µs: memcpy 16755 [67020 B]
1.213178ms: memcpy 16755 [67020 B]
252.053µs: memcpy 16755 [67020 B]
254.167µs: memcpy 16755 [67020 B]
240.583µs: memcpy 16755 [67020 B]
236.357µs: memcpy 16755 [67020 B]
239.074µs: memcpy 16755 [67020 B]
246.621µs: memcpy 16755 [67020 B]
268.354µs: memcpy 16755 [67020 B]
255.072µs: memcpy 16755 [67020 B]
239.376µs: memcpy 16755 [67020 B]
262.619µs: memcpy 16755 [67020 B]
243.602µs: memcpy 16755 [67020 B]
273.486µs: memcpy 16755 [67020 B]
255.374µs: memcpy 16755 [67020 B]
243.299µs: memcpy 16755 [67020 B]
243.3µs: memcpy 16755 [67020 B]
247.827µs: memcpy 16755 [67020 B]
257.487µs: memcpy 16755 [67020 B]
265.637µs: memcpy 16755 [67020 B]
253.865µs: memcpy 16755 [67020 B]
238.168µs: memcpy 16755 [67020 B]
360.723µs: memcpy 16755 [67020 B]
236.659µs: memcpy 16755 [67020 B]
239.375µs: memcpy 16755 [67020 B]
239.375µs: memcpy 16755 [67020 B]
236.055µs: memcpy 16755 [67020 B]
249.035µs: memcpy 16755 [67020 B]
239.376µs: memcpy 16755 [67020 B]
240.583µs: memcpy 16755 [67020 B]
247.827µs: memcpy 16755 [67020 B]
380.948µs: memcpy 242931 [971724 B]
452.791µs: memcpy 242931 [971724 B]
388.495µs: memcpy 242931 [971724 B]
399.06µs: memcpy 242931 [971724 B]
422.304µs: memcpy 242931 [971724 B]
382.457µs: memcpy 242931 [971724 B]
393.928µs: memcpy 242931 [971724 B]
285.862µs: memcpy 242931 [971724 B]
370.383µs: memcpy 242931 [971724 B]
383.061µs: memcpy 242931 [971724 B]
391.212µs: memcpy 242931 [971724 B]
377.024µs: memcpy 242931 [971724 B]
373.704µs: memcpy 242931 [971724 B]
399.361µs: memcpy 242931 [971724 B]
405.399µs: memcpy 242931 [971724 B]
377.326µs: memcpy 242931 [971724 B]
376.722µs: memcpy 242931 [971724 B]
408.719µs: memcpy 242931 [971724 B]
428.944µs: memcpy 242931 [971724 B]
334.462µs: memcpy 242931 [971724 B]
377.024µs: memcpy 242931 [971724 B]
393.929µs: memcpy 242931 [971724 B]
389.4µs: memcpy 242931 [971724 B]
376.723µs: memcpy 242931 [971724 B]
368.874µs: memcpy 242931 [971724 B]
381.854µs: memcpy 242931 [971724 B]
391.815µs: memcpy 242931 [971724 B]
377.929µs: memcpy 242931 [971724 B]
433.17µs: memcpy 242931 [971724 B]
378.835µs: memcpy 242931 [971724 B]
413.55µs: memcpy 242931 [971724 B]
379.439µs: memcpy 242931 [971724 B]
412.946µs: memcpy 242931 [971724 B]
377.93µs: memcpy 242931 [971724 B]
374.911µs: memcpy 242931 [971724 B]
347.14µs: memcpy 242931 [971724 B]
399.965µs: memcpy 242931 [971724 B]
399.362µs: memcpy 242931 [971724 B]
382.155µs: memcpy 242931 [971724 B]
391.211µs: memcpy 242931 [971724 B]
402.38µs: memcpy 242931 [971724 B]
381.552µs: memcpy 242931 [971724 B]
384.268µs: memcpy 242931 [971724 B]
388.495µs: memcpy 242931 [971724 B]
390.91µs: memcpy 242931 [971724 B]
387.287µs: memcpy 242931 [971724 B]
409.926µs: memcpy 242931 [971724 B]
390.608µs: memcpy 242931 [971724 B]
381.552µs: memcpy 242931 [971724 B]
396.042µs: memcpy 242931 [971724 B]
413.851µs: memcpy 242931 [971724 B]
447.055µs: memcpy 242931 [971724 B]
364.648µs: memcpy 242931 [971724 B]
387.287µs: memcpy 242931 [971724 B]
377.93µs: memcpy 242931 [971724 B]
372.194µs: memcpy 242931 [971724 B]
380.043µs: memcpy 242931 [971724 B]
375.514µs: memcpy 242931 [971724 B]
390.607µs: memcpy 242931 [971724 B]
386.684µs: memcpy 242931 [971724 B]
390.91µs: memcpy 242931 [971724 B]
447.66µs: memcpy 328666 [1314664 B]
424.416µs: memcpy 328666 [1314664 B]
445.848µs: memcpy 328666 [1314664 B]
426.227µs: memcpy 328666 [1314664 B]
426.227µs: memcpy 328666 [1314664 B]
438.302µs: memcpy 328666 [1314664 B]
467.582µs: memcpy 328666 [1314664 B]
452.791µs: memcpy 328666 [1314664 B]
315.444µs: memcpy 328666 [1314664 B]
431.057µs: memcpy 328666 [1314664 B]
426.831µs: memcpy 328666 [1314664 B]
460.639µs: memcpy 328666 [1314664 B]
442.829µs: memcpy 328666 [1314664 B]
425.925µs: memcpy 328666 [1314664 B]
447.357µs: memcpy 328666 [1314664 B]
417.473µs: memcpy 328666 [1314664 B]
469.997µs: memcpy 328666 [1314664 B]
450.376µs: memcpy 328666 [1314664 B]
427.737µs: memcpy 328666 [1314664 B]
429.547µs: memcpy 328666 [1314664 B]
324.5µs: memcpy 328666 [1314664 B]
428.642µs: memcpy 328666 [1314664 B]
412.342µs: memcpy 328666 [1314664 B]
428.944µs: memcpy 328666 [1314664 B]
410.833µs: memcpy 328666 [1314664 B]
433.472µs: memcpy 328666 [1314664 B]
441.622µs: memcpy 328666 [1314664 B]
426.529µs: memcpy 328666 [1314664 B]
430.151µs: memcpy 328666 [1314664 B]
434.679µs: memcpy 328666 [1314664 B]
466.676µs: memcpy 328666 [1314664 B]
450.678µs: memcpy 328666 [1314664 B]
438.603µs: memcpy 328666 [1314664 B]
437.396µs: memcpy 328666 [1314664 B]
430.453µs: memcpy 328666 [1314664 B]
467.582µs: memcpy 328666 [1314664 B]
492.637µs: memcpy 328666 [1314664 B]
478.147µs: memcpy 328666 [1314664 B]
427.736µs: memcpy 328666 [1314664 B]
467.884µs: memcpy 328666 [1314664 B]
438.603µs: memcpy 328666 [1314664 B]
425.925µs: memcpy 328666 [1314664 B]
480.26µs: memcpy 328666 [1314664 B]
442.528µs: memcpy 328666 [1314664 B]
444.037µs: memcpy 328666 [1314664 B]
889.282µs: memcpy 1103347 [4413388 B]
937.277µs: memcpy 1103347 [4413388 B]
912.223µs: memcpy 1103347 [4413388 B]
905.28µs: memcpy 1103347 [4413388 B]
963.841µs: memcpy 1103347 [4413388 B]
931.24µs: memcpy 1103347 [4413388 B]
912.223µs: memcpy 1103347 [4413388 B]
924.901µs: memcpy 1103347 [4413388 B]
930.636µs: memcpy 1103347 [4413388 B]
873.887µs: memcpy 1103347 [4413388 B]
895.923µs: memcpy 1103347 [4413388 B]
935.164µs: memcpy 1103347 [4413388 B]
967.464µs: memcpy 1103347 [4413388 B]
897.432µs: memcpy 1103347 [4413388 B]
940.296µs: memcpy 1103347 [4413388 B]
897.432µs: memcpy 1103347 [4413388 B]
916.148µs: memcpy 1103347 [4413388 B]
931.24µs: memcpy 1103347 [4413388 B]
902.865µs: memcpy 1103347 [4413388 B]
889.885µs: memcpy 1103347 [4413388 B]
900.752µs: memcpy 1103347 [4413388 B]
930.334µs: memcpy 1103347 [4413388 B]
902.563µs: memcpy 1103347 [4413388 B]
888.98µs: memcpy 1103347 [4413388 B]
896.224µs: memcpy 1103347 [4413388 B]
888.678µs: memcpy 1103347 [4413388 B]
896.526µs: memcpy 1103347 [4413388 B]
903.469µs: memcpy 1103347 [4413388 B]
831.928µs: memcpy 1103347 [4413388 B]
841.889µs: memcpy 1103347 [4413388 B]
880.829µs: memcpy 1103347 [4413388 B]
887.47µs: memcpy 1103347 [4413388 B]
791.177µs: memcpy 1103347 [4413388 B]
927.316µs: memcpy 1103347 [4413388 B]
908.298µs: memcpy 1103347 [4413388 B]
919.468µs: memcpy 1103347 [4413388 B]
861.51µs: memcpy 1103347 [4413388 B]
905.28µs: memcpy 1103347 [4413388 B]
922.486µs: memcpy 1103347 [4413388 B]
936.674µs: memcpy 1103347 [4413388 B]
878.112µs: memcpy 1103347 [4413388 B]
918.26µs: memcpy 1103347 [4413388 B]
911.921µs: memcpy 1103347 [4413388 B]
887.47µs: memcpy 1103347 [4413388 B]
1.271739ms: memcpy 1103347 [4413388 B]
935.768µs: memcpy 1103347 [4413388 B]
919.468µs: memcpy 1103347 [4413388 B]
891.093µs: memcpy 1103347 [4413388 B]
910.411µs: memcpy 1103347 [4413388 B]
933.957µs: memcpy 1103347 [4413388 B]
888.074µs: memcpy 1103347 [4413388 B]
917.657µs: memcpy 1103347 [4413388 B]
938.183µs: memcpy 1103347 [4413388 B]
891.696µs: memcpy 1103347 [4413388 B]
Benchmark 1: cmdbussy 16755 assign_cell.hlsl
  Time (mean ± σ): 77.020430 µs ± 11.906872 µs
  Range (min … max): 59.467000 µs … 109.576000 µs 79 runs
Benchmark 2: cmdbussy 27868 assign_cell.hlsl
  Time (mean ± σ): 94.344298 µs ± 16.650838 µs
  Range (min … max): 70.032000 µs … 143.384000 µs 94 runs
Benchmark 3: cmdbussy 84860 assign_cell.hlsl
  Time (mean ± σ): 121.324375 µs ± 13.818648 µs
  Range (min … max): 102.632000 µs … 177.494000 µs 128 runs
Benchmark 4: cmdbussy 242931 assign_cell.hlsl
  Time (mean ± σ): 225.322222 µs ± 15.102213 µs
  Range (min … max): 201.341000 µs … 253.865000 µs 45 runs
Benchmark 5: cmdbussy 328666 assign_cell.hlsl
  Time (mean ± σ): 274.884122 µs ± 15.464222 µs
  Range (min … max): 250.846000 µs … 314.237000 µs 49 runs
Benchmark 6: cmdbussy 1103347 assign_cell.hlsl
  Time (mean ± σ): 737.298943 µs ± 19.641971 µs
  Range (min … max): 709.976000 µs … 797.818000 µs 35 runs
Summary
  'cmdbussy 16755 assign_cell.hlsl' ran
    1.224926 ± 0.126326 times faster than 'cmdbussy 27868 assign_cell.hlsl'
    1.575223 ± -0.208917 times faster than 'cmdbussy 84860 assign_cell.hlsl'
    2.925486 ± -1.363954 times faster than 'cmdbussy 242931 assign_cell.hlsl'
    3.568977 ± -1.917213 times faster than 'cmdbussy 328666 assign_cell.hlsl'
    9.572771 ± -7.070153 times faster than 'cmdbussy 1103347 assign_cell.hlsl'
Benchmark 1: 16755 grouping
 Time (mean ± σ): 5.160478 ms ± 1.338881 ms
 Range (min … max): 3.996937 ms … 15.118690 ms 138 runs
Benchmark 2: 242931 grouping
 Time (mean ± σ): 24.059545 ms ± 1.050724 ms
 Range (min … max): 23.083585 ms … 31.002295 ms 61 runs
Benchmark 3: 328666 grouping
 Time (mean ± σ): 32.644063 ms ± 1.409783 ms
 Range (min … max): 31.362113 ms … 40.273642 ms 46 runs
Benchmark 4: 1103347 grouping
 Time (mean ± σ): 94.376382 ms ± 4.374384 ms
 Range (min … max): 91.812121 ms … 124.406731 ms 54 runs
Summary
  '16755 grouping' ran
    4.662270 ± -2.540167 times faster than '242931 grouping'
    6.325782 ± -3.805747 times faster than '328666 grouping'
   18.288302 ± -12.847826 times faster than '1103347 grouping'
Benchmark 1: 16755 copied
 Time (mean ± σ): 2.980292 ms ± 563.518349 µs
 Range (min … max): 2.582720 ms … 5.510768 ms 138 runs
Benchmark 2: 242931 copied
 Time (mean ± σ): 4.716775 ms ± 315.106241 µs
 Range (min … max): 4.271328 ms … 5.826816 ms 61 runs
Benchmark 3: 328666 copied
 Time (mean ± σ): 5.932178 ms ± 403.647195 µs
 Range (min … max): 5.457942 ms … 7.967309 ms 46 runs
Benchmark 4: 1103347 copied
 Time (mean ± σ): 8.905275 ms ± 499.789838 µs
 Range (min … max): 8.356709 ms … 11.274495 ms 54 runs
Summary
  '16755 copied' ran
    1.582656 ± -0.242072 times faster than '242931 copied'
    1.990469 ± -0.560053 times faster than '328666 copied'
    2.988054 ± -1.371878 times faster than '1103347 copied'
Benchmark 1: memcpy 242931 [971724 B]
 Time (mean ± σ): 388.197820 µs ± 23.969864 µs
 Range (min … max): 285.862000 µs … 452.791000 µs 61 runs
Benchmark 2: memcpy 328666 [1314664 B]
 Time (mean ± σ): 436.336089 µs ± 31.094674 µs
 Range (min … max): 315.444000 µs … 492.637000 µs 45 runs
Benchmark 3: memcpy 16755 [67020 B]
 Time (mean ± σ): 650.540254 µs ± 2.112618 ms
 Range (min … max): 172.363000 µs … 16.097624 ms 138 runs
Benchmark 4: memcpy 1103347 [4413388 B]
 Time (mean ± σ): 912.412944 µs ± 57.738241 µs
 Range (min … max): 791.177000 µs … 1.271739 ms 54 runs
Summary
  'memcpy 242931 [971724 B]' ran
    1.124004 ± 0.016804 times faster than 'memcpy 328666 [1314664 B]'
    1.675796 ± 4.547288 times faster than 'memcpy 16755 [67020 B]'
    2.350381 ± -1.073609 times faster than 'memcpy 1103347 [4413388 B]'
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th><samp>assign_cell.hlsl</samp></th><td><span class="roboto-unscale math-font-normal">77.0µs</span></td> <td><span class="roboto-unscale math-font-normal">225.3µs</span></td> <td><span class="roboto-unscale math-font-normal">274.9µs</span></td> <td><span class="roboto-unscale math-font-normal">737.3µs</span></td> <td><span class="roboto-unscale math-font-normal">12µs</span>/<span class="roboto-unscale math-font-normal">15µs</span>/<span class="roboto-unscale math-font-normal">15µs</span>/<span class="roboto-unscale math-font-normal">20µs</span></td></tr>
 <tr><th><q>grouping</q> </th> <td><span class="roboto-unscale math-font-normal">5.160ms</span></td> <td><span class="roboto-unscale math-font-normal">24.060ms</span></td> <td><span class="roboto-unscale math-font-normal">32.644ms</span></td> <td><span class="roboto-unscale math-font-normal">94.377ms</span></td> <td><span class="roboto-unscale math-font-normal">1.339ms</span>/<span class="roboto-unscale math-font-normal">1.051ms</span>/<span class="roboto-unscale math-font-normal">1.410ms</span>/<span class="roboto-unscale math-font-normal">4.375ms</span></td></tr>
 <tr><th>grouping speed </th> <td><span class="roboto-unscale math-font-normal">3246792</span></td> <td><span class="roboto-unscale math-font-normal">10097073</span></td> <td><span class="roboto-unscale math-font-normal">10068170</span></td> <td><span class="roboto-unscale math-font-normal">11690922</span></td> <td>[points/s]</td></tr>
 <tr><th><q>copying</q> </th> <td><span class="roboto-unscale math-font-normal">2.980ms</span></td> <td><span class="roboto-unscale math-font-normal">4.717ms</span></td> <td><span class="roboto-unscale math-font-normal">5.932ms</span></td> <td><span class="roboto-unscale math-font-normal">8.905ms</span></td> <td><span class="roboto-unscale math-font-normal">564µs</span>/<span class="roboto-unscale math-font-normal">315µs</span>/<span class="roboto-unscale math-font-normal">404µs</span>/<span class="roboto-unscale math-font-normal">500µs</span></td></tr>
 <tr><th><samp>GroupDesc</samp>s copied</th><td><span class="roboto-unscale math-font-normal">6523</span></td> <td><span class="roboto-unscale math-font-normal">66589</span></td> <td><span class="roboto-unscale math-font-normal">104645</span></td> <td><span class="roboto-unscale math-font-normal">167428</span></td> <td>= cells occupied; out of <span class="roboto-unscale math-font-normal">100<sup>3</sup></span></td></tr>
 <tr><th>…if w/o [​[​B_m​]​]/[​[​B_r​]​] scaling</th><td><span class="roboto-unscale math-font-normal">2260</span></td><td><span class="roboto-unscale math-font-normal">6979</span></td> <td><span class="roboto-unscale math-font-normal">10662</span></td> <td><span class="roboto-unscale math-font-normal">53492</span></td> <td style="text-align: center;">''</td></tr>
 <tr><th>memcpy </th> <td><span class="roboto-unscale math-font-normal">388.2µs</span></td> <td><span class="roboto-unscale math-font-normal">436.3µs</span></td> <td><span class="roboto-unscale math-font-normal">650.5µs</span></td> <td><span class="roboto-unscale math-font-normal">912.4µs</span></td> <td><span class="roboto-unscale math-font-normal">23µs</span>/<span class="roboto-unscale math-font-normal">31µs</span>/<span class="roboto-unscale math-font-normal">2µs</span>/<span class="roboto-unscale math-font-normal">57µs</span></td></tr>
 <tr><th>memcpy size </th> <td><span class="roboto-unscale math-font-normal">67kB</span></td> <td><span class="roboto-unscale math-font-normal">972kB</span></td> <td><span class="roboto-unscale math-font-normal">1315kB</span></td> <td><span class="roboto-unscale math-font-normal">4413kB</span></td></tr>
</table>
<p class="continuing">
So <q>grouping</q>, on the i7-2600, quickly arrives at a consistent <span class="roboto-unscale math-font-normal">~11Mp/s</span> throughput.
Bounding box scaling clearly works, increasing the occupancy, in the case of the <span class="roboto-unscale math-font-normal">1'103'347</span> image, from <span class="roboto-unscale math-font-normal">~5%</span>
(average population of <span class="roboto-unscale math-font-normal">~20</span> in non-empty cells, median <span class="roboto-unscale math-font-normal">9</span>)
to <span class="roboto-unscale math-font-normal">~17%</span> (<span class="roboto-unscale math-font-normal">~7</span>, <span class="roboto-unscale math-font-normal">3</span>).
</p>
<h3 id="grid-impl" class="continued"><a class="hash-link" href="#grid-impl">#</a> The grid-based mean-shift clustering shader implementation,</h3>
<p class="continuing">
thus, can take advantage of the grid by, instead of checking if <em>all</em> elements of [​[​D​]​] are closer to [​[​q_t​]​] than [​[​r​]​],
considering only the ones that could <em>feasibly</em> fulfil that predicate by virtue of being contained within near-by grid cells.
The actual range is complicated slightly by the bounding box scale being different along each axis,
so the sphere of influence (with a cubic bounding box) turns into an ellipsoid of influence with "radiuses" [​[​R​]​]
(with a prismatic bounding box from [​[​g_{tm}​]​] to [​[​g_{tM}​]​])
rounded up to encompas any cell it intersects
after the [​[​B_r​]​] scaling:
</p>
<div class="mathnospace">
[​![​
\begin{align}
<!--"-->M_t &= (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ D\\<!--"-->
&\Leftrightarrow\\
M_t &= (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ \left(\bigcup_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM}} h(x_g)\right)\\
\text{where}&\\
R &= \left\lceil G \frac{r}{B_r} \right\rceil\\
g_t &= \operatorname{trunc}(g(q_t))\\
g_{tm} &= \max(g_t - R, (0, 0, 0))\\
g_{tM} &= \min(g_t + R, (G-1, G-1, G-1))\\
\end{align}
​]!​]
</div>
<div class="singles">
 <figure>
  <video width="100%" autoplay controls loop><source src="/content/assets/blogn_t/018.26-grid-scaling-0000-0130-1x1-tilt.mp4" type="video/mp4" /></video>
  <figcaption>Effect of the scaling on [​[​r​]​] (as-if [​[​G=1, r=0.2​]​], [​[​R​]​] quantisation not applied)</figcaption>
 </figure>
</div>
<p class="continued">
With
[​[​R​]​] as <samp>grid_bothdirs</samp>,
[​[​g_t​]​] as <samp>gridpos</samp>,
[​[​g_{tm}​]​] as <samp>gridpos_from</samp>,
and
[​[​g_{tM}​]​] as <samp>gridpos_to</samp>,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/posterise_grid_kernel.hlsl.inc#L29"><samp>posterise_grid_kernel.hlsl.inc</samp></a>
can implement the [​[​\bigcup​]​] literally:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">float3</span><span class="token operator">></span><!--"-->          <!--"-->outputs<span class="token punctuation">;</span><!--"-->            <!--"--><span class="token comment">// HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token comment">/*<!--"-->            <!--"-->3 */</span><!--"-->   <!--"-->KNOWN_RGBS_FREQS
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->groups_data<span class="token punctuation">;</span><!--"-->        <!--"--><span class="token comment">// DEVICE_LOCAL</span>

<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->known_rgbs_len<!--"-->   <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float</span><!--"-->  <!--"-->radiussy_squared <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>radiussy_squared<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->iter_limit<!--"-->       <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iter_limit<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_min<!--"-->         <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_range<!--"-->       <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span><!--"-->  <!--"-->grid_bothdir<!--"-->     <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>grid_bothdirs<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

<!--"-->	<!--"-->known_rgbs_pack <span class="token keyword">this</span> <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> center <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iter_limit<span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos<!--"-->      <!--"--><span class="token operator">=</span> <span class="token keyword">trunc</span><span class="token punctuation">(</span><span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_from <span class="token operator">=</span> gridpos <span class="token operator">-</span> <span class="token keyword">min</span><span class="token punctuation">(</span>grid_bothdirs<span class="token punctuation">,</span> gridpos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_to<!--"-->   <!--"--><span class="token operator">=</span> <span class="token keyword">min</span><span class="token punctuation">(</span>gridpos <span class="token operator">+</span> grid_bothdirs<span class="token punctuation">,</span> GRID_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> newcenter<!--"-->     <!--"--><span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gx <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>x<span class="token punctuation">;</span> gx <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token operator">++</span>gx<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gy <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>y<span class="token punctuation">;</span> gy <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token operator">++</span>gy<span class="token punctuation">)</span>
<!--"-->				<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gz <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>z<span class="token punctuation">;</span> gz <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token operator">++</span>gz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->					<!--"--><span class="token class-name">groupdesc_t</span> group <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gx<span class="token punctuation">]</span><span class="token punctuation">[</span>gy<span class="token punctuation">]</span><span class="token punctuation">[</span>gz<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->					<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>start_idx <span class="token operator">!=</span> group<span class="token punctuation">.</span>end_idx<span class="token punctuation">;</span> <span class="token operator">++</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->						<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> i <span class="token operator">=</span> groups_data<span class="token punctuation">[</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->						<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->						<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->						<!--"--><span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#if</span> <span class="token expression"><span class="token operator">!</span>BRANCHLESS_ADD</span></span>
<!--"-->						<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive keyword">#endif</span></span>
<!--"-->						<!--"--><span class="token punctuation">{</span>
<!--"-->							<!--"-->FREQ_LOAD
<!--"-->							<!--"-->newcenter_count <span class="token operator">+=</span> FREQ<span class="token punctuation">;</span>
<!--"-->							<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> FREQ_MUL lab<span class="token punctuation">;</span>
<!--"-->						<!--"--><span class="token punctuation">}</span>
</small><!--"-->					<!--"--><span class="token punctuation">}</span>
<!--"-->				<!--"--><span class="token punctuation">}</span>

<small style='display: block; line-height: initial;'><!--"-->		<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">bool</span> same <span class="token operator">=</span> newcenter <span class="token operator">==</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/posterise_grid.hlsl"><samp>posterise_grid.hlsl</samp></a>
and
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/posterise_grid_mul.hlsl"><samp>posterise_grid_mul.hlsl</samp></a>
are unchanged,
and so is both the outer-most [​[​q_t​]​] loop and inner-most [​[​\Sigma​]​].
To avoid overflow if [​[​R > g_t​]​] we observe [​[​\max(g_t - R, (0, 0, 0)) = g_t - \min(R, g_t)​]​].
</p>
<p class="indented continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/shader.h#L9">
 Reordering the scalar parameters to forced-padding locations</a>
allows retaining the same size while fitting <samp>grid_bothdirs</samp>/[​[​R​]​]:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint3</span><!--"-->   <!--"-->grid_bothdirs<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->known_rgbs_len<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token class-name">point_t</span> bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float</span><!--"-->   <!--"-->radiussy_squared<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token class-name">point_t</span> bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">int</span><!--"-->     <!--"-->iter_limit<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">bbox_max</span> <span class="token expression">bbox_range</span></span>

<!--"-->	<!--"--><span class="token class-name">groupdesc_t</span> group_ranges<span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="indented continuing">
[​[​R​]​] computation is can likewise be
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8283e16a104509e020942c54a7ae442797bea080/item/src/posterise_gpu.rs#L616">implemented directly</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><small style='display: block; line-height: initial;'><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>

</small><!--"-->	<!--"--><span class="token comment">// find_bbox.hlsl ...</span>
<!--"-->	<!--"--><span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token keyword">let</span> bbox_min <span class="token operator">=</span> <span class="token function">become_float3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> bbox_range <span class="token operator">=</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">let</span> bbox_max <span class="token operator">=</span> <span class="token function">become_float3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">[</span>bbox_max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bbox_max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bbox_max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<!--"-->   <!--"--><span class="token operator">=</span> bbox_min<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_range <span class="token operator">=</span> bbox_range<span class="token punctuation">;</span>

</small><!--"-->		<!--"--><span class="token keyword">let</span> scaled_radiussies <span class="token operator">=</span> bbox_range<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>scale<span class="token closure-punctuation punctuation">|</span></span> radiussy <span class="token operator">/</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> direction_cells<!--"-->   <!--"--><span class="token operator">=</span> scaled_radiussies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>sr<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span>sr <span class="token operator">*</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>grid_bothdirs <span class="token operator">=</span> direction_cells<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continued">
By mildly instrumenting (<samp>dbg!(direction_cells)</samp>) or recalling the bounding boxes from <a href="#grid">before</a>,
we can compute the following and use it as the best-case prediction
(additionally assuming every cell inspected will be non-empty, which it won't<!--'-->,
 but non-empty cells are where the points are so they're<!--'--> roughly where [​[​q_t​]​]s are
 and they're<!--'--> pretty dense, so.):
</p>
<table class="perf">
 <caption>[​[​r=0.02, G=100​]​]</caption>
 <tr><th>(colours)</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th></tr>
 <tr><th>[​[​R​]​]</th> <td><span class="roboto-unscale math-font-normal">3×7×8</span></td> <td><span class="roboto-unscale math-font-normal">3×1×7</span></td> <td><span class="roboto-unscale math-font-normal">3×8×10</span></td> <td><span class="roboto-unscale math-font-normal">2×5×4</span></td></tr>
 <tr><th>Volume between [​[​g_{tm}​]​] and [​[​g_{tM}​]​] when not near an edge</th> <td><span class="roboto-unscale math-font-normal">1785</span></td> <td><span class="roboto-unscale math-font-normal">315</span></td> <td><span class="roboto-unscale math-font-normal">2499</span></td> <td><span class="roboto-unscale math-font-normal">495</span></td></tr>
 <tr><th>Average points inspected when not near an edge</th> <td><span class="roboto-unscale math-font-normal">4585</span></td> <td><span class="roboto-unscale math-font-normal">1149</span></td> <td><span class="roboto-unscale math-font-normal">7849</span></td> <td><span class="roboto-unscale math-font-normal">3262</span></td></tr>
 <tr><th>Projected average speed-up</th> <td><span class="roboto-unscale math-font-normal">72.64%</span></td> <td><span class="roboto-unscale math-font-normal">99.53%</span></td> <td><span class="roboto-unscale math-font-normal">97.61%</span></td> <td><span class="roboto-unscale math-font-normal">99.70%</span></td></tr>
</table>
<p class="continued">
To contrast with real performance data:
</p>
<!--
127.564796ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
118.878455ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
120.513634ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
118.934601ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
117.431938ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
117.452768ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
117.029861ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
117.141549ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.893163ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
113.978653ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
111.163199ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.421957ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
114.220142ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.511912ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.613955ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
114.666895ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.806227ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
113.24151ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
111.812501ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
1.574252133s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
1.565167334s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
1.937814595s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.562109185s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
1.578621263s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.590732818s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
1.58395816s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.024161529s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
1.60444212s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
4.082810335s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.026844768s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.06468149s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.597240631s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.023244779s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.530159651s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.069314447s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.429522635s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.055795619s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
4.097178901s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
8.599332828s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~181 levels
8.264387659s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~69 levels
10.703902786s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~131 levels
9.531067044s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~102 levels
8.140011416s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~64 levels
8.249509552s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~54 levels
9.482006541s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~55 levels
8.765439191s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~54 levels
8.345361473s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~54 levels
12.874083966s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~146 levels
8.653643292s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~9365 levels
8.486575503s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~9276 levels
11.594080452s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~10295 levels
8.585882521s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~9305 levels
100.174264ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
97.762398ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
100.140154ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
99.159107ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
98.665565ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
100.368663ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
99.324526ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
98.362194ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
98.954445ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
100.348438ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
99.818673ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
99.428366ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
99.889609ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
557.7799ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
545.406029ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
708.155399ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
535.931831ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
550.382201ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
553.863559ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
551.2419ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
549.946315ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
554.305483ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
3.01998891s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.005828325s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.346185553s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
2.999888613s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.523654856s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
2.986719037s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.649072217s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.011748416s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.904451147s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.005888093s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
3.694295467s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
8.196744916s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~220 levels
9.460674954s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~183 levels
9.576366365s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~183 levels
8.320987435s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~177 levels
11.161813301s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~185 levels
8.355028258s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~141 levels
9.232788888s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~145 levels
9.109581751s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~144 levels
8.234889535s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~142 levels
8.353483336s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~142 levels
8.624341981s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~7482 levels
8.460889577s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~7451 levels
8.564126519s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~7471 levels
9.026406769s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~7554 levels
8.488517976s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~7451 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02
 Time (mean ± σ): 116.646196 ms ± 5.210278 ms
 Range (min … max): 111.163199 ms … 131.613955 ms 19 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02
 Time (mean ± σ): 4197.679326 ms ± 214.743511 ms
 Range (min … max): 4023.244779 ms … 4597.240631 ms 10 runs
Benchmark 4: MSC 242931 RGBs @ r=0.02
 Time (mean ± σ): 9047.740347 ms ± 960.745676 ms
 Range (min … max): 8140.011416 ms … 10703.902786 ms 5 runs
  avg levels = 109.40
Benchmark 2: MSC 27868 RGBs @ r=0.02
 Time (mean ± σ): 1891.251015 ms ± 400.056011 ms
 Range (min … max): 1565.167334 ms … 2590.732818 ms 9 runs
Benchmark 5: MSC 328666 RGBs @ r=0.02
 Time (mean ± σ): 9543.280145 ms ± 1721.156390 ms
 Range (min … max): 8249.509552 ms … 12874.083966 ms 5 runs
  avg levels = 72.60
Benchmark 6: MSC 1103347 RGBs @ r=0.02
 Time (mean ± σ): 9330.045442 ms ± 1308.490962 ms
 Range (min … max): 8486.575503 ms … 11594.080452 ms 4 runs
  avg levels = 9560.25
Benchmark 1: MSC 16755 RGBs @ r=0.02 * freq
 Time (mean ± σ): 99.415108 ms ± 782.423169 µs
 Range (min … max): 97.762398 ms … 100.368663 ms 13 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 * freq
 Time (mean ± σ): 3286.156421 ms ± 332.411821 ms
 Range (min … max): 2986.719037 ms … 3904.451147 ms 11 runs
Benchmark 4: MSC 242931 RGBs @ r=0.02 * freq
 Time (mean ± σ): 9343.317394 ms ± 1070.962089 ms
 Range (min … max): 8196.744916 ms … 11161.813301 ms 5 runs
  avg levels = 189.60
Benchmark 2: MSC 27868 RGBs @ r=0.02 * freq
 Time (mean ± σ): 567.445846 ms ± 50.098362 ms
 Range (min … max): 535.931831 ms … 708.155399 ms 9 runs
Benchmark 5: MSC 328666 RGBs @ r=0.02 * freq
 Time (mean ± σ): 8657.154354 ms ± 423.756890 ms
 Range (min … max): 8234.889535 ms … 9232.788888 ms 5 runs
  avg levels = 142.80
Benchmark 6: MSC 1103347 RGBs @ r=0.02 * freq
 Time (mean ± σ): 8632.856564 ms ± 204.980172 ms
 Range (min … max): 8460.889577 ms … 9026.406769 ms 5 runs
  avg levels = 7481.80
-->
<!-- degen:
128.830197ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
120.480429ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
118.952109ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
120.114574ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
118.226436ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.798378ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
113.604648ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.712951ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
114.205049ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.700273ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.88471ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
115.011922ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
115.110328ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
114.847408ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.523986ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
114.816618ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
111.691757ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.415618ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
116.297848ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.198883ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
115.283597ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
113.096013ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.486254ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
111.728584ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
114.774358ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
117.894088ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
119.102134ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
116.346146ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
116.510056ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.969533ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
120.484052ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
112.537268ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
151.560906ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
148.841142ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
149.139984ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.394799ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.748579ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.265108ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.081403ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.657656ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.45528ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
146.709704ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.835624ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.912727ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.171056ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
146.425351ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.426ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
143.132354ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.201717ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.156631ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.521818ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.321986ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.48747ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
146.454934ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.907962ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
143.374144ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
143.334902ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.113876ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
142.231602ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
144.536609ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.738015ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.551464ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
141.743795ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
146.265365ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
145.12071ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
 Time (mean ± σ): 115.426131 ms ± 3.595989 ms
 Range (min … max): 111.691757 ms … 128.830197 ms 32 runs
Benchmark 2: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
 Time (mean ± σ): 144.812748 ms ± 2.176153 ms
 Range (min … max): 141.743795 ms … 151.560906 ms 33 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">116.646ms</span></td> <td><span class="roboto-unscale math-font-normal">99.415ms</span></td> <td><span class="roboto-unscale math-font-normal">85.23%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">5.49%</span></td> <td><span class="roboto-unscale math-font-normal">12.35%</span></td> <td><span class="roboto-unscale math-font-normal">-6.68 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">9.47%</span></td> <td><span class="roboto-unscale math-font-normal">16.36%</span></td> <td><span class="roboto-unscale math-font-normal">-7.02 p.p.</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">115.426ms</span></td> <td><span class="roboto-unscale math-font-normal">144.812ms</span></td> <td><span class="roboto-unscale math-font-normal">125.46%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">6.75%</span></td> <td><span class="roboto-unscale math-font-normal">1.54%</span></td> <td><span class="roboto-unscale math-font-normal">6.63 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">11.87%</span></td> <td><span class="roboto-unscale math-font-normal">4.64%</span></td> <td><span class="roboto-unscale math-font-normal">9.51 p.p.</span></td></tr>
</table>
<p class="continuation">
[​[​*freq​]​] becomes more slower than [​[​palette​]​] in the degenerate case and less slower than [​[​palette​]​] on the real image.
What this means is unclear to me.
</p>
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">116.65ms</span></td> <td><span class="roboto-unscale math-font-normal">4.198s</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~109</span>/<span class="roboto-unscale math-font-normal">155</span>]</td> <td><span class="roboto-unscale math-font-normal">5ms</span>/<span class="roboto-unscale math-font-normal">214ms</span>/–</td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">10%</span></td> <td><span class="roboto-unscale math-font-normal">36%</span></td> <td><span class="roboto-unscale math-font-normal">4%</span></td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">99.42ms</span></td> <td><span class="roboto-unscale math-font-normal">3.286s</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~190</span>/<span class="roboto-unscale math-font-normal">152</span>]</td> <td><span class="roboto-unscale math-font-normal">782µs</span>/<span class="roboto-unscale math-font-normal">332ms</span>/–</td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">18%</span></td> <td><span class="roboto-unscale math-font-normal">25%</span></td> <td><span class="roboto-unscale math-font-normal">31%</span></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">1.891s</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~73</span>/<span class="roboto-unscale math-font-normal">220</span>]</td> <td>[time-out; <span class="roboto-unscale math-font-normal">~9560</span>/<span class="roboto-unscale math-font-normal">6505</span>]</td> <td><span class="roboto-unscale math-font-normal">400ms</span>/–/–</td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-30%</span></td> <td><span class="roboto-unscale math-font-normal">∞</span></td> <td><span class="roboto-unscale math-font-normal">42.58×</span></td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">567.45ms</span></td> <td>[time-out; <span class="roboto-unscale math-font-normal">~143</span>/<span class="roboto-unscale math-font-normal">132</span>]</td> <td>[time-out; <span class="roboto-unscale math-font-normal">~7482</span>/<span class="roboto-unscale math-font-normal">5075</span>]</td> <td><span class="roboto-unscale math-font-normal">50ms</span>/–/–</td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-52%</span></td> <td><span class="roboto-unscale math-font-normal">81%</span></td> <td><span class="roboto-unscale math-font-normal">4.6×</span></td> <td></td></tr>
 <tfoot class="label"><tr><td colspan=4> Computation of cells labelled <q>time-out</q> was terminated by the driver after like <span class="roboto-unscale math-font-normal">8-11s</span>; progress corresponds to <em>how many distinct output colours</em> <span style="white-space: nowrap;">([​[​\overline{Set(O)}​]​])</span> were produced vs. a correct implementation; this is a very vague proxy measured for a very vague amount of time. </td></tr></tfoot>
</table>
<p>
The predictions are entirely uncorrelated with reality.
I love economics.
</p>
<div class="singles">
<figure> <a href="/content/assets/blogn_t/018.27-graphml-gridded.png"><img alt="" src="/content/assets/blogn_t/018.27-graphml-gridded.png" /></a> <figcaption></figcaption> </figure>
</div>
<h2 id="cicada-grid" ><a class="hash-link" href="#cicada-grid">#</a> Failure: GPU-side grid-cell-to-index-list mapping</h2>
<p class="indented continued">
While the collection (<q>grouping</q>) can't<!--'--> be sped up on the host, it could, theoretically,
be executed on the GPU by collecting each value of [​[​h​]​] directly from the definition by looking at each element of [​[​D​]​] for each cell,
after pre-computing the sizes to fix the allocation question.
To that end, the latter can be summed up easily in
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/shader-side-grid-cell-allocation/item/src/assign_cell.hlsl#L26"><samp>assign_cell.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token comment">// ...</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->known_rgbs_freqs<span class="token punctuation">;</span><!--"-->   <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>

</small><span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->  <!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	              <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	              <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>z <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token function">InterlockedAdd</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">.</span>group_len<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
(noting that the intermediate map now goes to a non-<samp>HOST_VISIBLE</samp> memory since it doesn't<!--'--> need to be),
after
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/shader-side-grid-cell-allocation/item/src/shader.h#L4">easily restructuring</a>
the group index range to <samp>[begin, begin+size)</samp>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">groupdesc_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint</span> start_idx<span class="token punctuation">,</span> group_len<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="indented continued">
Thus, the allocator can dump the indices into <samp>groups_data</samp> in the same manner as the host-side implementation,
but instead of doing it in order, it can use Some Global to get the next unused chunk.
This is much more like a classical bump allocator.
Conveniently, the Some Global can just be the first integer in <samp>groups_data</samp>.
So, <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/shader-side-grid-cell-allocation/item/src/posterise_gpu.rs#L770">the driver</a>
is greatly simplified:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_groups_data<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// ... through assign_cell.hlsl &amp;c.</span>

<!--"-->	<!--"--><span class="token comment">// self.buffer_groups_data[0] = 1;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_fill_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// cicada_grid.hlsl</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">CICADA_GRID</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">,</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// ... posterise.hlsl/posterise_mul.hlsl &amp;c.</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continued">
The initial offset must be initialised (to <span class="roboto-unscale math-font-normal">1</span> instead of <span class="roboto-unscale math-font-normal">0</span> to not overwrite itself),
but this can be done in the same command buffer as dispatching the shader and the "couple dozen μs" (like <span class="roboto-unscale math-font-normal">79±32</span> in this case) become free.
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/shader-side-grid-cell-allocation/item/src/cicada_grid.hlsl"><samp>cicada_grid.hlsl</samp></a>
is dispatched at [​[​\text{numthreads} = (G, 1, 1), \text{dispatch}(1, G, G)​]​] to evaluate every integer in [​[​h​]​]'s<!--'--> domain of [​[​[0, G )^3​]​]:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->known_rgbs_freqs<span class="token punctuation">;</span><!--"-->   <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->groups_data<span class="token punctuation">;</span><!--"-->        <!--"--><span class="token comment">// DEVICE_LOCAL</span>

</small><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">next_start</span> <span class="token expression">groups_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span></span>
<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span>GRID_SIZE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos<!--"-->        <!--"--><span class="token operator">=</span> DTid<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->  <!--"-->known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->  <!--"-->my_rgbs<!--"-->        <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">.</span>group_len<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>my_rgbs <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">uint</span> start_idx<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token function">InterlockedAdd</span><span class="token punctuation">(</span>next_start<span class="token punctuation">,</span> my_rgbs<span class="token punctuation">,</span> start_idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">.</span>start_idx <span class="token operator">=</span> start_idx<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> gridpos_saved <span class="token operator">=</span> <span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	                           <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	                           <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>z <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> rgb <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> rgb <span class="token operator">&lt;</span> known_rgbs_len<span class="token punctuation">;</span> <span class="token operator">++</span>rgb<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>known_rgbs_freqs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span> <span class="token operator">==</span> gridpos_saved<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->groups_data<span class="token punctuation">[</span>start_idx<span class="token punctuation">]</span> <span class="token operator">=</span> rgb<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token operator">++</span>start_idx<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<!--
57.354µs: cmdbussy 16755 assign_cell.hlsl
47.694µs: cmdbussy *groups_data = 0:
5.949069ms: cmdbussy 16755 cicada_grid.hlsl
102.633µs: cmdbussy 16755 assign_cell.hlsl
74.258µs: cmdbussy *groups_data = 0:
5.88598ms: cmdbussy 16755 cicada_grid.hlsl
82.408µs: cmdbussy 16755 assign_cell.hlsl
74.862µs: cmdbussy *groups_data = 0:
5.895036ms: cmdbussy 16755 cicada_grid.hlsl
103.236µs: cmdbussy 16755 assign_cell.hlsl
61.278µs: cmdbussy *groups_data = 0:
5.886887ms: cmdbussy 16755 cicada_grid.hlsl
87.539µs: cmdbussy 16755 assign_cell.hlsl
101.425µs: cmdbussy *groups_data = 0:
5.971709ms: cmdbussy 16755 cicada_grid.hlsl
80.899µs: cmdbussy 16755 assign_cell.hlsl
67.315µs: cmdbussy *groups_data = 0:
5.920091ms: cmdbussy 16755 cicada_grid.hlsl
101.425µs: cmdbussy 16755 assign_cell.hlsl
74.257µs: cmdbussy *groups_data = 0:
5.835268ms: cmdbussy 16755 cicada_grid.hlsl
111.386µs: cmdbussy 16755 assign_cell.hlsl
115.311µs: cmdbussy *groups_data = 0:
5.908016ms: cmdbussy 16755 cicada_grid.hlsl
63.391µs: cmdbussy 16755 assign_cell.hlsl
57.958µs: cmdbussy *groups_data = 0:
5.823797ms: cmdbussy 16755 cicada_grid.hlsl
82.71µs: cmdbussy 16755 assign_cell.hlsl
70.636µs: cmdbussy *groups_data = 0:
5.876623ms: cmdbussy 16755 cicada_grid.hlsl
80.899µs: cmdbussy 16755 assign_cell.hlsl
84.521µs: cmdbussy *groups_data = 0:
5.852474ms: cmdbussy 16755 cicada_grid.hlsl
103.84µs: cmdbussy 16755 assign_cell.hlsl
95.087µs: cmdbussy *groups_data = 0:
5.968993ms: cmdbussy 16755 cicada_grid.hlsl
124.366µs: cmdbussy 16755 assign_cell.hlsl
101.727µs: cmdbussy *groups_data = 0:
5.935486ms: cmdbussy 16755 cicada_grid.hlsl
69.73µs: cmdbussy 16755 assign_cell.hlsl
69.729µs: cmdbussy *groups_data = 0:
5.90379ms: cmdbussy 16755 cicada_grid.hlsl
99.614µs: cmdbussy 16755 assign_cell.hlsl
83.012µs: cmdbussy *groups_data = 0:
5.809007ms: cmdbussy 16755 cicada_grid.hlsl
95.086µs: cmdbussy 16755 assign_cell.hlsl
91.162µs: cmdbussy *groups_data = 0:
5.888697ms: cmdbussy 16755 cicada_grid.hlsl
98.406µs: cmdbussy 16755 assign_cell.hlsl
67.315µs: cmdbussy *groups_data = 0:
5.956616ms: cmdbussy 16755 cicada_grid.hlsl
95.991µs: cmdbussy 16755 assign_cell.hlsl
87.238µs: cmdbussy *groups_data = 0:
5.830438ms: cmdbussy 16755 cicada_grid.hlsl
83.314µs: cmdbussy 16755 assign_cell.hlsl
73.654µs: cmdbussy *groups_data = 0:
5.897753ms: cmdbussy 16755 cicada_grid.hlsl
80.597µs: cmdbussy 16755 assign_cell.hlsl
81.2µs: cmdbussy *groups_data = 0:
5.827722ms: cmdbussy 16755 cicada_grid.hlsl
90.256µs: cmdbussy 16755 assign_cell.hlsl
80.898µs: cmdbussy *groups_data = 0:
5.936089ms: cmdbussy 16755 cicada_grid.hlsl
94.784µs: cmdbussy 16755 assign_cell.hlsl
83.917µs: cmdbussy *groups_data = 0:
5.927335ms: cmdbussy 16755 cicada_grid.hlsl
151.836µs: cmdbussy 16755 assign_cell.hlsl
95.086µs: cmdbussy *groups_data = 0:
5.952691ms: cmdbussy 16755 cicada_grid.hlsl
79.087µs: cmdbussy 16755 assign_cell.hlsl
105.349µs: cmdbussy *groups_data = 0:
5.834665ms: cmdbussy 16755 cicada_grid.hlsl
107.764µs: cmdbussy 16755 assign_cell.hlsl
98.105µs: cmdbussy *groups_data = 0:
5.953296ms: cmdbussy 16755 cicada_grid.hlsl
75.767µs: cmdbussy 16755 assign_cell.hlsl
95.992µs: cmdbussy *groups_data = 0:
5.988915ms: cmdbussy 16755 cicada_grid.hlsl
108.67µs: cmdbussy 16755 assign_cell.hlsl
101.425µs: cmdbussy *groups_data = 0:
5.905601ms: cmdbussy 16755 cicada_grid.hlsl
90.558µs: cmdbussy 16755 assign_cell.hlsl
90.256µs: cmdbussy *groups_data = 0:
5.862737ms: cmdbussy 16755 cicada_grid.hlsl
155.156µs: cmdbussy 16755 assign_cell.hlsl
92.671µs: cmdbussy *groups_data = 0:
5.821382ms: cmdbussy 16755 cicada_grid.hlsl
60.071µs: cmdbussy 16755 assign_cell.hlsl
51.316µs: cmdbussy *groups_data = 0:
5.869378ms: cmdbussy 16755 cicada_grid.hlsl
139.158µs: cmdbussy 16755 assign_cell.hlsl
148.213µs: cmdbussy *groups_data = 0:
5.846437ms: cmdbussy 16755 cicada_grid.hlsl
92.671µs: cmdbussy 16755 assign_cell.hlsl
86.332µs: cmdbussy *groups_data = 0:
5.945749ms: cmdbussy 16755 cicada_grid.hlsl
66.41µs: cmdbussy 16755 assign_cell.hlsl
93.577µs: cmdbussy *groups_data = 0:
5.901074ms: cmdbussy 16755 cicada_grid.hlsl
90.559µs: cmdbussy 16755 assign_cell.hlsl
70.635µs: cmdbussy *groups_data = 0:
5.81776ms: cmdbussy 16755 cicada_grid.hlsl
81.201µs: cmdbussy 16755 assign_cell.hlsl
92.671µs: cmdbussy *groups_data = 0:
5.890508ms: cmdbussy 16755 cicada_grid.hlsl
106.859µs: cmdbussy 16755 assign_cell.hlsl
92.37µs: cmdbussy *groups_data = 0:
5.859115ms: cmdbussy 16755 cicada_grid.hlsl
100.821µs: cmdbussy 16755 assign_cell.hlsl
87.238µs: cmdbussy *groups_data = 0:
5.86485ms: cmdbussy 16755 cicada_grid.hlsl
76.673µs: cmdbussy 16755 assign_cell.hlsl
63.693µs: cmdbussy *groups_data = 0:
6.013365ms: cmdbussy 16755 cicada_grid.hlsl
55.24µs: cmdbussy 16755 assign_cell.hlsl
61.881µs: cmdbussy *groups_data = 0:
5.899565ms: cmdbussy 16755 cicada_grid.hlsl
76.974µs: cmdbussy 16755 assign_cell.hlsl
97.803µs: cmdbussy *groups_data = 0:
5.922505ms: cmdbussy 16755 cicada_grid.hlsl
102.029µs: cmdbussy 16755 assign_cell.hlsl
58.561µs: cmdbussy *groups_data = 0:
5.814138ms: cmdbussy 16755 cicada_grid.hlsl
102.632µs: cmdbussy 16755 assign_cell.hlsl
73.352µs: cmdbussy *groups_data = 0:
5.834966ms: cmdbussy 16755 cicada_grid.hlsl
113.198µs: cmdbussy 16755 assign_cell.hlsl
77.277µs: cmdbussy *groups_data = 0:
5.89081ms: cmdbussy 16755 cicada_grid.hlsl
103.538µs: cmdbussy 16755 assign_cell.hlsl
73.654µs: cmdbussy *groups_data = 0:
5.866057ms: cmdbussy 16755 cicada_grid.hlsl
64.9µs: cmdbussy 16755 assign_cell.hlsl
65.202µs: cmdbussy *groups_data = 0:
5.959031ms: cmdbussy 16755 cicada_grid.hlsl
67.315µs: cmdbussy 16755 assign_cell.hlsl
63.39µs: cmdbussy *groups_data = 0:
5.951183ms: cmdbussy 16755 cicada_grid.hlsl
108.972µs: cmdbussy 16755 assign_cell.hlsl
102.029µs: cmdbussy *groups_data = 0:
5.840098ms: cmdbussy 16755 cicada_grid.hlsl
131.309µs: cmdbussy 16755 assign_cell.hlsl
69.428µs: cmdbussy *groups_data = 0:
5.898961ms: cmdbussy 16755 cicada_grid.hlsl
94.18µs: cmdbussy 16755 assign_cell.hlsl
83.314µs: cmdbussy *groups_data = 0:
5.88749ms: cmdbussy 16755 cicada_grid.hlsl
105.651µs: cmdbussy 16755 assign_cell.hlsl
76.673µs: cmdbussy *groups_data = 0:
5.772179ms: cmdbussy 16755 cicada_grid.hlsl
85.728µs: cmdbussy 16755 assign_cell.hlsl
61.882µs: cmdbussy *groups_data = 0:
5.920996ms: cmdbussy 16755 cicada_grid.hlsl
74.862µs: cmdbussy 16755 assign_cell.hlsl
67.315µs: cmdbussy *groups_data = 0:
5.886886ms: cmdbussy 16755 cicada_grid.hlsl
83.615µs: cmdbussy 16755 assign_cell.hlsl
73.956µs: cmdbussy *groups_data = 0:
5.888395ms: cmdbussy 16755 cicada_grid.hlsl
70.937µs: cmdbussy 16755 assign_cell.hlsl
58.259µs: cmdbussy *groups_data = 0:
5.909224ms: cmdbussy 16755 cicada_grid.hlsl
102.331µs: cmdbussy 16755 assign_cell.hlsl
61.882µs: cmdbussy *groups_data = 0:
6.010045ms: cmdbussy 16755 cicada_grid.hlsl
109.877µs: cmdbussy 16755 assign_cell.hlsl
78.786µs: cmdbussy *groups_data = 0:
5.948767ms: cmdbussy 16755 cicada_grid.hlsl
115.311µs: cmdbussy 16755 assign_cell.hlsl
126.177µs: cmdbussy *groups_data = 0:
5.901074ms: cmdbussy 16755 cicada_grid.hlsl
75.767µs: cmdbussy 16755 assign_cell.hlsl
80.295µs: cmdbussy *groups_data = 0:
5.846437ms: cmdbussy 16755 cicada_grid.hlsl
81.503µs: cmdbussy 16755 assign_cell.hlsl
77.276µs: cmdbussy *groups_data = 0:
5.923713ms: cmdbussy 16755 cicada_grid.hlsl
144.592µs: cmdbussy 16755 assign_cell.hlsl
145.195µs: cmdbussy *groups_data = 0:
5.843116ms: cmdbussy 16755 cicada_grid.hlsl
57.354µs: cmdbussy 16755 assign_cell.hlsl
52.825µs: cmdbussy *groups_data = 0:
5.874208ms: cmdbussy 16755 cicada_grid.hlsl
118.631µs: cmdbussy 16755 assign_cell.hlsl
112.292µs: cmdbussy *groups_data = 0:
5.989821ms: cmdbussy 16755 cicada_grid.hlsl
66.409µs: cmdbussy 16755 assign_cell.hlsl
60.372µs: cmdbussy *groups_data = 0:
5.931864ms: cmdbussy 16755 cicada_grid.hlsl
106.557µs: cmdbussy 16755 assign_cell.hlsl
90.86µs: cmdbussy *groups_data = 0:
5.786668ms: cmdbussy 16755 cicada_grid.hlsl
85.124µs: cmdbussy 16755 assign_cell.hlsl
97.501µs: cmdbussy *groups_data = 0:
5.863945ms: cmdbussy 16755 cicada_grid.hlsl
131.913µs: cmdbussy 16755 assign_cell.hlsl
73.05µs: cmdbussy *groups_data = 0:
5.816251ms: cmdbussy 16755 cicada_grid.hlsl
85.125µs: cmdbussy 16755 assign_cell.hlsl
67.919µs: cmdbussy *groups_data = 0:
5.919487ms: cmdbussy 16755 cicada_grid.hlsl
143.082µs: cmdbussy 16755 assign_cell.hlsl
133.724µs: cmdbussy *groups_data = 0:
5.834664ms: cmdbussy 16755 cicada_grid.hlsl
133.724µs: cmdbussy 16755 assign_cell.hlsl
98.406µs: cmdbussy *groups_data = 0:
5.997669ms: cmdbussy 16755 cicada_grid.hlsl
135.234µs: cmdbussy 16755 assign_cell.hlsl
117.122µs: cmdbussy *groups_data = 0:
5.948767ms: cmdbussy 16755 cicada_grid.hlsl
108.368µs: cmdbussy 16755 assign_cell.hlsl
82.709µs: cmdbussy *groups_data = 0:
5.873605ms: cmdbussy 16755 cicada_grid.hlsl
122.254µs: cmdbussy 16755 assign_cell.hlsl
67.918µs: cmdbussy *groups_data = 0:
5.986199ms: cmdbussy 16755 cicada_grid.hlsl
118.329µs: cmdbussy 16755 assign_cell.hlsl
102.029µs: cmdbussy *groups_data = 0:
6.050193ms: cmdbussy 16755 cicada_grid.hlsl
102.934µs: cmdbussy 16755 assign_cell.hlsl
95.992µs: cmdbussy *groups_data = 0:
5.917676ms: cmdbussy 16755 cicada_grid.hlsl
96.294µs: cmdbussy 16755 assign_cell.hlsl
63.692µs: cmdbussy *groups_data = 0:
5.901074ms: cmdbussy 16755 cicada_grid.hlsl
70.635µs: cmdbussy 16755 assign_cell.hlsl
58.259µs: cmdbussy *groups_data = 0:
5.904696ms: cmdbussy 16755 cicada_grid.hlsl
100.218µs: cmdbussy 16755 assign_cell.hlsl
76.371µs: cmdbussy *groups_data = 0:
5.897754ms: cmdbussy 16755 cicada_grid.hlsl
100.217µs: cmdbussy 16755 assign_cell.hlsl
89.049µs: cmdbussy *groups_data = 0:
5.881755ms: cmdbussy 16755 cicada_grid.hlsl
70.032µs: cmdbussy 27868 assign_cell.hlsl
63.994µs: cmdbussy *groups_data = 0:
9.361906ms: cmdbussy 27868 cicada_grid.hlsl
99.01µs: cmdbussy 27868 assign_cell.hlsl
202.246µs: cmdbussy *groups_data = 0:
9.439786ms: cmdbussy 27868 cicada_grid.hlsl
67.919µs: cmdbussy 27868 assign_cell.hlsl
92.973µs: cmdbussy *groups_data = 0:
9.338361ms: cmdbussy 27868 cicada_grid.hlsl
68.523µs: cmdbussy 27868 assign_cell.hlsl
77.276µs: cmdbussy *groups_data = 0:
9.298817ms: cmdbussy 27868 cicada_grid.hlsl
113.499µs: cmdbussy 27868 assign_cell.hlsl
83.918µs: cmdbussy *groups_data = 0:
9.316324ms: cmdbussy 27868 cicada_grid.hlsl
131.611µs: cmdbussy 27868 assign_cell.hlsl
109.273µs: cmdbussy *groups_data = 0:
9.410808ms: cmdbussy 27868 cicada_grid.hlsl
123.461µs: cmdbussy 27868 assign_cell.hlsl
71.239µs: cmdbussy *groups_data = 0:
9.334437ms: cmdbussy 27868 cicada_grid.hlsl
87.539µs: cmdbussy 27868 assign_cell.hlsl
83.917µs: cmdbussy *groups_data = 0:
9.406581ms: cmdbussy 27868 cicada_grid.hlsl
80.295µs: cmdbussy 27868 assign_cell.hlsl
58.259µs: cmdbussy *groups_data = 0:
9.476311ms: cmdbussy 27868 cicada_grid.hlsl
93.879µs: cmdbussy 27868 assign_cell.hlsl
65.503µs: cmdbussy *groups_data = 0:
9.41775ms: cmdbussy 27868 cicada_grid.hlsl
76.672µs: cmdbussy 27868 assign_cell.hlsl
103.84µs: cmdbussy *groups_data = 0:
9.440994ms: cmdbussy 27868 cicada_grid.hlsl
85.426µs: cmdbussy 27868 assign_cell.hlsl
63.39µs: cmdbussy *groups_data = 0:
9.294289ms: cmdbussy 27868 cicada_grid.hlsl
95.388µs: cmdbussy 27868 assign_cell.hlsl
117.122µs: cmdbussy *groups_data = 0:
9.44703ms: cmdbussy 27868 cicada_grid.hlsl
89.049µs: cmdbussy 27868 assign_cell.hlsl
98.406µs: cmdbussy *groups_data = 0:
9.508007ms: cmdbussy 27868 cicada_grid.hlsl
89.35µs: cmdbussy 27868 assign_cell.hlsl
88.143µs: cmdbussy *groups_data = 0:
9.3447ms: cmdbussy 27868 cicada_grid.hlsl
92.671µs: cmdbussy 27868 assign_cell.hlsl
58.863µs: cmdbussy *groups_data = 0:
9.493819ms: cmdbussy 27868 cicada_grid.hlsl
64.598µs: cmdbussy 27868 assign_cell.hlsl
111.085µs: cmdbussy *groups_data = 0:
9.401752ms: cmdbussy 27868 cicada_grid.hlsl
62.787µs: cmdbussy 27868 assign_cell.hlsl
69.126µs: cmdbussy *groups_data = 0:
9.373075ms: cmdbussy 27868 cicada_grid.hlsl
76.975µs: cmdbussy 27868 assign_cell.hlsl
50.109µs: cmdbussy *groups_data = 0:
9.471784ms: cmdbussy 27868 cicada_grid.hlsl
59.768µs: cmdbussy 27868 assign_cell.hlsl
50.712µs: cmdbussy *groups_data = 0:
9.415939ms: cmdbussy 27868 cicada_grid.hlsl
62.787µs: cmdbussy 27868 assign_cell.hlsl
57.957µs: cmdbussy *groups_data = 0:
9.324173ms: cmdbussy 27868 cicada_grid.hlsl
79.691µs: cmdbussy 27868 assign_cell.hlsl
62.183µs: cmdbussy *groups_data = 0:
9.378207ms: cmdbussy 27868 cicada_grid.hlsl
86.333µs: cmdbussy 27868 assign_cell.hlsl
57.353µs: cmdbussy *groups_data = 0:
9.423787ms: cmdbussy 27868 cicada_grid.hlsl
54.939µs: cmdbussy 27868 assign_cell.hlsl
62.183µs: cmdbussy *groups_data = 0:
9.584075ms: cmdbussy 27868 cicada_grid.hlsl
74.56µs: cmdbussy 27868 assign_cell.hlsl
91.162µs: cmdbussy *groups_data = 0:
9.444314ms: cmdbussy 27868 cicada_grid.hlsl
92.672µs: cmdbussy 27868 assign_cell.hlsl
82.408µs: cmdbussy *groups_data = 0:
9.427108ms: cmdbussy 27868 cicada_grid.hlsl
62.183µs: cmdbussy 27868 assign_cell.hlsl
54.033µs: cmdbussy *groups_data = 0:
9.372471ms: cmdbussy 27868 cicada_grid.hlsl
71.843µs: cmdbussy 27868 assign_cell.hlsl
61.278µs: cmdbussy *groups_data = 0:
9.456086ms: cmdbussy 27868 cicada_grid.hlsl
86.03µs: cmdbussy 27868 assign_cell.hlsl
64.296µs: cmdbussy *groups_data = 0:
9.291874ms: cmdbussy 27868 cicada_grid.hlsl
70.334µs: cmdbussy 27868 assign_cell.hlsl
110.783µs: cmdbussy *groups_data = 0:
9.365226ms: cmdbussy 27868 cicada_grid.hlsl
100.821µs: cmdbussy 27868 assign_cell.hlsl
59.165µs: cmdbussy *groups_data = 0:
9.609733ms: cmdbussy 27868 cicada_grid.hlsl
89.653µs: cmdbussy 27868 assign_cell.hlsl
64.9µs: cmdbussy *groups_data = 0:
10.499317ms: cmdbussy 27868 cicada_grid.hlsl
59.467µs: cmdbussy 27868 assign_cell.hlsl
61.58µs: cmdbussy *groups_data = 0:
9.35134ms: cmdbussy 27868 cicada_grid.hlsl
80.597µs: cmdbussy 27868 assign_cell.hlsl
89.955µs: cmdbussy *groups_data = 0:
9.358283ms: cmdbussy 27868 cicada_grid.hlsl
83.313µs: cmdbussy 27868 assign_cell.hlsl
90.86µs: cmdbussy *groups_data = 0:
9.383036ms: cmdbussy 27868 cicada_grid.hlsl
64.598µs: cmdbussy 27868 assign_cell.hlsl
60.07µs: cmdbussy *groups_data = 0:
9.488688ms: cmdbussy 27868 cicada_grid.hlsl
83.313µs: cmdbussy 27868 assign_cell.hlsl
72.446µs: cmdbussy *groups_data = 0:
9.404468ms: cmdbussy 27868 cicada_grid.hlsl
64.598µs: cmdbussy 27868 assign_cell.hlsl
74.56µs: cmdbussy *groups_data = 0:
9.429824ms: cmdbussy 27868 cicada_grid.hlsl
459.734µs: cmdbussy 27868 assign_cell.hlsl
83.615µs: cmdbussy *groups_data = 0:
9.608526ms: cmdbussy 27868 cicada_grid.hlsl
64.297µs: cmdbussy 27868 assign_cell.hlsl
51.014µs: cmdbussy *groups_data = 0:
9.381225ms: cmdbussy 27868 cicada_grid.hlsl
73.05µs: cmdbussy 27868 assign_cell.hlsl
79.993µs: cmdbussy *groups_data = 0:
9.429523ms: cmdbussy 27868 cicada_grid.hlsl
92.067µs: cmdbussy 27868 assign_cell.hlsl
51.92µs: cmdbussy *groups_data = 0:
9.505894ms: cmdbussy 27868 cicada_grid.hlsl
63.692µs: cmdbussy 27868 assign_cell.hlsl
64.296µs: cmdbussy *groups_data = 0:
9.406883ms: cmdbussy 27868 cicada_grid.hlsl
75.164µs: cmdbussy 27868 assign_cell.hlsl
57.354µs: cmdbussy *groups_data = 0:
9.506195ms: cmdbussy 27868 cicada_grid.hlsl
67.919µs: cmdbussy 27868 assign_cell.hlsl
53.731µs: cmdbussy *groups_data = 0:
9.403261ms: cmdbussy 27868 cicada_grid.hlsl
59.467µs: cmdbussy 27868 assign_cell.hlsl
69.729µs: cmdbussy *groups_data = 0:
9.465444ms: cmdbussy 27868 cicada_grid.hlsl
79.692µs: cmdbussy 27868 assign_cell.hlsl
77.578µs: cmdbussy *groups_data = 0:
9.384243ms: cmdbussy 27868 cicada_grid.hlsl
74.862µs: cmdbussy 27868 assign_cell.hlsl
71.541µs: cmdbussy *groups_data = 0:
9.347417ms: cmdbussy 27868 cicada_grid.hlsl
70.333µs: cmdbussy 27868 assign_cell.hlsl
69.126µs: cmdbussy *groups_data = 0:
9.336248ms: cmdbussy 27868 cicada_grid.hlsl
85.125µs: cmdbussy 27868 assign_cell.hlsl
55.241µs: cmdbussy *groups_data = 0:
9.549361ms: cmdbussy 27868 cicada_grid.hlsl
57.957µs: cmdbussy 27868 assign_cell.hlsl
53.43µs: cmdbussy *groups_data = 0:
9.479632ms: cmdbussy 27868 cicada_grid.hlsl
101.123µs: cmdbussy 27868 assign_cell.hlsl
98.105µs: cmdbussy *groups_data = 0:
9.410203ms: cmdbussy 27868 cicada_grid.hlsl
101.727µs: cmdbussy 27868 assign_cell.hlsl
65.504µs: cmdbussy *groups_data = 0:
9.425599ms: cmdbussy 27868 cicada_grid.hlsl
75.767µs: cmdbussy 27868 assign_cell.hlsl
68.22µs: cmdbussy *groups_data = 0:
9.330814ms: cmdbussy 27868 cicada_grid.hlsl
64.901µs: cmdbussy 27868 assign_cell.hlsl
76.069µs: cmdbussy *groups_data = 0:
9.494725ms: cmdbussy 27868 cicada_grid.hlsl
64.9µs: cmdbussy 27868 assign_cell.hlsl
73.955µs: cmdbussy *groups_data = 0:
9.356171ms: cmdbussy 27868 cicada_grid.hlsl
82.408µs: cmdbussy 27868 assign_cell.hlsl
63.693µs: cmdbussy *groups_data = 0:
9.406883ms: cmdbussy 27868 cicada_grid.hlsl
65.503µs: cmdbussy 27868 assign_cell.hlsl
69.73µs: cmdbussy *groups_data = 0:
9.528533ms: cmdbussy 27868 cicada_grid.hlsl
62.183µs: cmdbussy 27868 assign_cell.hlsl
59.769µs: cmdbussy *groups_data = 0:
9.473594ms: cmdbussy 27868 cicada_grid.hlsl
64.9µs: cmdbussy 27868 assign_cell.hlsl
77.276µs: cmdbussy *groups_data = 0:
9.457595ms: cmdbussy 27868 cicada_grid.hlsl
64.598µs: cmdbussy 27868 assign_cell.hlsl
56.146µs: cmdbussy *groups_data = 0:
9.444012ms: cmdbussy 27868 cicada_grid.hlsl
54.938µs: cmdbussy 27868 assign_cell.hlsl
74.862µs: cmdbussy *groups_data = 0:
9.406279ms: cmdbussy 27868 cicada_grid.hlsl
98.105µs: cmdbussy 27868 assign_cell.hlsl
71.24µs: cmdbussy *groups_data = 0:
9.446125ms: cmdbussy 27868 cicada_grid.hlsl
65.504µs: cmdbussy 27868 assign_cell.hlsl
94.18µs: cmdbussy *groups_data = 0:
9.322362ms: cmdbussy 27868 cicada_grid.hlsl
124.97µs: cmdbussy 27868 assign_cell.hlsl
62.485µs: cmdbussy *groups_data = 0:
9.409599ms: cmdbussy 27868 cicada_grid.hlsl
71.541µs: cmdbussy 27868 assign_cell.hlsl
64.296µs: cmdbussy *groups_data = 0:
9.471783ms: cmdbussy 27868 cicada_grid.hlsl
138.253µs: cmdbussy 27868 assign_cell.hlsl
67.013µs: cmdbussy *groups_data = 0:
9.456992ms: cmdbussy 27868 cicada_grid.hlsl
73.955µs: cmdbussy 27868 assign_cell.hlsl
118.933µs: cmdbussy *groups_data = 0:
9.418957ms: cmdbussy 27868 cicada_grid.hlsl
75.164µs: cmdbussy 27868 assign_cell.hlsl
83.917µs: cmdbussy *groups_data = 0:
9.430126ms: cmdbussy 27868 cicada_grid.hlsl
107.462µs: cmdbussy 27868 assign_cell.hlsl
95.388µs: cmdbussy *groups_data = 0:
9.693047ms: cmdbussy 27868 cicada_grid.hlsl
117.424µs: cmdbussy 27868 assign_cell.hlsl
60.674µs: cmdbussy *groups_data = 0:
9.540003ms: cmdbussy 27868 cicada_grid.hlsl
95.69µs: cmdbussy 27868 assign_cell.hlsl
58.259µs: cmdbussy *groups_data = 0:
9.465142ms: cmdbussy 27868 cicada_grid.hlsl
79.691µs: cmdbussy 84860 assign_cell.hlsl
59.165µs: cmdbussy *groups_data = 0:
64.424607ms: cmdbussy 84860 cicada_grid.hlsl
83.012µs: cmdbussy 84860 assign_cell.hlsl
77.578µs: cmdbussy *groups_data = 0:
64.503694ms: cmdbussy 84860 cicada_grid.hlsl
67.013µs: cmdbussy 84860 assign_cell.hlsl
60.372µs: cmdbussy *groups_data = 0:
64.476225ms: cmdbussy 84860 cicada_grid.hlsl
69.73µs: cmdbussy 84860 assign_cell.hlsl
56.448µs: cmdbussy *groups_data = 0:
64.507619ms: cmdbussy 84860 cicada_grid.hlsl
131.007µs: cmdbussy 84860 assign_cell.hlsl
84.521µs: cmdbussy *groups_data = 0:
64.622929ms: cmdbussy 84860 cicada_grid.hlsl
70.937µs: cmdbussy 84860 assign_cell.hlsl
55.24µs: cmdbussy *groups_data = 0:
64.5046ms: cmdbussy 84860 cicada_grid.hlsl
68.22µs: cmdbussy 84860 assign_cell.hlsl
52.221µs: cmdbussy *groups_data = 0:
64.564973ms: cmdbussy 84860 cicada_grid.hlsl
58.259µs: cmdbussy 84860 assign_cell.hlsl
57.354µs: cmdbussy *groups_data = 0:
64.58248ms: cmdbussy 84860 cicada_grid.hlsl
71.843µs: cmdbussy 84860 assign_cell.hlsl
91.766µs: cmdbussy *groups_data = 0:
64.58731ms: cmdbussy 84860 cicada_grid.hlsl
64.599µs: cmdbussy 84860 assign_cell.hlsl
56.448µs: cmdbussy *groups_data = 0:
64.658247ms: cmdbussy 84860 cicada_grid.hlsl
65.504µs: cmdbussy 84860 assign_cell.hlsl
57.354µs: cmdbussy *groups_data = 0:
64.549275ms: cmdbussy 84860 cicada_grid.hlsl
88.747µs: cmdbussy 84860 assign_cell.hlsl
57.957µs: cmdbussy *groups_data = 0:
64.475621ms: cmdbussy 84860 cicada_grid.hlsl
68.824µs: cmdbussy 84860 assign_cell.hlsl
96.294µs: cmdbussy *groups_data = 0:
64.592743ms: cmdbussy 84860 cicada_grid.hlsl
66.41µs: cmdbussy 84860 assign_cell.hlsl
97.199µs: cmdbussy *groups_data = 0:
64.60029ms: cmdbussy 84860 cicada_grid.hlsl
67.013µs: cmdbussy 84860 assign_cell.hlsl
88.144µs: cmdbussy *groups_data = 0:
64.607233ms: cmdbussy 84860 cicada_grid.hlsl
70.032µs: cmdbussy 84860 assign_cell.hlsl
54.033µs: cmdbussy *groups_data = 0:
64.635305ms: cmdbussy 84860 cicada_grid.hlsl
92.369µs: cmdbussy 84860 assign_cell.hlsl
73.654µs: cmdbussy *groups_data = 0:
64.529956ms: cmdbussy 84860 cicada_grid.hlsl
95.388µs: cmdbussy 84860 assign_cell.hlsl
73.955µs: cmdbussy *groups_data = 0:
64.617495ms: cmdbussy 84860 cicada_grid.hlsl
90.86µs: cmdbussy 84860 assign_cell.hlsl
79.993µs: cmdbussy *groups_data = 0:
64.594554ms: cmdbussy 84860 cicada_grid.hlsl
84.219µs: cmdbussy 84860 assign_cell.hlsl
59.165µs: cmdbussy *groups_data = 0:
64.614477ms: cmdbussy 84860 cicada_grid.hlsl
64.9µs: cmdbussy 84860 assign_cell.hlsl
70.635µs: cmdbussy *groups_data = 0:
64.623231ms: cmdbussy 84860 cicada_grid.hlsl
81.2µs: cmdbussy 84860 assign_cell.hlsl
73.051µs: cmdbussy *groups_data = 0:
64.538408ms: cmdbussy 84860 cicada_grid.hlsl
117.424µs: cmdbussy 84860 assign_cell.hlsl
101.124µs: cmdbussy *groups_data = 0:
64.681189ms: cmdbussy 84860 cicada_grid.hlsl
70.032µs: cmdbussy 84860 assign_cell.hlsl
59.467µs: cmdbussy *groups_data = 0:
64.609647ms: cmdbussy 84860 cicada_grid.hlsl
72.748µs: cmdbussy 84860 assign_cell.hlsl
57.052µs: cmdbussy *groups_data = 0:
64.38295ms: cmdbussy 84860 cicada_grid.hlsl
75.163µs: cmdbussy 84860 assign_cell.hlsl
57.957µs: cmdbussy *groups_data = 0:
64.404684ms: cmdbussy 84860 cicada_grid.hlsl
71.239µs: cmdbussy 84860 assign_cell.hlsl
54.637µs: cmdbussy *groups_data = 0:
64.443322ms: cmdbussy 84860 cicada_grid.hlsl
82.408µs: cmdbussy 84860 assign_cell.hlsl
57.656µs: cmdbussy *groups_data = 0:
64.919054ms: cmdbussy 84860 cicada_grid.hlsl
98.406µs: cmdbussy 84860 assign_cell.hlsl
91.464µs: cmdbussy *groups_data = 0:
64.262507ms: cmdbussy 84860 cicada_grid.hlsl
84.521µs: cmdbussy 84860 assign_cell.hlsl
63.089µs: cmdbussy *groups_data = 0:
64.651003ms: cmdbussy 84860 cicada_grid.hlsl
68.522µs: cmdbussy 84860 assign_cell.hlsl
52.524µs: cmdbussy *groups_data = 0:
64.5372ms: cmdbussy 84860 cicada_grid.hlsl
70.333µs: cmdbussy 84860 assign_cell.hlsl
63.391µs: cmdbussy *groups_data = 0:
64.485583ms: cmdbussy 84860 cicada_grid.hlsl
67.315µs: cmdbussy 84860 assign_cell.hlsl
51.316µs: cmdbussy *groups_data = 0:
64.395628ms: cmdbussy 84860 cicada_grid.hlsl
70.937µs: cmdbussy 84860 assign_cell.hlsl
54.335µs: cmdbussy *groups_data = 0:
64.692659ms: cmdbussy 84860 cicada_grid.hlsl
72.144µs: cmdbussy 84860 assign_cell.hlsl
51.618µs: cmdbussy *groups_data = 0:
64.47532ms: cmdbussy 84860 cicada_grid.hlsl
72.749µs: cmdbussy 84860 assign_cell.hlsl
57.957µs: cmdbussy *groups_data = 0:
64.577952ms: cmdbussy 84860 cicada_grid.hlsl
57.656µs: cmdbussy 84860 assign_cell.hlsl
45.279µs: cmdbussy *groups_data = 0:
64.449964ms: cmdbussy 84860 cicada_grid.hlsl
94.181µs: cmdbussy 84860 assign_cell.hlsl
73.352µs: cmdbussy *groups_data = 0:
64.702017ms: cmdbussy 84860 cicada_grid.hlsl
80.597µs: cmdbussy 84860 assign_cell.hlsl
84.219µs: cmdbussy *groups_data = 0:
64.66851ms: cmdbussy 84860 cicada_grid.hlsl
112.594µs: cmdbussy 84860 assign_cell.hlsl
68.523µs: cmdbussy *groups_data = 0:
64.60512ms: cmdbussy 84860 cicada_grid.hlsl
79.389µs: cmdbussy 84860 assign_cell.hlsl
77.88µs: cmdbussy *groups_data = 0:
64.395628ms: cmdbussy 84860 cicada_grid.hlsl
94.483µs: cmdbussy 84860 assign_cell.hlsl
59.467µs: cmdbussy *groups_data = 0:
64.652209ms: cmdbussy 84860 cicada_grid.hlsl
62.485µs: cmdbussy 84860 assign_cell.hlsl
51.317µs: cmdbussy *groups_data = 0:
64.766615ms: cmdbussy 84860 cicada_grid.hlsl
73.654µs: cmdbussy 84860 assign_cell.hlsl
77.88µs: cmdbussy *groups_data = 0:
64.625344ms: cmdbussy 84860 cicada_grid.hlsl
110.783µs: cmdbussy 84860 assign_cell.hlsl
63.089µs: cmdbussy *groups_data = 0:
64.663379ms: cmdbussy 84860 cicada_grid.hlsl
64.9µs: cmdbussy 84860 assign_cell.hlsl
53.732µs: cmdbussy *groups_data = 0:
64.54837ms: cmdbussy 84860 cicada_grid.hlsl
85.124µs: cmdbussy 84860 assign_cell.hlsl
68.22µs: cmdbussy *groups_data = 0:
64.689641ms: cmdbussy 84860 cicada_grid.hlsl
97.199µs: cmdbussy 84860 assign_cell.hlsl
83.011µs: cmdbussy *groups_data = 0:
64.674849ms: cmdbussy 84860 cicada_grid.hlsl
69.126µs: cmdbussy 84860 assign_cell.hlsl
60.976µs: cmdbussy *groups_data = 0:
64.672132ms: cmdbussy 84860 cicada_grid.hlsl
72.447µs: cmdbussy 84860 assign_cell.hlsl
64.598µs: cmdbussy *groups_data = 0:
64.534484ms: cmdbussy 84860 cicada_grid.hlsl
66.711µs: cmdbussy 84860 assign_cell.hlsl
48.298µs: cmdbussy *groups_data = 0:
64.739749ms: cmdbussy 84860 cicada_grid.hlsl
93.879µs: cmdbussy 84860 assign_cell.hlsl
79.39µs: cmdbussy *groups_data = 0:
64.555615ms: cmdbussy 84860 cicada_grid.hlsl
92.671µs: cmdbussy 84860 assign_cell.hlsl
78.785µs: cmdbussy *groups_data = 0:
64.546559ms: cmdbussy 84860 cicada_grid.hlsl
88.747µs: cmdbussy 84860 assign_cell.hlsl
76.672µs: cmdbussy *groups_data = 0:
64.610855ms: cmdbussy 84860 cicada_grid.hlsl
91.464µs: cmdbussy 84860 assign_cell.hlsl
57.655µs: cmdbussy *groups_data = 0:
64.644059ms: cmdbussy 84860 cicada_grid.hlsl
65.504µs: cmdbussy 84860 assign_cell.hlsl
57.052µs: cmdbussy *groups_data = 0:
64.455397ms: cmdbussy 84860 cicada_grid.hlsl
108.971µs: cmdbussy 84860 assign_cell.hlsl
81.804µs: cmdbussy *groups_data = 0:
64.678773ms: cmdbussy 84860 cicada_grid.hlsl
86.634µs: cmdbussy 84860 assign_cell.hlsl
54.335µs: cmdbussy *groups_data = 0:
64.823063ms: cmdbussy 84860 cicada_grid.hlsl
97.803µs: cmdbussy 84860 assign_cell.hlsl
91.162µs: cmdbussy *groups_data = 0:
64.401061ms: cmdbussy 84860 cicada_grid.hlsl
99.312µs: cmdbussy 84860 assign_cell.hlsl
73.654µs: cmdbussy *groups_data = 0:
64.861701ms: cmdbussy 84860 cicada_grid.hlsl
72.447µs: cmdbussy 84860 assign_cell.hlsl
57.656µs: cmdbussy *groups_data = 0:
64.652814ms: cmdbussy 84860 cicada_grid.hlsl
94.482µs: cmdbussy 84860 assign_cell.hlsl
62.183µs: cmdbussy *groups_data = 0:
64.290279ms: cmdbussy 84860 cicada_grid.hlsl
71.239µs: cmdbussy 84860 assign_cell.hlsl
72.145µs: cmdbussy *groups_data = 0:
64.63923ms: cmdbussy 84860 cicada_grid.hlsl
62.485µs: cmdbussy 84860 assign_cell.hlsl
47.392µs: cmdbussy *groups_data = 0:
64.617797ms: cmdbussy 84860 cicada_grid.hlsl
67.919µs: cmdbussy 84860 assign_cell.hlsl
73.05µs: cmdbussy *groups_data = 0:
64.758766ms: cmdbussy 84860 cicada_grid.hlsl
216.434µs: cmdbussy 84860 assign_cell.hlsl
60.976µs: cmdbussy *groups_data = 0:
64.568292ms: cmdbussy 84860 cicada_grid.hlsl
63.089µs: cmdbussy 84860 assign_cell.hlsl
50.108µs: cmdbussy *groups_data = 0:
64.628061ms: cmdbussy 84860 cicada_grid.hlsl
104.444µs: cmdbussy 84860 assign_cell.hlsl
501.088µs: cmdbussy *groups_data = 0:
64.668208ms: cmdbussy 84860 cicada_grid.hlsl
90.256µs: cmdbussy 84860 assign_cell.hlsl
60.372µs: cmdbussy *groups_data = 0:
64.437285ms: cmdbussy 84860 cicada_grid.hlsl
71.24µs: cmdbussy 84860 assign_cell.hlsl
60.976µs: cmdbussy *groups_data = 0:
64.474414ms: cmdbussy 84860 cicada_grid.hlsl
68.824µs: cmdbussy 84860 assign_cell.hlsl
58.259µs: cmdbussy *groups_data = 0:
64.594252ms: cmdbussy 84860 cicada_grid.hlsl
65.504µs: cmdbussy 84860 assign_cell.hlsl
98.708µs: cmdbussy *groups_data = 0:
64.606025ms: cmdbussy 84860 cicada_grid.hlsl
75.465µs: cmdbussy 84860 assign_cell.hlsl
59.768µs: cmdbussy *groups_data = 0:
64.802838ms: cmdbussy 84860 cicada_grid.hlsl
69.428µs: cmdbussy 84860 assign_cell.hlsl
75.164µs: cmdbussy *groups_data = 0:
64.839062ms: cmdbussy 84860 cicada_grid.hlsl
68.824µs: cmdbussy 84860 assign_cell.hlsl
61.278µs: cmdbussy *groups_data = 0:
64.654625ms: cmdbussy 84860 cicada_grid.hlsl
87.238µs: cmdbussy 242931 assign_cell.hlsl
63.391µs: cmdbussy *groups_data = 0:
181.666072ms: cmdbussy 242931 cicada_grid.hlsl
131.913µs: cmdbussy 242931 assign_cell.hlsl
128.894µs: cmdbussy *groups_data = 0:
181.44843ms: cmdbussy 242931 cicada_grid.hlsl
95.69µs: cmdbussy 242931 assign_cell.hlsl
72.145µs: cmdbussy *groups_data = 0:
181.780175ms: cmdbussy 242931 cicada_grid.hlsl
143.685µs: cmdbussy 242931 assign_cell.hlsl
121.348µs: cmdbussy *groups_data = 0:
181.841754ms: cmdbussy 242931 cicada_grid.hlsl
122.857µs: cmdbussy 242931 assign_cell.hlsl
73.352µs: cmdbussy *groups_data = 0:
181.626527ms: cmdbussy 242931 cicada_grid.hlsl
98.709µs: cmdbussy 242931 assign_cell.hlsl
80.597µs: cmdbussy *groups_data = 0:
183.030783ms: cmdbussy 242931 cicada_grid.hlsl
87.238µs: cmdbussy 242931 assign_cell.hlsl
77.578µs: cmdbussy *groups_data = 0:
181.997212ms: cmdbussy 242931 cicada_grid.hlsl
96.596µs: cmdbussy 242931 assign_cell.hlsl
73.654µs: cmdbussy *groups_data = 0:
181.349722ms: cmdbussy 242931 cicada_grid.hlsl
109.273µs: cmdbussy 242931 assign_cell.hlsl
94.181µs: cmdbussy *groups_data = 0:
182.065433ms: cmdbussy 242931 cicada_grid.hlsl
96.897µs: cmdbussy 242931 assign_cell.hlsl
60.372µs: cmdbussy *groups_data = 0:
182.178329ms: cmdbussy 242931 cicada_grid.hlsl
96.897µs: cmdbussy 242931 assign_cell.hlsl
95.388µs: cmdbussy *groups_data = 0:
181.653997ms: cmdbussy 242931 cicada_grid.hlsl
131.31µs: cmdbussy 242931 assign_cell.hlsl
75.767µs: cmdbussy *groups_data = 0:
182.568936ms: cmdbussy 242931 cicada_grid.hlsl
85.426µs: cmdbussy 242931 assign_cell.hlsl
115.009µs: cmdbussy *groups_data = 0:
182.18346ms: cmdbussy 242931 cicada_grid.hlsl
125.876µs: cmdbussy 242931 assign_cell.hlsl
103.84µs: cmdbussy *groups_data = 0:
182.252586ms: cmdbussy 242931 cicada_grid.hlsl
117.122µs: cmdbussy 242931 assign_cell.hlsl
116.82µs: cmdbussy *groups_data = 0:
181.877676ms: cmdbussy 242931 cicada_grid.hlsl
121.65µs: cmdbussy 242931 assign_cell.hlsl
132.215µs: cmdbussy *groups_data = 0:
181.778364ms: cmdbussy 242931 cicada_grid.hlsl
163.609µs: cmdbussy 242931 assign_cell.hlsl
95.086µs: cmdbussy *groups_data = 0:
182.099242ms: cmdbussy 242931 cicada_grid.hlsl
104.745µs: cmdbussy 242931 assign_cell.hlsl
118.027µs: cmdbussy *groups_data = 0:
181.403453ms: cmdbussy 242931 cicada_grid.hlsl
114.707µs: cmdbussy 242931 assign_cell.hlsl
81.805µs: cmdbussy *groups_data = 0:
181.953141ms: cmdbussy 242931 cicada_grid.hlsl
103.84µs: cmdbussy 242931 assign_cell.hlsl
104.443µs: cmdbussy *groups_data = 0:
182.299375ms: cmdbussy 242931 cicada_grid.hlsl
96.293µs: cmdbussy 242931 assign_cell.hlsl
76.069µs: cmdbussy *groups_data = 0:
181.940161ms: cmdbussy 242931 cicada_grid.hlsl
146.1µs: cmdbussy 242931 assign_cell.hlsl
145.497µs: cmdbussy *groups_data = 0:
182.116145ms: cmdbussy 242931 cicada_grid.hlsl
102.934µs: cmdbussy 242931 assign_cell.hlsl
78.483µs: cmdbussy *groups_data = 0:
181.615661ms: cmdbussy 242931 cicada_grid.hlsl
129.196µs: cmdbussy 242931 assign_cell.hlsl
76.974µs: cmdbussy *groups_data = 0:
181.746366ms: cmdbussy 242931 cicada_grid.hlsl
176.589µs: cmdbussy 242931 assign_cell.hlsl
85.125µs: cmdbussy *groups_data = 0:
181.283614ms: cmdbussy 242931 cicada_grid.hlsl
92.672µs: cmdbussy 242931 assign_cell.hlsl
71.541µs: cmdbussy *groups_data = 0:
181.241656ms: cmdbussy 242931 cicada_grid.hlsl
82.709µs: cmdbussy 242931 assign_cell.hlsl
59.466µs: cmdbussy *groups_data = 0:
181.878581ms: cmdbussy 242931 cicada_grid.hlsl
103.539µs: cmdbussy 242931 assign_cell.hlsl
60.674µs: cmdbussy *groups_data = 0:
182.355824ms: cmdbussy 242931 cicada_grid.hlsl
111.99µs: cmdbussy 242931 assign_cell.hlsl
60.976µs: cmdbussy *groups_data = 0:
181.842962ms: cmdbussy 242931 cicada_grid.hlsl
130.404µs: cmdbussy 242931 assign_cell.hlsl
109.878µs: cmdbussy *groups_data = 0:
181.994798ms: cmdbussy 242931 cicada_grid.hlsl
132.517µs: cmdbussy 242931 assign_cell.hlsl
91.162µs: cmdbussy *groups_data = 0:
181.628641ms: cmdbussy 242931 cicada_grid.hlsl
105.651µs: cmdbussy 242931 assign_cell.hlsl
84.521µs: cmdbussy *groups_data = 0:
181.864394ms: cmdbussy 242931 cicada_grid.hlsl
103.84µs: cmdbussy 328666 assign_cell.hlsl
91.464µs: cmdbussy *groups_data = 0:
323.403225ms: cmdbussy 328666 cicada_grid.hlsl
113.802µs: cmdbussy 328666 assign_cell.hlsl
100.519µs: cmdbussy *groups_data = 0:
322.60903ms: cmdbussy 328666 cicada_grid.hlsl
115.915µs: cmdbussy 328666 assign_cell.hlsl
75.767µs: cmdbussy *groups_data = 0:
324.189572ms: cmdbussy 328666 cicada_grid.hlsl
86.03µs: cmdbussy 328666 assign_cell.hlsl
79.088µs: cmdbussy *groups_data = 0:
322.567071ms: cmdbussy 328666 cicada_grid.hlsl
129.8µs: cmdbussy 328666 assign_cell.hlsl
96.294µs: cmdbussy *groups_data = 0:
322.776563ms: cmdbussy 328666 cicada_grid.hlsl
104.142µs: cmdbussy 328666 assign_cell.hlsl
85.426µs: cmdbussy *groups_data = 0:
322.604803ms: cmdbussy 328666 cicada_grid.hlsl
160.288µs: cmdbussy 328666 assign_cell.hlsl
129.499µs: cmdbussy *groups_data = 0:
322.934436ms: cmdbussy 328666 cicada_grid.hlsl
150.628µs: cmdbussy 328666 assign_cell.hlsl
86.634µs: cmdbussy *groups_data = 0:
322.459608ms: cmdbussy 328666 cicada_grid.hlsl
124.065µs: cmdbussy 328666 assign_cell.hlsl
102.935µs: cmdbussy *groups_data = 0:
322.541715ms: cmdbussy 328666 cicada_grid.hlsl
79.691µs: cmdbussy 328666 assign_cell.hlsl
57.051µs: cmdbussy *groups_data = 0:
322.441497ms: cmdbussy 328666 cicada_grid.hlsl
98.105µs: cmdbussy 328666 assign_cell.hlsl
52.524µs: cmdbussy *groups_data = 0:
323.023786ms: cmdbussy 328666 cicada_grid.hlsl
99.916µs: cmdbussy 328666 assign_cell.hlsl
89.048µs: cmdbussy *groups_data = 0:
322.3609ms: cmdbussy 328666 cicada_grid.hlsl
105.953µs: cmdbussy 328666 assign_cell.hlsl
93.577µs: cmdbussy *groups_data = 0:
322.734905ms: cmdbussy 328666 cicada_grid.hlsl
118.933µs: cmdbussy 328666 assign_cell.hlsl
100.821µs: cmdbussy *groups_data = 0:
322.413424ms: cmdbussy 328666 cicada_grid.hlsl
131.913µs: cmdbussy 328666 assign_cell.hlsl
106.255µs: cmdbussy *groups_data = 0:
322.295699ms: cmdbussy 328666 cicada_grid.hlsl
98.406µs: cmdbussy 328666 assign_cell.hlsl
90.256µs: cmdbussy *groups_data = 0:
322.676949ms: cmdbussy 328666 cicada_grid.hlsl
86.634µs: cmdbussy 328666 assign_cell.hlsl
61.579µs: cmdbussy *groups_data = 0:
323.098346ms: cmdbussy 328666 cicada_grid.hlsl
111.386µs: cmdbussy 328666 assign_cell.hlsl
64.598µs: cmdbussy *groups_data = 0:
322.775657ms: cmdbussy 328666 cicada_grid.hlsl
111.688µs: cmdbussy 328666 assign_cell.hlsl
80.295µs: cmdbussy *groups_data = 0:
322.475607ms: cmdbussy 328666 cicada_grid.hlsl
104.443µs: cmdbussy 328666 assign_cell.hlsl
61.278µs: cmdbussy *groups_data = 0:
322.859876ms: cmdbussy 328666 cicada_grid.hlsl
125.272µs: cmdbussy 328666 assign_cell.hlsl
92.671µs: cmdbussy *groups_data = 0:
322.968244ms: cmdbussy 328666 cicada_grid.hlsl
168.74µs: cmdbussy 328666 assign_cell.hlsl
63.39µs: cmdbussy *groups_data = 0:
323.453937ms: cmdbussy 328666 cicada_grid.hlsl
182.022µs: cmdbussy 1103347 assign_cell.hlsl
77.277µs: cmdbussy *groups_data = 0:
1.397360591s: cmdbussy 1103347 cicada_grid.hlsl
161.194µs: cmdbussy 1103347 assign_cell.hlsl
78.484µs: cmdbussy *groups_data = 0:
1.395616742s: cmdbussy 1103347 cicada_grid.hlsl
159.383µs: cmdbussy 1103347 assign_cell.hlsl
63.995µs: cmdbussy *groups_data = 0:
1.396635823s: cmdbussy 1103347 cicada_grid.hlsl
142.78µs: cmdbussy 1103347 assign_cell.hlsl
72.748µs: cmdbussy *groups_data = 0:
1.395326352s: cmdbussy 1103347 cicada_grid.hlsl
146.402µs: cmdbussy 1103347 assign_cell.hlsl
79.088µs: cmdbussy *groups_data = 0:
1.396816638s: cmdbussy 1103347 cicada_grid.hlsl
165.721µs: cmdbussy 1103347 assign_cell.hlsl
101.425µs: cmdbussy *groups_data = 0:
1.397281503s: cmdbussy 1103347 cicada_grid.hlsl
161.798µs: cmdbussy 1103347 assign_cell.hlsl
88.144µs: cmdbussy *groups_data = 0:
1.396038743s: cmdbussy 1103347 cicada_grid.hlsl
136.139µs: cmdbussy 1103347 assign_cell.hlsl
118.329µs: cmdbussy *groups_data = 0:
1.395507166s: cmdbussy 1103347 cicada_grid.hlsl
156.062µs: cmdbussy 1103347 assign_cell.hlsl
108.972µs: cmdbussy *groups_data = 0:
1.395069771s: cmdbussy 1103347 cicada_grid.hlsl
Benchmark 1: cmdbussy 84860 assign_cell.hlsl
 Time (mean ± σ): 81.361493 µs ± 21.770075 µs
 Range (min … max): 57.656000 µs … 216.434000 µs 75 runs
Benchmark 3: cmdbussy 16755 assign_cell.hlsl
 Time (mean ± σ): 96.487026 µs ± 22.839193 µs
 Range (min … max): 55.240000 µs … 155.156000 µs 78 runs
Benchmark 4: cmdbussy 242931 assign_cell.hlsl
 Time (mean ± σ): 113.933500 µs ± 22.368955 µs
 Range (min … max): 82.709000 µs … 176.589000 µs 32 runs
Benchmark 2: cmdbussy 27868 assign_cell.hlsl
 Time (mean ± σ): 85.979986 µs ± 48.073003 µs
 Range (min … max): 54.938000 µs … 459.734000 µs 72 runs
Benchmark 5: cmdbussy 328666 assign_cell.hlsl
 Time (mean ± σ): 114.981364 µs ± 22.419119 µs
 Range (min … max): 79.691000 µs … 168.740000 µs 22 runs
Benchmark 6: cmdbussy 1103347 assign_cell.hlsl
 Time (mean ± σ): 156.833444 µs ± 12.904706 µs
 Range (min … max): 136.139000 µs … 182.022000 µs 9 runs
Benchmark 1: cmdbussy *groups_data = 0:
 Time (mean ± σ): 79.330639 µs ± 32.674656 µs
 Range (min … max): 45.279000 µs … 501.088000 µs 288 runs
Benchmark 1: cmdbussy 16755 cicada_grid.hlsl
 Time (mean ± σ): 5.897517 ms ± 56.016805 µs
 Range (min … max): 5.772179 ms … 6.050193 ms 78 runs
Benchmark 3: cmdbussy 84860 cicada_grid.hlsl
 Time (mean ± σ): 64.588360 ms ± 123.469577 µs
 Range (min … max): 64.262507 ms … 64.919054 ms 75 runs
Benchmark 4: cmdbussy 242931 cicada_grid.hlsl
 Time (mean ± σ): 181.892608 ms ± 374.300702 µs
 Range (min … max): 181.241656 ms … 183.030783 ms 32 runs
Benchmark 2: cmdbussy 27868 cicada_grid.hlsl
 Time (mean ± σ): 9.441346 ms ± 147.232393 µs
 Range (min … max): 9.291874 ms … 10.499317 ms 72 runs
Benchmark 5: cmdbussy 328666 cicada_grid.hlsl
 Time (mean ± σ): 322.802948 ms ± 430.303192 µs
 Range (min … max): 322.295699 ms … 324.189572 ms 22 runs
Benchmark 6: cmdbussy 1103347 cicada_grid.hlsl
 Time (mean ± σ): 1396.183703 ms ± 814.541803 µs
 Range (min … max): 1395.069771 ms … 1397.360591 ms 9 runs
-->
<p class="continued">
Visiting <em>every</em> point in [​[​Set(D)​]​] for <em>every</em> occupied cell
(up to [​[​G^3​]​] in theory but cf. occupancy rates above; there are [​[​G^3​]​] (so, <span class="roboto-unscale math-font-normal">1'000'000</span>), threads dispatched though),
is, expectedly, ruinous:
</p>
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th><samp>assign_cell.hlsl</samp> </th> <td><span class="roboto-unscale math-font-normal">96.5µs</span></td> <td><span class="roboto-unscale math-font-normal">113.9µs</span></td> <td><span class="roboto-unscale math-font-normal">115µs</span></td> <td><span class="roboto-unscale math-font-normal">156.8µs</span></td> <td><span class="roboto-unscale math-font-normal">23µs</span>/<span class="roboto-unscale math-font-normal">22µs</span>/<span class="roboto-unscale math-font-normal">22µs</span>/<span class="roboto-unscale math-font-normal">13µs</span></td></tr>
 <tr><th>speed-up vs previous </th> <td><span class="roboto-unscale math-font-normal">-25.27%</span></td> <td><span class="roboto-unscale math-font-normal">49.44%</span></td> <td><span class="roboto-unscale math-font-normal">58.17%</span></td> <td><span class="roboto-unscale math-font-normal">78.73%</span></td> <td></td></tr>
 <tr><th><q>grouping</q> + <q>copying</q> + memcpy</th> <td><span class="roboto-unscale math-font-normal">5.898ms</span></td> <td><span class="roboto-unscale math-font-normal">181.893ms</span></td> <td><span class="roboto-unscale math-font-normal">322.803ms</span></td><td><span class="roboto-unscale math-font-normal">1396.184ms</span></td> <td><span class="roboto-unscale math-font-normal">56µs</span>/<span class="roboto-unscale math-font-normal">374µs</span>/<span class="roboto-unscale math-font-normal">430µs</span>/<span class="roboto-unscale math-font-normal">815µs</span></td></tr>
 <tr><th>speed-up vs previous </th> <td><span class="roboto-unscale math-font-normal">32.91%</span></td> <td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>6.24</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td> <td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>8.27</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td><td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>13.4</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td> <td></td></tr>
</table>
<p class="continuing">
Interestingly enough, the cost of uploading to system RAM actually makes up for the additional atomic in all but the smallest cases.
But everything else is eye-wateringly worser.
</p>
<p class="indented continuation">
Also, this makes the allocation order basically random.
Functionally this is immaterial, but may be tangentially relevant later.
</p>
<p class="indented continued">
Even another <span class="roboto-unscale math-font-normal">40×</span> speed-up wouldn't<!--'--> guarantee we can compute every [​[​f​]​] within the <span class="roboto-unscale math-font-normal">~8s</span> driver-imposed limit.
But, each shader call could iterate [​[​t​]​], like, <span class="roboto-unscale math-font-normal">10</span> times.
The points that converge can be committed as the final [​[​f​]​] mapping as previous,
but the ones that don't<!--'--> can be saved and
</p>
<h2 id="oneshot" class="continuing"><a class="hash-link" href="#oneshot">#</a> processed piece-meal.</h2>
<p class="indented continuing">
The first step here is getting rid of the mis-leading <samp>iter_limit</samp> in
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e8ac90d68fe873865fd9627b699eb4d0a275ee26/item/src/posterise_grid.kernel.hlsl.inc#L26">the current shader</a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token comment">// ...</span>
<!--"-->	<!--"-->known_rgbs_pack <span class="token keyword">this</span> <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">center</span> <span class="token expression"><span class="token keyword">this</span><span class="token punctuation">.</span>lab</span></span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// ...</span>
</code></pre>
</div>
<p class="indented continued">
Since the amount of unconverged points decreases each iteration, the [​[​q_t​]​] points-to-process array must be compacted between iterations.
Well, it doesn't<!--'--> <em>need</em> to be and a thread that just exits instantly could be spawned for it, but this sucks,
actively makes occupancy (how many GPU threads are working vs waiting) worse, and basically defeats the purpose;
this is already a bit of an issue in the current driver,
where it may take <span class="roboto-unscale math-font-normal">64</span> pregnant threads where <span class="roboto-unscale math-font-normal">63</span> have few fast-to-solve points and <span class="roboto-unscale math-font-normal">1</span> that takes long to converge,
as long as the latter to bear an output
(this is hopefully attenuated slightly by the points being sorted by [​[​{\color{var(--r)}r\color{initial}}{\color{var(--r)}r\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--b)}b\color{initial}}{\color{var(--b)}b\color{initial}}_{16}​]​] so similar colours in similar natal situations are carried together, but.).
We can store [​[​q_t​]​]s and [​[​q_{t+10}​]​]s in alternating ranges of a big array and page-flip the input/output iterators
(this makes initialisation a memcpy from <samp>known_rgbs_bundle</samp> as [​[​q_0​]​], which is quite nice from a point-and-woo-at-definition perspective):
</p>
<div class="singles continuation">
 <figure> <a href="/content/assets/blogn_t/018.28-current_rgbs_bundle.png"><img alt="Data flow diagram; known_rgbs_bundle (Set(D)) is copied to the start of current_rgbs_bundle, double the length of Set(D), and this is q_0; this then is shorter and copied to the second half of current_rgbs_bundle as q_10; this is then shorter and copied to the front half of current_rgbs_bundle again as q_20" class="dark-invert" src="/content/assets/blogn_t/018.28-current_rgbs_bundle.png" /></a> <figcaption></figcaption> </figure>
</div>
<p class="indented continuing">
In the current driver, <samp>known_rgbs_freqs</samp> is indexed by the same offset as <samp>known_rgbs_bundle</samp>.
This is no longer possible once original-index data is lost when the state compacts,
so in this case we want to index <samp>known_rgbs_freqs</samp> by [​[​{\color{var(--r)}r\color{initial}}{\color{var(--r)}r\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--b)}b\color{initial}}{\color{var(--b)}b\color{initial}}_{16}​]​] (like <samp>outputs</samp>),
which is kept with the state.
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">USEONESHOT</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">FIND_BBOX</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">USEONESHOT</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ASSIGN_CELL</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">FIND_BBOX</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SHADER_COUNT</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">ASSIGN_CELL</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token keyword">static</span> <span class="token constant">SHADER_DATA</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">SHADER_COUNT</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise_grid.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise_grid.mul.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise_grid_oneshot.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/posterise_grid_oneshot.mul.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/find_bbox.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/assign_cell.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</small><span class="token keyword">const</span> <span class="token constant">SHADER_MAX_BINDING</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><span class="token attribute attr-name">#[repr(C)]</span>
</small><span class="token keyword">struct</span> <span class="token type-definition class-name">ParamsT</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"-->grid_bothdirs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->known_rgbs_len<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>

<!--"-->	<!--"-->bbox_min<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->radiussy_squared<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span>

<!--"-->	<!--"-->bbox_range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->_padding1<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>

</small><!--"-->	<!--"-->current_rgbs_start<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token comment">// [​[​q_t \in \texttt{current_rgbs_bundle} \circ [\texttt{current_rgbs_start}, \texttt{current_rgbs_start}+\texttt{current_rgbs_len} )​]​]</span>
<!--"-->	<!--"-->current_rgbs_len<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<!--"-->	<!--"-->current_rgbs_next<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span><!--"-->  <!--"--><span class="token comment">// [​[​q_{t+\texttt{iter_limit}} \to \texttt{current_rgbs_bundle} \circ [\texttt{current_rgbs_next}, \ldots )​]​]</span>
<!--"-->	<!--"-->iter_limit<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"-->group_ranges<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">GroupDesc</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</small><span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->buffer_outputs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->             <!--"--><span class="token comment">// [[vk::binding(0)]] <abbr title="StructuredBuffer">SB</abbr>&lt;float3><!--"-->          <!--"-->outputs;<!--"-->             <!--"-->[HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_params<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->              <!--"--><span class="token comment">// [[vk::binding(1)]] <abbr title="StructuredBuffer">SB</abbr>&lt;params_t><!--"-->        <!--"-->params;<!--"-->              <!--"-->[DEVICE_LOCAL &amp; HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_known_rgbs_bundle<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->   <!--"--><span class="token comment">// [[vk::binding(2)]] <abbr title="StructuredBuffer">SB</abbr>&lt;known_rgbs_pack> known_rgbs_bundle;<!--"-->   <!--"-->[DEVICE_LOCAL &amp; HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_known_rgbs_freqs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->    <!--"--><span class="token comment">// [[vk::binding(3)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint><!--"-->            <!--"-->known_rgbs_freqs;<!--"-->    <!--"-->[DEVICE_LOCAL &amp; HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_groups_data<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->         <!--"--><span class="token comment">// [[vk::binding(4)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint><!--"-->            <!--"-->groups_data;<!--"-->         <!--"-->[DEVICE_LOCAL]</span>
<!--"-->	<!--"-->buffer_current_rgbs_bundle<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span> <span class="token comment">// [[vk::binding(5)]] <abbr title="StructuredBuffer">SB</abbr>&lt;float4><!--"-->          <!--"-->current_rgbs_bundle; [DEVICE_LOCAL]</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token comment">// vk::BufferUsageFlags::STORAGE_BUFFER<!--"-->                <!--"-->| ::TRANSFER_SRC ⬎<!--"-->       <!--"-->⬐ ::TRANSFER_DST</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_known_rgbs_bundle<!--"-->   <!--"--><span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>input_memory_type_index<span class="token punctuation">,</span><!--"-->   <!--"--><span class="token boolean">true</span><span class="token punctuation">,</span><!--"-->  <!--"--><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// was false, false</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_current_rgbs_bundle <span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>private_memory_type_index<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">Lab</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">Lab</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> use_oneshot_driver <span class="token operator">=</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">50_000</span><span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_groups_data<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">if</span> use_oneshot_driver <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_current_rgbs_bundle<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">,</span> <span class="token punctuation">(</span>known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">let</span> buffer_known_rgbs_freqs_len <span class="token operator">=</span> <span class="token keyword">if</span> use_oneshot_driver <span class="token punctuation">{</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span> freq_weighting <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">,</span> buffer_known_rgbs_freqs_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">let</span> buffer_known_rgbs_bundle_map <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_bundle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">KnownRgbsPack</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>buffer_known_rgbs_bundle_map<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> lab<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dest_lab<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->dest_lab <span class="token operator">=</span> <span class="token class-name">KnownRgbsPack</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->rgb<span class="token punctuation">:</span> rgb<span class="token punctuation">,</span>
<!--"-->			<!--"-->lab<span class="token punctuation">:</span> lab<span class="token punctuation">,</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">unmap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span>
</small>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">if</span> freq_weighting <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> buffer_known_rgbs_freqs_map <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>buffer_known_rgbs_freqs_map<span class="token punctuation">,</span> buffer_known_rgbs_freqs_len <span class="token operator">/</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->		<!--"--><span class="token keyword">if</span> use_oneshot_driver <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">,</span> freq<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs <span class="token punctuation">{</span>
<!--"-->				<!--"-->known_rgbs_freqs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> freq<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->			<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">_</span><span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">,</span> freq<span class="token punctuation">)</span><span class="token punctuation">,</span> dest_freq<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->				<!--"-->dest_freq <span class="token operator">=</span> freq<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
</small><!--"-->		<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">unmap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
</small>
<!--"-->	<!--"--><span class="token comment">// ...</span>

<!--"-->	<!--"--><span class="token comment">// posterise_grid_oneshot.kernel.hlsl.inc or posterise_grid.kernel.hlsl.inc</span>
<!--"-->	<!--"--><span class="token keyword">if</span> use_oneshot_driver <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_len <span class="token operator">=</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">let</span> il <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>len<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">if</span> len <span class="token operator">&lt;=</span><!--"-->  <!--"--><span class="token number">10_000</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span>
<!--"-->		          <!--"--><span class="token keyword">else</span> <span class="token keyword">if</span> len <span class="token operator">&lt;=</span> <span class="token number">100_000</span> <span class="token punctuation">{</span> <span class="token number">20</span> <span class="token punctuation">}</span>
<!--"-->		          <!--"--><span class="token keyword">else</span><!--"-->                   <!--"--><span class="token punctuation">{</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> first <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>orig_start<span class="token punctuation">,</span> orig_next<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><!--"-->                <!--"-->known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		                                <!--"--><span class="token punctuation">(</span>known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><!--"-->               <!--"--><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_start <span class="token operator">=</span> orig_start<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_next<!--"-->  <!--"--><span class="token operator">=</span> orig_next<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>iter_limit <span class="token operator">=</span> <span class="token function">il</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_len<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token keyword">if</span> first <span class="token punctuation">{</span>
<!--"-->				<!--"--><span class="token comment">// memcpy(self.buffer_current_rgbs, self.buffer_known_rgbs, known_rgbs.len() * mem::size_of::&lt;KnownRgbsPack>());</span>
<!--"-->				<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_copy_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span>
<!--"-->					<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_current_rgbs_bundle<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span>
<!--"-->					<!--"--><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">BufferCopy</span> <span class="token punctuation">{</span>
<!--"-->					  	<!--"-->src_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->					  	<!--"-->dst_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->					  	<!--"-->size<span class="token punctuation">:</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">KnownRgbsPack</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->					  <!--"--><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span>
<!--"-->				<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">USEONESHOT</span> <span class="token operator">+</span> freq_weighting<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_len<span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token keyword">let</span> still_to_do <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_next <span class="token operator">-</span> orig_next<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">if</span> still_to_do <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
<!--"-->				<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>
<!--"-->			<!--"--><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"did {}/{} ({} steps); {} left"</span><span class="token punctuation">,</span>
<!--"-->			         <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_len <span class="token operator">-</span> still_to_do<span class="token punctuation">,</span>
<!--"-->			         <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_len<span class="token punctuation">,</span>
<!--"-->			         <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>iter_limit<span class="token punctuation">,</span>
<!--"-->			         <!--"-->still_to_do<span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>current_rgbs_len <span class="token operator">=</span> still_to_do<span class="token punctuation">;</span>
<!--"-->			<!--"-->first <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span>
<!--"-->			<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span>freq_weighting<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"--><span class="token comment">// ... output copying</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuation">
The actual value of [​[​10​]​] is roughly tuned to dispatch shaders that don't make effectively-zero progress and also don't take <span class="roboto-unscale math-font-normal"> >8s</span>
(there's<!--'--> inherent per-dispatch/per-writeback overhead on one side of <samp>-1</samp> and occupancy on the other).
This is inherently slower (more indirection, more sparse) than not doing it, so only doing it when needed seems apt;
<span class="roboto-unscale math-font-normal"> >50'000<!--'--></span> is as good of a threshold as any.
(The corresponding
 <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e8ac90d68fe873865fd9627b699eb4d0a275ee26/item/src/shader.h#L9"><samp>shader.h</samp></a>
 diff is trivial.)
</p>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e8ac90d68fe873865fd9627b699eb4d0a275ee26/item/src/posterise_grid_oneshot.kernel.hlsl.inc#L43">
 <samp>posterise_grid_oneshot.kernel.hlsl.inc</samp></a>
differs little and predictably from its do-it-all counterpart:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">float3</span><span class="token operator">></span><!--"-->          <!--"-->outputs<span class="token punctuation">;</span><!--"-->              <!--"--><span class="token comment">// HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->               <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->    <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token comment">/*<!--"-->            <!--"-->3 */</span><!--"-->   <!--"-->KNOWN_RGBS_FREQS
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->groups_data<span class="token punctuation">;</span><!--"-->          <!--"--><span class="token comment">// DEVICE_LOCAL</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> current_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL</span>

<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->current_rgbs_start <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>current_rgbs_start<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->current_rgbs_len<!--"-->   <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>current_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->iter_limit<!--"-->         <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iter_limit<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float</span><!--"-->  <!--"-->radiussy_squared<!--"-->   <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>radiussy_squared<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_min<!--"-->           <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_range<!--"-->         <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span><!--"-->  <!--"-->grid_bothdirs<!--"-->      <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>grid_bothdirs<span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> current_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->id <span class="token operator">+=</span> current_rgbs_start<span class="token punctuation">;</span>

<!--"-->	<!--"-->known_rgbs_pack <span class="token keyword">this</span> <span class="token operator">=</span> current_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">center</span> <span class="token expression"><span class="token keyword">this</span><span class="token punctuation">.</span>lab</span></span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iter_limit<span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos<!--"-->      <!--"--><span class="token operator">=</span> <span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_from <span class="token operator">=</span> gridpos <span class="token operator">-</span> <span class="token keyword">min</span><span class="token punctuation">(</span>grid_bothdirs<span class="token punctuation">,</span> gridpos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_to<!--"-->   <!--"--><span class="token operator">=</span> <span class="token keyword">min</span><span class="token punctuation">(</span>gridpos <span class="token operator">+</span> grid_bothdirs<span class="token punctuation">,</span> GRID_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> newcenter<!--"-->     <!--"--><span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gx <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>x<span class="token punctuation">;</span> gx <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token operator">++</span>gx<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gy <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>y<span class="token punctuation">;</span> gy <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token operator">++</span>gy<span class="token punctuation">)</span>
<!--"-->				<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gz <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>z<span class="token punctuation">;</span> gz <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token operator">++</span>gz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->					<!--"--><span class="token class-name">groupdesc_t</span> group <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gx<span class="token punctuation">]</span><span class="token punctuation">[</span>gy<span class="token punctuation">]</span><span class="token punctuation">[</span>gz<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->					<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>start_idx <span class="token operator">!=</span> group<span class="token punctuation">.</span>end_idx<span class="token punctuation">;</span> <span class="token operator">++</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->						<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> i <span class="token operator">=</span> groups_data<span class="token punctuation">[</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->						<!--"-->INTERROGATED_LOAD

<!--"-->						<!--"--><span class="token keyword">float3</span> tmp <span class="token operator">=</span> interrogated_lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<!--"-->						<!--"--><span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#if</span> <span class="token expression"><span class="token operator">!</span>BRANCHLESS_ADD</span></span>
<!--"-->						<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive keyword">#endif</span></span>
<!--"-->						<!--"--><span class="token punctuation">{</span>
<!--"-->							<!--"-->FREQ_LOAD
<!--"-->							<!--"-->newcenter_count <span class="token operator">+=</span> FREQ<span class="token punctuation">;</span>
<!--"-->							<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> FREQ <span class="token operator">*</span> interrogated_lab<span class="token punctuation">;</span>
<!--"-->						<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><!--"-->					<!--"--><span class="token punctuation">}</span>
<!--"-->				<!--"--><span class="token punctuation">}</span>

<!--"-->		<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">bool</span> same <span class="token operator">=</span> newcenter <span class="token operator">==</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->			<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> center<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"--><span class="token keyword">uint</span> savein<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token function">InterlockedAdd</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>current_rgbs_next<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> savein<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->current_rgbs_bundle<span class="token punctuation">[</span>savein<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e8ac90d68fe873865fd9627b699eb4d0a275ee26/item/src/posterise_grid_oneshot.hlsl">
 <samp>posterise_grid_oneshot.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">KNOWN_RGBS_FREQS</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">BRANCHLESS_ADD</span><!--"-->    <!--"--><span class="token expression"><span class="token number">1</span></span></span>
</small><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">INTERROGATED_LOAD</span> <span class="token expression"><span class="token keyword">const</span> <span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">interrogated_lab</span><!--"-->  <!--"--><span class="token expression">lab</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_LOAD</span></span>
<small style='display: block; line-height: initial;'><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ</span><!--"-->              <!--"--><span class="token expression">matched</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"posterise_grid_oneshot.kernel.hlsl.inc"</span></span>
</small></code></pre>
</div>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e8ac90d68fe873865fd9627b699eb4d0a275ee26/item/src/posterise_grid_oneshot.mul.hlsl">
 <samp>posterise_grid_oneshot.mul.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">KNOWN_RGBS_FREQS</span><!--"-->  <!--"--><span class="token expression"><span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span> known_rgbs_freqs<span class="token punctuation">;</span> </span><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">BRANCHLESS_ADD</span><!--"-->    <!--"--><span class="token expression"><span class="token number">0</span></span></span>
</small><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">INTERROGATED_LOAD</span> <span class="token expression"><span class="token keyword">const</span> known_rgbs_pack interrogated <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">interrogated_lab</span><!--"-->  <!--"--><span class="token expression">interrogated<span class="token punctuation">.</span>lab</span></span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_LOAD</span><!--"-->         <!--"--><span class="token expression"><span class="token keyword">const</span> <span class="token keyword">uint</span> freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>interrogated<span class="token punctuation">.</span>rgb<span class="token punctuation">]</span><span class="token punctuation">;</span></span></span>
<small style='display: block; line-height: initial;'><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ</span><!--"-->              <!--"--><span class="token expression">freq</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"posterise_grid_oneshot.kernel.hlsl.inc"</span></span>
</small></code></pre>
</div>
<p class="continuing">
The expansion for [​[​palette​]​] is entirely unchanged:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">const</span> <span class="token keyword">uint</span> i <span class="token operator">=</span> groups_data<span class="token punctuation">[</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
<span class="token keyword">float3</span> tmp <span class="token operator">=</span> lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
newcenter_count <span class="token operator">+=</span> matched<span class="token punctuation">;</span>
newcenter<!--"-->       <!--"--><span class="token operator">+=</span> matched <span class="token operator">*</span> lab<span class="token punctuation">;</span>
</small></code></pre>
</div>
<p class="continuing">
But [​[​*freq​]​] reads more data more indirectly:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">const</span> <span class="token keyword">uint</span> i <span class="token operator">=</span> groups_data<span class="token punctuation">[</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> known_rgbs_pack interrogated <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">float3</span> tmp <span class="token operator">=</span> interrogated<span class="token punctuation">.</span>lab <span class="token operator">-</span> center<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">bool</span> matched <span class="token operator">=</span> <span class="token keyword">dot</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>interrogated<span class="token punctuation">.</span>rgb<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->newcenter_count <span class="token operator">+=</span> freq<span class="token punctuation">;</span>
<!--"-->	<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> freq <span class="token operator">*</span> interrogated<span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<!--
[src\main.rs:162:27] images().swap_remove(0) = ".\\00.png"
1.38071ms: frequencies
16.686856ms: 16755 RGBs
353.177µs: cmdbussy
63.693µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    7,
    8,
]
73.654µs: cmdbussy
6.066191ms: grouping
2.423639ms: copied
225.188µs: cmdbussy
57.957µs: cmdbussy
44.282654ms: cmdbussy
did 8726/16755 (20 steps); 8029 left
75.41656ms: cmdbussy
140.850287ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
146.920705ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
137.099971ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
135.552029ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
135.58131ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.05672ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
124.854692ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
129.260951ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
136.774262ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
128.815707ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
139.577945ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
127.217657ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
137.62551ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
138.683531ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
144.615697ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
154.679731ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.111788ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
126.484135ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
135.531201ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.788559ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.613717ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.250214ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
130.764217ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.384303ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
138.097318ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
136.380335ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.545433ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
139.653409ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
129.067459ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.378632ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
126.713852ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.303103ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
158.022234ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
138.244626ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
134.724931ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.064569ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.233309ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
146.460367ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.846992ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
141.505325ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
135.077202ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
136.411728ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
126.965301ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.13654ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.308472ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.371022ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
134.378395ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.511926ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
127.681013ms: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
245.413µs: cmdbussy
91.766µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    7,
    8,
]
129.196µs: cmdbussy
4.785698ms: grouping
2.565816ms: copied
254.468µs: cmdbussy
89.048µs: cmdbussy
63.743005ms: cmdbussy
did 9892/16755 (20 steps); 6863 left
64.646173ms: cmdbussy
176.99025ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
139.969759ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
139.148699ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
147.697392ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.422056ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
148.383823ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
143.45625ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.054691ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
138.463475ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.457072ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
136.830409ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
142.843473ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
139.051499ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
144.300554ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
150.309392ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.737802ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
139.342795ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
141.721759ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
139.446937ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
134.657616ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
144.532685ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
143.5779ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
147.02213ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
139.815508ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
142.540103ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
140.162347ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
138.292622ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
145.942072ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
142.566063ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
148.543205ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.399114ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.304029ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.833794ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
147.207473ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
145.681869ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
141.548188ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
138.189084ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
150.469076ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
137.97748ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
142.090632ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
138.664515ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
138.526866ms: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
  Time (mean ± σ): 134.983231 ms ± 6.620501 ms
  Range (min … max): 124.854692 ms … 158.022234 ms 49 runs
Benchmark 2: MSC 16755 RGBs @ r=0.02 * freq [yesgrid] => ~325 levels
  Time (mean ± σ): 142.337439 ms ± 6.768182 ms
  Range (min … max): 134.657616 ms … 176.990250 ms 42 runs
-->
<!--
1.644235ms: frequencies
15.670189ms: 16755 RGBs
299.144µs: cmdbussy
61.278µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    7,
    8,
]
66.107µs: cmdbussy
5.266562ms: grouping
2.400999ms: copied
242.696µs: cmdbussy
73.352µs: cmdbussy
44.461959ms: cmdbussy
did 8726/16755 (20 steps); 8029 left
93.605776ms: cmdbussy
158.251647ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.867281ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
129.742721ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
134.648258ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
146.294646ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.501727ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.515979ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
140.197061ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
145.44853ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.040247ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
127.908616ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.49804ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.73845ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
139.578548ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
130.957107ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
139.557116ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.681033ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
136.351658ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
130.525748ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
136.165108ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
136.592543ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
140.066355ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
132.842227ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
130.820967ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
148.624104ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
130.033714ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.902534ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
133.321279ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
142.773139ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
146.95723ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
138.131428ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
127.947858ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
128.897209ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
139.759665ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
143.248871ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
139.008031ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
142.307368ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
131.862085ms: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
283.145µs: cmdbussy
150.326µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    7,
    8,
]
121.65µs: cmdbussy
4.473575ms: grouping
2.746328ms: copied
246.62µs: cmdbussy
83.616µs: cmdbussy
70.330812ms: cmdbussy
did 8726/16755 (20 steps); 8029 left
125.88132ms: cmdbussy
244.100813ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
194.008247ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
202.927928ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
194.420589ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
200.099795ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
201.879868ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
188.446163ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
203.001883ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
196.688468ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
196.82189ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
194.820253ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
195.867709ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
213.211715ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
194.773766ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
194.116012ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
214.790749ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
205.286667ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
195.647653ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
212.988037ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
204.017343ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
206.731674ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
193.979872ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
204.301695ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
210.680614ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
199.840497ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
185.946154ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
203.30797ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
195.605392ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
206.779367ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
200.869238ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
209.690511ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
203.95697ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
194.087033ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
217.339056ms: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
Benchmark 1: MSC DEGEN 16755 RGBs @ r=0.02 [yesgrid] => ~374 levels
  Time (mean ± σ): 136.593845 ms ± 6.582382 ms
  Range (min … max): 127.908616 ms … 158.251647 ms 38 runs
Benchmark 2: MSC DEGEN 16755 RGBs @ r=0.02 * freq [yesgrid] => ~374 levels
  Time (mean ± σ): 202.383282 ms ± 10.374129 ms
  Range (min … max): 185.946154 ms … 244.100813 ms 34 runs
-->
<table class="perf ">
 <caption><code>use_oneshot_driver = true</code></caption>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th> <th>±σ</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">134.983ms</span></td> <td><span class="roboto-unscale math-font-normal">142.337ms</span></td> <td><span class="roboto-unscale math-font-normal">105.45%</span></td> <td><span class="roboto-unscale math-font-normal">6.6ms</span>/<span class="roboto-unscale math-font-normal">6.8ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-15.72%</span></td> <td><span class="roboto-unscale math-font-normal">-43.17%</span></td> <td><span class="roboto-unscale math-font-normal">20.22 p.p.</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-4.76%</span></td> <td><span class="roboto-unscale math-font-normal">-19.75%</span></td> <td><span class="roboto-unscale math-font-normal">13.20 p.p.</span></td> <td></td></tr>
 <tr><th>iterations [​[​(pointsdone \operatorname{@} depth)​]​]</th> <td><span class="roboto-unscale math-font-normal">2</span> [​[​((8726 \operatorname{@} q_{20}), (8029 \operatorname{@} \infty))​]​]</td> <td><span class="roboto-unscale math-font-normal">2</span> [​[​((9892 \operatorname{@} q_{20}), (6863 \operatorname{@} \infty))​]​]</td> <td></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th> <th>±σ</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">136.594ms</span></td> <td><span class="roboto-unscale math-font-normal">202.383ms</span></td> <td><span class="roboto-unscale math-font-normal">148.16%</span></td> <td><span class="roboto-unscale math-font-normal">6.6ms</span>/<span class="roboto-unscale math-font-normal">10.4ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-18.34%</span></td> <td><span class="roboto-unscale math-font-normal">-39.76%</span></td> <td><span class="roboto-unscale math-font-normal">22.71 p.p.</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-4.29%</span></td> <td><span class="roboto-unscale math-font-normal">-33.27%</span></td> <td><span class="roboto-unscale math-font-normal">32.21 p.p.</span></td> <td></td></tr>
 <tr><th>iterations [​[​(pointsdone \operatorname{@} depth)​]​]</th> <td colspan=2 style="text-align: center;"><span class="roboto-unscale math-font-normal">2</span> [​[​((8726 \operatorname{@} q_{20}), (8029 \operatorname{@} \infty))​]​]</td> <td></td> <td></td></tr>
</table>
<p class="continuing">
<a href="#grid-impl">Previous</a> and <code>use_oneshot_driver = known_rgbs.len() > 50_000</code> are equivalent,
so this measures the minimum cost of the piece-meal shader.
As ever, <span class="roboto-unscale math-font-normal"><sub>d</sub></span> is equivalent except for measuring the relative cost of [​[​*freq​]​]:
the indirections really show — this is the first time that [​[​*freq​]​] is <em>slower</em> than [​[​palette​]​] in the non-degenerate case.
</p>
<p class="indented continuation">
Becoming slower than base-line seems wrong some-how (largely on account of "how would it even be possible").
</p>
<!--
[src\main.rs:188:27] possible.swap_remove(i as usize) = ".\\0image.png"
5.873906ms: frequencies
16.107284ms: 27868 RGBs
330.537µs: cmdbussy
108.971µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    11,
    11,
]
106.557µs: cmdbussy
6.883328ms: grouping
2.052954ms: copied
278.618µs: cmdbussy
55.543µs: cmdbussy
117.362511ms: cmdbussy
did 1435/27868 (20 steps); 26433 left
101.526298ms: cmdbussy
did 2011/26433 (20 steps); 24422 left
93.384211ms: cmdbussy
did 3731/24422 (20 steps); 20691 left
83.64015ms: cmdbussy
did 3481/20691 (20 steps); 17210 left
82.094925ms: cmdbussy
did 2988/17210 (20 steps); 14222 left
80.989511ms: cmdbussy
did 2211/14222 (20 steps); 12011 left
81.828986ms: cmdbussy
did 589/12011 (20 steps); 11422 left
81.579649ms: cmdbussy
did 629/11422 (20 steps); 10793 left
83.317159ms: cmdbussy
did 805/10793 (20 steps); 9988 left
1.637472919s: cmdbussy
2.463927201s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.459621159s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.446177795s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.426919087s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.477819733s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
3.383754223s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
3.45868509s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
2.434647625s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
3.40361303s: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
281.636µs: cmdbussy
83.918µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    11,
    11,
]
128.291µs: cmdbussy
7.172813ms: grouping
2.448089ms: copied
267.146µs: cmdbussy
70.636µs: cmdbussy
147.221961ms: cmdbussy
did 17216/27868 (20 steps); 10652 left
125.371175ms: cmdbussy
did 7467/10652 (20 steps); 3185 left
460.443427ms: cmdbussy
791.811245ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
765.5542ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
751.129185ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
733.216171ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
728.33116ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
721.84176ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
744.855917ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
753.463775ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
742.326627ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
740.94169ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
728.248149ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
749.49944ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
730.676014ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
756.148825ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
758.7729ms: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
[src\main.rs:188:27] possible.swap_remove(i as usize) = ".\\B.png"
1.730869ms: frequencies
26.751192ms: 84860 RGBs
105.048µs: cmdbussy
88.143µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    10,
    12,
]
116.82µs: cmdbussy
11.147411ms: grouping
2.606868ms: copied
301.257µs: cmdbussy
112.594µs: cmdbussy
443.945234ms: cmdbussy
did 3439/84860 (20 steps); 81421 left
378.94679ms: cmdbussy
did 4585/81421 (20 steps); 76836 left
381.799373ms: cmdbussy
did 4990/76836 (20 steps); 71846 left
385.517693ms: cmdbussy
did 7237/71846 (20 steps); 64609 left
379.10738ms: cmdbussy
did 8241/64609 (20 steps); 56368 left
382.456222ms: cmdbussy
did 1893/56368 (20 steps); 54475 left
379.830336ms: cmdbussy
did 1537/54475 (20 steps); 52938 left
360.953481ms: cmdbussy
did 1434/52938 (20 steps); 51504 left
342.946286ms: cmdbussy
did 1165/51504 (20 steps); 50339 left
323.619055ms: cmdbussy
did 1606/50339 (20 steps); 48733 left
285.583106ms: cmdbussy
did 1593/48733 (20 steps); 47140 left
254.358339ms: cmdbussy
did 2736/47140 (20 steps); 44404 left
228.402551ms: cmdbussy
did 4634/44404 (20 steps); 39770 left
170.655101ms: cmdbussy
did 7876/39770 (20 steps); 31894 left
154.098951ms: cmdbussy
did 7448/31894 (20 steps); 24446 left
143.304113ms: cmdbussy
did 4920/24446 (20 steps); 19526 left
138.184555ms: cmdbussy
did 4170/19526 (20 steps); 15356 left
124.848352ms: cmdbussy
did 3074/15356 (20 steps); 12282 left
116.090772ms: cmdbussy
did 2309/12282 (20 steps); 9973 left
653.019045ms: cmdbussy
6.057922528s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
6.076305238s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
6.079566541s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
6.088994553s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
6.097406202s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
6.132967499s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
6.094658365s: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
203.152µs: cmdbussy
70.635µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    10,
    12,
]
117.121µs: cmdbussy
13.886193ms: grouping
2.487633ms: copied
329.028µs: cmdbussy
434.377µs: cmdbussy
773.257985ms: cmdbussy
did 4698/84860 (20 steps); 80162 left
634.959326ms: cmdbussy
did 6368/80162 (20 steps); 73794 left
660.425798ms: cmdbussy
did 11911/73794 (20 steps); 61883 left
634.234861ms: cmdbussy
did 12558/61883 (20 steps); 49325 left
557.977015ms: cmdbussy
did 7092/49325 (20 steps); 42233 left
472.710742ms: cmdbussy
did 11538/42233 (20 steps); 30695 left
375.979802ms: cmdbussy
did 8300/30695 (20 steps); 22395 left
348.824117ms: cmdbussy
did 5246/22395 (20 steps); 17149 left
316.635208ms: cmdbussy
did 3911/17149 (20 steps); 13238 left
294.303256ms: cmdbussy
did 2755/13238 (20 steps); 10483 left
267.719596ms: cmdbussy
did 2384/10483 (20 steps); 8099 left
1.317306244s: cmdbussy
6.69813755s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
6.620392739s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
6.620050429s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
6.81331308s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
6.675676099s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
6.689113124s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
6.691092726s: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
[src\main.rs:188:27] possible.swap_remove(i as usize) = ".\\CDSCN9810.JPG"
10.9346ms: frequencies
54.823929ms: 242931 RGBs
265.939µs: cmdbussy
79.692µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    13,
    7,
]
221.566µs: cmdbussy
31.19458ms: grouping
3.725866ms: copied
246.318µs: cmdbussy
79.691µs: cmdbussy
1.413177485s: cmdbussy
did 409/242931 (10 steps); 242522 left
2.48991861s: cmdbussy
did 536/242522 (10 steps); 241986 left
2.608578517s: cmdbussy
did 489/241986 (10 steps); 241497 left
2.728201964s: cmdbussy
did 481/241497 (10 steps); 241016 left
2.796858959s: cmdbussy
did 544/241016 (10 steps); 240472 left
1.799678639s: cmdbussy
did 678/240472 (10 steps); 239794 left
1.810668781s: cmdbussy
did 907/239794 (10 steps); 238887 left
2.811337705s: cmdbussy
did 1251/238887 (10 steps); 237636 left
2.814192703s: cmdbussy
did 1929/237636 (10 steps); 235707 left
2.811219677s: cmdbussy
did 2851/235707 (10 steps); 232856 left
2.809843495s: cmdbussy
did 4193/232856 (10 steps); 228663 left
2.786384394s: cmdbussy
did 5704/228663 (10 steps); 222959 left
2.769280368s: cmdbussy
did 4411/222959 (10 steps); 218548 left
1.750982783s: cmdbussy
did 2533/218548 (10 steps); 216015 left
1.723783328s: cmdbussy
did 2646/216015 (10 steps); 213369 left
2.701589327s: cmdbussy
did 2672/213369 (10 steps); 210697 left
2.661035557s: cmdbussy
did 2617/210697 (10 steps); 208080 left
2.630217096s: cmdbussy
did 2507/208080 (10 steps); 205573 left
2.59963499s: cmdbussy
did 2516/205573 (10 steps); 203057 left
1.576666415s: cmdbussy
did 2675/203057 (10 steps); 200382 left
1.551705558s: cmdbussy
did 2591/200382 (10 steps); 197791 left
2.522176645s: cmdbussy
did 2588/197791 (10 steps); 195203 left
2.488146386s: cmdbussy
did 2597/195203 (10 steps); 192606 left
1.47357195s: cmdbussy
did 2768/192606 (10 steps); 189838 left
1.443221976s: cmdbussy
did 2961/189838 (10 steps); 186877 left
2.420633443s: cmdbussy
did 3020/186877 (10 steps); 183857 left
2.407048204s: cmdbussy
did 3059/183857 (10 steps); 180798 left
1.393930247s: cmdbussy
did 3049/180798 (10 steps); 177749 left
1.368464981s: cmdbussy
did 3090/177749 (10 steps); 174659 left
2.344992599s: cmdbussy
did 3296/174659 (10 steps); 171363 left
2.341516071s: cmdbussy
did 3187/171363 (10 steps); 168176 left
1.337747341s: cmdbussy
did 3256/168176 (10 steps); 164920 left
1.304698733s: cmdbussy
did 3291/164920 (10 steps); 161629 left
2.303126038s: cmdbussy
did 3275/161629 (10 steps); 158354 left
2.295274341s: cmdbussy
did 3615/158354 (10 steps); 154739 left
1.289536876s: cmdbussy
did 3757/154739 (10 steps); 150982 left
1.242488274s: cmdbussy
did 3871/150982 (10 steps); 147111 left
2.203806644s: cmdbussy
did 3849/147111 (10 steps); 143262 left
2.170972055s: cmdbussy
did 3836/143262 (10 steps); 139426 left
2.13123512s: cmdbussy
did 3705/139426 (10 steps); 135721 left
1.100259992s: cmdbussy
did 3818/135721 (10 steps); 131903 left
2.058606847s: cmdbussy
did 3911/131903 (10 steps); 127992 left
1.007663034s: cmdbussy
did 4062/127992 (10 steps); 123930 left
1.93782667s: cmdbussy
did 4193/123930 (10 steps); 119737 left
890.281506ms: cmdbussy
did 4413/119737 (10 steps); 115324 left
846.126238ms: cmdbussy
did 4413/115324 (10 steps); 110911 left
800.181237ms: cmdbussy
did 4387/110911 (10 steps); 106524 left
774.030144ms: cmdbussy
did 4500/106524 (10 steps); 102024 left
725.336401ms: cmdbussy
did 4547/102024 (10 steps); 97477 left
1.356719885s: cmdbussy
did 9053/97477 (20 steps); 88424 left
2.211364027s: cmdbussy
did 9153/88424 (20 steps); 79271 left
1.008523941s: cmdbussy
did 9378/79271 (20 steps); 69893 left
891.654972ms: cmdbussy
did 8867/69893 (20 steps); 61026 left
823.322176ms: cmdbussy
did 8828/61026 (20 steps); 52198 left
745.478052ms: cmdbussy
did 8023/52198 (20 steps); 44175 left
612.214428ms: cmdbussy
did 7043/44175 (20 steps); 37132 left
411.018879ms: cmdbussy
did 6459/37132 (20 steps); 30673 left
338.446752ms: cmdbussy
did 5885/30673 (20 steps); 24788 left
284.050257ms: cmdbussy
did 5115/24788 (20 steps); 19673 left
267.892261ms: cmdbussy
did 4191/19673 (20 steps); 15482 left
260.958522ms: cmdbussy
did 3501/15482 (20 steps); 11981 left
245.205321ms: cmdbussy
did 2921/11981 (20 steps); 9060 left
1.484704873s: cmdbussy
107.29819273s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~178 levels
238.47µs: cmdbussy
91.766µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    13,
    7,
]
226.093µs: cmdbussy
25.548277ms: grouping
3.528147ms: copied
377.627µs: cmdbussy
82.106µs: cmdbussy
1.694548729s: cmdbussy
did 1853/242931 (10 steps); 241078 left
2.447647857s: cmdbussy
did 11458/241078 (10 steps); 229620 left
2.611805407s: cmdbussy
did 8918/229620 (10 steps); 220702 left
2.752237618s: cmdbussy
did 7158/220702 (10 steps); 213544 left
1.812974996s: cmdbussy
did 6140/213544 (10 steps); 207404 left
1.891901592s: cmdbussy
did 7593/207404 (10 steps); 199811 left
2.847959437s: cmdbussy
did 10377/199811 (10 steps); 189434 left
2.843403153s: cmdbussy
did 13072/189434 (10 steps); 176362 left
2.810158939s: cmdbussy
did 15944/176362 (10 steps); 160418 left
1.721509713s: cmdbussy
did 18398/160418 (10 steps); 142020 left
1.569804518s: cmdbussy
did 16329/142020 (10 steps); 125691 left
2.557950149s: cmdbussy
did 16083/125691 (10 steps); 109608 left
2.436463014s: cmdbussy
did 15680/109608 (10 steps); 93928 left
2.68283714s: cmdbussy
did 23235/93928 (20 steps); 70693 left
2.209098562s: cmdbussy
did 15649/70693 (20 steps); 55044 left
3.024162133s: cmdbussy
did 11954/55044 (20 steps); 43090 left
2.870809684s: cmdbussy
did 9276/43090 (20 steps); 33814 left
1.385310617s: cmdbussy
did 6745/33814 (20 steps); 27069 left
1.164857868s: cmdbussy
did 5624/27069 (20 steps); 21445 left
1.963850377s: cmdbussy
did 4809/21445 (20 steps); 16636 left
1.839923605s: cmdbussy
did 4091/16636 (20 steps); 12545 left
716.466528ms: cmdbussy
did 2944/12545 (20 steps); 9601 left
4.158179805s: cmdbussy
52.086906885s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~197 levels
109.100988986s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~178 levels
52.143835991s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~197 levels
111.910527601s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~178 levels
52.499913818s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~197 levels
111.89515414s: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~178 levels
56.157907828s: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~197 levels
[src\main.rs:188:27] possible.swap_remove(i as usize) = ".\\DSCN9773.JPG"
11.508135ms: frequencies
69.913641ms: 328666 RGBs
274.995µs: cmdbussy
101.728µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    8,
    10,
]
274.693µs: cmdbussy
39.016393ms: grouping
4.951722ms: copied
425.322µs: cmdbussy
85.729µs: cmdbussy
4.078195791s: cmdbussy
did 2863/328666 (10 steps); 325803 left
3.258759468s: cmdbussy
did 2399/325803 (10 steps); 323404 left
2.961552011s: cmdbussy
did 4471/323404 (10 steps); 318933 left
3.799976274s: cmdbussy
did 6288/318933 (10 steps); 312645 left
3.746096866s: cmdbussy
did 10097/312645 (10 steps); 302548 left
3.695681008s: cmdbussy
did 14279/302548 (10 steps); 288269 left
2.567114034s: cmdbussy
did 15496/288269 (10 steps); 272773 left
2.53846927s: cmdbussy
did 19285/272773 (10 steps); 253488 left
3.475076423s: cmdbussy
did 17463/253488 (10 steps); 236025 left
3.378428496s: cmdbussy
did 11674/236025 (10 steps); 224351 left
3.307405818s: cmdbussy
did 10639/224351 (10 steps); 213712 left
2.194448964s: cmdbussy
did 10127/213712 (10 steps); 203585 left
2.104639387s: cmdbussy
did 11113/203585 (10 steps); 192472 left
3.008182536s: cmdbussy
did 13380/192472 (10 steps); 179092 left
2.948321157s: cmdbussy
did 15469/179092 (10 steps); 163623 left
1.768635895s: cmdbussy
did 16069/163623 (10 steps); 147554 left
1.648499889s: cmdbussy
did 14800/147554 (10 steps); 132754 left
2.54460157s: cmdbussy
did 11883/132754 (10 steps); 120871 left
2.393551109s: cmdbussy
did 9652/120871 (10 steps); 111219 left
2.323265878s: cmdbussy
did 8774/111219 (10 steps); 102445 left
2.248968014s: cmdbussy
did 8787/102445 (10 steps); 93658 left
3.20545752s: cmdbussy
did 17262/93658 (20 steps); 76396 left
1.707299624s: cmdbussy
did 13791/76396 (20 steps); 62605 left
1.449046075s: cmdbussy
did 12693/62605 (20 steps); 49912 left
2.219482266s: cmdbussy
did 11791/49912 (20 steps); 38121 left
1.880060203s: cmdbussy
did 9938/38121 (20 steps); 28183 left
756.101132ms: cmdbussy
did 7493/28183 (20 steps); 20690 left
684.576762ms: cmdbussy
did 4933/20690 (20 steps); 15757 left
650.333994ms: cmdbussy
did 3457/15757 (20 steps); 12300 left
605.220317ms: cmdbussy
did 2139/12300 (20 steps); 10161 left
539.058201ms: cmdbussy
did 1250/10161 (20 steps); 8911 left
2.778680307s: cmdbussy
76.576736748s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~190 levels
110.783µs: cmdbussy
94.784µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    3,
    8,
    10,
]
370.685µs: cmdbussy
31.264008ms: grouping
4.927271ms: copied
467.28µs: cmdbussy
84.219µs: cmdbussy
2.408652292s: cmdbussy
did 317/328666 (10 steps); 328349 left
3.465856392s: cmdbussy
did 362/328349 (10 steps); 327987 left
3.561763856s: cmdbussy
did 878/327987 (10 steps); 327109 left
2.554281033s: cmdbussy
did 1789/327109 (10 steps); 325320 left
2.562786259s: cmdbussy
did 2419/325320 (10 steps); 322901 left
3.551161304s: cmdbussy
did 3814/322901 (10 steps); 319087 left
2.536807528s: cmdbussy
did 3577/319087 (10 steps); 315510 left
2.514340342s: cmdbussy
did 2930/315510 (10 steps); 312580 left
3.491898513s: cmdbussy
did 3392/312580 (10 steps); 309188 left
3.471831421s: cmdbussy
did 3645/309188 (10 steps); 305543 left
2.441001187s: cmdbussy
did 3472/305543 (10 steps); 302071 left
2.40996116s: cmdbussy
did 4022/302071 (10 steps); 298049 left
3.393597597s: cmdbussy
did 4420/298049 (10 steps); 293629 left
3.335368981s: cmdbussy
did 4944/293629 (10 steps); 288685 left
2.290526677s: cmdbussy
did 6067/288685 (10 steps); 282618 left
2.23615886s: cmdbussy
did 8302/282618 (10 steps); 274316 left
3.178091136s: cmdbussy
did 6410/274316 (10 steps); 267906 left
3.130982463s: cmdbussy
did 4369/267906 (10 steps); 263537 left
3.081515654s: cmdbussy
did 4688/263537 (10 steps); 258849 left
2.038772791s: cmdbussy
did 4601/258849 (10 steps); 254248 left
1.991155483s: cmdbussy
did 4590/254248 (10 steps); 249658 left
2.933015615s: cmdbussy
did 4849/249658 (10 steps); 244809 left
2.876997525s: cmdbussy
did 4877/244809 (10 steps); 239932 left
1.817045588s: cmdbussy
did 4993/239932 (10 steps); 234939 left
1.746190443s: cmdbussy
did 5327/234939 (10 steps); 229612 left
2.698832131s: cmdbussy
did 5790/229612 (10 steps); 223822 left
2.63968254s: cmdbussy
did 6589/223822 (10 steps); 217233 left
2.587924609s: cmdbussy
did 7088/217233 (10 steps); 210145 left
2.533126941s: cmdbussy
did 7359/210145 (10 steps); 202786 left
2.454601216s: cmdbussy
did 7199/202786 (10 steps); 195587 left
2.393787467s: cmdbussy
did 6704/195587 (10 steps); 188883 left
2.332416784s: cmdbussy
did 6672/188883 (10 steps); 182211 left
2.290329563s: cmdbussy
did 6604/182211 (10 steps); 175607 left
2.252386586s: cmdbussy
did 6554/175607 (10 steps); 169053 left
2.198731763s: cmdbussy
did 6509/169053 (10 steps); 162544 left
1.133774674s: cmdbussy
did 6431/162544 (10 steps); 156113 left
1.086027263s: cmdbussy
did 6327/156113 (10 steps); 149786 left
2.047874192s: cmdbussy
did 5989/149786 (10 steps); 143797 left
2.017057541s: cmdbussy
did 5642/143797 (10 steps); 138155 left
1.985327762s: cmdbussy
did 5447/138155 (10 steps); 132708 left
1.955838996s: cmdbussy
did 5105/132708 (10 steps); 127603 left
1.913450517s: cmdbussy
did 4979/127603 (10 steps); 122624 left
859.584695ms: cmdbussy
did 4806/122624 (10 steps); 117818 left
824.83812ms: cmdbussy
did 4710/117818 (10 steps); 113108 left
804.792158ms: cmdbussy
did 4574/113108 (10 steps); 108534 left
766.608297ms: cmdbussy
did 4581/108534 (10 steps); 103953 left
734.31917ms: cmdbussy
did 4327/103953 (10 steps); 99626 left
1.393878931s: cmdbussy
did 8770/99626 (20 steps); 90856 left
2.261385051s: cmdbussy
did 8484/90856 (20 steps); 82372 left
1.071369515s: cmdbussy
did 8201/82372 (20 steps); 74171 left
937.867421ms: cmdbussy
did 7705/74171 (20 steps); 66466 left
1.857959174s: cmdbussy
did 7465/66466 (20 steps); 59001 left
757.381927ms: cmdbussy
did 7143/59001 (20 steps); 51858 left
635.566971ms: cmdbussy
did 6636/51858 (20 steps); 45222 left
505.828778ms: cmdbussy
did 6336/45222 (20 steps); 38886 left
370.070578ms: cmdbussy
did 5917/38886 (20 steps); 32969 left
306.188113ms: cmdbussy
did 5208/32969 (20 steps); 27761 left
255.7309ms: cmdbussy
did 4925/27761 (20 steps); 22836 left
238.148725ms: cmdbussy
did 4257/22836 (20 steps); 18579 left
225.75644ms: cmdbussy
did 3813/18579 (20 steps); 14766 left
214.360899ms: cmdbussy
did 3644/14766 (20 steps); 11122 left
199.636439ms: cmdbussy
did 2455/11122 (20 steps); 8667 left
1.36055744s: cmdbussy
122.216174478s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~292 levels
125.473787177s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~292 levels
78.372579644s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~190 levels
121.366457306s: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~292 levels
78.299165023s: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~190 levels
[src\main.rs:162:27] images().swap_remove(0) = ".\\x002. fluorescent heart.png"
35.829952ms: frequencies
206.335632ms: 1103347 RGBs
348.649µs: cmdbussy
145.799µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    2,
    5,
    4,
]
717.825µs: cmdbussy
124.45533ms: grouping
7.367513ms: copied
866.944µs: cmdbussy
143.383µs: cmdbussy
5.865973877s: cmdbussy
did 12380/1103347 (10 steps); 1090967 left
6.834459022s: cmdbussy
did 80853/1090967 (10 steps); 1010114 left
6.433991379s: cmdbussy
did 174244/1010114 (10 steps); 835870 left
5.659918371s: cmdbussy
did 186416/835870 (10 steps); 649454 left
4.781159791s: cmdbussy
did 151358/649454 (10 steps); 498096 left
4.030932264s: cmdbussy
did 118824/498096 (10 steps); 379272 left
2.430365731s: cmdbussy
did 87645/379272 (10 steps); 291627 left
1.921070688s: cmdbussy
did 72871/291627 (10 steps); 218756 left
2.511134583s: cmdbussy
did 56003/218756 (10 steps); 162753 left
2.165655987s: cmdbussy
did 38613/162753 (10 steps); 124140 left
951.6377ms: cmdbussy
did 31674/124140 (10 steps); 92466 left
1.358751106s: cmdbussy
did 38589/92466 (20 steps); 53877 left
992.700104ms: cmdbussy
did 22957/53877 (20 steps); 30920 left
1.566814589s: cmdbussy
did 12058/30920 (20 steps); 18862 left
457.377127ms: cmdbussy
did 8975/18862 (20 steps); 9887 left
1.233203946s: cmdbussy
49.549648076s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
49.432092073s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
51.575855315s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
49.487737364s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
49.452174559s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
48.464887419s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
48.383878287s: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
258.997µs: cmdbussy
155.458µs: cmdbussy
[src\posterise_gpu.rs:654:13] direction_cells = [
    2,
    5,
    4,
]
747.709µs: cmdbussy
91.073165ms: grouping
6.747491ms: copied
954.483µs: cmdbussy
161.495µs: cmdbussy
8.31622196s: cmdbussy
did 269906/1103347 (10 steps); 833441 left
6.513429931s: cmdbussy
did 475001/833441 (10 steps); 358440 left
3.808270197s: cmdbussy
did 202825/358440 (10 steps); 155615 left
2.43082788s: cmdbussy
did 82171/155615 (10 steps); 73444 left
2.39855445s: cmdbussy
did 50097/73444 (20 steps); 23347 left
697.064436ms: cmdbussy
did 16122/23347 (20 steps); 7225 left
794.527689ms: cmdbussy
25.278102999s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~8242 levels
25.223905128s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~8242 levels
22.343798138s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~8242 levels
24.347354357s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~8242 levels
24.260490638s: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~8242 levels
Benchmark 2: MSC 84860 RGBs @ r=0.02 [yesgrid] => ~247 levels
  Time (mean ± σ): 6089.688704 ms ± 21.542180 ms
  Range (min … max): 6057.922528 ms … 6132.967499 ms 7 runs
Benchmark 4: MSC 242931 RGBs @ r=0.02 [yesgrid] => ~178 levels
  Time (mean ± σ): 110051.215864 ms ± 1958.265559 ms
  Range (min … max): 107298.192730 ms … 111910.527601 ms 4 runs
Benchmark 1: MSC 27868 RGBs @ r=0.02 [yesgrid] => ~375 levels
  Time (mean ± σ): 2772.796105 ms ± 454.946633 ms
  Range (min … max): 2426.919087 ms … 3458.685090 ms 9 runs
Benchmark 5: MSC 328666 RGBs @ r=0.02 [yesgrid] => ~292 levels
  Time (mean ± σ): 123018.806320 ms ± 1770.254798 ms
  Range (min … max): 121366.457306 ms … 125473.787177 ms 3 runs
Benchmark 3: MSC 1103347 RGBs @ r=0.02 [yesgrid] => ~12016 levels
  Time (mean ± σ): 49478.039013 ms ± 973.396050 ms
  Range (min … max): 48383.878287 ms … 51575.855315 ms 7 runs
Benchmark 2: MSC 84860 RGBs @ r=0.02 * freq [yesgrid] => ~245 levels
  Time (mean ± σ): 6686.825107 ms ± 59.936924 ms
  Range (min … max): 6620.050429 ms … 6813.313080 ms 7 runs
Benchmark 4: MSC 242931 RGBs @ r=0.02 * freq [yesgrid] => ~197 levels
  Time (mean ± σ): 53222.141130 ms ± 1702.339358 ms
  Range (min … max): 52086.906885 ms … 56157.907828 ms 4 runs
Benchmark 1: MSC 27868 RGBs @ r=0.02 * freq [yesgrid] => ~315 levels
  Time (mean ± σ): 746.454471 ms ± 17.297251 ms
  Range (min … max): 721.841760 ms … 791.811245 ms 15 runs
Benchmark 5: MSC 328666 RGBs @ r=0.02 * freq [yesgrid] => ~190 levels
  Time (mean ± σ): 77749.493805 ms ± 829.805906 ms
  Range (min … max): 76576.736748 ms … 78372.579644 ms 3 runs
Benchmark 3: MSC 1103347 RGBs @ r=0.02 * freq [yesgrid] => ~8242 levels
  Time (mean ± σ): 24290.730252 ms ± 1062.109756 ms
  Range (min … max): 22343.798138 ms … 25278.102999 ms 5 runs
-->
<table class="perf left" id="itersumdet">
 <caption><code>use_oneshot_driver = true</code></caption>
 <tr><th>(colours) </th><th>*<span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">134.983ms</span></td> <td><span class="roboto-unscale math-font-normal">6.090s</span></td> <td><span class="roboto-unscale math-font-normal">110.051s</span></td> <td><span class="roboto-unscale math-font-normal">6.6ms</span>/<span class="roboto-unscale math-font-normal">21.5ms</span>/<span class="roboto-unscale math-font-normal">1.958s</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-15.72%</span></td> <td><span class="roboto-unscale math-font-normal">-45.07%</span></td> <td>—</td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-4.37%</span></td> <td><span class="roboto-unscale math-font-normal">7.82%</span></td> <td>—</td> <td></td></tr>
 <tr><th><details><summary>iterations</summary> [​[​(pointsdone \operatorname{@} depth)​]​]</details></th> <td><details><summary><span class="roboto-unscale math-font-normal">2</span></summary> [​[​(8726 \operatorname{@} q_{20}), (8029 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">20</span></summary> [​[​(3439 \operatorname{@} q_{20}), (4585 \operatorname{@} q_{40}), (4990 \operatorname{@} q_{60}), (7237 \operatorname{@} q_{80}), (8241 \operatorname{@} q_{100}), (1893 \operatorname{@} q_{120}), (1537 \operatorname{@} q_{140}), (1434 \operatorname{@} q_{160}), (1165 \operatorname{@} q_{180}), (1606 \operatorname{@} q_{200}), (1593 \operatorname{@} q_{220}), (2736 \operatorname{@} q_{240}), (4634 \operatorname{@} q_{260}), (7876 \operatorname{@} q_{280}), (7448 \operatorname{@} q_{300}), (4920 \operatorname{@} q_{320}), (4170 \operatorname{@} q_{340}), (3074 \operatorname{@} q_{360}), (2309 \operatorname{@} q_{380}), (9973 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">63</span></summary> [​[​(409 \operatorname{@} q_{10}), (536 \operatorname{@} q_{20}), (489 \operatorname{@} q_{30}), (481 \operatorname{@} q_{40}), (544 \operatorname{@} q_{50}), (678 \operatorname{@} q_{60}), (907 \operatorname{@} q_{70}), (1251 \operatorname{@} q_{80}), (1929 \operatorname{@} q_{90}), (2851 \operatorname{@} q_{100}), (4193 \operatorname{@} q_{110}), (5704 \operatorname{@} q_{120}), (4411 \operatorname{@} q_{130}), (2533 \operatorname{@} q_{140}), (2646 \operatorname{@} q_{150}), (2672 \operatorname{@} q_{160}), (2617 \operatorname{@} q_{170}), (2507 \operatorname{@} q_{180}), (2516 \operatorname{@} q_{190}), (2675 \operatorname{@} q_{200}), (2591 \operatorname{@} q_{210}), (2588 \operatorname{@} q_{220}), (2597 \operatorname{@} q_{230}), (2768 \operatorname{@} q_{240}), (2961 \operatorname{@} q_{250}), (3020 \operatorname{@} q_{260}), (3059 \operatorname{@} q_{270}), (3049 \operatorname{@} q_{280}), (3090 \operatorname{@} q_{290}), (3296 \operatorname{@} q_{300}), (3187 \operatorname{@} q_{310}), (3256 \operatorname{@} q_{320}), (3291 \operatorname{@} q_{330}), (3275 \operatorname{@} q_{340}), (3615 \operatorname{@} q_{350}), (3757 \operatorname{@} q_{360}), (3871 \operatorname{@} q_{370}), (3849 \operatorname{@} q_{380}), (3836 \operatorname{@} q_{390}), (3705 \operatorname{@} q_{400}), (3818 \operatorname{@} q_{410}), (3911 \operatorname{@} q_{420}), (4062 \operatorname{@} q_{430}), (4193 \operatorname{@} q_{440}), (4413 \operatorname{@} q_{450}), (4413 \operatorname{@} q_{460}), (4387 \operatorname{@} q_{470}), (4500 \operatorname{@} q_{480}), (4547 \operatorname{@} q_{490}), (9053 \operatorname{@} q_{510}), (9153 \operatorname{@} q_{530}), (9378 \operatorname{@} q_{550}), (8867 \operatorname{@} q_{570}), (8828 \operatorname{@} q_{590}), (8023 \operatorname{@} q_{610}), (7043 \operatorname{@} q_{630}), (6459 \operatorname{@} q_{650}), (5885 \operatorname{@} q_{670}), (5115 \operatorname{@} q_{690}), (4191 \operatorname{@} q_{710}), (3501 \operatorname{@} q_{730}), (2921 \operatorname{@} q_{750}), (9060 \operatorname{@} \infty)​]​]</details></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">142.337ms</span></td> <td><span class="roboto-unscale math-font-normal">6.687s</span></td> <td><span class="roboto-unscale math-font-normal">53.222s</span></td> <td><span class="roboto-unscale math-font-normal">6.8ms</span>/<span class="roboto-unscale math-font-normal">59.9ms</span>/<span class="roboto-unscale math-font-normal">1.702s</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-43.17%</span></td> <td><span class="roboto-unscale math-font-normal">-103.48%</span></td> <td>—</td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-17.53%</span></td> <td><span class="roboto-unscale math-font-normal">-53.49%</span></td> <td>—</td> <td></td></tr>
 <tr><th><details><summary>iterations</summary> [​[​(pointsdone \operatorname{@} depth)​]​]</details></th> <td><details><summary><span class="roboto-unscale math-font-normal">2</span></summary> [​[​(9892 \operatorname{@} q_{20}), (6863 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">12</span></summary> [​[​( 4698 \operatorname{@} q_{20}), ( 6368 \operatorname{@} q_{40}), (11911 \operatorname{@} q_{60}), (12558 \operatorname{@} q_{80}), ( 7092 \operatorname{@} q_{100}), (11538 \operatorname{@} q_{120}), ( 8300 \operatorname{@} q_{140}), ( 5246 \operatorname{@} q_{160}), ( 3911 \operatorname{@} q_{180}), ( 2755 \operatorname{@} q_{200}), ( 2384 \operatorname{@} q_{220}), ( 8099 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">23</span></summary> [​[​(1853 \operatorname{@} q_{10}), (11458 \operatorname{@} q_{20}), (8918 \operatorname{@} q_{30}), (7158 \operatorname{@} q_{40}), (6140 \operatorname{@} q_{50}), (7593 \operatorname{@} q_{60}), (10377 \operatorname{@} q_{70}), (13072 \operatorname{@} q_{80}), (15944 \operatorname{@} q_{90}), (18398 \operatorname{@} q_{100}), (16329 \operatorname{@} q_{110}), (16083 \operatorname{@} q_{120}), (15680 \operatorname{@} q_{130}), (23235 \operatorname{@} q_{150}), (15649 \operatorname{@} q_{170}), (11954 \operatorname{@} q_{190}), (9276 \operatorname{@} q_{210}), (6745 \operatorname{@} q_{230}), (5624 \operatorname{@} q_{250}), (4809 \operatorname{@} q_{270}), (4091 \operatorname{@} q_{290}), (2944 \operatorname{@} q_{310}), (9601 \operatorname{@} \infty)​]​]</details></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th><th>*<span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">2.773s</span></td> <td><span class="roboto-unscale math-font-normal">123.019s</span></td> <td><span class="roboto-unscale math-font-normal">49.478s</span></td> <td><span class="roboto-unscale math-font-normal">454.9ms</span>/<span class="roboto-unscale math-font-normal">1.77s</span>/<span class="roboto-unscale math-font-normal">973ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-46.61%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-90.46%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th><details><summary>iterations</summary> [​[​(pointsdone \operatorname{@} depth)​]​]</details></th> <td><details><summary><span class="roboto-unscale math-font-normal">10</span></summary> [​[​( 1435 \operatorname{@} q_{20}), ( 2011 \operatorname{@} q_{40}), ( 3731 \operatorname{@} q_{60}), ( 3481 \operatorname{@} q_{80}), ( 2988 \operatorname{@} q_{100}), ( 2211 \operatorname{@} q_{120}), ( 589 \operatorname{@} q_{140}), ( 629 \operatorname{@} q_{160}), ( 805 \operatorname{@} q_{180}), ( 9988 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">32</span></summary> [​[​(2863 \operatorname{@} q_{10}), (2399 \operatorname{@} q_{20}), (4471 \operatorname{@} q_{30}), (6288 \operatorname{@} q_{40}), (10097 \operatorname{@} q_{50}), (14279 \operatorname{@} q_{60}), (15496 \operatorname{@} q_{70}), (19285 \operatorname{@} q_{80}), (17463 \operatorname{@} q_{90}), (11674 \operatorname{@} q_{100}), (10639 \operatorname{@} q_{110}), (10127 \operatorname{@} q_{120}), (11113 \operatorname{@} q_{130}), (13380 \operatorname{@} q_{140}), (15469 \operatorname{@} q_{150}), (16069 \operatorname{@} q_{160}), (14800 \operatorname{@} q_{170}), (11883 \operatorname{@} q_{180}), (9652 \operatorname{@} q_{190}), (8774 \operatorname{@} q_{200}), (8787 \operatorname{@} q_{210}), (17262 \operatorname{@} q_{230}), (13791 \operatorname{@} q_{250}), (12693 \operatorname{@} q_{270}), (11791 \operatorname{@} q_{290}), (9938 \operatorname{@} q_{310}), (7493 \operatorname{@} q_{330}), (4933 \operatorname{@} q_{350}), (3457 \operatorname{@} q_{370}), (2139 \operatorname{@} q_{390}), (1250 \operatorname{@} q_{410}), (8911 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">16</span></summary> [​[​(12380 \operatorname{@} q_{10}), (80853 \operatorname{@} q_{20}), (174244 \operatorname{@} q_{30}), (186416 \operatorname{@} q_{40}), (151358 \operatorname{@} q_{50}), (118824 \operatorname{@} q_{60}), (87645 \operatorname{@} q_{70}), (72871 \operatorname{@} q_{80}), (56003 \operatorname{@} q_{90}), (38613 \operatorname{@} q_{100}), (31674 \operatorname{@} q_{110}), (38589 \operatorname{@} q_{130}), (22957 \operatorname{@} q_{150}), (12058 \operatorname{@} q_{170}), (8975 \operatorname{@} q_{190}), (9887 \operatorname{@} \infty)​]​]</details></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">746.454ms</span></td> <td><span class="roboto-unscale math-font-normal">77.749s</span></td> <td><span class="roboto-unscale math-font-normal">24.291s</span></td> <td><span class="roboto-unscale math-font-normal">17.3ms</span>/<span class="roboto-unscale math-font-normal">829ms</span>/<span class="roboto-unscale math-font-normal">1.062s</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-31.55%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-99.89%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th><details><summary>iterations</summary> [​[​(pointsdone \operatorname{@} depth)​]​]</details></th> <td><details><summary><span class="roboto-unscale math-font-normal">3</span></summary> [​[​(17216 \operatorname{@} q_{20}), ( 7467 \operatorname{@} q_{40}), ( 3185 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">63</span></summary> [​[​(317 \operatorname{@} q_{10}), (362 \operatorname{@} q_{20}), (878 \operatorname{@} q_{30}), (1789 \operatorname{@} q_{40}), (2419 \operatorname{@} q_{50}), (3814 \operatorname{@} q_{60}), (3577 \operatorname{@} q_{70}), (2930 \operatorname{@} q_{80}), (3392 \operatorname{@} q_{90}), (3645 \operatorname{@} q_{100}), (3472 \operatorname{@} q_{110}), (4022 \operatorname{@} q_{120}), (4420 \operatorname{@} q_{130}), (4944 \operatorname{@} q_{140}), (6067 \operatorname{@} q_{150}), (8302 \operatorname{@} q_{160}), (6410 \operatorname{@} q_{170}), (4369 \operatorname{@} q_{180}), (4688 \operatorname{@} q_{190}), (4601 \operatorname{@} q_{200}), (4590 \operatorname{@} q_{210}), (4849 \operatorname{@} q_{220}), (4877 \operatorname{@} q_{230}), (4993 \operatorname{@} q_{240}), (5327 \operatorname{@} q_{250}), (5790 \operatorname{@} q_{260}), (6589 \operatorname{@} q_{270}), (7088 \operatorname{@} q_{280}), (7359 \operatorname{@} q_{290}), (7199 \operatorname{@} q_{300}), (6704 \operatorname{@} q_{310}), (6672 \operatorname{@} q_{320}), (6604 \operatorname{@} q_{330}), (6554 \operatorname{@} q_{340}), (6509 \operatorname{@} q_{350}), (6431 \operatorname{@} q_{360}), (6327 \operatorname{@} q_{370}), (5989 \operatorname{@} q_{380}), (5642 \operatorname{@} q_{390}), (5447 \operatorname{@} q_{400}), (5105 \operatorname{@} q_{410}), (4979 \operatorname{@} q_{420}), (4806 \operatorname{@} q_{430}), (4710 \operatorname{@} q_{440}), (4574 \operatorname{@} q_{450}), (4581 \operatorname{@} q_{460}), (4327 \operatorname{@} q_{470}), (8770 \operatorname{@} q_{490}), (8484 \operatorname{@} q_{510}), (8201 \operatorname{@} q_{530}), (7705 \operatorname{@} q_{550}), (7465 \operatorname{@} q_{570}), (7143 \operatorname{@} q_{590}), (6636 \operatorname{@} q_{610}), (6336 \operatorname{@} q_{630}), (5917 \operatorname{@} q_{650}), (5208 \operatorname{@} q_{670}), (4925 \operatorname{@} q_{690}), (4257 \operatorname{@} q_{710}), (3813 \operatorname{@} q_{730}), (3644 \operatorname{@} q_{750}), (2455 \operatorname{@} q_{770}), (8667 \operatorname{@} \infty)​]​]</details></td> <td><details><summary><span class="roboto-unscale math-font-normal">7</span></summary> [​[​(269906 \operatorname{@} q_{10}), (475001 \operatorname{@} q_{20}), (202825 \operatorname{@} q_{30}), (82171 \operatorname{@} q_{40}), (50097 \operatorname{@} q_{60}), (16122 \operatorname{@} q_{80}), (7225 \operatorname{@} \infty)​]​]</details></td></tr>
 <tfoot class="slowdown-didnt"><tr><td colspan=5><strong>*</strong>: slow-down doesn't<!--'--> apply (and subsequent measurement comparisons will ignore it)<br /> <strong>—</strong>: didn't<!--'--> complete before</td></tfoot>
</table>
<script>
 for(let tr of itersumdet.querySelectorAll("tr")) {
  let thd = tr.querySelector("th details");
  if(!thd)
   continue;
  let tdds = Array.from(tr.querySelectorAll("td details"));
  for(let tdd of tdds) {
   tdd.addEventListener("toggle", function() {
     thd.open = !tdds.every(function(tdd) { return !tdd.open; });
   })
  }
 }
</script>
<p class="indented">
The slow-down is even more surprising here, but this is why images with few colours are not beholden to the new shader.
Images with many complete for the first time, and this explains why <span class="roboto-unscale math-font-normal"><!--'-->328'666</span> is so much slower than <span class="roboto-unscale math-font-normal">1'103'347</span> —
a maximum observed iteration depth of [​[​q_{410}​]​]/[​[​q_{770}​]​] beats [​[​q_{190}​]​]/[​[​q_{80}​]​].
</p>
<!--
import matplotlib.pyplot as plt
inf = -1
# processed piece-meal
palette = {
 16755: [(8726, 20), (8029, inf)],
 84860: [(3439, 20), (4585, 40), (4990, 60), (7237, 80), (8241, 100), (1893, 120), (1537, 140), (1434, 160), (1165, 180), (1606, 200), (1593, 220), (2736, 240), (4634, 260), (7876, 280), (7448, 300), (4920, 320), (4170, 340), (3074, 360), (2309, 380), (9973, inf)],
 242931: [(409, 10), (536, 20), (489, 30), (481, 40), (544, 50), (678, 60), (907, 70), (1251, 80), (1929, 90), (2851, 100), (4193, 110), (5704, 120), (4411, 130), (2533, 140), (2646, 150), (2672, 160), (2617, 170), (2507, 180), (2516, 190), (2675, 200), (2591, 210), (2588, 220), (2597, 230), (2768, 240), (2961, 250), (3020, 260), (3059, 270), (3049, 280), (3090, 290), (3296, 300), (3187, 310), (3256, 320), (3291, 330), (3275, 340), (3615, 350), (3757, 360), (3871, 370), (3849, 380), (3836, 390), (3705, 400), (3818, 410), (3911, 420), (4062, 430), (4193, 440), (4413, 450), (4413, 460), (4387, 470), (4500, 480), (4547, 490), (9053, 510), (9153, 530), (9378, 550), (8867, 570), (8828, 590), (8023, 610), (7043, 630), (6459, 650), (5885, 670), (5115, 690), (4191, 710), (3501, 730), (2921, 750), (9060, inf)],
 27868: [( 1435, 20), ( 2011, 40), ( 3731, 60), ( 3481, 80), ( 2988, 100), ( 2211, 120), ( 589, 140), ( 629, 160), ( 805, 180), ( 9988, inf)],
 328666: [(2863, 10), (2399, 20), (4471, 30), (6288, 40), (10097, 50), (14279, 60), (15496, 70), (19285, 80), (17463, 90), (11674, 100), (10639, 110), (10127, 120), (11113, 130), (13380, 140), (15469, 150), (16069, 160), (14800, 170), (11883, 180), (9652, 190), (8774, 200), (8787, 210), (17262, 230), (13791, 250), (12693, 270), (11791, 290), (9938, 310), (7493, 330), (4933, 350), (3457, 370), (2139, 390), (1250, 410), (8911, inf)],
 1103347: [(12380, 10), (80853, 20), (174244, 30), (186416, 40), (151358, 50), (118824, 60), (87645, 70), (72871, 80), (56003, 90), (38613, 100), (31674, 110), (38589, 130), (22957, 150), (12058, 170), (8975, 190), (9887, inf)],
}
mulfreq = {
 16755: [(9892 , 20), (6863 , inf)],
 84860: [( 4698 , 20), ( 6368 , 40), (11911 , 60), (12558 , 80), ( 7092 , 100), (11538 , 120), ( 8300 , 140), ( 5246 , 160), ( 3911 , 180), ( 2755 , 200), ( 2384 , 220), ( 8099 , inf)],
 242931: [(1853 , 10), (11458 , 20), (8918 , 30), (7158 , 40), (6140 , 50), (7593 , 60), (10377 , 70), (13072 , 80), (15944 , 90), (18398 , 100), (16329 , 110), (16083 , 120), (15680 , 130), (23235 , 150), (15649 , 170), (11954 , 190), (9276 , 210), (6745 , 230), (5624 , 250), (4809 , 270), (4091 , 290), (2944 , 310), (9601 , inf)],
 27868: [(17216 , 20), ( 7467 , 40), ( 3185 , inf)],
 328666: [(317 , 10), (362 , 20), (878 , 30), (1789 , 40), (2419 , 50), (3814 , 60), (3577 , 70), (2930 , 80), (3392 , 90), (3645 , 100), (3472 , 110), (4022 , 120), (4420 , 130), (4944 , 140), (6067 , 150), (8302 , 160), (6410 , 170), (4369 , 180), (4688 , 190), (4601 , 200), (4590 , 210), (4849 , 220), (4877 , 230), (4993 , 240), (5327 , 250), (5790 , 260), (6589 , 270), (7088 , 280), (7359 , 290), (7199 , 300), (6704 , 310), (6672 , 320), (6604 , 330), (6554 , 340), (6509 , 350), (6431 , 360), (6327 , 370), (5989 , 380), (5642 , 390), (5447 , 400), (5105 , 410), (4979 , 420), (4806 , 430), (4710 , 440), (4574 , 450), (4581 , 460), (4327 , 470), (8770 , 490), (8484 , 510), (8201 , 530), (7705 , 550), (7465 , 570), (7143 , 590), (6636 , 610), (6336 , 630), (5917 , 650), (5208 , 670), (4925 , 690), (4257 , 710), (3813 , 730), (3644 , 750), (2455 , 770), (8667 , inf)],
 1103347: [(269906 , 10), (475001 , 20), (202825 , 30), (82171 , 40), (50097 , 60), (16122 , 80), (7225 , inf)],
}
for (variant, varname) in [(palette, "palette"), (mulfreq, "*freq")]:
 plt.figure(layout='constrained')
 maxx = 0
 for (k, v) in variant.items():
  cur = k
  accx = [0]
  accy = [cur]
  lastx = 0
  for (howmany, x) in v:
   cur -= howmany
   if x == inf:
    x = lastx + 10
   accx += [x]
   accy += [cur]
   lastx = x
   maxx = max(maxx, x)
  plt.plot(accx, accy, label=f"{k}")
 plt.ylabel('current_rgbs_len', fontdict={'family': 'DejaVu Sans Mono'})
 plt.xlabel('t', fontdict={'family': 'MathJax_Main'})
 plt.title(varname, fontdict={'family': 'MathJax_Main'})
 plt.legend()
 plt.xlim(0, maxx)
 plt.ylim(0, 1103347)
 plt.ticklabel_format(style='plain')
 # plt.show()
 plt.savefig(f"{varname}.png")
 plt.close()
-->
<div class="side-by-each continuation">
 <figure> <a href="/content/assets/blogn_t/018.29-oneshot-palette.png"><img alt="Plot of current_rgbs_len against t for palette" class="dark-invert" src="/content/assets/blogn_t/018.29-oneshot-palette.png" /></a> <figcaption>(final [​[​\infty​]​] step rendered as-if it were <span class="roboto-unscale math-font-normal">10</span> long)</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.30-oneshot-mulfreq.png"><img alt="Plot of current_rgbs_len against t for *freq" class="dark-invert" src="/content/assets/blogn_t/018.30-oneshot-mulfreq.png" /></a> <figcaption>(likewise)</figcaption> </figure>
</div>
<h2 id="expand_rgb" ><a class="hash-link" href="#expand_rgb">#</a> straight up "bussing it" and by "it", haha, well. let's<!--'--> justr say. My rgbs.</h2>
<p class="indented continued">
It's convenient to replace the CPU implementation isocallingconventionally but it's also a little silly and goofy
to run the [​[​p​]​]/[​[​p'<!--'-->​]​] transformations on the CPU when a dedicated FPU is available.
<samp>known_rgbs</samp> work items <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8207e447aa91db490f70de0b9f1052c3e949c29f/item/src/main.rs#L160">
 can be thinned</a> to just [​[​({\color{var(--r)}r\color{initial}}{\color{var(--r)}r\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--g)}g\color{initial}}{\color{var(--b)}b\color{initial}}{\color{var(--b)}b\color{initial}}_{16}, \text{multiplicity of}\ \color{var(--r)}r\color{initial},\color{var(--g)}g\color{initial},\color{var(--b)}b\color{initial})​]​],
and the returned <samp>outputs</samp> [​[​f​]​] mapping reduced from [​[​C \to P​]​] directly to [​[​C \to C​]​],
so the whole <a href="#RgbStuffedInLab"><samp>RgbStuffedInLab</samp></a> dance can likewise go the way of the dinosaur:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> outputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><!--"-->            <!--"--><span class="token comment">// was [[f32; 3]; ...]</span>
<span class="token comment">// ...</span>
<span class="token keyword">let</span> known_rgbs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token operator">=</span> frequencies<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><!--"-->  <!--"--><span class="token comment">// was Vec&lt;(u32, Lab, u32)></span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> freq<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> freq <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="indented continuing">
This also allows reducing the <samp>outputs</samp> mapping from an array of (<samp>float3</samp>, padding primitive)) to <samp>uint</samp>,
quartering the allocation (this matches the ranges used with <samp>outputs</samp> as a staging buffer),
and <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8207e447aa91db490f70de0b9f1052c3e949c29f/item/src/posterise_gpu.rs#L495">
 turns the <samp>outputs</samp> copy into a byte swizzle</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->buffer_outputs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->                         <!--"--><span class="token comment">// [[vk::binding(0)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint> outputs; [HOST_VISIBLE]</span>
<!--"-->	<!--"-->buffer_outputs_map<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">let</span> buffer_known_rgbs_bundle_map <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">map_memory</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_bundle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token class-name">KnownRgbsPack</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>buffer_known_rgbs_bundle_map<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>known<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bundle<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->bundle<span class="token punctuation">.</span>rgb <span class="token operator">=</span> known<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token comment">// ... known_rgbs_freqs setup</span>

<!--"-->	<!--"--><span class="token comment">// expand_rgb.hlsl</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">EXPAND_RGB</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// ... everything through posterise_grid.kernel.hlsl.inc/posterise_grid_oneshot.kernel.hlsl.inc</span>

<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> <span class="token string">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> out <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>out <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><!--"-->         <!--"--><span class="token comment">// [​[​\color{var(--r)}r\color{initial}​]​]</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>out <span class="token operator">>></span><!--"-->  <!--"--><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// [​[​\color{var(--g)}g\color{initial}​]​]</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>out <span class="token operator">>></span><!--"-->  <!--"--><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// [​[​\color{var(--b)}b\color{initial}​]​]</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
where
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8207e447aa91db490f70de0b9f1052c3e949c29f/item/src/expand_rgb.hlsl"><samp>expand_rgb.hlsl</samp></a>
is a trivial [​[​p \circ I​]​]:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>

<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"-->known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>lab <span class="token operator">=</span>
<!--"-->		<!--"--><span class="token function">linear_srgb_to_oklab</span><span class="token punctuation">(</span><span class="token function">unpack_rgb_to_r_g_b</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>rgb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
[​[​p^{-1}​]​] distributed across the kernels:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->outputs<span class="token punctuation">;</span><!--"-->            <!--"--><span class="token comment">// HOST_VISIBLE</span>
<small style='display: block; line-height: initial;'>
</small><span class="token comment">// <a href="https://git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8207e447aa91db490f70de0b9f1052c3e949c29f/item/src/posterise_grid_oneshot.kernel.hlsl.inc#L62">posterise_grid_oneshot.kernel.hlsl.inc</a></span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack_r_g_b_to_rgb</span><span class="token punctuation">(</span><span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>
</small><span class="token comment">// <a href="https://git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/8207e447aa91db490f70de0b9f1052c3e949c29f/item/src/posterise_grid.kernel.hlsl.inc#L63">posterise_grid.kernel.hlsl.inc</a></span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack_r_g_b_to_rgb</span><span class="token punctuation">(</span><span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

</div>
<p class="continuing">
and predictable (un)packing in
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e3c68498216d45ebdcbf8f01e22615734294e4a0/item/src/shader.h#L49"><samp>shader.h</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">float3</span> <span class="token function">unpack_rgb_to_r_g_b</span><span class="token punctuation">(</span><span class="token keyword">uint</span> rgb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">return</span> <span class="token keyword">uint3</span><span class="token punctuation">(</span>rgb <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>rgb <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>rgb <span class="token operator">>></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">uint</span> <span class="token function">pack_r_g_b_to_rgb</span><span class="token punctuation">(</span><span class="token keyword">float3</span> r_g_b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">uint3</span> rgb <span class="token operator">=</span> <span class="token keyword">uint3</span><span class="token punctuation">(</span><span class="token function">round</span><span class="token punctuation">(</span>r_g_b <span class="token operator">*</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">return</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>r <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>g <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">.</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<!--
15.269616ms: 16755 RGBs pre
14.717513ms: 16755 RGBs pre
14.957794ms: 16755 RGBs pre
14.985565ms: 16755 RGBs pre
14.706948ms: 16755 RGBs pre
14.446141ms: 16755 RGBs pre
14.596467ms: 16755 RGBs pre
14.701212ms: 16755 RGBs pre
14.488098ms: 16755 RGBs pre
14.431047ms: 16755 RGBs pre
14.695477ms: 16755 RGBs pre
14.588317ms: 16755 RGBs pre
14.49957ms: 16755 RGBs pre
14.600391ms: 16755 RGBs pre
14.455799ms: 16755 RGBs pre
14.436178ms: 16755 RGBs pre
14.630577ms: 16755 RGBs pre
14.418671ms: 16755 RGBs pre
14.418972ms: 16755 RGBs pre
15.003375ms: 16755 RGBs pre
14.709363ms: 16755 RGBs pre
14.456705ms: 16755 RGBs pre
14.615182ms: 16755 RGBs pre
14.421085ms: 16755 RGBs pre
14.612164ms: 16755 RGBs pre
14.595864ms: 16755 RGBs pre
14.455498ms: 16755 RGBs pre
14.943304ms: 16755 RGBs pre
14.655933ms: 16755 RGBs pre
14.937267ms: 16755 RGBs pre
14.568998ms: 16755 RGBs pre
14.660763ms: 16755 RGBs pre
14.612164ms: 16755 RGBs pre
14.620012ms: 16755 RGBs pre
14.659555ms: 16755 RGBs pre
14.607032ms: 16755 RGBs pre
14.586505ms: 16755 RGBs pre
16.91385ms: 16755 RGBs pre
14.801128ms: 16755 RGBs pre
14.563564ms: 16755 RGBs pre
14.535189ms: 16755 RGBs pre
14.606428ms: 16755 RGBs pre
14.571715ms: 16755 RGBs pre
14.607937ms: 16755 RGBs pre
14.487193ms: 16755 RGBs pre
14.48991ms: 16755 RGBs pre
14.482967ms: 16755 RGBs pre
14.537906ms: 16755 RGBs pre
14.54998ms: 16755 RGBs pre
14.823164ms: 16755 RGBs pre
14.558432ms: 16755 RGBs pre
14.825277ms: 16755 RGBs pre
14.496853ms: 16755 RGBs pre
14.657745ms: 16755 RGBs pre
14.520398ms: 16755 RGBs pre
14.600391ms: 16755 RGBs pre
14.484476ms: 16755 RGBs pre
14.463648ms: 16755 RGBs pre
14.51255ms: 16755 RGBs pre
15.482729ms: 16755 RGBs pre
15.846471ms: 16755 RGBs pre
15.152192ms: 16755 RGBs pre
14.665593ms: 16755 RGBs pre
14.785432ms: 16755 RGBs pre
15.617963ms: 16755 RGBs pre
14.793279ms: 16755 RGBs pre
14.746189ms: 16755 RGBs pre
14.482666ms: 16755 RGBs pre
14.60824ms: 16755 RGBs pre
14.728984ms: 16755 RGBs pre
15.269616ms: 16755 RGBs pre
14.519794ms: 16755 RGBs pre
14.877801ms: 16755 RGBs pre
14.694873ms: 16755 RGBs pre
14.444329ms: 16755 RGBs pre
14.91674ms: 16755 RGBs pre
14.754642ms: 16755 RGBs pre
14.576243ms: 16755 RGBs pre
14.57262ms: 16755 RGBs pre
14.961416ms: 16755 RGBs pre
14.958699ms: 16755 RGBs pre
14.484778ms: 16755 RGBs pre
14.599486ms: 16755 RGBs pre
14.738643ms: 16755 RGBs pre
14.485382ms: 16755 RGBs pre
14.602202ms: 16755 RGBs pre
14.600089ms: 16755 RGBs pre
14.713589ms: 16755 RGBs pre
14.803241ms: 16755 RGBs pre
14.529454ms: 16755 RGBs pre
14.451876ms: 16755 RGBs pre
14.65865ms: 16755 RGBs pre
14.599183ms: 16755 RGBs pre
14.444631ms: 16755 RGBs pre
14.468478ms: 16755 RGBs pre
14.458215ms: 16755 RGBs pre
15.04141ms: 16755 RGBs pre
14.753435ms: 16755 RGBs pre
14.738341ms: 16755 RGBs pre
14.600089ms: 16755 RGBs pre
14.61639ms: 16755 RGBs pre
14.488099ms: 16755 RGBs pre
14.44614ms: 16755 RGBs pre
14.767018ms: 16755 RGBs pre
14.972585ms: 16755 RGBs pre
14.492928ms: 16755 RGBs pre
14.605221ms: 16755 RGBs pre
14.501683ms: 16755 RGBs pre
14.49323ms: 16755 RGBs pre
14.943607ms: 16755 RGBs pre
14.516474ms: 16755 RGBs pre
14.803543ms: 16755 RGBs pre
14.581374ms: 16755 RGBs pre
14.466969ms: 16755 RGBs pre
14.547868ms: 16755 RGBs pre
14.434971ms: 16755 RGBs pre
14.49474ms: 16755 RGBs pre
14.55813ms: 16755 RGBs pre
14.459724ms: 16755 RGBs pre
14.429236ms: 16755 RGBs pre
14.93606ms: 16755 RGBs pre
14.626049ms: 16755 RGBs pre
14.613673ms: 16755 RGBs pre
14.598882ms: 16755 RGBs pre
14.769433ms: 16755 RGBs pre
14.428029ms: 16755 RGBs pre
15.091216ms: 16755 RGBs pre
14.628464ms: 16755 RGBs pre
15.240939ms: 16755 RGBs pre
14.93606ms: 16755 RGBs pre
14.623634ms: 16755 RGBs pre
14.54998ms: 16755 RGBs pre
14.930626ms: 16755 RGBs pre
14.488702ms: 16755 RGBs pre
14.899837ms: 16755 RGBs pre
14.699703ms: 16755 RGBs pre
14.505003ms: 16755 RGBs pre
14.517077ms: 16755 RGBs pre
14.849728ms: 16755 RGBs pre
14.378825ms: 16755 RGBs pre
14.434367ms: 16755 RGBs pre
14.764603ms: 16755 RGBs pre
14.667404ms: 16755 RGBs pre
14.758566ms: 16755 RGBs pre
14.514964ms: 16755 RGBs pre
14.620917ms: 16755 RGBs pre
14.615786ms: 16755 RGBs pre
14.529152ms: 16755 RGBs pre
14.587411ms: 16755 RGBs pre
14.632389ms: 16755 RGBs pre
14.546056ms: 16755 RGBs pre
14.527341ms: 16755 RGBs pre
14.893196ms: 16755 RGBs pre
14.452781ms: 16755 RGBs pre
14.521304ms: 16755 RGBs pre
14.513757ms: 16755 RGBs pre
14.612466ms: 16755 RGBs pre
14.630276ms: 16755 RGBs pre
14.763698ms: 16755 RGBs pre
14.684308ms: 16755 RGBs pre
14.467874ms: 16755 RGBs pre
14.618805ms: 16755 RGBs pre
14.461837ms: 16755 RGBs pre
15.303726ms: 16755 RGBs pre
14.693364ms: 16755 RGBs pre
14.646575ms: 16755 RGBs pre
14.530057ms: 16755 RGBs pre
14.577147ms: 16755 RGBs pre
14.460327ms: 16755 RGBs pre
14.489608ms: 16755 RGBs pre
14.972585ms: 16755 RGBs pre
14.716305ms: 16755 RGBs pre
14.549075ms: 16755 RGBs pre
15.339949ms: 16755 RGBs pre
14.737738ms: 16755 RGBs pre
14.501079ms: 16755 RGBs pre
14.518285ms: 16755 RGBs pre
14.57594ms: 16755 RGBs pre
14.396031ms: 16755 RGBs pre
14.806562ms: 16755 RGBs pre
14.767924ms: 16755 RGBs pre
14.589222ms: 16755 RGBs pre
14.573828ms: 16755 RGBs pre
14.808675ms: 16755 RGBs pre
14.802637ms: 16755 RGBs pre
14.546358ms: 16755 RGBs pre
14.62937ms: 16755 RGBs pre
14.46063ms: 16755 RGBs pre
14.530058ms: 16755 RGBs pre
14.882329ms: 16755 RGBs pre
14.447348ms: 16755 RGBs pre
14.525529ms: 16755 RGBs pre
14.514361ms: 16755 RGBs pre
14.57262ms: 16755 RGBs pre
14.385165ms: 16755 RGBs pre
14.518587ms: 16755 RGBs pre
14.642047ms: 16755 RGBs pre
14.571412ms: 16755 RGBs pre
14.533679ms: 16755 RGBs pre
14.4558ms: 16755 RGBs pre
14.878706ms: 16755 RGBs pre
15.353835ms: 16755 RGBs pre
14.550584ms: 16755 RGBs pre
14.437386ms: 16755 RGBs pre
14.512248ms: 16755 RGBs pre
14.761886ms: 16755 RGBs pre
14.413237ms: 16755 RGBs pre
14.848822ms: 16755 RGBs pre
14.585298ms: 16755 RGBs pre
14.495343ms: 16755 RGBs pre
14.846408ms: 16755 RGBs pre
14.647481ms: 16755 RGBs pre
14.927306ms: 16755 RGBs pre
14.787846ms: 16755 RGBs pre
14.479345ms: 16755 RGBs pre
14.695779ms: 16755 RGBs pre
14.661669ms: 16755 RGBs pre
14.716004ms: 16755 RGBs pre
14.648387ms: 16755 RGBs pre
15.045031ms: 16755 RGBs pre
15.030543ms: 16755 RGBs pre
14.62454ms: 16755 RGBs pre
14.563866ms: 16755 RGBs pre
14.564167ms: 16755 RGBs pre
14.840974ms: 16755 RGBs pre
14.610654ms: 16755 RGBs pre
14.716004ms: 16755 RGBs pre
14.688535ms: 16755 RGBs pre
14.556017ms: 16755 RGBs pre
14.583789ms: 16755 RGBs pre
14.824371ms: 16755 RGBs pre
14.436783ms: 16755 RGBs pre
18.117972ms: 16755 RGBs pre
14.465157ms: 16755 RGBs pre
14.712381ms: 16755 RGBs pre
14.458215ms: 16755 RGBs pre
14.732002ms: 16755 RGBs pre
14.556923ms: 16755 RGBs pre
14.589524ms: 16755 RGBs pre
14.62786ms: 16755 RGBs pre
14.532472ms: 16755 RGBs pre
14.485382ms: 16755 RGBs pre
14.448857ms: 16755 RGBs pre
14.582582ms: 16755 RGBs pre
14.556319ms: 16755 RGBs pre
14.405992ms: 16755 RGBs pre
14.720532ms: 16755 RGBs pre
14.806863ms: 16755 RGBs pre
14.817127ms: 16755 RGBs pre
207.375178ms: 1103347 RGBs pre
206.889786ms: 1103347 RGBs pre
207.026227ms: 1103347 RGBs pre
206.303573ms: 1103347 RGBs pre
214.422716ms: 1103347 RGBs pre
209.206566ms: 1103347 RGBs pre
214.835662ms: 1103347 RGBs pre
208.592883ms: 1103347 RGBs pre
205.952509ms: 1103347 RGBs pre
206.126683ms: 1103347 RGBs pre
207.220625ms: 1103347 RGBs pre
207.862984ms: 1103347 RGBs pre
207.042225ms: 1103347 RGBs pre
207.649569ms: 1103347 RGBs pre
208.002745ms: 1103347 RGBs pre
206.284254ms: 1103347 RGBs pre
206.176791ms: 1103347 RGBs pre
206.011372ms: 1103347 RGBs pre
205.808823ms: 1103347 RGBs pre
206.140568ms: 1103347 RGBs pre
206.171659ms: 1103347 RGBs pre
206.260407ms: 1103347 RGBs pre
206.687842ms: 1103347 RGBs pre
208.269591ms: 1103347 RGBs pre
207.105012ms: 1103347 RGBs pre
206.182526ms: 1103347 RGBs pre
207.299712ms: 1103347 RGBs pre
206.65192ms: 1103347 RGBs pre
205.79373ms: 1103347 RGBs pre
207.740127ms: 1103347 RGBs pre
207.655908ms: 1103347 RGBs pre
205.951603ms: 1103347 RGBs pre
205.973639ms: 1103347 RGBs pre
206.982155ms: 1103347 RGBs pre
208.118359ms: 1103347 RGBs pre
206.540533ms: 1103347 RGBs pre
206.083818ms: 1103347 RGBs pre
206.179508ms: 1103347 RGBs pre
206.513667ms: 1103347 RGBs pre
212.864512ms: 1103347 RGBs pre
206.948649ms: 1103347 RGBs pre
219.791004ms: 1103347 RGBs pre
220.083808ms: 1103347 RGBs pre
209.27539ms: 1103347 RGBs pre
207.264395ms: 1103347 RGBs pre
206.384471ms: 1103347 RGBs pre
209.959406ms: 1103347 RGBs pre
382.314534ms: 1103347 RGBs pre
231.254158ms: 1103347 RGBs pre
206.903067ms: 1103347 RGBs pre
209.028468ms: 1103347 RGBs pre
211.753363ms: 1103347 RGBs pre
209.643961ms: 1103347 RGBs pre
207.603988ms: 1103347 RGBs pre
207.164781ms: 1103347 RGBs pre
206.989702ms: 1103347 RGBs pre
207.104409ms: 1103347 RGBs pre
208.374034ms: 1103347 RGBs pre
208.270194ms: 1103347 RGBs pre
206.438202ms: 1103347 RGBs pre
206.288178ms: 1103347 RGBs pre
206.184941ms: 1103347 RGBs pre
206.83696ms: 1103347 RGBs pre
208.303701ms: 1103347 RGBs pre
206.2592ms: 1103347 RGBs pre
207.499243ms: 1103347 RGBs pre
207.458793ms: 1103347 RGBs pre
208.677404ms: 1103347 RGBs pre
207.167196ms: 1103347 RGBs pre
11.883344ms: 16755 RGBs post
12.287837ms: 16755 RGBs post
11.841083ms: 16755 RGBs post
11.685928ms: 16755 RGBs post
11.927416ms: 16755 RGBs post
11.968771ms: 16755 RGBs post
11.72849ms: 16755 RGBs post
12.918424ms: 16755 RGBs post
12.292667ms: 16755 RGBs post
12.413411ms: 16755 RGBs post
12.864089ms: 16755 RGBs post
12.191544ms: 16755 RGBs post
11.695889ms: 16755 RGBs post
11.883646ms: 16755 RGBs post
12.033067ms: 16755 RGBs post
11.723358ms: 16755 RGBs post
11.828406ms: 16755 RGBs post
11.813916ms: 16755 RGBs post
11.793692ms: 16755 RGBs post
11.847121ms: 16755 RGBs post
11.70585ms: 16755 RGBs post
12.050273ms: 16755 RGBs post
13.196438ms: 16755 RGBs post
11.6814ms: 16755 RGBs post
11.835046ms: 16755 RGBs post
11.822368ms: 16755 RGBs post
12.030954ms: 16755 RGBs post
11.546166ms: 16755 RGBs post
11.739659ms: 16755 RGBs post
11.946433ms: 16755 RGBs post
11.872176ms: 16755 RGBs post
11.784334ms: 16755 RGBs post
11.984467ms: 16755 RGBs post
11.786447ms: 16755 RGBs post
11.981147ms: 16755 RGBs post
11.955489ms: 16755 RGBs post
11.675363ms: 16755 RGBs post
11.691361ms: 16755 RGBs post
12.35485ms: 16755 RGBs post
12.047859ms: 16755 RGBs post
11.716114ms: 16755 RGBs post
11.771052ms: 16755 RGBs post
12.037293ms: 16755 RGBs post
11.870968ms: 16755 RGBs post
11.736942ms: 16755 RGBs post
11.847724ms: 16755 RGBs post
11.747507ms: 16755 RGBs post
11.745092ms: 16755 RGBs post
11.90206ms: 16755 RGBs post
11.877307ms: 16755 RGBs post
12.033067ms: 16755 RGBs post
11.937377ms: 16755 RGBs post
11.740866ms: 16755 RGBs post
11.948244ms: 16755 RGBs post
11.85346ms: 16755 RGBs post
11.880929ms: 16755 RGBs post
11.896626ms: 16755 RGBs post
12.421259ms: 16755 RGBs post
12.135096ms: 16755 RGBs post
11.647289ms: 16755 RGBs post
11.820859ms: 16755 RGBs post
12.118493ms: 16755 RGBs post
11.714001ms: 16755 RGBs post
11.753545ms: 16755 RGBs post
11.946131ms: 16755 RGBs post
11.700115ms: 16755 RGBs post
11.983864ms: 16755 RGBs post
11.821463ms: 16755 RGBs post
11.812709ms: 16755 RGBs post
11.907795ms: 16755 RGBs post
12.188223ms: 16755 RGBs post
11.71219ms: 16755 RGBs post
11.725773ms: 16755 RGBs post
11.737244ms: 16755 RGBs post
11.864025ms: 16755 RGBs post
12.148076ms: 16755 RGBs post
11.822067ms: 16755 RGBs post
11.676268ms: 16755 RGBs post
11.703435ms: 16755 RGBs post
11.760185ms: 16755 RGBs post
12.45537ms: 16755 RGBs post
11.6977ms: 16755 RGBs post
11.997749ms: 16755 RGBs post
11.922887ms: 16755 RGBs post
11.784636ms: 16755 RGBs post
11.823878ms: 16755 RGBs post
12.93563ms: 16755 RGBs post
13.816761ms: 16755 RGBs post
11.776486ms: 16755 RGBs post
11.866138ms: 16755 RGBs post
11.719735ms: 16755 RGBs post
11.789164ms: 16755 RGBs post
11.88425ms: 16755 RGBs post
11.688946ms: 16755 RGBs post
11.790371ms: 16755 RGBs post
11.882438ms: 16755 RGBs post
11.708265ms: 16755 RGBs post
11.759883ms: 16755 RGBs post
11.867043ms: 16755 RGBs post
11.755355ms: 16755 RGBs post
16.842309ms: 16755 RGBs post
12.020389ms: 16755 RGBs post
11.873382ms: 16755 RGBs post
11.701624ms: 16755 RGBs post
11.728791ms: 16755 RGBs post
11.904173ms: 16755 RGBs post
11.708265ms: 16755 RGBs post
11.845611ms: 16755 RGBs post
11.684117ms: 16755 RGBs post
11.85014ms: 16755 RGBs post
11.854668ms: 16755 RGBs post
12.073516ms: 16755 RGBs post
11.838065ms: 16755 RGBs post
11.773769ms: 16755 RGBs post
11.698605ms: 16755 RGBs post
11.936472ms: 16755 RGBs post
11.851649ms: 16755 RGBs post
11.985675ms: 16755 RGBs post
11.854969ms: 16755 RGBs post
16.291111ms: 16755 RGBs post
14.287664ms: 16755 RGBs post
12.984531ms: 16755 RGBs post
13.881963ms: 16755 RGBs post
12.194563ms: 16755 RGBs post
15.649357ms: 16755 RGBs post
13.373026ms: 16755 RGBs post
11.830216ms: 16755 RGBs post
12.91118ms: 16755 RGBs post
13.710204ms: 16755 RGBs post
11.694078ms: 16755 RGBs post
11.937075ms: 16755 RGBs post
12.014955ms: 16755 RGBs post
12.291761ms: 16755 RGBs post
11.885155ms: 16755 RGBs post
11.865535ms: 16755 RGBs post
14.301851ms: 16755 RGBs post
17.028256ms: 16755 RGBs post
12.180375ms: 16755 RGBs post
11.872779ms: 16755 RGBs post
17.876182ms: 16755 RGBs post
12.712254ms: 16755 RGBs post
11.833839ms: 16755 RGBs post
11.974808ms: 16755 RGBs post
17.340982ms: 16755 RGBs post
11.8438ms: 16755 RGBs post
11.964846ms: 16755 RGBs post
11.809389ms: 16755 RGBs post
12.671502ms: 16755 RGBs post
11.904173ms: 16755 RGBs post
11.99956ms: 16755 RGBs post
11.88757ms: 16755 RGBs post
12.124531ms: 16755 RGBs post
18.310559ms: 16755 RGBs post
17.998435ms: 16755 RGBs post
16.138069ms: 16755 RGBs post
11.995334ms: 16755 RGBs post
12.007711ms: 16755 RGBs post
11.98326ms: 16755 RGBs post
17.523609ms: 16755 RGBs post
12.661843ms: 16755 RGBs post
11.864025ms: 16755 RGBs post
11.839574ms: 16755 RGBs post
15.667468ms: 16755 RGBs post
13.823101ms: 16755 RGBs post
11.946735ms: 16755 RGBs post
17.336757ms: 16755 RGBs post
11.822368ms: 16755 RGBs post
17.819432ms: 16755 RGBs post
11.815425ms: 16755 RGBs post
11.899343ms: 16755 RGBs post
12.414015ms: 16755 RGBs post
12.104306ms: 16755 RGBs post
12.842355ms: 16755 RGBs post
12.081666ms: 16755 RGBs post
11.849536ms: 16755 RGBs post
12.383829ms: 16755 RGBs post
11.850442ms: 16755 RGBs post
11.971186ms: 16755 RGBs post
12.258859ms: 16755 RGBs post
11.771656ms: 16755 RGBs post
12.064159ms: 16755 RGBs post
11.812105ms: 16755 RGBs post
11.754752ms: 16755 RGBs post
11.828104ms: 16755 RGBs post
11.720339ms: 16755 RGBs post
11.733018ms: 16755 RGBs post
11.968167ms: 16755 RGBs post
11.714ms: 16755 RGBs post
11.997447ms: 16755 RGBs post
12.196374ms: 16755 RGBs post
11.805766ms: 16755 RGBs post
11.896022ms: 16755 RGBs post
11.933151ms: 16755 RGBs post
11.730602ms: 16755 RGBs post
12.017974ms: 16755 RGBs post
11.920775ms: 16755 RGBs post
11.714302ms: 16755 RGBs post
11.808785ms: 16755 RGBs post
11.916549ms: 16755 RGBs post
11.788258ms: 16755 RGBs post
11.980242ms: 16755 RGBs post
11.946132ms: 16755 RGBs post
12.163169ms: 16755 RGBs post
11.989901ms: 16755 RGBs post
11.884854ms: 16755 RGBs post
11.926208ms: 16755 RGBs post
11.855573ms: 16755 RGBs post
11.737848ms: 16755 RGBs post
11.716113ms: 16755 RGBs post
11.893305ms: 16755 RGBs post
11.791579ms: 16755 RGBs post
11.824783ms: 16755 RGBs post
11.96545ms: 16755 RGBs post
11.850744ms: 16755 RGBs post
11.829311ms: 16755 RGBs post
11.810596ms: 16755 RGBs post
11.730301ms: 16755 RGBs post
11.763807ms: 16755 RGBs post
11.743884ms: 16755 RGBs post
11.857686ms: 16755 RGBs post
12.461407ms: 16755 RGBs post
11.876099ms: 16755 RGBs post
11.683512ms: 16755 RGBs post
11.904172ms: 16755 RGBs post
12.333116ms: 16755 RGBs post
11.84531ms: 16755 RGBs post
11.791579ms: 16755 RGBs post
11.714906ms: 16755 RGBs post
11.98175ms: 16755 RGBs post
11.882741ms: 16755 RGBs post
11.753847ms: 16755 RGBs post
11.955187ms: 16755 RGBs post
11.810294ms: 16755 RGBs post
11.745696ms: 16755 RGBs post
12.074422ms: 16755 RGBs post
11.83565ms: 16755 RGBs post
11.94432ms: 16755 RGBs post
11.891797ms: 16755 RGBs post
11.902663ms: 16755 RGBs post
11.700115ms: 16755 RGBs post
11.722453ms: 16755 RGBs post
11.834745ms: 16755 RGBs post
11.956998ms: 16755 RGBs post
11.775278ms: 16755 RGBs post
11.821765ms: 16755 RGBs post
11.680192ms: 16755 RGBs post
12.005296ms: 16755 RGBs post
12.041217ms: 16755 RGBs post
11.697096ms: 16755 RGBs post
11.860403ms: 16755 RGBs post
11.904474ms: 16755 RGBs post
11.644271ms: 16755 RGBs post
11.800936ms: 16755 RGBs post
11.85014ms: 16755 RGBs post
11.805163ms: 16755 RGBs post
11.856479ms: 16755 RGBs post
11.857082ms: 16755 RGBs post
11.799728ms: 16755 RGBs post
11.927114ms: 16755 RGBs post
11.964544ms: 16755 RGBs post
11.826293ms: 16755 RGBs post
11.928926ms: 16755 RGBs post
11.831122ms: 16755 RGBs post
11.813615ms: 16755 RGBs post
12.194563ms: 16755 RGBs post
11.828707ms: 16755 RGBs post
13.002945ms: 16755 RGBs post
11.924397ms: 16755 RGBs post
11.70102ms: 16755 RGBs post
11.755959ms: 16755 RGBs post
11.86644ms: 16755 RGBs post
11.82418ms: 16755 RGBs post
11.748714ms: 16755 RGBs post
11.961224ms: 16755 RGBs post
11.793389ms: 16755 RGBs post
11.803955ms: 16755 RGBs post
11.675664ms: 16755 RGBs post
11.71551ms: 16755 RGBs post
11.790673ms: 16755 RGBs post
11.733319ms: 16755 RGBs post
11.74328ms: 16755 RGBs post
12.204222ms: 16755 RGBs post
11.726377ms: 16755 RGBs post
11.730301ms: 16755 RGBs post
11.822368ms: 16755 RGBs post
11.734527ms: 16755 RGBs post
11.840178ms: 16755 RGBs post
11.809388ms: 16755 RGBs post
18.790215ms: 16755 RGBs post
12.722818ms: 16755 RGBs post
11.686531ms: 16755 RGBs post
11.988996ms: 16755 RGBs post
11.747205ms: 16755 RGBs post
11.698304ms: 16755 RGBs post
12.174639ms: 16755 RGBs post
11.809086ms: 16755 RGBs post
11.919567ms: 16755 RGBs post
11.836556ms: 16755 RGBs post
11.805163ms: 16755 RGBs post
12.069592ms: 16755 RGBs post
11.914738ms: 16755 RGBs post
11.701323ms: 16755 RGBs post
11.72034ms: 16755 RGBs post
12.020993ms: 16755 RGBs post
12.026728ms: 16755 RGBs post
11.749922ms: 16755 RGBs post
11.702832ms: 16755 RGBs post
12.191845ms: 16755 RGBs post
11.947641ms: 16755 RGBs post
11.742073ms: 16755 RGBs post
11.775882ms: 16755 RGBs post
11.856479ms: 16755 RGBs post
11.713094ms: 16755 RGBs post
11.757469ms: 16755 RGBs post
12.190638ms: 16755 RGBs post
11.907795ms: 16755 RGBs post
11.999862ms: 16755 RGBs post
11.815124ms: 16755 RGBs post
12.054499ms: 16755 RGBs post
11.76411ms: 16755 RGBs post
11.821161ms: 16755 RGBs post
12.227767ms: 16755 RGBs post
11.653327ms: 16755 RGBs post
11.692568ms: 16755 RGBs post
11.674759ms: 16755 RGBs post
12.073818ms: 16755 RGBs post
11.674759ms: 16755 RGBs post
11.89904ms: 16755 RGBs post
11.866138ms: 16755 RGBs post
11.886966ms: 16755 RGBs post
11.688644ms: 16755 RGBs post
11.872477ms: 16755 RGBs post
11.716717ms: 16755 RGBs post
11.767128ms: 16755 RGBs post
11.847423ms: 16755 RGBs post
11.694983ms: 16755 RGBs post
11.712491ms: 16755 RGBs post
11.843196ms: 16755 RGBs post
11.887872ms: 16755 RGBs post
12.100382ms: 16755 RGBs post
12.142341ms: 16755 RGBs post
11.67325ms: 16755 RGBs post
11.682607ms: 16755 RGBs post
11.822972ms: 16755 RGBs post
11.742375ms: 16755 RGBs post
11.678682ms: 16755 RGBs post
11.944018ms: 16755 RGBs post
11.731508ms: 16755 RGBs post
11.725471ms: 16755 RGBs post
11.894513ms: 16755 RGBs post
11.673249ms: 16755 RGBs post
11.751431ms: 16755 RGBs post
11.735432ms: 16755 RGBs post
11.710076ms: 16755 RGBs post
11.87942ms: 16755 RGBs post
11.870364ms: 16755 RGBs post
11.728792ms: 16755 RGBs post
12.04665ms: 16755 RGBs post
12.101288ms: 16755 RGBs post
11.822972ms: 16755 RGBs post
11.749016ms: 16755 RGBs post
11.868553ms: 16755 RGBs post
11.852856ms: 16755 RGBs post
11.749319ms: 16755 RGBs post
12.125738ms: 16755 RGBs post
12.464124ms: 16755 RGBs post
11.873382ms: 16755 RGBs post
11.744186ms: 16755 RGBs post
12.092835ms: 16755 RGBs post
11.715812ms: 16755 RGBs post
11.961828ms: 16755 RGBs post
11.88425ms: 16755 RGBs post
11.951564ms: 16755 RGBs post
11.796106ms: 16755 RGBs post
11.939792ms: 16755 RGBs post
11.931642ms: 16755 RGBs post
11.840178ms: 16755 RGBs post
11.934056ms: 16755 RGBs post
12.085893ms: 16755 RGBs post
11.802144ms: 16755 RGBs post
11.817538ms: 16755 RGBs post
12.026124ms: 16755 RGBs post
11.908701ms: 16755 RGBs post
12.264896ms: 16755 RGBs post
11.887872ms: 16755 RGBs post
11.709774ms: 16755 RGBs post
11.73332ms: 16755 RGBs post
11.892702ms: 16755 RGBs post
12.170716ms: 16755 RGBs post
11.981147ms: 16755 RGBs post
11.829613ms: 16755 RGBs post
11.719434ms: 16755 RGBs post
11.688342ms: 16755 RGBs post
11.970582ms: 16755 RGBs post
11.753544ms: 16755 RGBs post
11.771958ms: 16755 RGBs post
11.721848ms: 16755 RGBs post
11.721849ms: 16755 RGBs post
11.817841ms: 16755 RGBs post
11.753242ms: 16755 RGBs post
11.806974ms: 16755 RGBs post
11.845008ms: 16755 RGBs post
11.762902ms: 16755 RGBs post
11.673853ms: 16755 RGBs post
11.834141ms: 16755 RGBs post
11.87459ms: 16755 RGBs post
11.688343ms: 16755 RGBs post
11.718227ms: 16755 RGBs post
11.909606ms: 16755 RGBs post
11.812709ms: 16755 RGBs post
11.771957ms: 16755 RGBs post
11.760788ms: 16755 RGBs post
11.880326ms: 16755 RGBs post
12.501253ms: 16755 RGBs post
11.673249ms: 16755 RGBs post
11.853762ms: 16755 RGBs post
11.941ms: 16755 RGBs post
11.790371ms: 16755 RGBs post
11.846517ms: 16755 RGBs post
13.126707ms: 16755 RGBs post
11.893004ms: 16755 RGBs post
11.75626ms: 16755 RGBs post
11.797917ms: 16755 RGBs post
11.686531ms: 16755 RGBs post
11.700718ms: 16755 RGBs post
11.886363ms: 16755 RGBs post
11.693172ms: 16755 RGBs post
11.696794ms: 16755 RGBs post
11.84531ms: 16755 RGBs post
11.716717ms: 16755 RGBs post
12.010126ms: 16755 RGBs post
11.842593ms: 16755 RGBs post
11.733621ms: 16755 RGBs post
11.840782ms: 16755 RGBs post
11.855874ms: 16755 RGBs post
11.795502ms: 16755 RGBs post
11.685022ms: 16755 RGBs post
11.817539ms: 16755 RGBs post
11.978732ms: 16755 RGBs post
11.738149ms: 16755 RGBs post
11.842291ms: 16755 RGBs post
18.712033ms: 16755 RGBs post
12.98755ms: 16755 RGBs post
11.734225ms: 16755 RGBs post
11.873383ms: 16755 RGBs post
29.11113ms: 1103347 RGBs post
28.613965ms: 1103347 RGBs post
31.356368ms: 1103347 RGBs post
36.353972ms: 1103347 RGBs post
28.503182ms: 1103347 RGBs post
28.629963ms: 1103347 RGBs post
28.683997ms: 1103347 RGBs post
28.578949ms: 1103347 RGBs post
29.00729ms: 1103347 RGBs post
28.717805ms: 1103347 RGBs post
28.999742ms: 1103347 RGBs post
28.491108ms: 1103347 RGBs post
29.185387ms: 1103347 RGBs post
28.412021ms: 1103347 RGBs post
28.910392ms: 1103347 RGBs post
28.955067ms: 1103347 RGBs post
31.494016ms: 1103347 RGBs post
28.85485ms: 1103347 RGBs post
28.958388ms: 1103347 RGBs post
28.448244ms: 1103347 RGBs post
29.806314ms: 1103347 RGBs post
29.012421ms: 1103347 RGBs post
32.068759ms: 1103347 RGBs post
29.012723ms: 1103347 RGBs post
28.553593ms: 1103347 RGBs post
29.088188ms: 1103347 RGBs post
28.472694ms: 1103347 RGBs post
28.479335ms: 1103347 RGBs post
28.680072ms: 1103347 RGBs post
28.585288ms: 1103347 RGBs post
29.222214ms: 1103347 RGBs post
28.607927ms: 1103347 RGBs post
28.675243ms: 1103347 RGBs post
28.83704ms: 1103347 RGBs post
29.055285ms: 1103347 RGBs post
29.652366ms: 1103347 RGBs post
28.92307ms: 1103347 RGBs post
29.016345ms: 1103347 RGBs post
28.883225ms: 1103347 RGBs post
28.664376ms: 1103347 RGBs post
28.952653ms: 1103347 RGBs post
28.712673ms: 1103347 RGBs post
28.372476ms: 1103347 RGBs post
29.004874ms: 1103347 RGBs post
28.805948ms: 1103347 RGBs post
28.742859ms: 1103347 RGBs post
28.962916ms: 1103347 RGBs post
29.392765ms: 1103347 RGBs post
28.616682ms: 1103347 RGBs post
29.99709ms: 1103347 RGBs post
29.087282ms: 1103347 RGBs post
28.824663ms: 1103347 RGBs post
31.461717ms: 1103347 RGBs post
28.625134ms: 1103347 RGBs post
28.375193ms: 1103347 RGBs post
28.605211ms: 1103347 RGBs post
28.523708ms: 1103347 RGBs post
28.625133ms: 1103347 RGBs post
29.193537ms: 1103347 RGBs post
29.199273ms: 1103347 RGBs post
28.555706ms: 1103347 RGBs post
28.933937ms: 1103347 RGBs post
28.582571ms: 1103347 RGBs post
28.754632ms: 1103347 RGBs post
28.522199ms: 1103347 RGBs post
28.485373ms: 1103347 RGBs post
28.392701ms: 1103347 RGBs post
28.668903ms: 1103347 RGBs post
28.421077ms: 1103347 RGBs post
28.796289ms: 1103347 RGBs post
28.477524ms: 1103347 RGBs post
29.003365ms: 1103347 RGBs post
28.595854ms: 1103347 RGBs post
28.639322ms: 1103347 RGBs post
28.671922ms: 1103347 RGBs post
28.71871ms: 1103347 RGBs post
28.677959ms: 1103347 RGBs post
28.631775ms: 1103347 RGBs post
29.032948ms: 1103347 RGBs post
28.704523ms: 1103347 RGBs post
28.633586ms: 1103347 RGBs post
28.558423ms: 1103347 RGBs post
28.798402ms: 1103347 RGBs post
28.540915ms: 1103347 RGBs post
28.574723ms: 1103347 RGBs post
32.734965ms: 1103347 RGBs post
28.86632ms: 1103347 RGBs post
28.573817ms: 1103347 RGBs post
28.498352ms: 1103347 RGBs post
28.75433ms: 1103347 RGBs post
28.735313ms: 1103347 RGBs post
28.78361ms: 1103347 RGBs post
28.972877ms: 1103347 RGBs post
28.762178ms: 1103347 RGBs post
28.536085ms: 1103347 RGBs post
28.79478ms: 1103347 RGBs post
28.780894ms: 1103347 RGBs post
28.992196ms: 1103347 RGBs post
28.604003ms: 1103347 RGBs post
29.092414ms: 1103347 RGBs post
28.599777ms: 1103347 RGBs post
28.526727ms: 1103347 RGBs post
29.018157ms: 1103347 RGBs post
28.894998ms: 1103347 RGBs post
28.548461ms: 1103347 RGBs post
32.047025ms: 1103347 RGBs post
28.82738ms: 1103347 RGBs post
28.868735ms: 1103347 RGBs post
28.485674ms: 1103347 RGBs post
28.799005ms: 1103347 RGBs post
28.706636ms: 1103347 RGBs post
28.594344ms: 1103347 RGBs post
28.823456ms: 1103347 RGBs post
29.12592ms: 1103347 RGBs post
28.646868ms: 1103347 RGBs post
28.825267ms: 1103347 RGBs post
28.899224ms: 1103347 RGBs post
28.76248ms: 1103347 RGBs post
28.832512ms: 1103347 RGBs post
28.862396ms: 1103347 RGBs post
28.486882ms: 1103347 RGBs post
29.208329ms: 1103347 RGBs post
29.744735ms: 1103347 RGBs post
29.116563ms: 1103347 RGBs post
28.838549ms: 1103347 RGBs post
29.012119ms: 1103347 RGBs post
28.773951ms: 1103347 RGBs post
29.348392ms: 1103347 RGBs post
28.754331ms: 1103347 RGBs post
28.482052ms: 1103347 RGBs post
28.728068ms: 1103347 RGBs post
29.193839ms: 1103347 RGBs post
28.765499ms: 1103347 RGBs post
28.446131ms: 1103347 RGBs post
28.611551ms: 1103347 RGBs post
29.440761ms: 1103347 RGBs post
28.693052ms: 1103347 RGBs post
28.992498ms: 1103347 RGBs post
28.861792ms: 1103347 RGBs post
28.707239ms: 1103347 RGBs post
28.512842ms: 1103347 RGBs post
28.524011ms: 1103347 RGBs post
28.953559ms: 1103347 RGBs post
29.097848ms: 1103347 RGBs post
28.561139ms: 1103347 RGBs post
28.614569ms: 1103347 RGBs post
28.69426ms: 1103347 RGBs post
28.412926ms: 1103347 RGBs post
28.985555ms: 1103347 RGBs post
28.77214ms: 1103347 RGBs post
28.406285ms: 1103347 RGBs post
29.093621ms: 1103347 RGBs post
28.853642ms: 1103347 RGBs post
29.256022ms: 1103347 RGBs post
28.45579ms: 1103347 RGBs post
28.854246ms: 1103347 RGBs post
28.752217ms: 1103347 RGBs post
29.016345ms: 1103347 RGBs post
28.64566ms: 1103347 RGBs post
28.443716ms: 1103347 RGBs post
28.718408ms: 1103347 RGBs post
28.961407ms: 1103347 RGBs post
29.243344ms: 1103347 RGBs post
28.535481ms: 1103347 RGBs post
29.007893ms: 1103347 RGBs post
29.170898ms: 1103347 RGBs post
29.083962ms: 1103347 RGBs post
28.767008ms: 1103347 RGBs post
28.863ms: 1103347 RGBs post
28.703014ms: 1103347 RGBs post
28.72837ms: 1103347 RGBs post
28.692448ms: 1103347 RGBs post
66.409µs: cmdbussy expand_rgb.hlsl 16755
94.784µs: cmdbussy expand_rgb.hlsl 16755
99.312µs: cmdbussy expand_rgb.hlsl 16755
71.541µs: cmdbussy expand_rgb.hlsl 16755
57.958µs: cmdbussy expand_rgb.hlsl 16755
64.598µs: cmdbussy expand_rgb.hlsl 16755
88.143µs: cmdbussy expand_rgb.hlsl 16755
70.333µs: cmdbussy expand_rgb.hlsl 16755
102.331µs: cmdbussy expand_rgb.hlsl 16755
72.145µs: cmdbussy expand_rgb.hlsl 16755
59.769µs: cmdbussy expand_rgb.hlsl 16755
66.409µs: cmdbussy expand_rgb.hlsl 16755
54.335µs: cmdbussy expand_rgb.hlsl 16755
134.328µs: cmdbussy expand_rgb.hlsl 16755
106.556µs: cmdbussy expand_rgb.hlsl 16755
92.973µs: cmdbussy expand_rgb.hlsl 16755
98.104µs: cmdbussy expand_rgb.hlsl 16755
89.351µs: cmdbussy expand_rgb.hlsl 16755
100.52µs: cmdbussy expand_rgb.hlsl 16755
137.649µs: cmdbussy expand_rgb.hlsl 16755
90.257µs: cmdbussy expand_rgb.hlsl 16755
130.705µs: cmdbussy expand_rgb.hlsl 16755
293.711µs: cmdbussy expand_rgb.hlsl 16755
109.273µs: cmdbussy expand_rgb.hlsl 16755
77.277µs: cmdbussy expand_rgb.hlsl 16755
91.765µs: cmdbussy expand_rgb.hlsl 16755
114.103µs: cmdbussy expand_rgb.hlsl 16755
69.126µs: cmdbussy expand_rgb.hlsl 16755
88.445µs: cmdbussy expand_rgb.hlsl 16755
95.388µs: cmdbussy expand_rgb.hlsl 16755
98.105µs: cmdbussy expand_rgb.hlsl 16755
115.915µs: cmdbussy expand_rgb.hlsl 16755
126.781µs: cmdbussy expand_rgb.hlsl 16755
132.818µs: cmdbussy expand_rgb.hlsl 16755
61.58µs: cmdbussy expand_rgb.hlsl 16755
95.388µs: cmdbussy expand_rgb.hlsl 16755
123.763µs: cmdbussy expand_rgb.hlsl 16755
134.328µs: cmdbussy expand_rgb.hlsl 16755
83.615µs: cmdbussy expand_rgb.hlsl 16755
132.517µs: cmdbussy expand_rgb.hlsl 16755
92.973µs: cmdbussy expand_rgb.hlsl 16755
92.672µs: cmdbussy expand_rgb.hlsl 16755
90.86µs: cmdbussy expand_rgb.hlsl 16755
102.935µs: cmdbussy expand_rgb.hlsl 16755
82.408µs: cmdbussy expand_rgb.hlsl 16755
110.179µs: cmdbussy expand_rgb.hlsl 16755
92.671µs: cmdbussy expand_rgb.hlsl 16755
93.879µs: cmdbussy expand_rgb.hlsl 16755
78.181µs: cmdbussy expand_rgb.hlsl 16755
93.275µs: cmdbussy expand_rgb.hlsl 16755
89.351µs: cmdbussy expand_rgb.hlsl 16755
86.634µs: cmdbussy expand_rgb.hlsl 16755
98.708µs: cmdbussy expand_rgb.hlsl 16755
96.293µs: cmdbussy expand_rgb.hlsl 16755
129.498µs: cmdbussy expand_rgb.hlsl 16755
78.785µs: cmdbussy expand_rgb.hlsl 16755
79.993µs: cmdbussy expand_rgb.hlsl 16755
77.276µs: cmdbussy expand_rgb.hlsl 16755
68.824µs: cmdbussy expand_rgb.hlsl 16755
78.786µs: cmdbussy expand_rgb.hlsl 16755
116.82µs: cmdbussy expand_rgb.hlsl 16755
83.616µs: cmdbussy expand_rgb.hlsl 16755
116.518µs: cmdbussy expand_rgb.hlsl 16755
113.801µs: cmdbussy expand_rgb.hlsl 16755
115.612µs: cmdbussy expand_rgb.hlsl 16755
104.443µs: cmdbussy expand_rgb.hlsl 16755
116.518µs: cmdbussy expand_rgb.hlsl 16755
89.653µs: cmdbussy expand_rgb.hlsl 16755
107.764µs: cmdbussy expand_rgb.hlsl 16755
109.273µs: cmdbussy expand_rgb.hlsl 16755
82.71µs: cmdbussy expand_rgb.hlsl 16755
93.576µs: cmdbussy expand_rgb.hlsl 16755
99.312µs: cmdbussy expand_rgb.hlsl 16755
133.422µs: cmdbussy expand_rgb.hlsl 16755
136.742µs: cmdbussy expand_rgb.hlsl 16755
93.879µs: cmdbussy expand_rgb.hlsl 16755
113.802µs: cmdbussy expand_rgb.hlsl 16755
81.804µs: cmdbussy expand_rgb.hlsl 16755
102.632µs: cmdbussy expand_rgb.hlsl 16755
82.407µs: cmdbussy expand_rgb.hlsl 16755
98.406µs: cmdbussy expand_rgb.hlsl 16755
88.445µs: cmdbussy expand_rgb.hlsl 16755
102.633µs: cmdbussy expand_rgb.hlsl 16755
89.955µs: cmdbussy expand_rgb.hlsl 16755
82.106µs: cmdbussy expand_rgb.hlsl 16755
101.425µs: cmdbussy expand_rgb.hlsl 16755
70.334µs: cmdbussy expand_rgb.hlsl 16755
96.595µs: cmdbussy expand_rgb.hlsl 16755
71.541µs: cmdbussy expand_rgb.hlsl 16755
124.971µs: cmdbussy expand_rgb.hlsl 16755
114.104µs: cmdbussy expand_rgb.hlsl 16755
105.953µs: cmdbussy expand_rgb.hlsl 16755
110.481µs: cmdbussy expand_rgb.hlsl 16755
107.16µs: cmdbussy expand_rgb.hlsl 16755
86.634µs: cmdbussy expand_rgb.hlsl 16755
87.54µs: cmdbussy expand_rgb.hlsl 16755
88.445µs: cmdbussy expand_rgb.hlsl 16755
109.274µs: cmdbussy expand_rgb.hlsl 16755
96.293µs: cmdbussy expand_rgb.hlsl 16755
95.086µs: cmdbussy expand_rgb.hlsl 16755
101.123µs: cmdbussy expand_rgb.hlsl 16755
82.408µs: cmdbussy expand_rgb.hlsl 16755
126.479µs: cmdbussy expand_rgb.hlsl 16755
124.367µs: cmdbussy expand_rgb.hlsl 16755
87.238µs: cmdbussy expand_rgb.hlsl 16755
101.426µs: cmdbussy expand_rgb.hlsl 16755
70.635µs: cmdbussy expand_rgb.hlsl 16755
102.633µs: cmdbussy expand_rgb.hlsl 16755
364.346µs: cmdbussy expand_rgb.hlsl 16755
124.668µs: cmdbussy expand_rgb.hlsl 16755
105.651µs: cmdbussy expand_rgb.hlsl 16755
98.708µs: cmdbussy expand_rgb.hlsl 16755
105.349µs: cmdbussy expand_rgb.hlsl 16755
99.916µs: cmdbussy expand_rgb.hlsl 16755
93.275µs: cmdbussy expand_rgb.hlsl 16755
68.825µs: cmdbussy expand_rgb.hlsl 16755
77.88µs: cmdbussy expand_rgb.hlsl 16755
68.824µs: cmdbussy expand_rgb.hlsl 16755
61.277µs: cmdbussy expand_rgb.hlsl 16755
13.201569ms: cmdbussy expand_rgb.hlsl 16755
53.732µs: cmdbussy expand_rgb.hlsl 16755
70.333µs: cmdbussy expand_rgb.hlsl 16755
86.935µs: cmdbussy expand_rgb.hlsl 16755
50.109µs: cmdbussy expand_rgb.hlsl 16755
68.824µs: cmdbussy expand_rgb.hlsl 16755
95.086µs: cmdbussy expand_rgb.hlsl 16755
84.219µs: cmdbussy expand_rgb.hlsl 16755
81.2µs: cmdbussy expand_rgb.hlsl 16755
86.634µs: cmdbussy expand_rgb.hlsl 16755
124.367µs: cmdbussy expand_rgb.hlsl 16755
118.027µs: cmdbussy expand_rgb.hlsl 16755
89.049µs: cmdbussy expand_rgb.hlsl 16755
84.822µs: cmdbussy expand_rgb.hlsl 16755
105.047µs: cmdbussy expand_rgb.hlsl 16755
91.162µs: cmdbussy expand_rgb.hlsl 16755
109.878µs: cmdbussy expand_rgb.hlsl 16755
82.71µs: cmdbussy expand_rgb.hlsl 16755
75.163µs: cmdbussy expand_rgb.hlsl 16755
91.162µs: cmdbussy expand_rgb.hlsl 16755
101.124µs: cmdbussy expand_rgb.hlsl 16755
63.693µs: cmdbussy expand_rgb.hlsl 16755
93.879µs: cmdbussy expand_rgb.hlsl 16755
70.032µs: cmdbussy expand_rgb.hlsl 16755
83.615µs: cmdbussy expand_rgb.hlsl 16755
58.863µs: cmdbussy expand_rgb.hlsl 16755
88.747µs: cmdbussy expand_rgb.hlsl 16755
78.785µs: cmdbussy expand_rgb.hlsl 16755
81.502µs: cmdbussy expand_rgb.hlsl 16755
70.032µs: cmdbussy expand_rgb.hlsl 16755
82.408µs: cmdbussy expand_rgb.hlsl 16755
70.937µs: cmdbussy expand_rgb.hlsl 16755
97.803µs: cmdbussy expand_rgb.hlsl 16755
81.804µs: cmdbussy expand_rgb.hlsl 16755
71.54µs: cmdbussy expand_rgb.hlsl 16755
86.936µs: cmdbussy expand_rgb.hlsl 16755
73.05µs: cmdbussy expand_rgb.hlsl 16755
90.256µs: cmdbussy expand_rgb.hlsl 16755
76.069µs: cmdbussy expand_rgb.hlsl 16755
87.841µs: cmdbussy expand_rgb.hlsl 16755
76.069µs: cmdbussy expand_rgb.hlsl 16755
119.537µs: cmdbussy expand_rgb.hlsl 16755
58.863µs: cmdbussy expand_rgb.hlsl 16755
89.351µs: cmdbussy expand_rgb.hlsl 16755
95.69µs: cmdbussy expand_rgb.hlsl 16755
86.936µs: cmdbussy expand_rgb.hlsl 16755
102.33µs: cmdbussy expand_rgb.hlsl 16755
83.012µs: cmdbussy expand_rgb.hlsl 16755
69.428µs: cmdbussy expand_rgb.hlsl 16755
98.708µs: cmdbussy expand_rgb.hlsl 16755
74.258µs: cmdbussy expand_rgb.hlsl 16755
118.33µs: cmdbussy expand_rgb.hlsl 16755
68.523µs: cmdbussy expand_rgb.hlsl 16755
85.125µs: cmdbussy expand_rgb.hlsl 16755
68.522µs: cmdbussy expand_rgb.hlsl 16755
83.011µs: cmdbussy expand_rgb.hlsl 16755
79.994µs: cmdbussy expand_rgb.hlsl 16755
97.199µs: cmdbussy expand_rgb.hlsl 16755
82.408µs: cmdbussy expand_rgb.hlsl 16755
67.616µs: cmdbussy expand_rgb.hlsl 16755
118.027µs: cmdbussy expand_rgb.hlsl 16755
90.256µs: cmdbussy expand_rgb.hlsl 16755
131.611µs: cmdbussy expand_rgb.hlsl 16755
66.711µs: cmdbussy expand_rgb.hlsl 16755
132.215µs: cmdbussy expand_rgb.hlsl 16755
89.954µs: cmdbussy expand_rgb.hlsl 16755
102.029µs: cmdbussy expand_rgb.hlsl 16755
98.407µs: cmdbussy expand_rgb.hlsl 16755
114.104µs: cmdbussy expand_rgb.hlsl 16755
83.012µs: cmdbussy expand_rgb.hlsl 16755
105.047µs: cmdbussy expand_rgb.hlsl 16755
93.275µs: cmdbussy expand_rgb.hlsl 16755
101.124µs: cmdbussy expand_rgb.hlsl 16755
124.668µs: cmdbussy expand_rgb.hlsl 16755
75.465µs: cmdbussy expand_rgb.hlsl 16755
60.674µs: cmdbussy expand_rgb.hlsl 16755
133.724µs: cmdbussy expand_rgb.hlsl 16755
112.594µs: cmdbussy expand_rgb.hlsl 16755
95.086µs: cmdbussy expand_rgb.hlsl 16755
101.123µs: cmdbussy expand_rgb.hlsl 16755
100.218µs: cmdbussy expand_rgb.hlsl 16755
102.934µs: cmdbussy expand_rgb.hlsl 16755
97.803µs: cmdbussy expand_rgb.hlsl 16755
62.787µs: cmdbussy expand_rgb.hlsl 16755
124.065µs: cmdbussy expand_rgb.hlsl 16755
75.163µs: cmdbussy expand_rgb.hlsl 16755
90.86µs: cmdbussy expand_rgb.hlsl 16755
91.766µs: cmdbussy expand_rgb.hlsl 16755
93.879µs: cmdbussy expand_rgb.hlsl 16755
88.144µs: cmdbussy expand_rgb.hlsl 16755
87.539µs: cmdbussy expand_rgb.hlsl 16755
82.106µs: cmdbussy expand_rgb.hlsl 16755
116.82µs: cmdbussy expand_rgb.hlsl 16755
130.706µs: cmdbussy expand_rgb.hlsl 16755
112.293µs: cmdbussy expand_rgb.hlsl 16755
106.254µs: cmdbussy expand_rgb.hlsl 16755
123.763µs: cmdbussy expand_rgb.hlsl 16755
94.784µs: cmdbussy expand_rgb.hlsl 16755
70.334µs: cmdbussy expand_rgb.hlsl 16755
351.667µs: cmdbussy expand_rgb.hlsl 16755
126.178µs: cmdbussy expand_rgb.hlsl 16755
75.767µs: cmdbussy expand_rgb.hlsl 16755
101.727µs: cmdbussy expand_rgb.hlsl 16755
127.989µs: cmdbussy expand_rgb.hlsl 16755
78.786µs: cmdbussy expand_rgb.hlsl 16755
111.689µs: cmdbussy expand_rgb.hlsl 16755
63.089µs: cmdbussy expand_rgb.hlsl 16755
97.501µs: cmdbussy expand_rgb.hlsl 16755
103.84µs: cmdbussy expand_rgb.hlsl 16755
82.106µs: cmdbussy expand_rgb.hlsl 16755
83.615µs: cmdbussy expand_rgb.hlsl 16755
106.254µs: cmdbussy expand_rgb.hlsl 16755
114.707µs: cmdbussy expand_rgb.hlsl 16755
95.086µs: cmdbussy expand_rgb.hlsl 16755
113.801µs: cmdbussy expand_rgb.hlsl 16755
62.787µs: cmdbussy expand_rgb.hlsl 16755
138.252µs: cmdbussy expand_rgb.hlsl 16755
78.786µs: cmdbussy expand_rgb.hlsl 16755
85.426µs: cmdbussy expand_rgb.hlsl 16755
111.387µs: cmdbussy expand_rgb.hlsl 16755
96.595µs: cmdbussy expand_rgb.hlsl 16755
105.953µs: cmdbussy expand_rgb.hlsl 16755
112.896µs: cmdbussy expand_rgb.hlsl 16755
97.2µs: cmdbussy expand_rgb.hlsl 16755
94.784µs: cmdbussy expand_rgb.hlsl 16755
110.783µs: cmdbussy expand_rgb.hlsl 16755
97.803µs: cmdbussy expand_rgb.hlsl 16755
97.199µs: cmdbussy expand_rgb.hlsl 16755
98.407µs: cmdbussy expand_rgb.hlsl 16755
108.066µs: cmdbussy expand_rgb.hlsl 16755
118.933µs: cmdbussy expand_rgb.hlsl 16755
118.933µs: cmdbussy expand_rgb.hlsl 16755
110.179µs: cmdbussy expand_rgb.hlsl 16755
129.8µs: cmdbussy expand_rgb.hlsl 16755
115.311µs: cmdbussy expand_rgb.hlsl 16755
89.351µs: cmdbussy expand_rgb.hlsl 16755
107.765µs: cmdbussy expand_rgb.hlsl 16755
95.69µs: cmdbussy expand_rgb.hlsl 16755
119.537µs: cmdbussy expand_rgb.hlsl 16755
98.709µs: cmdbussy expand_rgb.hlsl 16755
120.744µs: cmdbussy expand_rgb.hlsl 16755
79.692µs: cmdbussy expand_rgb.hlsl 16755
78.484µs: cmdbussy expand_rgb.hlsl 16755
354.083µs: cmdbussy expand_rgb.hlsl 16755
75.465µs: cmdbussy expand_rgb.hlsl 16755
68.522µs: cmdbussy expand_rgb.hlsl 16755
67.013µs: cmdbussy expand_rgb.hlsl 16755
98.104µs: cmdbussy expand_rgb.hlsl 16755
66.711µs: cmdbussy expand_rgb.hlsl 16755
81.201µs: cmdbussy expand_rgb.hlsl 16755
113.802µs: cmdbussy expand_rgb.hlsl 16755
85.728µs: cmdbussy expand_rgb.hlsl 16755
100.218µs: cmdbussy expand_rgb.hlsl 16755
88.747µs: cmdbussy expand_rgb.hlsl 16755
83.616µs: cmdbussy expand_rgb.hlsl 16755
100.218µs: cmdbussy expand_rgb.hlsl 16755
119.235µs: cmdbussy expand_rgb.hlsl 16755
107.161µs: cmdbussy expand_rgb.hlsl 16755
107.161µs: cmdbussy expand_rgb.hlsl 16755
87.54µs: cmdbussy expand_rgb.hlsl 16755
76.069µs: cmdbussy expand_rgb.hlsl 16755
97.802µs: cmdbussy expand_rgb.hlsl 16755
93.879µs: cmdbussy expand_rgb.hlsl 16755
83.615µs: cmdbussy expand_rgb.hlsl 16755
86.634µs: cmdbussy expand_rgb.hlsl 16755
115.915µs: cmdbussy expand_rgb.hlsl 16755
62.486µs: cmdbussy expand_rgb.hlsl 16755
89.351µs: cmdbussy expand_rgb.hlsl 16755
105.35µs: cmdbussy expand_rgb.hlsl 16755
100.218µs: cmdbussy expand_rgb.hlsl 16755
76.974µs: cmdbussy expand_rgb.hlsl 16755
107.161µs: cmdbussy expand_rgb.hlsl 16755
106.255µs: cmdbussy expand_rgb.hlsl 16755
117.122µs: cmdbussy expand_rgb.hlsl 16755
111.085µs: cmdbussy expand_rgb.hlsl 16755
83.011µs: cmdbussy expand_rgb.hlsl 16755
81.201µs: cmdbussy expand_rgb.hlsl 16755
56.146µs: cmdbussy expand_rgb.hlsl 16755
134.63µs: cmdbussy expand_rgb.hlsl 16755
102.633µs: cmdbussy expand_rgb.hlsl 16755
93.577µs: cmdbussy expand_rgb.hlsl 16755
89.049µs: cmdbussy expand_rgb.hlsl 16755
86.332µs: cmdbussy expand_rgb.hlsl 16755
102.632µs: cmdbussy expand_rgb.hlsl 16755
136.441µs: cmdbussy expand_rgb.hlsl 16755
68.522µs: cmdbussy expand_rgb.hlsl 16755
100.218µs: cmdbussy expand_rgb.hlsl 16755
106.859µs: cmdbussy expand_rgb.hlsl 16755
99.916µs: cmdbussy expand_rgb.hlsl 16755
103.84µs: cmdbussy expand_rgb.hlsl 16755
95.388µs: cmdbussy expand_rgb.hlsl 16755
95.69µs: cmdbussy expand_rgb.hlsl 16755
118.028µs: cmdbussy expand_rgb.hlsl 16755
131.913µs: cmdbussy expand_rgb.hlsl 16755
99.614µs: cmdbussy expand_rgb.hlsl 16755
97.803µs: cmdbussy expand_rgb.hlsl 16755
87.841µs: cmdbussy expand_rgb.hlsl 16755
65.202µs: cmdbussy expand_rgb.hlsl 16755
119.839µs: cmdbussy expand_rgb.hlsl 16755
77.578µs: cmdbussy expand_rgb.hlsl 16755
119.839µs: cmdbussy expand_rgb.hlsl 16755
85.426µs: cmdbussy expand_rgb.hlsl 16755
99.614µs: cmdbussy expand_rgb.hlsl 16755
87.842µs: cmdbussy expand_rgb.hlsl 16755
149.421µs: cmdbussy expand_rgb.hlsl 16755
102.029µs: cmdbussy expand_rgb.hlsl 16755
93.577µs: cmdbussy expand_rgb.hlsl 16755
83.314µs: cmdbussy expand_rgb.hlsl 16755
70.636µs: cmdbussy expand_rgb.hlsl 16755
107.462µs: cmdbussy expand_rgb.hlsl 16755
66.41µs: cmdbussy expand_rgb.hlsl 16755
121.952µs: cmdbussy expand_rgb.hlsl 16755
105.048µs: cmdbussy expand_rgb.hlsl 16755
66.711µs: cmdbussy expand_rgb.hlsl 16755
66.108µs: cmdbussy expand_rgb.hlsl 16755
74.258µs: cmdbussy expand_rgb.hlsl 16755
99.312µs: cmdbussy expand_rgb.hlsl 16755
107.161µs: cmdbussy expand_rgb.hlsl 16755
92.068µs: cmdbussy expand_rgb.hlsl 16755
99.614µs: cmdbussy expand_rgb.hlsl 16755
92.068µs: cmdbussy expand_rgb.hlsl 16755
86.634µs: cmdbussy expand_rgb.hlsl 16755
95.992µs: cmdbussy expand_rgb.hlsl 16755
114.405µs: cmdbussy expand_rgb.hlsl 16755
95.992µs: cmdbussy expand_rgb.hlsl 16755
92.973µs: cmdbussy expand_rgb.hlsl 16755
92.973µs: cmdbussy expand_rgb.hlsl 16755
120.443µs: cmdbussy expand_rgb.hlsl 16755
110.783µs: cmdbussy expand_rgb.hlsl 16755
104.142µs: cmdbussy expand_rgb.hlsl 16755
132.215µs: cmdbussy expand_rgb.hlsl 16755
111.084µs: cmdbussy expand_rgb.hlsl 16755
135.535µs: cmdbussy expand_rgb.hlsl 16755
103.237µs: cmdbussy expand_rgb.hlsl 16755
114.707µs: cmdbussy expand_rgb.hlsl 16755
146.101µs: cmdbussy expand_rgb.hlsl 16755
99.916µs: cmdbussy expand_rgb.hlsl 16755
90.256µs: cmdbussy expand_rgb.hlsl 16755
82.106µs: cmdbussy expand_rgb.hlsl 16755
111.386µs: cmdbussy expand_rgb.hlsl 16755
92.672µs: cmdbussy expand_rgb.hlsl 16755
111.991µs: cmdbussy expand_rgb.hlsl 16755
97.199µs: cmdbussy expand_rgb.hlsl 16755
84.521µs: cmdbussy expand_rgb.hlsl 16755
89.652µs: cmdbussy expand_rgb.hlsl 16755
67.013µs: cmdbussy expand_rgb.hlsl 16755
91.162µs: cmdbussy expand_rgb.hlsl 16755
94.482µs: cmdbussy expand_rgb.hlsl 16755
90.558µs: cmdbussy expand_rgb.hlsl 16755
125.272µs: cmdbussy expand_rgb.hlsl 16755
112.594µs: cmdbussy expand_rgb.hlsl 16755
91.766µs: cmdbussy expand_rgb.hlsl 16755
79.691µs: cmdbussy expand_rgb.hlsl 16755
378.231µs: cmdbussy expand_rgb.hlsl 16755
79.088µs: cmdbussy expand_rgb.hlsl 16755
77.88µs: cmdbussy expand_rgb.hlsl 16755
65.806µs: cmdbussy expand_rgb.hlsl 16755
83.012µs: cmdbussy expand_rgb.hlsl 16755
112.896µs: cmdbussy expand_rgb.hlsl 16755
102.029µs: cmdbussy expand_rgb.hlsl 16755
94.482µs: cmdbussy expand_rgb.hlsl 16755
86.332µs: cmdbussy expand_rgb.hlsl 16755
126.178µs: cmdbussy expand_rgb.hlsl 16755
83.917µs: cmdbussy expand_rgb.hlsl 16755
111.386µs: cmdbussy expand_rgb.hlsl 16755
111.689µs: cmdbussy expand_rgb.hlsl 16755
119.839µs: cmdbussy expand_rgb.hlsl 16755
103.236µs: cmdbussy expand_rgb.hlsl 16755
84.219µs: cmdbussy expand_rgb.hlsl 16755
111.386µs: cmdbussy expand_rgb.hlsl 16755
54.033µs: cmdbussy expand_rgb.hlsl 16755
120.442µs: cmdbussy expand_rgb.hlsl 16755
102.934µs: cmdbussy expand_rgb.hlsl 16755
67.315µs: cmdbussy expand_rgb.hlsl 16755
92.672µs: cmdbussy expand_rgb.hlsl 16755
113.198µs: cmdbussy expand_rgb.hlsl 16755
94.482µs: cmdbussy expand_rgb.hlsl 16755
80.597µs: cmdbussy expand_rgb.hlsl 16755
138.856µs: cmdbussy expand_rgb.hlsl 16755
102.934µs: cmdbussy expand_rgb.hlsl 16755
95.388µs: cmdbussy expand_rgb.hlsl 16755
120.443µs: cmdbussy expand_rgb.hlsl 16755
127.385µs: cmdbussy expand_rgb.hlsl 16755
108.367µs: cmdbussy expand_rgb.hlsl 16755
124.971µs: cmdbussy expand_rgb.hlsl 16755
89.351µs: cmdbussy expand_rgb.hlsl 16755
133.12µs: cmdbussy expand_rgb.hlsl 16755
101.123µs: cmdbussy expand_rgb.hlsl 16755
101.727µs: cmdbussy expand_rgb.hlsl 16755
79.993µs: cmdbussy expand_rgb.hlsl 16755
123.461µs: cmdbussy expand_rgb.hlsl 16755
63.995µs: cmdbussy expand_rgb.hlsl 16755
122.556µs: cmdbussy expand_rgb.hlsl 16755
133.725µs: cmdbussy expand_rgb.hlsl 16755
90.86µs: cmdbussy expand_rgb.hlsl 16755
115.008µs: cmdbussy expand_rgb.hlsl 16755
131.008µs: cmdbussy expand_rgb.hlsl 16755
79.993µs: cmdbussy expand_rgb.hlsl 16755
134.63µs: cmdbussy expand_rgb.hlsl 16755
88.143µs: cmdbussy expand_rgb.hlsl 16755
330.537µs: cmdbussy expand_rgb.hlsl 16755
77.578µs: cmdbussy expand_rgb.hlsl 16755
95.086µs: cmdbussy expand_rgb.hlsl 16755
110.783µs: cmdbussy expand_rgb.hlsl 16755
94.784µs: cmdbussy expand_rgb.hlsl 16755
89.049µs: cmdbussy expand_rgb.hlsl 16755
132.215µs: cmdbussy expand_rgb.hlsl 16755
83.314µs: cmdbussy expand_rgb.hlsl 16755
97.501µs: cmdbussy expand_rgb.hlsl 16755
92.973µs: cmdbussy expand_rgb.hlsl 16755
98.407µs: cmdbussy expand_rgb.hlsl 16755
84.823µs: cmdbussy expand_rgb.hlsl 16755
88.747µs: cmdbussy expand_rgb.hlsl 16755
106.557µs: cmdbussy expand_rgb.hlsl 16755
112.594µs: cmdbussy expand_rgb.hlsl 16755
124.366µs: cmdbussy expand_rgb.hlsl 16755
86.332µs: cmdbussy expand_rgb.hlsl 16755
83.615µs: cmdbussy expand_rgb.hlsl 16755
131.611µs: cmdbussy expand_rgb.hlsl 16755
78.785µs: cmdbussy expand_rgb.hlsl 16755
115.612µs: cmdbussy expand_rgb.hlsl 16755
110.783µs: cmdbussy expand_rgb.hlsl 16755
93.577µs: cmdbussy expand_rgb.hlsl 16755
93.275µs: cmdbussy expand_rgb.hlsl 16755
80.295µs: cmdbussy expand_rgb.hlsl 16755
106.255µs: cmdbussy expand_rgb.hlsl 16755
205.567µs: cmdbussy expand_rgb.hlsl 1103347
148.213µs: cmdbussy expand_rgb.hlsl 1103347
150.931µs: cmdbussy expand_rgb.hlsl 1103347
6.076755ms: cmdbussy expand_rgb.hlsl 1103347
156.062µs: cmdbussy expand_rgb.hlsl 1103347
159.986µs: cmdbussy expand_rgb.hlsl 1103347
156.665µs: cmdbussy expand_rgb.hlsl 1103347
149.723µs: cmdbussy expand_rgb.hlsl 1103347
158.779µs: cmdbussy expand_rgb.hlsl 1103347
160.891µs: cmdbussy expand_rgb.hlsl 1103347
150.025µs: cmdbussy expand_rgb.hlsl 1103347
163.91µs: cmdbussy expand_rgb.hlsl 1103347
175.381µs: cmdbussy expand_rgb.hlsl 1103347
150.024µs: cmdbussy expand_rgb.hlsl 1103347
150.628µs: cmdbussy expand_rgb.hlsl 1103347
169.042µs: cmdbussy expand_rgb.hlsl 1103347
156.665µs: cmdbussy expand_rgb.hlsl 1103347
158.778µs: cmdbussy expand_rgb.hlsl 1103347
158.175µs: cmdbussy expand_rgb.hlsl 1103347
166.929µs: cmdbussy expand_rgb.hlsl 1103347
152.742µs: cmdbussy expand_rgb.hlsl 1103347
162.1µs: cmdbussy expand_rgb.hlsl 1103347
212.208µs: cmdbussy expand_rgb.hlsl 1103347
150.93µs: cmdbussy expand_rgb.hlsl 1103347
147.61µs: cmdbussy expand_rgb.hlsl 1103347
146.1µs: cmdbussy expand_rgb.hlsl 1103347
149.722µs: cmdbussy expand_rgb.hlsl 1103347
151.836µs: cmdbussy expand_rgb.hlsl 1103347
175.683µs: cmdbussy expand_rgb.hlsl 1103347
148.817µs: cmdbussy expand_rgb.hlsl 1103347
158.175µs: cmdbussy expand_rgb.hlsl 1103347
212.208µs: cmdbussy expand_rgb.hlsl 1103347
189.87µs: cmdbussy expand_rgb.hlsl 1103347
151.534µs: cmdbussy expand_rgb.hlsl 1103347
149.421µs: cmdbussy expand_rgb.hlsl 1103347
150.327µs: cmdbussy expand_rgb.hlsl 1103347
151.232µs: cmdbussy expand_rgb.hlsl 1103347
152.138µs: cmdbussy expand_rgb.hlsl 1103347
178.4µs: cmdbussy expand_rgb.hlsl 1103347
148.213µs: cmdbussy expand_rgb.hlsl 1103347
158.778µs: cmdbussy expand_rgb.hlsl 1103347
150.628µs: cmdbussy expand_rgb.hlsl 1103347
185.342µs: cmdbussy expand_rgb.hlsl 1103347
155.76µs: cmdbussy expand_rgb.hlsl 1103347
150.025µs: cmdbussy expand_rgb.hlsl 1103347
149.12µs: cmdbussy expand_rgb.hlsl 1103347
155.156µs: cmdbussy expand_rgb.hlsl 1103347
151.534µs: cmdbussy expand_rgb.hlsl 1103347
146.704µs: cmdbussy expand_rgb.hlsl 1103347
156.061µs: cmdbussy expand_rgb.hlsl 1103347
149.12µs: cmdbussy expand_rgb.hlsl 1103347
147.609µs: cmdbussy expand_rgb.hlsl 1103347
163.608µs: cmdbussy expand_rgb.hlsl 1103347
156.061µs: cmdbussy expand_rgb.hlsl 1103347
171.457µs: cmdbussy expand_rgb.hlsl 1103347
149.723µs: cmdbussy expand_rgb.hlsl 1103347
161.193µs: cmdbussy expand_rgb.hlsl 1103347
185.342µs: cmdbussy expand_rgb.hlsl 1103347
147.308µs: cmdbussy expand_rgb.hlsl 1103347
153.647µs: cmdbussy expand_rgb.hlsl 1103347
150.327µs: cmdbussy expand_rgb.hlsl 1103347
178.4µs: cmdbussy expand_rgb.hlsl 1103347
156.062µs: cmdbussy expand_rgb.hlsl 1103347
157.571µs: cmdbussy expand_rgb.hlsl 1103347
161.193µs: cmdbussy expand_rgb.hlsl 1103347
149.12µs: cmdbussy expand_rgb.hlsl 1103347
188.06µs: cmdbussy expand_rgb.hlsl 1103347
148.817µs: cmdbussy expand_rgb.hlsl 1103347
148.516µs: cmdbussy expand_rgb.hlsl 1103347
150.629µs: cmdbussy expand_rgb.hlsl 1103347
153.345µs: cmdbussy expand_rgb.hlsl 1103347
164.514µs: cmdbussy expand_rgb.hlsl 1103347
149.723µs: cmdbussy expand_rgb.hlsl 1103347
147.61µs: cmdbussy expand_rgb.hlsl 1103347
172.06µs: cmdbussy expand_rgb.hlsl 1103347
148.213µs: cmdbussy expand_rgb.hlsl 1103347
150.326µs: cmdbussy expand_rgb.hlsl 1103347
149.723µs: cmdbussy expand_rgb.hlsl 1103347
149.119µs: cmdbussy expand_rgb.hlsl 1103347
402.682µs: cmdbussy expand_rgb.hlsl 1103347
153.949µs: cmdbussy expand_rgb.hlsl 1103347
147.006µs: cmdbussy expand_rgb.hlsl 1103347
162.1µs: cmdbussy expand_rgb.hlsl 1103347
149.42µs: cmdbussy expand_rgb.hlsl 1103347
154.251µs: cmdbussy expand_rgb.hlsl 1103347
155.157µs: cmdbussy expand_rgb.hlsl 1103347
156.666µs: cmdbussy expand_rgb.hlsl 1103347
157.572µs: cmdbussy expand_rgb.hlsl 1103347
152.741µs: cmdbussy expand_rgb.hlsl 1103347
151.232µs: cmdbussy expand_rgb.hlsl 1103347
163.306µs: cmdbussy expand_rgb.hlsl 1103347
149.723µs: cmdbussy expand_rgb.hlsl 1103347
164.514µs: cmdbussy expand_rgb.hlsl 1103347
156.062µs: cmdbussy expand_rgb.hlsl 1103347
153.345µs: cmdbussy expand_rgb.hlsl 1103347
158.477µs: cmdbussy expand_rgb.hlsl 1103347
147.006µs: cmdbussy expand_rgb.hlsl 1103347
164.514µs: cmdbussy expand_rgb.hlsl 1103347
149.723µs: cmdbussy expand_rgb.hlsl 1103347
159.986µs: cmdbussy expand_rgb.hlsl 1103347
149.421µs: cmdbussy expand_rgb.hlsl 1103347
153.346µs: cmdbussy expand_rgb.hlsl 1103347
159.684µs: cmdbussy expand_rgb.hlsl 1103347
432.566µs: cmdbussy expand_rgb.hlsl 1103347
401.474µs: cmdbussy expand_rgb.hlsl 1103347
166.627µs: cmdbussy expand_rgb.hlsl 1103347
220.056µs: cmdbussy expand_rgb.hlsl 1103347
162.703µs: cmdbussy expand_rgb.hlsl 1103347
158.477µs: cmdbussy expand_rgb.hlsl 1103347
160.59µs: cmdbussy expand_rgb.hlsl 1103347
151.534µs: cmdbussy expand_rgb.hlsl 1103347
165.118µs: cmdbussy expand_rgb.hlsl 1103347
148.516µs: cmdbussy expand_rgb.hlsl 1103347
159.986µs: cmdbussy expand_rgb.hlsl 1103347
147.911µs: cmdbussy expand_rgb.hlsl 1103347
161.797µs: cmdbussy expand_rgb.hlsl 1103347
159.382µs: cmdbussy expand_rgb.hlsl 1103347
158.477µs: cmdbussy expand_rgb.hlsl 1103347
156.968µs: cmdbussy expand_rgb.hlsl 1103347
148.817µs: cmdbussy expand_rgb.hlsl 1103347
159.684µs: cmdbussy expand_rgb.hlsl 1103347
153.044µs: cmdbussy expand_rgb.hlsl 1103347
147.61µs: cmdbussy expand_rgb.hlsl 1103347
173.871µs: cmdbussy expand_rgb.hlsl 1103347
159.081µs: cmdbussy expand_rgb.hlsl 1103347
164.212µs: cmdbussy expand_rgb.hlsl 1103347
159.382µs: cmdbussy expand_rgb.hlsl 1103347
154.251µs: cmdbussy expand_rgb.hlsl 1103347
159.684µs: cmdbussy expand_rgb.hlsl 1103347
160.59µs: cmdbussy expand_rgb.hlsl 1103347
147.912µs: cmdbussy expand_rgb.hlsl 1103347
150.024µs: cmdbussy expand_rgb.hlsl 1103347
195.002µs: cmdbussy expand_rgb.hlsl 1103347
156.062µs: cmdbussy expand_rgb.hlsl 1103347
148.515µs: cmdbussy expand_rgb.hlsl 1103347
150.025µs: cmdbussy expand_rgb.hlsl 1103347
151.534µs: cmdbussy expand_rgb.hlsl 1103347
148.214µs: cmdbussy expand_rgb.hlsl 1103347
158.476µs: cmdbussy expand_rgb.hlsl 1103347
146.704µs: cmdbussy expand_rgb.hlsl 1103347
403.286µs: cmdbussy expand_rgb.hlsl 1103347
490.825µs: cmdbussy expand_rgb.hlsl 1103347
159.684µs: cmdbussy expand_rgb.hlsl 1103347
159.081µs: cmdbussy expand_rgb.hlsl 1103347
150.326µs: cmdbussy expand_rgb.hlsl 1103347
146.402µs: cmdbussy expand_rgb.hlsl 1103347
151.232µs: cmdbussy expand_rgb.hlsl 1103347
166.024µs: cmdbussy expand_rgb.hlsl 1103347
159.685µs: cmdbussy expand_rgb.hlsl 1103347
156.968µs: cmdbussy expand_rgb.hlsl 1103347
150.93µs: cmdbussy expand_rgb.hlsl 1103347
158.779µs: cmdbussy expand_rgb.hlsl 1103347
148.817µs: cmdbussy expand_rgb.hlsl 1103347
148.817µs: cmdbussy expand_rgb.hlsl 1103347
155.156µs: cmdbussy expand_rgb.hlsl 1103347
148.515µs: cmdbussy expand_rgb.hlsl 1103347
151.836µs: cmdbussy expand_rgb.hlsl 1103347
158.779µs: cmdbussy expand_rgb.hlsl 1103347
148.818µs: cmdbussy expand_rgb.hlsl 1103347
156.062µs: cmdbussy expand_rgb.hlsl 1103347
193.191µs: cmdbussy expand_rgb.hlsl 1103347
153.345µs: cmdbussy expand_rgb.hlsl 1103347
149.12µs: cmdbussy expand_rgb.hlsl 1103347
148.817µs: cmdbussy expand_rgb.hlsl 1103347
149.119µs: cmdbussy expand_rgb.hlsl 1103347
152.741µs: cmdbussy expand_rgb.hlsl 1103347
172.664µs: cmdbussy expand_rgb.hlsl 1103347
152.137µs: cmdbussy expand_rgb.hlsl 1103347
149.421µs: cmdbussy expand_rgb.hlsl 1103347
148.214µs: cmdbussy expand_rgb.hlsl 1103347
153.647µs: cmdbussy expand_rgb.hlsl 1103347
160.892µs: cmdbussy expand_rgb.hlsl 1103347
Benchmark 4: 16755 RGBs pre
  Time (mean ± σ): 14.680143 ms ± 339.440841 µs
  Range (min … max): 14.378825 ms … 18.117972 ms 249 runs
Benchmark 3: 16755 RGBs post
  Time (mean ± σ): 12.115274 ms ± 1.041481 ms
  Range (min … max): 11.546166 ms … 18.790215 ms 445 runs
Benchmark 6: 1103347 RGBs pre
  Time (mean ± σ): 210.770776 ms ± 21.167100 ms
  Range (min … max): 205.793730 ms … 382.314534 ms 69 runs
Benchmark 5: 1103347 RGBs post
  Time (mean ± σ): 28.952224 ms ± 848.009892 µs
  Range (min … max): 28.372476 ms … 36.353972 ms 172 runs
Benchmark 1: cmdbussy expand_rgb.hlsl 16755
  Time (mean ± σ): 129.085778 µs ± 621.358271 µs
  Range (min … max): 50.109000 µs … 13.201569 ms 445 runs
Benchmark 2: cmdbussy expand_rgb.hlsl 1103347
  Time (mean ± σ): 200.058070 µs ± 451.868568 µs
  Range (min … max): 146.100000 µs … 6.076755 ms 172 runs
-->
<!--
68.22µs 16755 destlab
87.841µs 16755 destlab
69.428µs 16755 destlab
70.032µs 16755 destlab
100.519µs 16755 destlab
96.293µs 16755 destlab
85.729µs 16755 destlab
72.749µs 16755 destlab
79.389µs 16755 destlab
71.842µs 16755 destlab
68.522µs 16755 destlab
70.938µs 16755 destlab
70.938µs 16755 destlab
69.126µs 16755 destlab
69.428µs 16755 destlab
72.446µs 16755 destlab
67.616µs 16755 destlab
77.579µs 16755 destlab
69.126µs 16755 destlab
78.182µs 16755 destlab
71.541µs 16755 destlab
79.691µs 16755 destlab
67.919µs 16755 destlab
68.824µs 16755 destlab
68.221µs 16755 destlab
68.523µs 16755 destlab
78.785µs 16755 destlab
69.73µs 16755 destlab
67.919µs 16755 destlab
74.862µs 16755 destlab
73.956µs 16755 destlab
83.313µs 16755 destlab
68.522µs 16755 destlab
67.919µs 16755 destlab
71.541µs 16755 destlab
69.73µs 16755 destlab
69.126µs 16755 destlab
70.031µs 16755 destlab
69.428µs 16755 destlab
77.88µs 16755 destlab
71.843µs 16755 destlab
68.523µs 16755 destlab
68.22µs 16755 destlab
67.918µs 16755 destlab
67.013µs 16755 destlab
69.729µs 16755 destlab
67.617µs 16755 destlab
68.22µs 16755 destlab
67.918µs 16755 destlab
69.73µs 16755 destlab
80.597µs 16755 destlab
68.221µs 16755 destlab
67.617µs 16755 destlab
68.522µs 16755 destlab
68.523µs 16755 destlab
68.824µs 16755 destlab
67.315µs 16755 destlab
67.919µs 16755 destlab
70.333µs 16755 destlab
68.22µs 16755 destlab
104.142µs 16755 destlab
4.76034ms 1103347 destlab
5.376439ms 1103347 destlab
5.690977ms 1103347 destlab
5.39938ms 1103347 destlab
5.338404ms 1103347 destlab
5.501711ms 1103347 destlab
5.35893ms 1103347 destlab
5.140081ms 1103347 destlab
5.465185ms 1103347 destlab
5.424736ms 1103347 destlab
5.408435ms 1103347 destlab
5.764027ms 1103347 destlab
5.398776ms 1103347 destlab
5.401492ms 1103347 destlab
5.573251ms 1103347 destlab
5.095406ms 1103347 destlab
5.709692ms 1103347 destlab
5.384589ms 1103347 destlab
5.306708ms 1103347 destlab
5.497183ms 1103347 destlab
5.399983ms 1103347 destlab
5.422623ms 1103347 destlab
5.432585ms 1103347 destlab
5.371911ms 1103347 destlab
5.239997ms 1103347 destlab
5.482089ms 1103347 destlab
5.37523ms 1103347 destlab
5.323613ms 1103347 destlab
5.668337ms 1103347 destlab
4.985831ms 1103347 destlab
5.463978ms 1103347 destlab
5.371609ms 1103347 destlab
5.370099ms 1103347 destlab
5.469713ms 1103347 destlab
5.351988ms 1103347 destlab
5.408134ms 1103347 destlab
5.4027ms 1103347 destlab
5.393343ms 1103347 destlab
5.495673ms 1103347 destlab
5.4676ms 1103347 destlab
5.328141ms 1103347 destlab
5.461261ms 1103347 destlab
5.4027ms 1103347 destlab
5.371609ms 1103347 destlab
5.403304ms 1103347 destlab
138.554µs 16755 bundle.rgb
142.78µs 16755 bundle.rgb
144.29µs 16755 bundle.rgb
143.686µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
138.554µs 16755 bundle.rgb
135.535µs 16755 bundle.rgb
137.95µs 16755 bundle.rgb
134.931µs 16755 bundle.rgb
139.157µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
135.234µs 16755 bundle.rgb
145.195µs 16755 bundle.rgb
137.044µs 16755 bundle.rgb
135.234µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
137.95µs 16755 bundle.rgb
142.479µs 16755 bundle.rgb
139.46µs 16755 bundle.rgb
147.006µs 16755 bundle.rgb
134.63µs 16755 bundle.rgb
163.608µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
135.837µs 16755 bundle.rgb
135.536µs 16755 bundle.rgb
134.63µs 16755 bundle.rgb
139.46µs 16755 bundle.rgb
168.438µs 16755 bundle.rgb
135.837µs 16755 bundle.rgb
148.817µs 16755 bundle.rgb
134.328µs 16755 bundle.rgb
166.627µs 16755 bundle.rgb
135.536µs 16755 bundle.rgb
134.63µs 16755 bundle.rgb
135.535µs 16755 bundle.rgb
135.837µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
140.064µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
137.045µs 16755 bundle.rgb
147.006µs 16755 bundle.rgb
137.346µs 16755 bundle.rgb
138.253µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
140.063µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
134.63µs 16755 bundle.rgb
137.649µs 16755 bundle.rgb
164.212µs 16755 bundle.rgb
142.478µs 16755 bundle.rgb
135.535µs 16755 bundle.rgb
140.667µs 16755 bundle.rgb
145.497µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
137.044µs 16755 bundle.rgb
137.347µs 16755 bundle.rgb
135.838µs 16755 bundle.rgb
149.723µs 16755 bundle.rgb
155.156µs 16755 bundle.rgb
140.969µs 16755 bundle.rgb
137.649µs 16755 bundle.rgb
134.026µs 16755 bundle.rgb
135.234µs 16755 bundle.rgb
135.536µs 16755 bundle.rgb
148.817µs 16755 bundle.rgb
135.535µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
163.91µs 16755 bundle.rgb
134.63µs 16755 bundle.rgb
137.347µs 16755 bundle.rgb
136.742µs 16755 bundle.rgb
134.932µs 16755 bundle.rgb
135.234µs 16755 bundle.rgb
135.536µs 16755 bundle.rgb
137.045µs 16755 bundle.rgb
180.211µs 16755 bundle.rgb
140.667µs 16755 bundle.rgb
134.63µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
199.832µs 16755 bundle.rgb
135.535µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
135.838µs 16755 bundle.rgb
168.74µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
135.234µs 16755 bundle.rgb
154.251µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
138.554µs 16755 bundle.rgb
138.856µs 16755 bundle.rgb
181.72µs 16755 bundle.rgb
145.497µs 16755 bundle.rgb
134.932µs 16755 bundle.rgb
137.347µs 16755 bundle.rgb
139.46µs 16755 bundle.rgb
144.893µs 16755 bundle.rgb
154.552µs 16755 bundle.rgb
155.76µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
135.234µs 16755 bundle.rgb
134.629µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
134.026µs 16755 bundle.rgb
134.932µs 16755 bundle.rgb
137.045µs 16755 bundle.rgb
170.853µs 16755 bundle.rgb
133.724µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
136.441µs 16755 bundle.rgb
134.931µs 16755 bundle.rgb
135.233µs 16755 bundle.rgb
135.233µs 16755 bundle.rgb
170.853µs 16755 bundle.rgb
136.743µs 16755 bundle.rgb
138.856µs 16755 bundle.rgb
135.535µs 16755 bundle.rgb
135.233µs 16755 bundle.rgb
147.61µs 16755 bundle.rgb
142.78µs 16755 bundle.rgb
136.139µs 16755 bundle.rgb
140.063µs 16755 bundle.rgb
135.536µs 16755 bundle.rgb
134.932µs 16755 bundle.rgb
151.534µs 16755 bundle.rgb
144.29µs 16755 bundle.rgb
142.176µs 16755 bundle.rgb
194.701µs 16755 bundle.rgb
144.289µs 16755 bundle.rgb
137.951µs 16755 bundle.rgb
143.384µs 16755 bundle.rgb
138.855µs 16755 bundle.rgb
141.875µs 16755 bundle.rgb
9.172636ms 1103347 bundle.rgb
9.981924ms 1103347 bundle.rgb
10.134666ms 1103347 bundle.rgb
9.967435ms 1103347 bundle.rgb
10.113234ms 1103347 bundle.rgb
9.910081ms 1103347 bundle.rgb
9.84639ms 1103347 bundle.rgb
10.13376ms 1103347 bundle.rgb
10.653564ms 1103347 bundle.rgb
9.952644ms 1103347 bundle.rgb
10.412981ms 1103347 bundle.rgb
9.749794ms 1103347 bundle.rgb
9.826164ms 1103347 bundle.rgb
9.891668ms 1103347 bundle.rgb
9.979812ms 1103347 bundle.rgb
9.983736ms 1103347 bundle.rgb
10.086067ms 1103347 bundle.rgb
10.112328ms 1103347 bundle.rgb
9.834617ms 1103347 bundle.rgb
10.223715ms 1103347 bundle.rgb
9.891668ms 1103347 bundle.rgb
10.24726ms 1103347 bundle.rgb
10.072784ms 1103347 bundle.rgb
10.043806ms 1103347 bundle.rgb
9.932419ms 1103347 bundle.rgb
9.953851ms 1103347 bundle.rgb
9.932419ms 1103347 bundle.rgb
9.774244ms 1103347 bundle.rgb
9.814694ms 1103347 bundle.rgb
9.801714ms 1103347 bundle.rgb
9.86118ms 1103347 bundle.rgb
10.072483ms 1103347 bundle.rgb
10.086972ms 1103347 bundle.rgb
10.432602ms 1103347 bundle.rgb
10.263258ms 1103347 bundle.rgb
10.003658ms 1103347 bundle.rgb
10.258127ms 1103347 bundle.rgb
10.045919ms 1103347 bundle.rgb
9.761265ms 1103347 bundle.rgb
10.239713ms 1103347 bundle.rgb
10.259033ms 1103347 bundle.rgb
10.249675ms 1103347 bundle.rgb
10.019657ms 1103347 bundle.rgb
10.570854ms 1103347 bundle.rgb
10.096028ms 1103347 bundle.rgb
9.922156ms 1103347 bundle.rgb
10.085161ms 1103347 bundle.rgb
10.687071ms 1103347 bundle.rgb
10.439546ms 1103347 bundle.rgb
10.399398ms 1103347 bundle.rgb
10.030222ms 1103347 bundle.rgb
10.19866ms 1103347 bundle.rgb
10.276843ms 1103347 bundle.rgb
9.982227ms 1103347 bundle.rgb
10.003356ms 1103347 bundle.rgb
9.927288ms 1103347 bundle.rgb
10.025996ms 1103347 bundle.rgb
10.088783ms 1103347 bundle.rgb
9.760359ms 1103347 bundle.rgb
9.896196ms 1103347 bundle.rgb
10.118668ms 1103347 bundle.rgb
10.521652ms 1103347 bundle.rgb
10.243336ms 1103347 bundle.rgb
10.254203ms 1103347 bundle.rgb
10.065238ms 1103347 bundle.rgb
10.198358ms 1103347 bundle.rgb
10.332687ms 1103347 bundle.rgb
10.054975ms 1103347 bundle.rgb
10.189001ms 1103347 bundle.rgb
10.030826ms 1103347 bundle.rgb
Benchmark 1: 16755 destlab
  Time (mean ± σ): 72.792918 µs ± 7.869198 µs
  Range (min … max): 67.013000 µs … 104.142000 µs 61 runs
Benchmark 2: 16755 bundle.rgb
  Time (mean ± σ): 141.841221 µs ± 11.672071 µs
  Range (min … max): 133.724000 µs … 199.832000 µs 136 runs
Benchmark 3: 1103347 destlab
  Time (mean ± σ): 5.396884 ms ± 168.200009 µs
  Range (min … max): 4.760340 ms … 5.764027 ms 45 runs
Benchmark 4: 1103347 bundle.rgb
  Time (mean ± σ): 10.076924 ms ± 237.516176 µs
  Range (min … max): 9.172636 ms … 10.687071 ms 70 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th><samp>known_rgbs</samp> before </th> <td><span class="roboto-unscale math-font-normal">14.680ms</span></td> <td><span class="roboto-unscale math-font-normal">210.771ms</span></td> <td><span class="roboto-unscale math-font-normal">339µs</span>/<span class="roboto-unscale math-font-normal">21.17ms</span></td></tr>
 <tr><th><samp>dest_lab = KnownRgbsPack { rgb, lab }</samp></th> <td><span class="roboto-unscale math-font-normal">72.793µs</span></td> <td><span class="roboto-unscale math-font-normal">5.397ms</span></td> <td><span class="roboto-unscale math-font-normal">7.87µs</span>/<span class="roboto-unscale math-font-normal">168.2µs</span></td></tr>
 <tr class="spc"></tr>
 <tr><th><samp>known_rgbs</samp> after </th> <td><span class="roboto-unscale math-font-normal">12.115ms</span></td> <td><span class="roboto-unscale math-font-normal">28.952ms</span></td> <td><span class="roboto-unscale math-font-normal">1.04ms</span>/<span class="roboto-unscale math-font-normal">848µs</span></td></tr>
 <tr><th><samp>bundle.rgb = known</samp> </th> <td><span class="roboto-unscale math-font-normal">141.841µs</span></td> <td><span class="roboto-unscale math-font-normal">10.076ms</span></td> <td><span class="roboto-unscale math-font-normal">11.67µs</span>/<span class="roboto-unscale math-font-normal">237.5µs</span></td></tr>
 <tr><th><samp>expand_rgb.hlsl</samp> </th> <td><span class="roboto-unscale math-font-normal">129.086µs</span></td> <td><span class="roboto-unscale math-font-normal">200.058µs</span></td> <td><span class="roboto-unscale math-font-normal">621µs</span>/<span class="roboto-unscale math-font-normal">452µs</span></td></tr>
 <tr><th>(speed-up) </th> <td><span class="roboto-unscale math-font-normal">16.04%</span></td> <td><span class="roboto-unscale math-font-normal">81.85%</span></td> <td></td></tr>
</table>
<p class="continuing">
this is fixed analysis cost for an image
(and, interestingly, a quarter of the bytes in <samp>known_rgbs_bundle</samp> is <span class="roboto-unscale math-font-normal">~2×</span> slower;
 I'm<!--'--> assuming it induces a cache-line read/modify/write instead of a full write);
the following is paid for each computation/parameter change;
<samp>RgbStuffedInLab</samp> is considered to be distributed across each final [​[​f​]​] computation on the GPU, thus becoming immaterial:
</p>
<!--
7.248577ms labcopy 16755
2.917482ms labcopy 16755
2.468616ms labcopy 16755
2.406432ms labcopy 16755
2.403716ms labcopy 16755
2.389226ms labcopy 16755
2.410658ms labcopy 16755
2.57306ms labcopy 16755
2.629809ms labcopy 16755
2.403414ms labcopy 16755
2.375643ms labcopy 16755
2.370511ms labcopy 16755
2.362663ms labcopy 16755
2.369303ms labcopy 16755
2.842017ms labcopy 16755
2.453824ms labcopy 16755
2.423638ms labcopy 16755
2.400093ms labcopy 16755
2.378661ms labcopy 16755
2.381076ms labcopy 16755
2.385906ms labcopy 16755
2.786173ms labcopy 16755
2.399188ms labcopy 16755
2.402206ms labcopy 16755
2.374134ms labcopy 16755
2.363568ms labcopy 16755
2.369606ms labcopy 16755
2.441448ms labcopy 16755
2.672673ms labcopy 16755
2.388622ms labcopy 16755
2.369606ms labcopy 16755
2.371718ms labcopy 16755
2.38168ms labcopy 16755
2.370209ms labcopy 16755
2.487029ms labcopy 16755
2.606867ms labcopy 16755
2.371416ms labcopy 16755
2.376548ms labcopy 16755
2.379868ms labcopy 16755
2.368699ms labcopy 16755
2.370511ms labcopy 16755
2.463785ms labcopy 16755
2.655769ms labcopy 16755
2.528384ms labcopy 16755
2.467408ms labcopy 16755
2.37202ms labcopy 16755
2.401905ms labcopy 16755
2.370209ms labcopy 16755
2.663014ms labcopy 16755
2.530799ms labcopy 16755
2.421224ms labcopy 16755
2.369605ms labcopy 16755
2.371114ms labcopy 16755
2.3687ms labcopy 16755
2.367191ms labcopy 16755
2.69803ms labcopy 16755
2.426657ms labcopy 16755
2.376548ms labcopy 16755
2.376548ms labcopy 16755
2.368096ms labcopy 16755
2.375038ms labcopy 16755
2.4336ms labcopy 16755
2.671767ms labcopy 16755
2.407338ms labcopy 16755
2.371718ms labcopy 16755
2.365682ms labcopy 16755
2.379265ms labcopy 16755
2.365681ms labcopy 16755
2.486727ms labcopy 16755
2.616829ms labcopy 16755
2.36387ms labcopy 16755
2.37202ms labcopy 16755
2.394056ms labcopy 16755
2.365379ms labcopy 16755
2.365077ms labcopy 16755
2.567626ms labcopy 16755
2.533214ms labcopy 16755
2.397678ms labcopy 16755
2.416091ms labcopy 16755
2.692898ms labcopy 16755
2.488538ms labcopy 16755
2.38983ms labcopy 16755
2.691087ms labcopy 16755
2.496387ms labcopy 16755
2.36387ms labcopy 16755
2.362662ms labcopy 16755
2.371416ms labcopy 16755
2.375341ms labcopy 16755
2.360248ms labcopy 16755
2.7258ms labcopy 16755
2.407036ms labcopy 16755
2.384095ms labcopy 16755
2.365983ms labcopy 16755
2.377152ms labcopy 16755
2.364474ms labcopy 16755
2.447485ms labcopy 16755
2.647015ms labcopy 16755
2.378057ms labcopy 16755
2.366587ms labcopy 16755
2.400395ms labcopy 16755
2.76776ms labcopy 16755
2.52446ms labcopy 16755
2.385ms labcopy 16755
2.77923ms labcopy 16755
2.470729ms labcopy 16755
2.446278ms labcopy 16755
2.389226ms labcopy 16755
2.382284ms labcopy 16755
2.388321ms labcopy 16755
2.394358ms labcopy 16755
2.74995ms labcopy 16755
2.415186ms labcopy 16755
2.368096ms labcopy 16755
2.367492ms labcopy 16755
2.364172ms labcopy 16755
2.378359ms labcopy 16755
2.377454ms labcopy 16755
2.721273ms labcopy 16755
2.404923ms labcopy 16755
2.376849ms labcopy 16755
2.361455ms labcopy 16755
2.385604ms labcopy 16755
2.376548ms labcopy 16755
2.478577ms labcopy 16755
2.693804ms labcopy 16755
2.384095ms labcopy 16755
2.384698ms labcopy 16755
2.371718ms labcopy 16755
2.361757ms labcopy 16755
2.377756ms labcopy 16755
2.507857ms labcopy 16755
2.60898ms labcopy 16755
2.371416ms labcopy 16755
2.37202ms labcopy 16755
2.368096ms labcopy 16755
2.35572ms labcopy 16755
2.382283ms labcopy 16755
2.559778ms labcopy 16755
2.529289ms labcopy 16755
2.383189ms labcopy 16755
2.384397ms labcopy 16755
2.369002ms labcopy 16755
2.379265ms labcopy 16755
2.360248ms labcopy 16755
2.778325ms labcopy 16755
2.437524ms labcopy 16755
2.431185ms labcopy 16755
2.422732ms labcopy 16755
2.383793ms labcopy 16755
2.384699ms labcopy 16755
2.385ms labcopy 16755
2.82451ms labcopy 16755
2.413375ms labcopy 16755
2.43209ms labcopy 16755
2.395867ms labcopy 16755
2.378057ms labcopy 16755
2.403112ms labcopy 16755
2.531101ms labcopy 16755
2.768061ms labcopy 16755
2.38983ms labcopy 16755
2.426958ms labcopy 16755
2.534723ms labcopy 16755
2.431185ms labcopy 16755
2.471031ms labcopy 16755
2.815453ms labcopy 16755
2.487331ms labcopy 16755
2.446278ms labcopy 16755
2.414281ms labcopy 16755
2.391339ms labcopy 16755
2.400998ms labcopy 16755
2.396169ms labcopy 16755
2.872807ms labcopy 16755
2.423035ms labcopy 16755
2.423034ms labcopy 16755
2.397376ms labcopy 16755
2.386208ms labcopy 16755
2.372624ms labcopy 16755
2.503632ms labcopy 16755
2.78406ms labcopy 16755
2.382585ms labcopy 16755
2.370813ms labcopy 16755
2.381076ms labcopy 16755
2.376246ms labcopy 16755
2.360852ms labcopy 16755
2.567626ms labcopy 16755
2.544684ms labcopy 16755
2.37353ms labcopy 16755
2.371417ms labcopy 16755
2.381378ms labcopy 16755
2.353305ms labcopy 16755
2.368096ms labcopy 16755
2.53744ms labcopy 16755
2.595397ms labcopy 16755
2.380774ms labcopy 16755
2.366587ms labcopy 16755
2.361455ms labcopy 16755
2.36236ms labcopy 16755
2.369304ms labcopy 16755
2.701954ms labcopy 16755
2.427563ms labcopy 16755
2.823604ms labcopy 16755
2.4336ms labcopy 16755
2.395264ms labcopy 16755
2.491859ms labcopy 16755
2.412772ms labcopy 16755
2.517819ms labcopy 16755
2.765948ms labcopy 16755
2.460767ms labcopy 16755
2.404018ms labcopy 16755
2.412469ms labcopy 16755
2.371718ms labcopy 16755
2.382585ms labcopy 16755
2.854092ms labcopy 16755
2.470728ms labcopy 16755
2.460465ms labcopy 16755
2.392547ms labcopy 16755
2.384094ms labcopy 16755
2.377454ms labcopy 16755
2.370209ms labcopy 16755
2.857713ms labcopy 16755
2.500915ms labcopy 16755
2.616829ms labcopy 16755
2.489444ms labcopy 16755
2.463182ms labcopy 16755
2.430279ms labcopy 16755
2.641279ms labcopy 16755
2.715839ms labcopy 16755
2.455938ms labcopy 16755
2.462276ms labcopy 16755
2.479483ms labcopy 16755
2.402206ms labcopy 16755
2.393452ms labcopy 16755
2.859223ms labcopy 16755
2.517819ms labcopy 16755
2.424242ms labcopy 16755
2.413677ms labcopy 16755
2.477067ms labcopy 16755
2.431185ms labcopy 16755
2.57638ms labcopy 16755
2.673579ms labcopy 16755
2.380171ms labcopy 16755
2.383793ms labcopy 16755
2.379265ms labcopy 16755
2.394358ms labcopy 16755
2.391943ms labcopy 16755
2.600529ms labcopy 16755
2.577889ms labcopy 16755
2.392245ms labcopy 16755
2.379265ms labcopy 16755
2.375039ms labcopy 16755
2.365077ms labcopy 16755
2.362663ms labcopy 16755
2.644298ms labcopy 16755
2.463484ms labcopy 16755
2.361757ms labcopy 16755
2.369907ms labcopy 16755
2.368398ms labcopy 16755
2.3687ms labcopy 16755
2.378359ms labcopy 16755
2.690484ms labcopy 16755
2.429978ms labcopy 16755
2.373831ms labcopy 16755
2.364775ms labcopy 16755
2.377152ms labcopy 16755
2.401301ms labcopy 16755
2.373228ms labcopy 16755
2.717349ms labcopy 16755
2.41096ms labcopy 16755
2.370209ms labcopy 16755
2.37202ms labcopy 16755
2.38168ms labcopy 16755
2.371416ms labcopy 16755
2.430883ms labcopy 16755
2.737573ms labcopy 16755
2.400697ms labcopy 16755
2.370209ms labcopy 16755
2.373832ms labcopy 16755
2.362965ms labcopy 16755
2.368398ms labcopy 16755
2.477973ms labcopy 16755
2.628602ms labcopy 16755
2.52295ms labcopy 16755
2.418809ms labcopy 16755
2.373227ms labcopy 16755
2.373831ms labcopy 16755
2.365681ms labcopy 16755
2.61864ms labcopy 16755
2.52929ms labcopy 16755
2.376246ms labcopy 16755
2.377454ms labcopy 16755
2.37685ms labcopy 16755
2.371718ms labcopy 16755
2.36719ms labcopy 16755
2.677202ms labcopy 16755
2.455937ms labcopy 16755
2.383189ms labcopy 16755
2.385906ms labcopy 16755
2.372926ms labcopy 16755
2.370813ms labcopy 16755
2.360851ms labcopy 16755
189.564802ms labcopy 1103347
159.818859ms labcopy 1103347
160.151208ms labcopy 1103347
161.488148ms labcopy 1103347
161.186589ms labcopy 1103347
160.51978ms labcopy 1103347
161.737485ms labcopy 1103347
160.277687ms labcopy 1103347
160.006617ms labcopy 1103347
160.268632ms labcopy 1103347
161.999501ms labcopy 1103347
160.759457ms labcopy 1103347
161.569651ms labcopy 1103347
161.103578ms labcopy 1103347
165.453691ms labcopy 1103347
172.079529ms labcopy 1103347
169.093525ms labcopy 1103347
173.787456ms labcopy 1103347
175.825921ms labcopy 1103347
168.411622ms labcopy 1103347
160.983136ms labcopy 1103347
160.705726ms labcopy 1103347
161.001248ms labcopy 1103347
160.819829ms labcopy 1103347
161.490563ms labcopy 1103347
161.391251ms labcopy 1103347
161.726014ms labcopy 1103347
161.21919ms labcopy 1103347
160.528534ms labcopy 1103347
162.810599ms labcopy 1103347
159.850555ms labcopy 1103347
161.366498ms labcopy 1103347
159.942019ms labcopy 1103347
161.144028ms labcopy 1103347
160.018088ms labcopy 1103347
159.92602ms labcopy 1103347
159.889193ms labcopy 1103347
160.521591ms labcopy 1103347
160.091741ms labcopy 1103347
160.107136ms labcopy 1103347
160.528533ms labcopy 1103347
162.129602ms labcopy 1103347
160.255048ms labcopy 1103347
160.920953ms labcopy 1103347
160.1986ms labcopy 1103347
162.256383ms labcopy 1103347
160.071215ms labcopy 1103347
160.564757ms labcopy 1103347
160.830696ms labcopy 1103347
160.953554ms labcopy 1103347
161.175723ms labcopy 1103347
161.182967ms labcopy 1103347
160.230899ms labcopy 1103347
161.295561ms labcopy 1103347
162.766226ms labcopy 1103347
159.877119ms labcopy 1103347
165.309401ms labcopy 1103347
169.900097ms labcopy 1103347
168.028863ms labcopy 1103347
173.994835ms labcopy 1103347
177.438158ms labcopy 1103347
167.752057ms labcopy 1103347
162.047496ms labcopy 1103347
161.643305ms labcopy 1103347
160.700594ms labcopy 1103347
161.128632ms labcopy 1103347
160.646863ms labcopy 1103347
159.978544ms labcopy 1103347
160.484764ms labcopy 1103347
161.826232ms labcopy 1103347
160.294592ms labcopy 1103347
161.399099ms labcopy 1103347
160.983437ms labcopy 1103347
160.44673ms labcopy 1103347
160.677351ms labcopy 1103347
162.452894ms labcopy 1103347
162.963341ms labcopy 1103347
160.849411ms labcopy 1103347
161.769181ms labcopy 1103347
160.693651ms labcopy 1103347
160.930914ms labcopy 1103347
162.011876ms labcopy 1103347
161.041093ms labcopy 1103347
160.708141ms labcopy 1103347
161.077618ms labcopy 1103347
160.653504ms labcopy 1103347
160.94329ms labcopy 1103347
161.366498ms labcopy 1103347
161.065241ms labcopy 1103347
160.10623ms labcopy 1103347
162.290192ms labcopy 1103347
159.955602ms labcopy 1103347
163.567666ms labcopy 1103347
160.466351ms labcopy 1103347
161.273224ms labcopy 1103347
160.228183ms labcopy 1103347
160.163282ms labcopy 1103347
159.907606ms labcopy 1103347
165.0172ms labcopy 1103347
169.795049ms labcopy 1103347
4.988246ms swizzle 16755
1.38554ms swizzle 16755
1.261173ms swizzle 16755
1.504473ms swizzle 16755
1.613143ms swizzle 16755
1.305547ms swizzle 16755
1.273549ms swizzle 16755
1.3466ms swizzle 16755
1.343279ms swizzle 16755
1.292567ms swizzle 16755
1.300717ms swizzle 16755
1.285624ms swizzle 16755
1.285926ms swizzle 16755
1.269927ms swizzle 16755
1.286832ms swizzle 16755
1.378597ms swizzle 16755
1.582051ms swizzle 16755
1.335733ms swizzle 16755
1.338752ms swizzle 16755
1.283511ms swizzle 16755
1.255438ms swizzle 16755
1.25091ms swizzle 16755
1.250608ms swizzle 16755
1.326375ms swizzle 16755
1.303132ms swizzle 16755
1.250306ms swizzle 16755
1.244571ms swizzle 16755
1.24276ms swizzle 16755
1.39369ms swizzle 16755
1.339959ms swizzle 16755
1.49421ms swizzle 16755
1.428404ms swizzle 16755
1.277172ms swizzle 16755
1.266003ms swizzle 16755
1.257853ms swizzle 16755
1.256042ms swizzle 16755
1.241854ms swizzle 16755
1.241552ms swizzle 16755
1.249099ms swizzle 16755
1.239741ms swizzle 16755
1.232798ms swizzle 16755
1.422668ms swizzle 16755
1.408783ms swizzle 16755
1.315206ms swizzle 16755
1.245477ms swizzle 16755
1.249702ms swizzle 16755
1.261173ms swizzle 16755
1.271135ms swizzle 16755
1.28502ms swizzle 16755
1.243061ms swizzle 16755
1.235817ms swizzle 16755
1.240949ms swizzle 16755
1.230685ms swizzle 16755
1.22978ms swizzle 16755
1.414821ms swizzle 16755
1.400633ms swizzle 16755
1.39701ms swizzle 16755
1.260268ms swizzle 16755
1.244571ms swizzle 16755
1.235515ms swizzle 16755
1.239742ms swizzle 16755
1.259966ms swizzle 16755
1.239741ms swizzle 16755
1.239439ms swizzle 16755
1.243968ms swizzle 16755
1.236119ms swizzle 16755
1.221327ms swizzle 16755
1.352638ms swizzle 16755
1.444705ms swizzle 16755
1.239741ms swizzle 16755
1.215593ms swizzle 16755
1.22012ms swizzle 16755
1.218611ms swizzle 16755
1.228874ms swizzle 16755
1.217102ms swizzle 16755
1.22163ms swizzle 16755
1.213479ms swizzle 16755
1.234912ms swizzle 16755
1.211669ms swizzle 16755
1.211366ms swizzle 16755
1.393087ms swizzle 16755
1.406972ms swizzle 16755
1.308565ms swizzle 16755
1.235817ms swizzle 16755
1.238836ms swizzle 16755
1.232496ms swizzle 16755
1.231591ms swizzle 16755
1.23944ms swizzle 16755
1.243967ms swizzle 16755
1.259966ms swizzle 16755
1.237024ms swizzle 16755
1.235213ms swizzle 16755
1.230686ms swizzle 16755
1.44561ms swizzle 16755
1.38554ms swizzle 16755
1.252117ms swizzle 16755
1.22012ms swizzle 16755
1.239138ms swizzle 16755
1.212574ms swizzle 16755
1.221327ms swizzle 16755
1.479418ms swizzle 16755
1.314301ms swizzle 16755
1.333016ms swizzle 16755
1.226459ms swizzle 16755
1.22646ms swizzle 16755
1.214083ms swizzle 16755
1.209555ms swizzle 16755
1.219215ms swizzle 16755
1.215291ms swizzle 16755
1.229176ms swizzle 16755
1.582051ms swizzle 16755
1.340261ms swizzle 16755
1.266908ms swizzle 16755
1.2331ms swizzle 16755
1.239138ms swizzle 16755
1.256042ms swizzle 16755
1.234308ms swizzle 16755
1.219215ms swizzle 16755
1.22646ms swizzle 16755
1.221026ms swizzle 16755
1.218913ms swizzle 16755
1.220121ms swizzle 16755
1.221328ms swizzle 16755
1.334525ms swizzle 16755
1.390671ms swizzle 16755
1.246684ms swizzle 16755
1.233704ms swizzle 16755
1.223441ms swizzle 16755
1.227063ms swizzle 16755
1.227365ms swizzle 16755
1.222837ms swizzle 16755
1.225252ms swizzle 16755
1.216196ms swizzle 16755
1.222837ms swizzle 16755
1.223743ms swizzle 16755
1.225856ms swizzle 16755
1.349619ms swizzle 16755
1.402746ms swizzle 16755
1.23461ms swizzle 16755
1.224044ms swizzle 16755
1.227969ms swizzle 16755
1.215894ms swizzle 16755
1.218611ms swizzle 16755
1.22012ms swizzle 16755
1.216196ms swizzle 16755
1.217404ms swizzle 16755
1.215592ms swizzle 16755
1.221629ms swizzle 16755
1.22827ms swizzle 16755
1.298906ms swizzle 16755
1.47489ms swizzle 16755
1.345694ms swizzle 16755
1.249401ms swizzle 16755
1.243666ms swizzle 16755
1.246986ms swizzle 16755
1.282304ms swizzle 16755
1.24276ms swizzle 16755
1.231289ms swizzle 16755
1.240949ms swizzle 16755
1.232195ms swizzle 16755
1.233704ms swizzle 16755
1.231591ms swizzle 16755
1.3466ms swizzle 16755
1.425084ms swizzle 16755
1.482135ms swizzle 16755
1.28502ms swizzle 16755
1.24276ms swizzle 16755
1.234006ms swizzle 16755
1.239741ms swizzle 16755
1.227666ms swizzle 16755
1.23461ms swizzle 16755
1.230686ms swizzle 16755
1.245174ms swizzle 16755
1.238836ms swizzle 16755
1.243967ms swizzle 16755
1.368032ms swizzle 16755
1.379201ms swizzle 16755
1.376484ms swizzle 16755
1.274757ms swizzle 16755
1.294982ms swizzle 16755
1.29951ms swizzle 16755
1.250307ms swizzle 16755
1.239439ms swizzle 16755
1.225855ms swizzle 16755
1.219819ms swizzle 16755
1.231289ms swizzle 16755
1.220422ms swizzle 16755
1.232497ms swizzle 16755
1.310678ms swizzle 16755
1.546431ms swizzle 16755
1.344185ms swizzle 16755
1.242458ms swizzle 16755
1.243061ms swizzle 16755
1.283511ms swizzle 16755
1.248495ms swizzle 16755
1.246383ms swizzle 16755
1.23461ms swizzle 16755
1.230082ms swizzle 16755
1.244571ms swizzle 16755
1.248193ms swizzle 16755
1.625519ms swizzle 16755
2.212034ms swizzle 16755
1.226158ms swizzle 16755
1.237326ms swizzle 16755
1.357467ms swizzle 16755
1.43897ms swizzle 16755
1.234308ms swizzle 16755
1.327583ms swizzle 16755
1.419952ms swizzle 16755
1.23793ms swizzle 16755
1.232798ms swizzle 16755
1.223743ms swizzle 16755
1.230082ms swizzle 16755
1.22646ms swizzle 16755
1.219214ms swizzle 16755
1.217403ms swizzle 16755
1.211366ms swizzle 16755
1.215592ms swizzle 16755
1.222536ms swizzle 16755
1.214083ms swizzle 16755
1.287133ms swizzle 16755
1.419952ms swizzle 16755
1.285021ms swizzle 16755
1.228874ms swizzle 16755
1.23793ms swizzle 16755
1.238836ms swizzle 16755
1.231591ms swizzle 16755
1.250307ms swizzle 16755
1.23642ms swizzle 16755
1.232195ms swizzle 16755
1.23461ms swizzle 16755
1.231591ms swizzle 16755
1.227969ms swizzle 16755
1.253627ms swizzle 16755
1.509605ms swizzle 16755
1.349921ms swizzle 16755
1.239741ms swizzle 16755
1.245477ms swizzle 16755
1.235214ms swizzle 16755
1.331205ms swizzle 16755
1.241854ms swizzle 16755
1.247287ms swizzle 16755
1.228874ms swizzle 16755
1.223139ms swizzle 16755
1.221328ms swizzle 16755
1.233101ms swizzle 16755
1.227365ms swizzle 16755
1.413613ms swizzle 16755
1.332714ms swizzle 16755
1.222535ms swizzle 16755
1.216197ms swizzle 16755
1.216799ms swizzle 16755
1.253325ms swizzle 16755
1.229478ms swizzle 16755
1.219516ms swizzle 16755
1.217706ms swizzle 16755
1.22012ms swizzle 16755
1.223139ms swizzle 16755
1.211668ms swizzle 16755
1.221328ms swizzle 16755
1.380408ms swizzle 16755
1.405463ms swizzle 16755
1.229478ms swizzle 16755
1.222234ms swizzle 16755
1.237628ms swizzle 16755
1.228271ms swizzle 16755
1.225554ms swizzle 16755
1.223139ms swizzle 16755
1.214385ms swizzle 16755
1.214989ms swizzle 16755
1.214385ms swizzle 16755
1.213178ms swizzle 16755
1.22012ms swizzle 16755
1.304339ms swizzle 16755
1.308263ms swizzle 16755
1.312188ms swizzle 16755
1.233704ms swizzle 16755
1.361693ms swizzle 16755
1.332412ms swizzle 16755
1.262079ms swizzle 16755
1.258155ms swizzle 16755
1.247288ms swizzle 16755
1.237326ms swizzle 16755
1.257249ms swizzle 16755
1.234006ms swizzle 16755
1.254533ms swizzle 16755
1.365316ms swizzle 16755
1.483644ms swizzle 16755
1.370145ms swizzle 16755
1.263891ms swizzle 16755
1.248194ms swizzle 16755
1.265098ms swizzle 16755
1.325168ms swizzle 16755
1.251816ms swizzle 16755
1.237628ms swizzle 16755
1.241854ms swizzle 16755
1.238836ms swizzle 16755
1.233402ms swizzle 16755
1.232798ms swizzle 16755
1.443799ms swizzle 16755
88.380542ms swizzle 1103347
81.665051ms swizzle 1103347
81.657202ms swizzle 1103347
81.766778ms swizzle 1103347
81.72331ms swizzle 1103347
82.018832ms swizzle 1103347
82.651531ms swizzle 1103347
81.805718ms swizzle 1103347
83.385957ms swizzle 1103347
82.087958ms swizzle 1103347
82.243114ms swizzle 1103347
82.269376ms swizzle 1103347
85.847328ms swizzle 1103347
82.264546ms swizzle 1103347
82.08192ms swizzle 1103347
82.358726ms swizzle 1103347
82.195419ms swizzle 1103347
82.207494ms swizzle 1103347
83.954663ms swizzle 1103347
89.190132ms swizzle 1103347
87.715242ms swizzle 1103347
85.491134ms swizzle 1103347
86.131983ms swizzle 1103347
86.67654ms swizzle 1103347
91.582679ms swizzle 1103347
86.060443ms swizzle 1103347
91.15464ms swizzle 1103347
91.851033ms swizzle 1103347
81.852506ms swizzle 1103347
82.572444ms swizzle 1103347
81.998909ms swizzle 1103347
82.027283ms swizzle 1103347
81.975363ms swizzle 1103347
82.088561ms swizzle 1103347
82.191797ms swizzle 1103347
82.218663ms swizzle 1103347
82.454416ms swizzle 1103347
81.628525ms swizzle 1103347
81.652675ms swizzle 1103347
82.102144ms swizzle 1103347
81.634563ms swizzle 1103347
81.688596ms swizzle 1103347
81.858845ms swizzle 1103347
82.124482ms swizzle 1103347
81.75742ms swizzle 1103347
81.649052ms swizzle 1103347
81.737195ms swizzle 1103347
81.880277ms swizzle 1103347
82.28809ms swizzle 1103347
81.629733ms swizzle 1103347
81.594717ms swizzle 1103347
81.849186ms swizzle 1103347
81.610716ms swizzle 1103347
81.718782ms swizzle 1103347
81.9814ms swizzle 1103347
81.578417ms swizzle 1103347
81.580228ms swizzle 1103347
81.749873ms swizzle 1103347
81.572077ms swizzle 1103347
81.930085ms swizzle 1103347
81.644826ms swizzle 1103347
82.019133ms swizzle 1103347
81.461899ms swizzle 1103347
81.735686ms swizzle 1103347
81.722103ms swizzle 1103347
82.159196ms swizzle 1103347
82.028189ms swizzle 1103347
81.702481ms swizzle 1103347
82.734241ms swizzle 1103347
82.0786ms swizzle 1103347
81.641204ms swizzle 1103347
81.879975ms swizzle 1103347
81.801492ms swizzle 1103347
84.123705ms swizzle 1103347
83.914516ms swizzle 1103347
82.333672ms swizzle 1103347
82.105767ms swizzle 1103347
82.311334ms swizzle 1103347
82.467396ms swizzle 1103347
83.748794ms swizzle 1103347
81.613735ms swizzle 1103347
81.842545ms swizzle 1103347
81.998607ms swizzle 1103347
82.057168ms swizzle 1103347
81.615244ms swizzle 1103347
82.031811ms swizzle 1103347
82.063507ms swizzle 1103347
82.002833ms swizzle 1103347
81.949102ms swizzle 1103347
81.850092ms swizzle 1103347
81.815981ms swizzle 1103347
83.318039ms swizzle 1103347
81.687388ms swizzle 1103347
81.625205ms swizzle 1103347
81.66988ms swizzle 1103347
81.753797ms swizzle 1103347
81.831678ms swizzle 1103347
81.834697ms swizzle 1103347
82.276016ms swizzle 1103347
81.662334ms swizzle 1103347
Benchmark 2: labcopy 16755
  Time (mean ± σ): 2.471482 ms ± 303.868848 µs
  Range (min … max): 2.353305 ms … 7.248577 ms 300 runs
Benchmark 1: swizzle 16755
  Time (mean ± σ): 1.291316 ms ± 233.847756 µs
  Range (min … max): 1.209555 ms … 4.988246 ms 300 runs
Summary
  'swizzle 16755' ran
    1.913925 ± -0.421233 times faster than 'labcopy 16755'
Benchmark 2: labcopy 1103347
  Time (mean ± σ): 162.518528 ms ± 4.485960 ms
  Range (min … max): 159.818859 ms … 189.564802 ms 100 runs
Benchmark 1: swizzle 1103347
  Time (mean ± σ): 82.727102 ms ± 2.128016 ms
  Range (min … max): 81.461899 ms … 91.851033 ms 100 runs
Summary
  'swizzle 1103347' ran
    1.964514 ± -0.862381 times faster than 'labcopy 1103347'
-->
<!--
1.375276ms: conv 16755
1.371956ms: conv 16755
1.546432ms: conv 16755
1.37256ms: conv 16755
1.429008ms: conv 16755
1.36924ms: conv 16755
1.622198ms: conv 16755
1.379503ms: conv 16755
1.396709ms: conv 16755
1.438668ms: conv 16755
1.443799ms: conv 16755
1.415726ms: conv 16755
1.374974ms: conv 16755
1.565449ms: conv 16755
1.387049ms: conv 16755
1.36441ms: conv 16755
1.457081ms: conv 16755
1.380408ms: conv 16755
1.375276ms: conv 16755
1.467042ms: conv 16755
1.371654ms: conv 16755
1.424178ms: conv 16755
1.381314ms: conv 16755
1.378296ms: conv 16755
1.451346ms: conv 16755
1.547639ms: conv 16755
1.38403ms: conv 16755
1.403651ms: conv 16755
1.377088ms: conv 16755
1.378598ms: conv 16755
1.403954ms: conv 16755
1.384635ms: conv 16755
1.383729ms: conv 16755
1.403651ms: conv 16755
1.377994ms: conv 16755
1.555186ms: conv 16755
1.371956ms: conv 16755
1.553375ms: conv 16755
1.367127ms: conv 16755
1.556091ms: conv 16755
1.365618ms: conv 16755
1.361089ms: conv 16755
1.370447ms: conv 16755
1.397614ms: conv 16755
1.382823ms: conv 16755
1.361693ms: conv 16755
1.365315ms: conv 16755
1.373163ms: conv 16755
1.38071ms: conv 16755
1.37256ms: conv 16755
1.371353ms: conv 16755
1.371654ms: conv 16755
1.363504ms: conv 16755
1.373163ms: conv 16755
1.389464ms: conv 16755
1.38222ms: conv 16755
1.380409ms: conv 16755
1.363504ms: conv 16755
1.378899ms: conv 16755
1.393992ms: conv 16755
1.377993ms: conv 16755
1.553374ms: conv 16755
1.386144ms: conv 16755
1.372861ms: conv 16755
1.365315ms: conv 16755
1.382522ms: conv 16755
1.392785ms: conv 16755
1.372258ms: conv 16755
1.371956ms: conv 16755
1.382823ms: conv 16755
1.374371ms: conv 16755
1.367126ms: conv 16755
1.404557ms: conv 16755
1.370749ms: conv 16755
1.478815ms: conv 16755
1.395803ms: conv 16755
1.415726ms: conv 16755
1.375578ms: conv 16755
1.552469ms: conv 16755
1.393389ms: conv 16755
1.392483ms: conv 16755
1.407576ms: conv 16755
1.401236ms: conv 16755
1.558204ms: conv 16755
1.371352ms: conv 16755
1.392181ms: conv 16755
1.369843ms: conv 16755
1.37256ms: conv 16755
1.477608ms: conv 16755
1.368938ms: conv 16755
1.371655ms: conv 16755
1.368938ms: conv 16755
1.406066ms: conv 16755
1.414519ms: conv 16755
1.37588ms: conv 16755
1.372258ms: conv 16755
1.400331ms: conv 16755
1.374975ms: conv 16755
1.377088ms: conv 16755
1.382521ms: conv 16755
53.556702ms: conv 1103347
53.441995ms: conv 1103347
53.38766ms: conv 1103347
53.531346ms: conv 1103347
53.634582ms: conv 1103347
56.343176ms: conv 1103347
54.586952ms: conv 1103347
54.735467ms: conv 1103347
53.525006ms: conv 1103347
56.184398ms: conv 1103347
53.813585ms: conv 1103347
53.445014ms: conv 1103347
53.531648ms: conv 1103347
53.315214ms: conv 1103347
53.422072ms: conv 1103347
53.512329ms: conv 1103347
53.386151ms: conv 1103347
54.13718ms: conv 1103347
53.760156ms: conv 1103347
56.73137ms: conv 1103347
53.993494ms: conv 1103347
53.707029ms: conv 1103347
53.253936ms: conv 1103347
54.918395ms: conv 1103347
55.62988ms: conv 1103347
54.26698ms: conv 1103347
53.155228ms: conv 1103347
53.161567ms: conv 1103347
54.087675ms: conv 1103347
53.315515ms: conv 1103347
53.398829ms: conv 1103347
53.501461ms: conv 1103347
53.372869ms: conv 1103347
53.839545ms: conv 1103347
53.39732ms: conv 1103347
53.203827ms: conv 1103347
53.426299ms: conv 1103347
53.140135ms: conv 1103347
53.090629ms: conv 1103347
53.102402ms: conv 1103347
53.059236ms: conv 1103347
53.275972ms: conv 1103347
53.176659ms: conv 1103347
56.470864ms: conv 1103347
53.023012ms: conv 1103347
54.104579ms: conv 1103347
54.614723ms: conv 1103347
53.764986ms: conv 1103347
55.222067ms: conv 1103347
54.551635ms: conv 1103347
53.271443ms: conv 1103347
53.308874ms: conv 1103347
55.179806ms: conv 1103347
54.832364ms: conv 1103347
53.928897ms: conv 1103347
53.841658ms: conv 1103347
54.122389ms: conv 1103347
54.168573ms: conv 1103347
54.028812ms: conv 1103347
53.373171ms: conv 1103347
54.095825ms: conv 1103347
55.723759ms: conv 1103347
53.454673ms: conv 1103347
53.773438ms: conv 1103347
53.846489ms: conv 1103347
54.112729ms: conv 1103347
53.229183ms: conv 1103347
53.415129ms: conv 1103347
53.237635ms: conv 1103347
53.920746ms: conv 1103347
53.250917ms: conv 1103347
53.413922ms: conv 1103347
53.352946ms: conv 1103347
53.179678ms: conv 1103347
53.102402ms: conv 1103347
53.618584ms: conv 1103347
53.102402ms: conv 1103347
54.857721ms: conv 1103347
54.519335ms: conv 1103347
54.372933ms: conv 1103347
54.617138ms: conv 1103347
54.453832ms: conv 1103347
54.316787ms: conv 1103347
54.053867ms: conv 1103347
54.710413ms: conv 1103347
54.230153ms: conv 1103347
53.645751ms: conv 1103347
53.207449ms: conv 1103347
53.831395ms: conv 1103347
53.865506ms: conv 1103347
54.172195ms: conv 1103347
53.083083ms: conv 1103347
53.140739ms: conv 1103347
53.425996ms: conv 1103347
53.050482ms: conv 1103347
53.269029ms: conv 1103347
53.144361ms: conv 1103347
54.270904ms: conv 1103347
53.184508ms: conv 1103347
53.131682ms: conv 1103347
Benchmark 1: conv 16755
  Time (mean ± σ): 1.405303 ms ± 57.660435 µs
  Range (min … max): 1.361089 ms … 1.622198 ms 100 runs
Benchmark 2: conv 1103347
  Time (mean ± σ): 53.866505 ms ± 797.242550 µs
  Range (min … max): 53.023012 ms … 56.731370 ms 100 runs
-->
<table class="perf ">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal">1'103'347</span>, [​[​palette​]​]</th> <th>±σ</th></tr>
 <tr><th><samp>outputs[…].l = buffer_outputs_map[…][0]</samp></th> <td><span class="roboto-unscale math-font-normal">2.471ms</span></td> <td><span class="roboto-unscale math-font-normal">162.519ms</span></td> <td><span class="roboto-unscale math-font-normal">303µs</span>/<span class="roboto-unscale math-font-normal">234µs</span></td></tr>
 <tr><th><samp>RgbStuffedInLab</samp> </th> <td><span class="roboto-unscale math-font-normal">1.405ms</span></td> <td><span class="roboto-unscale math-font-normal">53.867ms</span></td> <td><span class="roboto-unscale math-font-normal">57.66µs</span>/<span class="roboto-unscale math-font-normal">797.24ms</span></td></tr>
 <tr class="spc"></tr>
 <tr><th><samp>outputs[…][0] = out >> 16</samp> </th> <td><span class="roboto-unscale math-font-normal">1.2913ms</span></td> <td><span class="roboto-unscale math-font-normal">82.727ms</span></td> <td><span class="roboto-unscale math-font-normal">4.49ms</span>/<span class="roboto-unscale math-font-normal">2.12ms</span></td></tr>
 <tr><th>(speed-up) </th> <td><span class="roboto-unscale math-font-normal">66.69%</span></td> <td><span class="roboto-unscale math-font-normal">61.77%</span></td> <td></td></tr>
</table>
<p class="continuation">
For <span class="roboto-unscale math-font-normal"><!--'-->16'755</span> this is <span class="roboto-unscale math-font-normal">~16% → ~12%</span> of overall runtime; for <span class="roboto-unscale math-font-normal">1'103'347</span> — <span class="roboto-unscale math-font-normal">~0.75% → ~0.22%</span>.
Not meaningless.
</p>
<div class="singles">
<figure> <a href="/content/assets/blogn_t/018.31-graphml-expand_rgb.png"><img alt="" src="/content/assets/blogn_t/018.31-graphml-expand_rgb.png" /></a> <figcaption></figcaption> </figure>
</div>
<p class="indented continued">
<em>Most</em> of this is fixed per image and running it each time is wasteful, so it's<!--'--> time for
</p>
<h2 id="GAAP" class="continuing"><a class="hash-link" href="#GAAP">#</a> our very own Enron scandal.</h2>
<p class="indented continued">
It also makes more sense to <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/add3092271e3c2f07cd063d17e03c996cb5097ec/item/src/main.rs#L159">
 split <samp>known_rgbs</samp> first</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> known_rgbs_rgbs<span class="token punctuation">:</span><!--"-->  <!--"--><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> freq<span class="token punctuation">)</span> <span class="token keyword">in</span> frequencies<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span><span class="token string">_</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> f <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"-->known_rgbs_rgbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>rgb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

posterise_gpu<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>known_rgbs_rgbs<span class="token punctuation">,</span> <span class="token operator">&amp;</span>known_rgbs_freqs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="indented continued">
And the analysis pre-computation step
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/add3092271e3c2f07cd063d17e03c996cb5097ec/item/src/posterise_gpu.rs#L470">enforced</a> thusly:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->use_oneshot_driver<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span>known_rgbs_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs <span class="token operator">=</span> known_rgbs_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>use_oneshot_driver <span class="token operator">=</span> known_rgbs <span class="token operator">></span> <span class="token number">50_000</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// everything previously in susmit()...</span>
<small style='display: block; line-height: initial;'>
</small><!--"-->	<!--"--><span class="token comment">// No longer predicated on freq_weighting (must accommodate either):</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">ensure_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">,</span> buffer_known_rgbs_freqs_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> bundle<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_bundle<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->bundle<span class="token punctuation">.</span>rgb <span class="token operator">=</span> rgb<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
</small><!--"-->	<!--"--><span class="token comment">// No longer predicated on freq_weighting (must accommodate either):</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_freqs_out <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span>known_rgbs_freqs_buffer_map <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>use_oneshot_driver <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> freq<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs_rgbs<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>known_rgbs_freqs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->known_rgbs_freqs_out<span class="token punctuation">[</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> freq<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</small><!--"-->		<!--"--><span class="token comment">// memcpy(known_rgbs_freqs_buffer_map, known_rgbs_freqs, known_rgbs * sizeof(u32))</span>
<!--"-->		<!--"--><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy_nonoverlapping</span><span class="token punctuation">(</span>known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> known_rgbs_freqs_buffer_map<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token punctuation">}</span>

</small><!--"-->	<!--"--><span class="token comment">// ...up to and including assign_cell.hlsl</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">susmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radiussy<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> freq_weighting<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> outputs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">0xFFFFFF</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>radiussy_squared <span class="token operator">=</span> radiussy <span class="token operator">*</span> radiussy<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>grid_bothdirs <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>
</small><!--"-->	<!--"--><span class="token comment">// posterise_grid.kernel.hlsl.inc/posterise_grid_oneshot.kernel.hlsl.inc</span>
<small style='display: block; line-height: initial;'>
</small><!--"-->	<!--"--><span class="token comment">// for rgb in known_rgbs_rgbs { outputs[rgb] = ...; }</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
copying the frequency data is simplified by the new layout, but must happen every time.
Doesn't<!--'--> really matter
</p>
<!--
16.300168ms: 16755 known_rgbs
13.194627ms: 16755 measurement overall
18.371836ms: 16755 known_rgbs
9.125848ms: 16755 measurement overall
14.659858ms: 16755 known_rgbs
8.370593ms: 16755 measurement overall
14.72355ms: 16755 known_rgbs
8.307203ms: 16755 measurement overall
14.832824ms: 16755 known_rgbs
8.227813ms: 16755 measurement overall
17.305967ms: 16755 known_rgbs
9.304549ms: 16755 measurement overall
14.752528ms: 16755 known_rgbs
7.852601ms: 16755 measurement overall
14.088134ms: 16755 known_rgbs
7.94497ms: 16755 measurement overall
14.338376ms: 16755 known_rgbs
7.295969ms: 16755 measurement overall
14.010254ms: 16755 known_rgbs
7.841432ms: 16755 measurement overall
13.9366ms: 16755 known_rgbs
7.594208ms: 16755 measurement overall
14.53036ms: 16755 known_rgbs
7.671182ms: 16755 measurement overall
14.019309ms: 16755 known_rgbs
7.491273ms: 16755 measurement overall
13.972521ms: 16755 known_rgbs
7.539269ms: 16755 measurement overall
14.090549ms: 16755 known_rgbs
7.531119ms: 16755 measurement overall
14.237857ms: 16755 known_rgbs
7.557079ms: 16755 measurement overall
14.095982ms: 16755 known_rgbs
7.614432ms: 16755 measurement overall
14.719324ms: 16755 known_rgbs
7.701972ms: 16755 measurement overall
15.765573ms: 16755 known_rgbs
8.335275ms: 16755 measurement overall
14.298229ms: 16755 known_rgbs
7.732762ms: 16755 measurement overall
14.128583ms: 16755 known_rgbs
8.591856ms: 16755 measurement overall
14.702722ms: 16755 known_rgbs
7.82815ms: 16755 measurement overall
14.706948ms: 16755 known_rgbs
7.577001ms: 16755 measurement overall
13.978257ms: 16755 known_rgbs
7.783173ms: 16755 measurement overall
13.983991ms: 16755 known_rgbs
8.07477ms: 16755 measurement overall
14.318454ms: 16755 known_rgbs
8.153555ms: 16755 measurement overall
14.546961ms: 16755 known_rgbs
7.693218ms: 16755 measurement overall
14.546357ms: 16755 known_rgbs
7.643109ms: 16755 measurement overall
13.928449ms: 16755 known_rgbs
7.75359ms: 16755 measurement overall
14.143978ms: 16755 known_rgbs
7.447202ms: 16755 measurement overall
14.161485ms: 16755 known_rgbs
7.369321ms: 16755 measurement overall
14.028969ms: 16755 known_rgbs
7.360869ms: 16755 measurement overall
14.012669ms: 16755 known_rgbs
7.917803ms: 16755 measurement overall
14.807165ms: 16755 known_rgbs
7.466218ms: 16755 measurement overall
14.236045ms: 16755 known_rgbs
7.982401ms: 16755 measurement overall
14.255365ms: 16755 known_rgbs
7.757515ms: 16755 measurement overall
14.615484ms: 16755 known_rgbs
7.389848ms: 16755 measurement overall
13.934185ms: 16755 known_rgbs
7.415507ms: 16755 measurement overall
13.984897ms: 16755 known_rgbs
7.550739ms: 16755 measurement overall
13.99999ms: 16755 known_rgbs
7.574587ms: 16755 measurement overall
14.189257ms: 16755 known_rgbs
7.471954ms: 16755 measurement overall
14.011461ms: 16755 known_rgbs
7.563116ms: 16755 measurement overall
14.194992ms: 16755 known_rgbs
7.538665ms: 16755 measurement overall
13.956824ms: 16755 known_rgbs
7.456258ms: 16755 measurement overall
13.919998ms: 16755 known_rgbs
7.537458ms: 16755 measurement overall
13.97403ms: 16755 known_rgbs
7.616545ms: 16755 measurement overall
14.056741ms: 16755 known_rgbs
7.446296ms: 16755 measurement overall
14.287362ms: 16755 known_rgbs
8.114012ms: 16755 measurement overall
14.891384ms: 16755 known_rgbs
7.973344ms: 16755 measurement overall
14.218537ms: 16755 known_rgbs
7.676918ms: 16755 measurement overall
13.932977ms: 16755 known_rgbs
7.568247ms: 16755 measurement overall
14.274683ms: 16755 known_rgbs
7.494594ms: 16755 measurement overall
14.185936ms: 16755 known_rgbs
7.475577ms: 16755 measurement overall
14.13945ms: 16755 known_rgbs
7.51663ms: 16755 measurement overall
13.926034ms: 16755 known_rgbs
7.485236ms: 16755 measurement overall
14.008442ms: 16755 known_rgbs
7.254614ms: 16755 measurement overall
14.237555ms: 16755 known_rgbs
7.784983ms: 16755 measurement overall
14.191671ms: 16755 known_rgbs
9.249611ms: 16755 measurement overall
14.609748ms: 16755 known_rgbs
7.533232ms: 16755 measurement overall
16.129013ms: 16755 known_rgbs
8.625967ms: 16755 measurement overall
14.135224ms: 16755 known_rgbs
7.961874ms: 16755 measurement overall
14.319962ms: 16755 known_rgbs
7.765966ms: 16755 measurement overall
14.24329ms: 16755 known_rgbs
7.595717ms: 16755 measurement overall
14.083908ms: 16755 known_rgbs
7.814868ms: 16755 measurement overall
14.528548ms: 16755 known_rgbs
8.206079ms: 16755 measurement overall
14.371883ms: 16755 known_rgbs
7.829357ms: 16755 measurement overall
14.114999ms: 16755 known_rgbs
7.822415ms: 16755 measurement overall
14.114395ms: 16755 known_rgbs
7.830866ms: 16755 measurement overall
14.243893ms: 16755 known_rgbs
8.269168ms: 16755 measurement overall
14.638727ms: 16755 known_rgbs
7.962176ms: 16755 measurement overall
14.262006ms: 16755 known_rgbs
7.831168ms: 16755 measurement overall
16.582709ms: 16755 known_rgbs
7.976967ms: 16755 measurement overall
14.652009ms: 16755 known_rgbs
8.245924ms: 16755 measurement overall
14.360714ms: 16755 known_rgbs
8.305391ms: 16755 measurement overall
18.037979ms: 16755 known_rgbs
9.189239ms: 16755 measurement overall
14.19952ms: 16755 known_rgbs
7.723706ms: 16755 measurement overall
14.41535ms: 16755 known_rgbs
7.882786ms: 16755 measurement overall
14.554206ms: 16755 known_rgbs
8.445152ms: 16755 measurement overall
14.352564ms: 16755 known_rgbs
7.543495ms: 16755 measurement overall
17.623222ms: 16755 known_rgbs
9.504683ms: 16755 measurement overall
14.232724ms: 16755 known_rgbs
8.262225ms: 16755 measurement overall
14.411125ms: 16755 known_rgbs
8.418588ms: 16755 measurement overall
14.795091ms: 16755 known_rgbs
8.296939ms: 16755 measurement overall
14.656537ms: 16755 known_rgbs
8.620836ms: 16755 measurement overall
18.26528ms: 16755 known_rgbs
7.964892ms: 16755 measurement overall
17.243784ms: 16755 known_rgbs
8.247434ms: 16755 measurement overall
14.262307ms: 16755 known_rgbs
8.466283ms: 16755 measurement overall
14.06157ms: 16755 known_rgbs
7.919915ms: 16755 measurement overall
14.223669ms: 16755 known_rgbs
7.807925ms: 16755 measurement overall
14.059155ms: 16755 known_rgbs
7.711329ms: 16755 measurement overall
14.752529ms: 16755 known_rgbs
7.763249ms: 16755 measurement overall
14.758264ms: 16755 known_rgbs
7.839922ms: 16755 measurement overall
14.297927ms: 16755 known_rgbs
7.917198ms: 16755 measurement overall
14.300342ms: 16755 known_rgbs
8.278224ms: 16755 measurement overall
15.464014ms: 16755 known_rgbs
8.104956ms: 16755 measurement overall
14.004216ms: 16755 known_rgbs
8.132123ms: 16755 measurement overall
14.657443ms: 16755 known_rgbs
8.339804ms: 16755 measurement overall
14.722343ms: 16755 known_rgbs
8.312032ms: 16755 measurement overall
14.119829ms: 16755 known_rgbs
8.532089ms: 16755 measurement overall
14.642048ms: 16755 known_rgbs
8.355198ms: 16755 measurement overall
14.675856ms: 16755 known_rgbs
8.320786ms: 16755 measurement overall
14.220348ms: 16755 known_rgbs
8.99967ms: 16755 measurement overall
16.935282ms: 16755 known_rgbs
9.75885ms: 16755 measurement overall
14.332942ms: 16755 known_rgbs
7.824225ms: 16755 measurement overall
15.253014ms: 16755 known_rgbs
9.761566ms: 16755 measurement overall
14.837653ms: 16755 known_rgbs
7.844752ms: 16755 measurement overall
14.761282ms: 16755 known_rgbs
8.791085ms: 16755 measurement overall
19.405709ms: 16755 known_rgbs
9.859671ms: 16755 measurement overall
15.583551ms: 16755 known_rgbs
7.565229ms: 16755 measurement overall
34.29649ms: 1103347 known_rgbs
225.190384ms: 1103347 measurement overall
27.403806ms: 1103347 known_rgbs
135.438488ms: 1103347 measurement overall
28.524916ms: 1103347 known_rgbs
133.089712ms: 1103347 measurement overall
27.50825ms: 1103347 known_rgbs
144.567356ms: 1103347 measurement overall
30.383773ms: 1103347 known_rgbs
150.055482ms: 1103347 measurement overall
27.210917ms: 1103347 known_rgbs
142.859127ms: 1103347 measurement overall
27.732532ms: 1103347 known_rgbs
138.282015ms: 1103347 measurement overall
28.078163ms: 1103347 known_rgbs
127.157247ms: 1103347 measurement overall
27.270384ms: 1103347 known_rgbs
129.270572ms: 1103347 measurement overall
27.190692ms: 1103347 known_rgbs
127.576832ms: 1103347 measurement overall
26.97124ms: 1103347 known_rgbs
127.995815ms: 1103347 measurement overall
27.104059ms: 1103347 known_rgbs
219.094612ms: 1103347 measurement overall
35.296554ms: 1103347 known_rgbs
163.295689ms: 1103347 measurement overall
28.388475ms: 1103347 known_rgbs
138.407589ms: 1103347 measurement overall
27.547491ms: 1103347 known_rgbs
130.40919ms: 1103347 measurement overall
27.712307ms: 1103347 known_rgbs
255.287087ms: 1103347 measurement overall
35.432693ms: 1103347 known_rgbs
196.029748ms: 1103347 measurement overall
28.238752ms: 1103347 known_rgbs
136.891042ms: 1103347 measurement overall
28.123744ms: 1103347 known_rgbs
133.185703ms: 1103347 measurement overall
27.193107ms: 1103347 known_rgbs
134.061401ms: 1103347 measurement overall
27.592771ms: 1103347 known_rgbs
134.537737ms: 1103347 measurement overall
27.300268ms: 1103347 known_rgbs
133.92496ms: 1103347 measurement overall
27.533304ms: 1103347 known_rgbs
133.635778ms: 1103347 measurement overall
27.169864ms: 1103347 known_rgbs
132.489009ms: 1103347 measurement overall
27.369998ms: 1103347 known_rgbs
132.160585ms: 1103347 measurement overall
27.393543ms: 1103347 known_rgbs
139.213556ms: 1103347 measurement overall
27.148432ms: 1103347 known_rgbs
133.124124ms: 1103347 measurement overall
27.28759ms: 1103347 known_rgbs
138.358084ms: 1103347 measurement overall
28.722936ms: 1103347 known_rgbs
128.994067ms: 1103347 measurement overall
26.915094ms: 1103347 known_rgbs
128.618855ms: 1103347 measurement overall
27.503119ms: 1103347 known_rgbs
129.660878ms: 1103347 measurement overall
27.481082ms: 1103347 known_rgbs
135.711371ms: 1103347 measurement overall
26.978183ms: 1103347 known_rgbs
134.767755ms: 1103347 measurement overall
27.941118ms: 1103347 known_rgbs
134.178221ms: 1103347 measurement overall
27.734344ms: 1103347 known_rgbs
143.381345ms: 1103347 measurement overall
27.138168ms: 1103347 known_rgbs
128.252396ms: 1103347 measurement overall
27.260121ms: 1103347 known_rgbs
128.697942ms: 1103347 measurement overall
26.940148ms: 1103347 known_rgbs
127.567475ms: 1103347 measurement overall
27.132132ms: 1103347 known_rgbs
129.890292ms: 1103347 measurement overall
26.992068ms: 1103347 known_rgbs
128.239115ms: 1103347 measurement overall
27.210012ms: 1103347 known_rgbs
128.421136ms: 1103347 measurement overall
27.552321ms: 1103347 known_rgbs
129.298041ms: 1103347 measurement overall
26.912679ms: 1103347 known_rgbs
127.248408ms: 1103347 measurement overall
27.393845ms: 1103347 known_rgbs
128.968108ms: 1103347 measurement overall
27.024368ms: 1103347 known_rgbs
127.604604ms: 1103347 measurement overall
15.056503ms: 16755 known_rgbs
13.806196ms: 16755 measurement overall
14.898025ms: 27868 known_rgbs
15.33361ms: 27868 measurement overall
15.895071ms: 27868 known_rgbs
10.579005ms: 27868 measurement overall
14.024139ms: 27868 known_rgbs
9.381222ms: 27868 measurement overall
14.090549ms: 27868 known_rgbs
9.068192ms: 27868 measurement overall
15.006695ms: 27868 known_rgbs
10.543083ms: 27868 measurement overall
16.121466ms: 27868 known_rgbs
12.583962ms: 27868 measurement overall
14.332641ms: 27868 known_rgbs
9.480233ms: 27868 measurement overall
14.024743ms: 27868 known_rgbs
8.678792ms: 27868 measurement overall
14.097793ms: 27868 known_rgbs
9.370958ms: 27868 measurement overall
14.064588ms: 27868 known_rgbs
9.129471ms: 27868 measurement overall
14.011461ms: 27868 known_rgbs
8.547182ms: 27868 measurement overall
14.048288ms: 27868 known_rgbs
9.519776ms: 27868 measurement overall
14.157562ms: 27868 known_rgbs
9.148789ms: 27868 measurement overall
14.327207ms: 27868 known_rgbs
8.937487ms: 27868 measurement overall
14.290682ms: 27868 known_rgbs
9.253837ms: 27868 measurement overall
14.080587ms: 27868 known_rgbs
9.112566ms: 27868 measurement overall
14.746491ms: 27868 known_rgbs
9.312096ms: 27868 measurement overall
14.06972ms: 27868 known_rgbs
8.63291ms: 27868 measurement overall
14.109264ms: 27868 known_rgbs
9.566866ms: 27868 measurement overall
14.076663ms: 27868 known_rgbs
8.993332ms: 27868 measurement overall
14.026554ms: 27868 known_rgbs
8.629589ms: 27868 measurement overall
14.107754ms: 27868 known_rgbs
10.93037ms: 27868 measurement overall
14.124659ms: 27868 known_rgbs
9.110454ms: 27868 measurement overall
14.095076ms: 27868 known_rgbs
8.695999ms: 27868 measurement overall
14.096888ms: 27868 known_rgbs
8.565595ms: 27868 measurement overall
14.133715ms: 27868 known_rgbs
9.27044ms: 27868 measurement overall
14.08602ms: 27868 known_rgbs
8.718638ms: 27868 measurement overall
14.021724ms: 27868 known_rgbs
8.554728ms: 27868 measurement overall
14.4721ms: 27868 known_rgbs
9.207351ms: 27868 measurement overall
14.116206ms: 27868 known_rgbs
8.546275ms: 27868 measurement overall
14.280116ms: 27868 known_rgbs
8.718034ms: 27868 measurement overall
15.316706ms: 27868 known_rgbs
10.003659ms: 27868 measurement overall
14.215217ms: 27868 known_rgbs
9.2155ms: 27868 measurement overall
15.826549ms: 27868 known_rgbs
9.399938ms: 27868 measurement overall
14.017801ms: 27868 known_rgbs
8.60212ms: 27868 measurement overall
13.983086ms: 27868 known_rgbs
9.800205ms: 27868 measurement overall
15.94035ms: 27868 known_rgbs
10.875734ms: 27868 measurement overall
14.116508ms: 27868 known_rgbs
9.009028ms: 27868 measurement overall
14.041647ms: 27868 known_rgbs
8.957712ms: 27868 measurement overall
14.16058ms: 27868 known_rgbs
9.367035ms: 27868 measurement overall
14.01931ms: 27868 known_rgbs
9.193163ms: 27868 measurement overall
14.187445ms: 27868 known_rgbs
8.755465ms: 27868 measurement overall
14.285249ms: 27868 known_rgbs
9.588601ms: 27868 measurement overall
14.09568ms: 27868 known_rgbs
9.128565ms: 27868 measurement overall
14.025347ms: 27868 known_rgbs
8.661889ms: 27868 measurement overall
14.067607ms: 27868 known_rgbs
8.996652ms: 27868 measurement overall
14.113188ms: 27868 known_rgbs
9.159354ms: 27868 measurement overall
13.995161ms: 27868 known_rgbs
8.694791ms: 27868 measurement overall
14.242988ms: 27868 known_rgbs
8.62808ms: 27868 measurement overall
14.602806ms: 27868 known_rgbs
9.546642ms: 27868 measurement overall
14.076361ms: 27868 known_rgbs
9.923666ms: 27868 measurement overall
14.342904ms: 27868 known_rgbs
8.934468ms: 27868 measurement overall
14.102925ms: 27868 known_rgbs
8.712903ms: 27868 measurement overall
14.668008ms: 27868 known_rgbs
9.475403ms: 27868 measurement overall
14.06821ms: 27868 known_rgbs
8.610874ms: 27868 measurement overall
14.128582ms: 27868 known_rgbs
8.603931ms: 27868 measurement overall
14.370675ms: 27868 known_rgbs
9.359488ms: 27868 measurement overall
14.150921ms: 27868 known_rgbs
9.233311ms: 27868 measurement overall
14.024441ms: 27868 known_rgbs
8.734939ms: 27868 measurement overall
14.106849ms: 27868 known_rgbs
8.81463ms: 27868 measurement overall
14.026856ms: 27868 known_rgbs
9.054609ms: 27868 measurement overall
15.428092ms: 27868 known_rgbs
8.994237ms: 27868 measurement overall
14.248422ms: 27868 known_rgbs
9.092644ms: 27868 measurement overall
14.17024ms: 27868 known_rgbs
9.233612ms: 27868 measurement overall
14.403276ms: 27868 known_rgbs
9.461215ms: 27868 measurement overall
14.164504ms: 27868 known_rgbs
8.822479ms: 27868 measurement overall
14.012065ms: 27868 known_rgbs
10.219187ms: 27868 measurement overall
14.332037ms: 27868 known_rgbs
9.858464ms: 27868 measurement overall
14.044364ms: 27868 known_rgbs
9.101398ms: 27868 measurement overall
14.411125ms: 27868 known_rgbs
8.516995ms: 27868 measurement overall
14.024139ms: 27868 known_rgbs
9.289759ms: 27868 measurement overall
14.656537ms: 27868 known_rgbs
9.159958ms: 27868 measurement overall
14.755849ms: 27868 known_rgbs
8.833043ms: 27868 measurement overall
14.190464ms: 27868 known_rgbs
8.938996ms: 27868 measurement overall
14.774866ms: 27868 known_rgbs
9.279194ms: 27868 measurement overall
14.119527ms: 27868 known_rgbs
9.188333ms: 27868 measurement overall
14.596164ms: 27868 known_rgbs
8.820969ms: 27868 measurement overall
15.151588ms: 84860 known_rgbs
59.822421ms: 84860 measurement overall
14.779998ms: 84860 known_rgbs
16.095506ms: 84860 measurement overall
14.760377ms: 84860 known_rgbs
16.364464ms: 84860 measurement overall
14.810788ms: 84860 known_rgbs
15.982007ms: 84860 measurement overall
15.294067ms: 84860 known_rgbs
16.171877ms: 84860 measurement overall
15.011827ms: 84860 known_rgbs
16.416987ms: 84860 measurement overall
14.703023ms: 84860 known_rgbs
16.390424ms: 84860 measurement overall
14.766716ms: 84860 known_rgbs
16.000722ms: 84860 measurement overall
15.049559ms: 84860 known_rgbs
16.825405ms: 84860 measurement overall
14.741058ms: 84860 known_rgbs
16.023362ms: 84860 measurement overall
14.82739ms: 84860 known_rgbs
16.546486ms: 84860 measurement overall
14.738945ms: 84860 known_rgbs
15.893562ms: 84860 measurement overall
15.274747ms: 84860 known_rgbs
16.13837ms: 84860 measurement overall
15.232487ms: 84860 known_rgbs
16.231042ms: 84860 measurement overall
15.195358ms: 84860 known_rgbs
16.354805ms: 84860 measurement overall
15.308556ms: 84860 known_rgbs
16.374124ms: 84860 measurement overall
14.894403ms: 84860 known_rgbs
16.095506ms: 84860 measurement overall
15.356552ms: 84860 known_rgbs
16.213835ms: 84860 measurement overall
14.794488ms: 84860 known_rgbs
16.374727ms: 84860 measurement overall
14.885951ms: 84860 known_rgbs
16.468002ms: 84860 measurement overall
14.742869ms: 84860 known_rgbs
15.944878ms: 84860 measurement overall
14.702118ms: 84860 known_rgbs
16.070452ms: 84860 measurement overall
14.779092ms: 84860 known_rgbs
16.173085ms: 84860 measurement overall
15.354137ms: 84860 known_rgbs
16.880646ms: 84860 measurement overall
15.278068ms: 84860 known_rgbs
16.302582ms: 84860 measurement overall
15.344477ms: 84860 known_rgbs
17.243482ms: 84860 measurement overall
16.186668ms: 84860 known_rgbs
15.791533ms: 84860 measurement overall
14.91674ms: 84860 known_rgbs
16.404309ms: 84860 measurement overall
14.868745ms: 84860 known_rgbs
16.034531ms: 84860 measurement overall
15.020883ms: 84860 known_rgbs
16.394348ms: 84860 measurement overall
15.222223ms: 84860 known_rgbs
16.399178ms: 84860 measurement overall
15.176944ms: 84860 known_rgbs
17.64707ms: 84860 measurement overall
15.217997ms: 84860 known_rgbs
16.941621ms: 84860 measurement overall
15.117176ms: 84860 known_rgbs
17.287554ms: 84860 measurement overall
15.544309ms: 84860 known_rgbs
18.191927ms: 84860 measurement overall
15.819907ms: 84860 known_rgbs
17.303854ms: 84860 measurement overall
18.49258ms: 84860 known_rgbs
18.493789ms: 84860 measurement overall
19.680704ms: 84860 known_rgbs
18.381496ms: 84860 measurement overall
15.416924ms: 84860 known_rgbs
18.9825ms: 84860 measurement overall
15.248184ms: 84860 known_rgbs
18.076316ms: 84860 measurement overall
15.385832ms: 84860 known_rgbs
18.548425ms: 84860 measurement overall
16.139276ms: 84860 known_rgbs
19.657461ms: 84860 measurement overall
19.509247ms: 84860 known_rgbs
17.956476ms: 84860 measurement overall
20.934029ms: 84860 known_rgbs
17.193675ms: 84860 measurement overall
14.916439ms: 84860 known_rgbs
17.741552ms: 84860 measurement overall
15.694938ms: 84860 known_rgbs
19.336281ms: 84860 measurement overall
15.029636ms: 84860 known_rgbs
16.877928ms: 84860 measurement overall
19.914947ms: 84860 known_rgbs
17.745175ms: 84860 measurement overall
15.035372ms: 84860 known_rgbs
17.798ms: 84860 measurement overall
15.303424ms: 84860 known_rgbs
17.852335ms: 84860 measurement overall
18.954729ms: 84860 known_rgbs
21.790709ms: 84860 measurement overall
20.873656ms: 84860 known_rgbs
19.62003ms: 84860 measurement overall
20.010939ms: 84860 known_rgbs
18.566838ms: 84860 measurement overall
16.744507ms: 84860 known_rgbs
17.76721ms: 84860 measurement overall
16.741186ms: 84860 known_rgbs
19.259307ms: 84860 measurement overall
15.000055ms: 84860 known_rgbs
17.904557ms: 84860 measurement overall
15.175738ms: 84860 known_rgbs
16.651533ms: 84860 measurement overall
14.897422ms: 84860 known_rgbs
17.024331ms: 84860 measurement overall
17.013464ms: 84860 known_rgbs
17.214805ms: 84860 measurement overall
15.166078ms: 84860 known_rgbs
17.081986ms: 84860 measurement overall
19.203764ms: 84860 known_rgbs
18.489864ms: 84860 measurement overall
15.620982ms: 84860 known_rgbs
19.452497ms: 84860 measurement overall
15.486351ms: 84860 known_rgbs
16.81635ms: 84860 measurement overall
14.993715ms: 84860 known_rgbs
17.038519ms: 84860 measurement overall
15.096649ms: 84860 known_rgbs
18.099559ms: 84860 measurement overall
15.439262ms: 84860 known_rgbs
16.731224ms: 84860 measurement overall
15.27837ms: 84860 known_rgbs
17.952854ms: 84860 measurement overall
15.218903ms: 84860 known_rgbs
18.070278ms: 84860 measurement overall
15.634867ms: 84860 known_rgbs
17.286044ms: 84860 measurement overall
15.290746ms: 84860 known_rgbs
16.799445ms: 84860 measurement overall
15.071293ms: 84860 known_rgbs
17.097381ms: 84860 measurement overall
14.984358ms: 84860 known_rgbs
17.136019ms: 84860 measurement overall
15.523481ms: 84860 known_rgbs
20.49301ms: 84860 measurement overall
15.700673ms: 84860 known_rgbs
18.073901ms: 84860 measurement overall
15.916201ms: 84860 known_rgbs
18.120085ms: 84860 measurement overall
15.337836ms: 84860 known_rgbs
18.189814ms: 84860 measurement overall
16.821481ms: 84860 known_rgbs
20.604397ms: 84860 measurement overall
14.716305ms: 84860 known_rgbs
16.009778ms: 84860 measurement overall
20.112364ms: 84860 known_rgbs
16.961544ms: 84860 measurement overall
14.877801ms: 84860 known_rgbs
16.447778ms: 84860 measurement overall
14.734719ms: 84860 known_rgbs
16.047209ms: 84860 measurement overall
14.910704ms: 84860 known_rgbs
16.588143ms: 84860 measurement overall
14.690345ms: 84860 known_rgbs
16.19844ms: 84860 measurement overall
14.899534ms: 84860 known_rgbs
16.124183ms: 84860 measurement overall
18.887415ms: 84860 known_rgbs
16.919887ms: 84860 measurement overall
14.711174ms: 84860 known_rgbs
16.055359ms: 84860 measurement overall
14.739549ms: 84860 known_rgbs
16.399178ms: 84860 measurement overall
14.721135ms: 84860 known_rgbs
16.146219ms: 84860 measurement overall
15.180567ms: 84860 known_rgbs
16.18697ms: 84860 measurement overall
14.758264ms: 84860 known_rgbs
16.261831ms: 84860 measurement overall
14.956284ms: 84860 known_rgbs
16.075282ms: 84860 measurement overall
14.712684ms: 84860 known_rgbs
16.043284ms: 84860 measurement overall
14.881423ms: 84860 known_rgbs
15.880279ms: 84860 measurement overall
14.723852ms: 84860 known_rgbs
16.407932ms: 84860 measurement overall
14.805958ms: 84860 known_rgbs
16.154369ms: 84860 measurement overall
14.812599ms: 84860 known_rgbs
16.933169ms: 84860 measurement overall
14.79328ms: 84860 known_rgbs
16.137163ms: 84860 measurement overall
15.064955ms: 84860 known_rgbs
17.15564ms: 84860 measurement overall
15.114158ms: 84860 known_rgbs
16.53411ms: 84860 measurement overall
15.112648ms: 84860 known_rgbs
15.983818ms: 84860 measurement overall
14.783017ms: 84860 known_rgbs
16.127503ms: 84860 measurement overall
15.261164ms: 84860 known_rgbs
16.573653ms: 84860 measurement overall
14.967453ms: 84860 known_rgbs
16.70134ms: 84860 measurement overall
14.728078ms: 84860 known_rgbs
16.038756ms: 84860 measurement overall
14.814108ms: 84860 known_rgbs
16.514791ms: 84860 measurement overall
14.81924ms: 84860 known_rgbs
16.32975ms: 84860 measurement overall
15.066766ms: 84860 known_rgbs
16.405215ms: 84860 measurement overall
16.622857ms: 242931 known_rgbs
44.432363ms: 242931 measurement overall
17.710762ms: 242931 known_rgbs
32.786886ms: 242931 measurement overall
16.169764ms: 242931 known_rgbs
32.5297ms: 242931 measurement overall
15.860659ms: 242931 known_rgbs
32.550528ms: 242931 measurement overall
15.882091ms: 242931 known_rgbs
32.652255ms: 242931 measurement overall
15.884204ms: 242931 known_rgbs
32.726513ms: 242931 measurement overall
15.951821ms: 242931 known_rgbs
32.192521ms: 242931 measurement overall
15.99559ms: 242931 known_rgbs
32.350395ms: 242931 measurement overall
16.105468ms: 242931 known_rgbs
32.873519ms: 242931 measurement overall
16.354804ms: 242931 known_rgbs
34.01576ms: 242931 measurement overall
15.893863ms: 242931 known_rgbs
32.332585ms: 242931 measurement overall
15.841641ms: 242931 known_rgbs
33.313934ms: 242931 measurement overall
16.394952ms: 242931 known_rgbs
33.538216ms: 242931 measurement overall
16.443854ms: 242931 known_rgbs
32.627201ms: 242931 measurement overall
15.872431ms: 242931 known_rgbs
32.436727ms: 242931 measurement overall
15.925558ms: 242931 known_rgbs
43.576588ms: 242931 measurement overall
15.945783ms: 242931 known_rgbs
32.698138ms: 242931 measurement overall
15.888128ms: 242931 known_rgbs
32.511588ms: 242931 measurement overall
15.8673ms: 242931 known_rgbs
32.835786ms: 242931 measurement overall
15.88994ms: 242931 known_rgbs
32.517324ms: 242931 measurement overall
15.959368ms: 242931 known_rgbs
32.255308ms: 242931 measurement overall
15.944878ms: 242931 known_rgbs
32.235688ms: 242931 measurement overall
15.894467ms: 242931 known_rgbs
32.156299ms: 242931 measurement overall
15.917107ms: 242931 known_rgbs
34.356258ms: 242931 measurement overall
21.238003ms: 242931 known_rgbs
34.158841ms: 242931 measurement overall
16.074376ms: 242931 known_rgbs
33.37491ms: 242931 measurement overall
16.041775ms: 242931 known_rgbs
31.803122ms: 242931 measurement overall
15.911975ms: 242931 known_rgbs
33.670129ms: 242931 measurement overall
15.877563ms: 242931 known_rgbs
33.128592ms: 242931 measurement overall
15.900504ms: 242931 known_rgbs
32.619654ms: 242931 measurement overall
15.973253ms: 242931 known_rgbs
34.099073ms: 242931 measurement overall
15.967518ms: 242931 known_rgbs
32.085965ms: 242931 measurement overall
15.850094ms: 242931 known_rgbs
32.135168ms: 242931 measurement overall
16.318883ms: 242931 known_rgbs
32.751265ms: 242931 measurement overall
15.846169ms: 242931 known_rgbs
32.437331ms: 242931 measurement overall
16.752052ms: 242931 known_rgbs
34.82867ms: 242931 measurement overall
15.793344ms: 242931 known_rgbs
34.26238ms: 242931 measurement overall
16.335485ms: 242931 known_rgbs
33.208584ms: 242931 measurement overall
16.533506ms: 242931 known_rgbs
35.749647ms: 242931 measurement overall
16.790691ms: 242931 known_rgbs
36.36363ms: 242931 measurement overall
23.098369ms: 328666 known_rgbs
68.826318ms: 328666 measurement overall
18.577403ms: 328666 known_rgbs
45.9634ms: 328666 measurement overall
23.406266ms: 328666 known_rgbs
49.446267ms: 328666 measurement overall
18.440359ms: 328666 known_rgbs
51.08869ms: 328666 measurement overall
16.825707ms: 328666 known_rgbs
44.643364ms: 328666 measurement overall
16.966374ms: 328666 known_rgbs
43.674089ms: 328666 measurement overall
16.802766ms: 328666 known_rgbs
43.590776ms: 328666 measurement overall
16.848648ms: 328666 known_rgbs
44.311015ms: 328666 measurement overall
16.786465ms: 328666 known_rgbs
43.940935ms: 328666 measurement overall
16.807596ms: 328666 known_rgbs
43.728123ms: 328666 measurement overall
16.836272ms: 328666 known_rgbs
43.185679ms: 328666 measurement overall
16.829631ms: 328666 known_rgbs
43.480295ms: 328666 measurement overall
18.220906ms: 328666 known_rgbs
45.186109ms: 328666 measurement overall
16.847441ms: 328666 known_rgbs
44.171555ms: 328666 measurement overall
16.816953ms: 328666 known_rgbs
43.758611ms: 328666 measurement overall
16.829329ms: 328666 known_rgbs
43.511688ms: 328666 measurement overall
16.890004ms: 328666 known_rgbs
43.190509ms: 328666 measurement overall
17.005616ms: 328666 known_rgbs
44.051717ms: 328666 measurement overall
16.878834ms: 328666 known_rgbs
44.455003ms: 328666 measurement overall
16.826613ms: 328666 known_rgbs
46.728616ms: 328666 measurement overall
16.739978ms: 328666 known_rgbs
43.663826ms: 328666 measurement overall
17.192166ms: 328666 known_rgbs
44.079488ms: 328666 measurement overall
16.888796ms: 328666 known_rgbs
44.77739ms: 328666 measurement overall
17.088627ms: 328666 known_rgbs
43.542177ms: 328666 measurement overall
17.0355ms: 328666 known_rgbs
43.931576ms: 328666 measurement overall
33.211603ms: 1103347 known_rgbs
170.895632ms: 1103347 measurement overall
26.963995ms: 1103347 known_rgbs
129.220162ms: 1103347 measurement overall
27.111303ms: 1103347 known_rgbs
130.616871ms: 1103347 measurement overall
27.033423ms: 1103347 known_rgbs
128.483018ms: 1103347 measurement overall
26.953732ms: 1103347 known_rgbs
129.602317ms: 1103347 measurement overall
26.949205ms: 1103347 known_rgbs
129.821769ms: 1103347 measurement overall
26.928376ms: 1103347 known_rgbs
130.058428ms: 1103347 measurement overall
27.484705ms: 1103347 known_rgbs
135.584589ms: 1103347 measurement overall
27.304796ms: 1103347 known_rgbs
138.603497ms: 1103347 measurement overall
27.231142ms: 1103347 known_rgbs
137.130115ms: 1103347 measurement overall
27.261932ms: 1103347 known_rgbs
139.474364ms: 1103347 measurement overall
27.710497ms: 1103347 known_rgbs
142.93429ms: 1103347 measurement overall
Benchmark 2: 16755 known_rgbs
  Time (mean ± σ): 14.674857 ms ± 1.040530 ms
  Range (min … max): 13.919998 ms … 19.405709 ms 110 runs
Benchmark 3: 84860 known_rgbs
  Time (mean ± σ): 15.627346 ms ± 1.466381 ms
  Range (min … max): 14.690345 ms … 20.934029 ms 107 runs
Benchmark 4: 242931 known_rgbs
  Time (mean ± σ): 16.235562 ms ± 880.991575 µs
  Range (min … max): 15.793344 ms … 21.238003 ms 40 runs
Benchmark 1: 27868 known_rgbs
  Time (mean ± σ): 14.333585 ms ± 477.324486 µs
  Range (min … max): 13.983086 ms … 16.121466 ms 77 runs
Benchmark 5: 328666 known_rgbs
  Time (mean ± σ): 17.579465 ms ± 1.748026 ms
  Range (min … max): 16.739978 ms … 23.406266 ms 25 runs
Benchmark 6: 1103347 known_rgbs
  Time (mean ± σ): 27.954045 ms ± 1.915551 ms
  Range (min … max): 26.912679 ms … 35.432693 ms 57 runs
Benchmark 1: 16755 measurement overall
  Time (mean ± σ): 8.095255 ms ± 917.960747 µs
  Range (min … max): 7.254614 ms … 13.806196 ms 110 runs
Benchmark 3: 84860 measurement overall
  Time (mean ± σ): 17.477675 ms ± 4.272018 ms
  Range (min … max): 15.791533 ms … 59.822421 ms 107 runs
Benchmark 4: 242931 measurement overall
  Time (mean ± σ): 33.629476 ms ± 2.576922 ms
  Range (min … max): 31.803122 ms … 44.432363 ms 40 runs
Benchmark 2: 27868 measurement overall
  Time (mean ± σ): 9.298359 ms ± 948.060587 µs
  Range (min … max): 8.516995 ms … 15.333610 ms 77 runs
Benchmark 5: 328666 measurement overall
  Time (mean ± σ): 45.637089 ms ± 5.082862 ms
  Range (min … max): 43.185679 ms … 68.826318 ms 25 runs
Benchmark 6: 1103347 measurement overall
  Time (mean ± σ): 140.833579 ms ± 24.824018 ms
  Range (min … max): 127.157247 ms … 255.287087 ms 57 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th><samp>known_rgbs_{rgbs,freqs}</samp></th> <td><span class="roboto-unscale math-font-normal">14.675ms</span></td> <td><span class="roboto-unscale math-font-normal">27.954ms</span></td> <td><span class="roboto-unscale math-font-normal">1.04ms</span>/<span class="roboto-unscale math-font-normal">1.92ms</span></td></tr>
 <tr><th>(speed-up) </th> <td><span class="roboto-unscale math-font-normal">-21.13%</span></td> <td><span class="roboto-unscale math-font-normal">3.45%</span></td> <td></td></tr>
</table>
<p class="continuing">
this is, practically, a wash (σ is like <span class="roboto-unscale math-font-normal">6%</span>); overall re-accounting like this remits
</p>
<table class="perf">
 <tr><th>(colours) </th><th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, <samp>measure()</samp></th> <td><span class="roboto-unscale math-font-normal">8.095ms</span></td> <td><span class="roboto-unscale math-font-normal">17.478ms</span></td> <td><span class="roboto-unscale math-font-normal">33.629ms</span></td> <td><span class="roboto-unscale math-font-normal">918µs</span>/<span class="roboto-unscale math-font-normal">4.27ms</span>/<span class="roboto-unscale math-font-normal">2.58ms</span></td></tr>
 <tr><th>(of previous, [​[​palette​]​]) </th> <td><span class="roboto-unscale math-font-normal">7.01%</span></td> <td><span class="roboto-unscale math-font-normal">0.29%</span></td> <td><span class="roboto-unscale math-font-normal">0.03%</span></td> <td></td></tr>
 <tr><th>(of previous, [​[​*freq​]​]) </th> <td><span class="roboto-unscale math-font-normal">5.59%</span></td> <td><span class="roboto-unscale math-font-normal">0.26%</span></td> <td><span class="roboto-unscale math-font-normal">0.06%</span></td> <td></td></tr>
 <tr></tr>
 <tr><th>(colours) </th><th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, <samp>measure()</samp></th> <td><span class="roboto-unscale math-font-normal">9.298ms</span></td> <td><span class="roboto-unscale math-font-normal">45.637ms</span></td> <td><span class="roboto-unscale math-font-normal">140.834ms</span></td> <td><span class="roboto-unscale math-font-normal">948µs</span>/<span class="roboto-unscale math-font-normal">5ms</span>/<span class="roboto-unscale math-font-normal">24.82ms</span></td></tr>
 <tr><th>(of previous, [​[​palette​]​]) </th> <td><span class="roboto-unscale math-font-normal">0.49%</span></td> <td><span class="roboto-unscale math-font-normal">0.04%</span></td> <td><span class="roboto-unscale math-font-normal">0.28%</span></td> <td></td></tr>
 <tr><th>(of previous, [​[​*freq​]​]) </th> <td><span class="roboto-unscale math-font-normal">1.64%</span></td> <td><span class="roboto-unscale math-font-normal">0.06%</span></td> <td><span class="roboto-unscale math-font-normal">0.58%</span></td> <td></td></tr>
</table>
<p class="continuing">
(though, of course, the [​[​palette​]​] path now also copies frequency data for <span class="roboto-unscale math-font-normal">40µs-20ms</span> which it didn't<!--'--> before).
</p>
<div class="singles">
<figure> <a href="/content/assets/blogn_t/018.32-graphml-GAAP.png"><img alt="" src="/content/assets/blogn_t/018.32-graphml-GAAP.png" /></a> <figcaption></figcaption> </figure>
</div>
<h2 id="known_rgbs-DEVICE_LOCAL" class="continued"><a class="hash-link" href="#known_rgbs-DEVICE_LOCAL">#</a> Do NOT tell americans about your allocations. Worst mistake of my life.</h2>
<p class="continuing">
The allocations in question, of course, being <samp>known_rgbs_bundle</samp> and <samp>known_rgbs_freqs</samp>,
both uploaded to precious <samp>DEVICE_LOCAL & HOST_VISIBLE</samp> memory directly.
These are write-only for the host, and writing only part of the former was slower anyway.
Thus,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/7430dcf60e6b94188f79889e248721e1af5b83d1/item/src/posterise_gpu.rs#L538">the driver</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">DISTRIBUTE_ONESHOT_FREQS</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">EXPAND_RGB</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->buffer_known_rgbs_bundle<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->   <!--"--><span class="token comment">// [[vk::binding(2)]] <abbr title="StructuredBuffer">SB</abbr>&lt;known_rgbs_pack> known_rgbs_bundle;<!--"-->   <!--"-->[DEVICE_LOCAL]</span>
<!--"-->	<!--"-->buffer_known_rgbs_freqs<span class="token punctuation">:</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">,</span><!--"-->    <!--"--><span class="token comment">// [[vk::binding(3)]] <abbr title="StructuredBuffer">SB</abbr>&lt;uint><!--"-->            <!--"-->known_rgbs_freqs;<!--"-->    <!--"-->[DEVICE_LOCAL]</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token comment">// vk::BufferUsageFlags::STORAGE_BUFFER<!--"-->              <!--"-->| ::TRANSFER_SRC ⬎<!--"-->       <!--"-->⬐ ::TRANSFER_DST</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_known_rgbs_bundle <span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>private_memory_type_index<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span><!--"-->  <!--"--><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->ret<span class="token punctuation">.</span>buffer_known_rgbs_freqs<!--"-->  <!--"--><span class="token operator">=</span> <span class="token class-name">BufferBundle</span><span class="token punctuation">(</span>private_memory_type_index<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// false, false</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ... ensure_buffer() ...</span>

<!--"-->	<!--"--><span class="token comment">// expand_rgb.hlsl</span>
<!--"-->	<!--"--><span class="token comment">// memcpy(buffer_outputs_map, known_rgbs_freqs, known_rgbs * sizeof(u32))</span>
<!--"-->	<!--"--><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy_nonoverlapping</span><span class="token punctuation">(</span>known_rgbs_rgbs<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">EXPAND_RGB</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</small>
<!--"-->	<!--"--><span class="token comment">// memcpy or distribute_oneshot_freqs.hlsl</span>
<!--"-->	<!--"--><span class="token comment">// memcpy(buffer_outputs_map, known_rgbs_freqs, known_rgbs * sizeof(u32))</span>
<!--"-->	<!--"--><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">copy_nonoverlapping</span><span class="token punctuation">(</span>known_rgbs_freqs<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> known_rgbs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>use_oneshot_driver <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">DISTRIBUTE_ONESHOT_FREQS</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> known_rgbs<span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token comment">// memcpy(buffer_known_rgbs_freqs, buffer_outputs, buffer_known_rgbs_freqs_len)</span>
<!--"-->		<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_copy_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_known_rgbs_freqs<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span>
<!--"-->		                            <!--"--><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">BufferCopy</span> <span class="token punctuation">{</span>
<!--"-->		                              	<!--"-->src_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->		                              	<!--"-->dst_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->		                              	<!--"-->size<span class="token punctuation">:</span> buffer_known_rgbs_freqs_len<span class="token punctuation">,</span>
<!--"-->		                              <!--"--><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// find_bbox.hlsl ...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/7430dcf60e6b94188f79889e248721e1af5b83d1/item/src/expand_rgb.hlsl#L22"><samp>expand_rgb.hlsl</samp></a>
needs to populate the whole bundle instead of just updating <code>.lab</code>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl">known_rgbs_pack bundle<span class="token punctuation">;</span>
bundle<span class="token punctuation">.</span>rgb <span class="token operator">=</span> outputs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
bundle<span class="token punctuation">.</span>lab <span class="token operator">=</span> <span class="token function">linear_srgb_to_oklab</span><span class="token punctuation">(</span><span class="token function">unpack_rgb_to_r_g_b</span><span class="token punctuation">(</span>bundle<span class="token punctuation">.</span>rgb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> bundle<span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuing">
and the new
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/7430dcf60e6b94188f79889e248721e1af5b83d1/item/src/distribute_oneshot_freqs.hlsl"><samp>distribute_oneshot_freqs.hlsl</samp></a>
replaces the <code>known_rgbs_freqs_out[rgb] = freq</code> loop:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->outputs<span class="token punctuation">;</span><!--"-->            <!--"--><span class="token comment">// HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->known_rgbs_freqs<span class="token punctuation">;</span><!--"-->   <!--"--><span class="token comment">// DEVICE_LOCAL</span>

<span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"-->known_rgbs_freqs<span class="token punctuation">[</span>known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> outputs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<!--
1.423574ms 16755 known_rgbs_{rgbs,freqs}
193.795µs 16755 known_rgbs_{rgbs,freqs}
188.965µs 16755 known_rgbs_{rgbs,freqs}
188.059µs 16755 known_rgbs_{rgbs,freqs}
216.736µs 16755 known_rgbs_{rgbs,freqs}
211.605µs 16755 known_rgbs_{rgbs,freqs}
183.229µs 16755 known_rgbs_{rgbs,freqs}
200.737µs 16755 known_rgbs_{rgbs,freqs}
200.134µs 16755 known_rgbs_{rgbs,freqs}
221.264µs 16755 known_rgbs_{rgbs,freqs}
195.907µs 16755 known_rgbs_{rgbs,freqs}
298.842µs 16755 known_rgbs_{rgbs,freqs}
195.304µs 16755 known_rgbs_{rgbs,freqs}
203.454µs 16755 known_rgbs_{rgbs,freqs}
187.153µs 16755 known_rgbs_{rgbs,freqs}
198.624µs 16755 known_rgbs_{rgbs,freqs}
207.077µs 16755 known_rgbs_{rgbs,freqs}
184.437µs 16755 known_rgbs_{rgbs,freqs}
228.207µs 16755 known_rgbs_{rgbs,freqs}
204.36µs 16755 known_rgbs_{rgbs,freqs}
209.492µs 16755 known_rgbs_{rgbs,freqs}
215.83µs 16755 known_rgbs_{rgbs,freqs}
212.51µs 16755 known_rgbs_{rgbs,freqs}
204.661µs 16755 known_rgbs_{rgbs,freqs}
207.981µs 16755 known_rgbs_{rgbs,freqs}
199.832µs 16755 known_rgbs_{rgbs,freqs}
217.34µs 16755 known_rgbs_{rgbs,freqs}
202.549µs 16755 known_rgbs_{rgbs,freqs}
199.53µs 16755 known_rgbs_{rgbs,freqs}
212.812µs 16755 known_rgbs_{rgbs,freqs}
212.812µs 16755 known_rgbs_{rgbs,freqs}
323.896µs 16755 known_rgbs_{rgbs,freqs}
248.13µs 16755 known_rgbs_{rgbs,freqs}
205.265µs 16755 known_rgbs_{rgbs,freqs}
185.342µs 16755 known_rgbs_{rgbs,freqs}
226.697µs 16755 known_rgbs_{rgbs,freqs}
201.341µs 16755 known_rgbs_{rgbs,freqs}
230.622µs 16755 known_rgbs_{rgbs,freqs}
185.947µs 16755 known_rgbs_{rgbs,freqs}
218.848µs 16755 known_rgbs_{rgbs,freqs}
202.549µs 16755 known_rgbs_{rgbs,freqs}
186.852µs 16755 known_rgbs_{rgbs,freqs}
221.264µs 16755 known_rgbs_{rgbs,freqs}
204.661µs 16755 known_rgbs_{rgbs,freqs}
196.209µs 16755 known_rgbs_{rgbs,freqs}
189.568µs 16755 known_rgbs_{rgbs,freqs}
487.203µs 16755 known_rgbs_{rgbs,freqs}
203.153µs 16755 known_rgbs_{rgbs,freqs}
207.68µs 16755 known_rgbs_{rgbs,freqs}
188.663µs 16755 known_rgbs_{rgbs,freqs}
225.49µs 16755 known_rgbs_{rgbs,freqs}
212.812µs 16755 known_rgbs_{rgbs,freqs}
203.454µs 16755 known_rgbs_{rgbs,freqs}
188.965µs 16755 known_rgbs_{rgbs,freqs}
215.528µs 16755 known_rgbs_{rgbs,freqs}
222.471µs 16755 known_rgbs_{rgbs,freqs}
209.19µs 16755 known_rgbs_{rgbs,freqs}
204.964µs 16755 known_rgbs_{rgbs,freqs}
195.606µs 16755 known_rgbs_{rgbs,freqs}
212.51µs 16755 known_rgbs_{rgbs,freqs}
199.832µs 16755 known_rgbs_{rgbs,freqs}
186.248µs 16755 known_rgbs_{rgbs,freqs}
218.246µs 16755 known_rgbs_{rgbs,freqs}
257.185µs 16755 known_rgbs_{rgbs,freqs}
185.04µs 16755 known_rgbs_{rgbs,freqs}
201.039µs 16755 known_rgbs_{rgbs,freqs}
220.057µs 16755 known_rgbs_{rgbs,freqs}
203.454µs 16755 known_rgbs_{rgbs,freqs}
204.359µs 16755 known_rgbs_{rgbs,freqs}
187.757µs 16755 known_rgbs_{rgbs,freqs}
193.492µs 16755 known_rgbs_{rgbs,freqs}
199.529µs 16755 known_rgbs_{rgbs,freqs}
186.248µs 16755 known_rgbs_{rgbs,freqs}
204.057µs 16755 known_rgbs_{rgbs,freqs}
206.774µs 16755 known_rgbs_{rgbs,freqs}
210.095µs 16755 known_rgbs_{rgbs,freqs}
208.887µs 16755 known_rgbs_{rgbs,freqs}
208.887µs 16755 known_rgbs_{rgbs,freqs}
189.568µs 16755 known_rgbs_{rgbs,freqs}
218.547µs 16755 known_rgbs_{rgbs,freqs}
203.152µs 16755 known_rgbs_{rgbs,freqs}
209.189µs 16755 known_rgbs_{rgbs,freqs}
186.55µs 16755 known_rgbs_{rgbs,freqs}
198.926µs 16755 known_rgbs_{rgbs,freqs}
198.926µs 16755 known_rgbs_{rgbs,freqs}
197.115µs 16755 known_rgbs_{rgbs,freqs}
201.643µs 16755 known_rgbs_{rgbs,freqs}
191.078µs 16755 known_rgbs_{rgbs,freqs}
185.946µs 16755 known_rgbs_{rgbs,freqs}
205.265µs 16755 known_rgbs_{rgbs,freqs}
265.034µs 16755 known_rgbs_{rgbs,freqs}
75.453063ms 1103347 known_rgbs_{rgbs,freqs}
28.108651ms 1103347 known_rgbs_{rgbs,freqs}
28.543631ms 1103347 known_rgbs_{rgbs,freqs}
28.502276ms 1103347 known_rgbs_{rgbs,freqs}
28.612757ms 1103347 known_rgbs_{rgbs,freqs}
29.034155ms 1103347 known_rgbs_{rgbs,freqs}
28.42651ms 1103347 known_rgbs_{rgbs,freqs}
28.351044ms 1103347 known_rgbs_{rgbs,freqs}
29.445893ms 1103347 known_rgbs_{rgbs,freqs}
29.057398ms 1103347 known_rgbs_{rgbs,freqs}
29.149466ms 1103347 known_rgbs_{rgbs,freqs}
29.038079ms 1103347 known_rgbs_{rgbs,freqs}
28.274976ms 1103347 known_rgbs_{rgbs,freqs}
28.362818ms 1103347 known_rgbs_{rgbs,freqs}
29.013629ms 1103347 known_rgbs_{rgbs,freqs}
29.092414ms 1103347 known_rgbs_{rgbs,freqs}
28.482353ms 1103347 known_rgbs_{rgbs,freqs}
28.312104ms 1103347 known_rgbs_{rgbs,freqs}
28.538801ms 1103347 known_rgbs_{rgbs,freqs}
29.342958ms 1103347 known_rgbs_{rgbs,freqs}
28.220943ms 1103347 known_rgbs_{rgbs,freqs}
28.49473ms 1103347 known_rgbs_{rgbs,freqs}
29.306735ms 1103347 known_rgbs_{rgbs,freqs}
29.027514ms 1103347 known_rgbs_{rgbs,freqs}
28.526727ms 1103347 known_rgbs_{rgbs,freqs}
28.93122ms 1103347 known_rgbs_{rgbs,freqs}
29.020873ms 1103347 known_rgbs_{rgbs,freqs}
28.450357ms 1103347 known_rgbs_{rgbs,freqs}
28.682487ms 1103347 known_rgbs_{rgbs,freqs}
29.342958ms 1103347 known_rgbs_{rgbs,freqs}
27.677594ms 1103347 known_rgbs_{rgbs,freqs}
28.644754ms 1103347 known_rgbs_{rgbs,freqs}
29.139504ms 1103347 known_rgbs_{rgbs,freqs}
28.310294ms 1103347 known_rgbs_{rgbs,freqs}
28.488995ms 1103347 known_rgbs_{rgbs,freqs}
28.063975ms 1103347 known_rgbs_{rgbs,freqs}
28.837342ms 1103347 known_rgbs_{rgbs,freqs}
28.267731ms 1103347 known_rgbs_{rgbs,freqs}
28.918543ms 1103347 known_rgbs_{rgbs,freqs}
28.80957ms 1103347 known_rgbs_{rgbs,freqs}
28.778177ms 1103347 known_rgbs_{rgbs,freqs}
29.03657ms 1103347 known_rgbs_{rgbs,freqs}
28.855756ms 1103347 known_rgbs_{rgbs,freqs}
28.481146ms 1103347 known_rgbs_{rgbs,freqs}
28.945106ms 1103347 known_rgbs_{rgbs,freqs}
28.651094ms 1103347 known_rgbs_{rgbs,freqs}
28.240563ms 1103347 known_rgbs_{rgbs,freqs}
28.601287ms 1103347 known_rgbs_{rgbs,freqs}
30.041162ms 1103347 known_rgbs_{rgbs,freqs}
29.468834ms 1103347 known_rgbs_{rgbs,freqs}
28.76731ms 1103347 known_rgbs_{rgbs,freqs}
28.902543ms 1103347 known_rgbs_{rgbs,freqs}
29.507774ms 1103347 known_rgbs_{rgbs,freqs}
28.826777ms 1103347 known_rgbs_{rgbs,freqs}
28.491108ms 1103347 known_rgbs_{rgbs,freqs}
29.397897ms 1103347 known_rgbs_{rgbs,freqs}
28.72837ms 1103347 known_rgbs_{rgbs,freqs}
28.824664ms 1103347 known_rgbs_{rgbs,freqs}
28.280409ms 1103347 known_rgbs_{rgbs,freqs}
29.003667ms 1103347 known_rgbs_{rgbs,freqs}
29.722096ms 1103347 known_rgbs_{rgbs,freqs}
28.960501ms 1103347 known_rgbs_{rgbs,freqs}
217.037µs 16755 known_rgbs_{rgbs,freqs}
209.793µs 16755 known_rgbs_{rgbs,freqs}
220.057µs 16755 known_rgbs_{rgbs,freqs}
272.882µs 16755 known_rgbs_{rgbs,freqs}
269.562µs 16755 known_rgbs_{rgbs,freqs}
205.868µs 16755 known_rgbs_{rgbs,freqs}
186.852µs 16755 known_rgbs_{rgbs,freqs}
205.266µs 16755 known_rgbs_{rgbs,freqs}
248.129µs 16755 known_rgbs_{rgbs,freqs}
204.964µs 16755 known_rgbs_{rgbs,freqs}
227.301µs 16755 known_rgbs_{rgbs,freqs}
206.171µs 16755 known_rgbs_{rgbs,freqs}
217.943µs 16755 known_rgbs_{rgbs,freqs}
204.662µs 16755 known_rgbs_{rgbs,freqs}
228.207µs 16755 known_rgbs_{rgbs,freqs}
204.058µs 16755 known_rgbs_{rgbs,freqs}
233.036µs 16755 known_rgbs_{rgbs,freqs}
207.68µs 16755 known_rgbs_{rgbs,freqs}
595.873µs 16755 known_rgbs_{rgbs,freqs}
202.247µs 16755 known_rgbs_{rgbs,freqs}
777.894µs 16755 memcpy or distribute_oneshot_freqs.hlsl
102.331µs 16755 memcpy or distribute_oneshot_freqs.hlsl
141.572µs 16755 memcpy or distribute_oneshot_freqs.hlsl
129.197µs 16755 memcpy or distribute_oneshot_freqs.hlsl
100.822µs 16755 memcpy or distribute_oneshot_freqs.hlsl
120.442µs 16755 memcpy or distribute_oneshot_freqs.hlsl
153.043µs 16755 memcpy or distribute_oneshot_freqs.hlsl
142.478µs 16755 memcpy or distribute_oneshot_freqs.hlsl
139.761µs 16755 memcpy or distribute_oneshot_freqs.hlsl
144.893µs 16755 memcpy or distribute_oneshot_freqs.hlsl
120.141µs 16755 memcpy or distribute_oneshot_freqs.hlsl
154.25µs 16755 memcpy or distribute_oneshot_freqs.hlsl
91.464µs 16755 memcpy or distribute_oneshot_freqs.hlsl
129.498µs 16755 memcpy or distribute_oneshot_freqs.hlsl
93.577µs 16755 memcpy or distribute_oneshot_freqs.hlsl
90.86µs 16755 memcpy or distribute_oneshot_freqs.hlsl
98.406µs 16755 memcpy or distribute_oneshot_freqs.hlsl
136.139µs 16755 memcpy or distribute_oneshot_freqs.hlsl
115.613µs 16755 memcpy or distribute_oneshot_freqs.hlsl
100.821µs 16755 memcpy or distribute_oneshot_freqs.hlsl
121.65µs 16755 memcpy or distribute_oneshot_freqs.hlsl
113.802µs 16755 memcpy or distribute_oneshot_freqs.hlsl
131.31µs 16755 memcpy or distribute_oneshot_freqs.hlsl
125.272µs 16755 memcpy or distribute_oneshot_freqs.hlsl
132.818µs 16755 memcpy or distribute_oneshot_freqs.hlsl
133.12µs 16755 memcpy or distribute_oneshot_freqs.hlsl
116.82µs 16755 memcpy or distribute_oneshot_freqs.hlsl
127.989µs 16755 memcpy or distribute_oneshot_freqs.hlsl
131.008µs 16755 memcpy or distribute_oneshot_freqs.hlsl
134.63µs 16755 memcpy or distribute_oneshot_freqs.hlsl
101.727µs 16755 memcpy or distribute_oneshot_freqs.hlsl
105.652µs 16755 memcpy or distribute_oneshot_freqs.hlsl
116.217µs 16755 memcpy or distribute_oneshot_freqs.hlsl
107.764µs 16755 memcpy or distribute_oneshot_freqs.hlsl
109.877µs 16755 memcpy or distribute_oneshot_freqs.hlsl
140.667µs 16755 memcpy or distribute_oneshot_freqs.hlsl
102.934µs 16755 memcpy or distribute_oneshot_freqs.hlsl
128.291µs 16755 memcpy or distribute_oneshot_freqs.hlsl
144.289µs 16755 memcpy or distribute_oneshot_freqs.hlsl
110.179µs 16755 memcpy or distribute_oneshot_freqs.hlsl
115.613µs 16755 memcpy or distribute_oneshot_freqs.hlsl
150.628µs 16755 memcpy or distribute_oneshot_freqs.hlsl
91.766µs 16755 memcpy or distribute_oneshot_freqs.hlsl
125.876µs 16755 memcpy or distribute_oneshot_freqs.hlsl
139.459µs 16755 memcpy or distribute_oneshot_freqs.hlsl
150.327µs 16755 memcpy or distribute_oneshot_freqs.hlsl
156.967µs 16755 memcpy or distribute_oneshot_freqs.hlsl
118.933µs 16755 memcpy or distribute_oneshot_freqs.hlsl
113.801µs 16755 memcpy or distribute_oneshot_freqs.hlsl
130.404µs 16755 memcpy or distribute_oneshot_freqs.hlsl
128.29µs 16755 memcpy or distribute_oneshot_freqs.hlsl
110.481µs 16755 memcpy or distribute_oneshot_freqs.hlsl
152.741µs 16755 memcpy or distribute_oneshot_freqs.hlsl
121.046µs 16755 memcpy or distribute_oneshot_freqs.hlsl
127.385µs 16755 memcpy or distribute_oneshot_freqs.hlsl
98.708µs 16755 memcpy or distribute_oneshot_freqs.hlsl
121.65µs 16755 memcpy or distribute_oneshot_freqs.hlsl
108.066µs 16755 memcpy or distribute_oneshot_freqs.hlsl
99.916µs 16755 memcpy or distribute_oneshot_freqs.hlsl
131.31µs 16755 memcpy or distribute_oneshot_freqs.hlsl
130.705µs 16755 memcpy or distribute_oneshot_freqs.hlsl
139.46µs 16755 memcpy or distribute_oneshot_freqs.hlsl
116.518µs 16755 memcpy or distribute_oneshot_freqs.hlsl
126.781µs 16755 memcpy or distribute_oneshot_freqs.hlsl
146.402µs 16755 memcpy or distribute_oneshot_freqs.hlsl
142.478µs 16755 memcpy or distribute_oneshot_freqs.hlsl
96.897µs 16755 memcpy or distribute_oneshot_freqs.hlsl
131.913µs 16755 memcpy or distribute_oneshot_freqs.hlsl
161.797µs 16755 memcpy or distribute_oneshot_freqs.hlsl
123.763µs 16755 memcpy or distribute_oneshot_freqs.hlsl
127.687µs 16755 memcpy or distribute_oneshot_freqs.hlsl
196.209µs 16755 memcpy or distribute_oneshot_freqs.hlsl
89.351µs 16755 memcpy or distribute_oneshot_freqs.hlsl
138.252µs 16755 memcpy or distribute_oneshot_freqs.hlsl
130.705µs 16755 memcpy or distribute_oneshot_freqs.hlsl
127.989µs 16755 memcpy or distribute_oneshot_freqs.hlsl
108.368µs 16755 memcpy or distribute_oneshot_freqs.hlsl
113.5µs 16755 memcpy or distribute_oneshot_freqs.hlsl
127.385µs 16755 memcpy or distribute_oneshot_freqs.hlsl
125.876µs 16755 memcpy or distribute_oneshot_freqs.hlsl
108.971µs 16755 memcpy or distribute_oneshot_freqs.hlsl
108.368µs 16755 memcpy or distribute_oneshot_freqs.hlsl
139.762µs 16755 memcpy or distribute_oneshot_freqs.hlsl
148.214µs 16755 memcpy or distribute_oneshot_freqs.hlsl
94.483µs 16755 memcpy or distribute_oneshot_freqs.hlsl
127.084µs 16755 memcpy or distribute_oneshot_freqs.hlsl
117.424µs 16755 memcpy or distribute_oneshot_freqs.hlsl
89.351µs 16755 memcpy or distribute_oneshot_freqs.hlsl
202.85µs 16755 memcpy or distribute_oneshot_freqs.hlsl
113.198µs 16755 memcpy or distribute_oneshot_freqs.hlsl
140.968µs 16755 memcpy or distribute_oneshot_freqs.hlsl
141.874µs 16755 memcpy or distribute_oneshot_freqs.hlsl
105.349µs 16755 memcpy or distribute_oneshot_freqs.hlsl
125.272µs 16755 memcpy or distribute_oneshot_freqs.hlsl
134.63µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.386µs 16755 memcpy or distribute_oneshot_freqs.hlsl
121.348µs 16755 memcpy or distribute_oneshot_freqs.hlsl
113.197µs 16755 memcpy or distribute_oneshot_freqs.hlsl
162.702µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.688µs 16755 memcpy or distribute_oneshot_freqs.hlsl
162.703µs 16755 memcpy or distribute_oneshot_freqs.hlsl
114.103µs 16755 memcpy or distribute_oneshot_freqs.hlsl
128.29µs 16755 memcpy or distribute_oneshot_freqs.hlsl
148.818µs 16755 memcpy or distribute_oneshot_freqs.hlsl
112.594µs 16755 memcpy or distribute_oneshot_freqs.hlsl
126.178µs 16755 memcpy or distribute_oneshot_freqs.hlsl
123.763µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.084µs 16755 memcpy or distribute_oneshot_freqs.hlsl
126.781µs 16755 memcpy or distribute_oneshot_freqs.hlsl
129.197µs 16755 memcpy or distribute_oneshot_freqs.hlsl
129.8µs 16755 memcpy or distribute_oneshot_freqs.hlsl
121.046µs 16755 memcpy or distribute_oneshot_freqs.hlsl
735.634µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
754.048µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
781.819µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
805.666µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
792.686µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
743.482µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
763.707µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
800.534µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
785.14µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
752.841µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
736.54µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
750.727µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
787.856µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
755.557µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
780.007µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
757.67µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
754.652µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
779.103µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
757.67µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
753.444µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
736.842µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
774.876µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
750.727µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
787.253µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
830.72µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
747.105µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
813.514µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
755.255µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
761.292µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
814.42µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
777.291µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
773.669µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
772.461µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
735.03µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
755.255µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
760.085µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
776.385µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
759.783µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
774.272µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
754.048µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
759.783µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
784.535µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
784.535µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
780.913µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
778.197µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
736.238µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
779.404µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
775.48µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
784.536µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
781.818µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
780.914µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
779.404µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
767.934µs: 1103347 memcpy or distribute_oneshot_freqs.hlsl
115.914µs 16755 memcpy or distribute_oneshot_freqs.hlsl
118.329µs 16755 memcpy or distribute_oneshot_freqs.hlsl
135.535µs 16755 memcpy or distribute_oneshot_freqs.hlsl
122.253µs 16755 memcpy or distribute_oneshot_freqs.hlsl
139.158µs 16755 memcpy or distribute_oneshot_freqs.hlsl
116.216µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.688µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.085µs 16755 memcpy or distribute_oneshot_freqs.hlsl
411.435µs 16755 memcpy or distribute_oneshot_freqs.hlsl
109.877µs 16755 memcpy or distribute_oneshot_freqs.hlsl
99.01µs 16755 memcpy or distribute_oneshot_freqs.hlsl
92.973µs 16755 memcpy or distribute_oneshot_freqs.hlsl
104.444µs 16755 memcpy or distribute_oneshot_freqs.hlsl
113.198µs 16755 memcpy or distribute_oneshot_freqs.hlsl
101.124µs 16755 memcpy or distribute_oneshot_freqs.hlsl
125.876µs 16755 memcpy or distribute_oneshot_freqs.hlsl
108.066µs 16755 memcpy or distribute_oneshot_freqs.hlsl
114.707µs 16755 memcpy or distribute_oneshot_freqs.hlsl
107.463µs 16755 memcpy or distribute_oneshot_freqs.hlsl
107.16µs 16755 memcpy or distribute_oneshot_freqs.hlsl
169.344µs 16755 memcpy or distribute_oneshot_freqs.hlsl
118.329µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.689µs 16755 memcpy or distribute_oneshot_freqs.hlsl
111.689µs 16755 memcpy or distribute_oneshot_freqs.hlsl
132.516µs 16755 memcpy or distribute_oneshot_freqs.hlsl
94.785µs 16755 memcpy or distribute_oneshot_freqs.hlsl
139.459µs 16755 memcpy or distribute_oneshot_freqs.hlsl
107.764µs 16755 memcpy or distribute_oneshot_freqs.hlsl
86.03µs 16755 memcpy or distribute_oneshot_freqs.hlsl
112.292µs 16755 memcpy or distribute_oneshot_freqs.hlsl
Benchmark 2: 16755 known_rgbs_{rgbs,freqs}
  Time (mean ± σ): 226.409054 µs ± 124.581797 µs
  Range (min … max): 183.229000 µs … 1.423574 ms 111 runs
Benchmark 1: 16755 memcpy or distribute_oneshot_freqs.hlsl
  Time (mean ± σ): 129.693697 µs ± 62.794134 µs
  Range (min … max): 86.030000 µs … 777.894000 µs 142 runs
Benchmark 4: 1103347 known_rgbs_{rgbs,freqs}
  Time (mean ± σ): 29.529333 ms ± 5.895793 ms
  Range (min … max): 27.677594 ms … 75.453063 ms 62 runs
Benchmark 1: 1103347 memcpy or distribute_oneshot_freqs.hlsl
  Time (mean ± σ): 770.052019 µs ± 20.968305 µs
  Range (min … max): 735.030000 µs … 830.720000 µs 53 runs
-->
<p></p>
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>host → <samp>known_rgbs_{rgbs,freqs}</samp> </th> <td><span class="roboto-unscale math-font-normal">226µs</span></td> <td><span class="roboto-unscale math-font-normal">29.529ms</span></td> <td><span class="roboto-unscale math-font-normal">124µs</span>/<span class="roboto-unscale math-font-normal">62.8µs</span></td></tr>
 <tr><th>(proportion of <samp>measure()</samp>) </th> <td><span class="roboto-unscale math-font-normal">2.8%</span></td> <td><span class="roboto-unscale math-font-normal">21%</span></td> <td></td></tr>
 <tr><th>memcpy or <samp>distribute_oneshot_freqs.hlsl</samp></th> <td><span class="roboto-unscale math-font-normal">130µs</span></td> <td><span class="roboto-unscale math-font-normal">770µs</span></td> <td><span class="roboto-unscale math-font-normal">62.8µs</span>/<span class="roboto-unscale math-font-normal">21µs</span></td></tr>
 <tr><th>(speed-up, 5700 XT) </th> <td><span class="roboto-unscale math-font-normal">42.72%</span></td> <td><span class="roboto-unscale math-font-normal">38.347×</span></td> <td></td></tr>
 <tr><th>(proportion of <samp>measure()</samp>) </th> <td><span class="roboto-unscale math-font-normal">1.6%</span></td> <td><span class="roboto-unscale math-font-normal">0.6%</span></td> <td></td></tr>
</table>
<p class="indented">
This leaves just <samp>params</samp> (constant [​[​G^3 \operatorname{sizeof}(\texttt{(uint, uint)}) + \varepsilon \approx 8\text{MB} \approx 3\%​]​]) in <code>DEVICE_LOCAL & HOST_VISIBLE</code>,
freeing [​[​\overline{Set(I)}(\operatorname{sizeof}(\texttt{struct known_rgbs_pack}) + \operatorname{sizeof}(\texttt{uint})) = \overline{Set(I)} \cdot 20\text{B}​]​]
([​[​\in [335\text{kB}, 22\text{MB}] \approx [0.13\%, 8.6\%]​]​] in test data;
 theoretical maximum [​[​320\text{MiB} = 125\%​]​]).
</p>
<div class="singles">
<figure> <a href="/content/assets/blogn_t/018.33-graphml-known_rgbs-DEVICE_LOCAL.png"><img alt="" src="/content/assets/blogn_t/018.33-graphml-known_rgbs-DEVICE_LOCAL.png" /></a> <figcaption></figcaption> </figure>
</div>
<h2 id="gilbert" ><a class="hash-link" href="#gilbert">#</a> You do not under any circumstances have to hand it to Scott Adams</h2>
<p class="indented continued">
The <samp>[start, end)</samp> pairs in the <samp>groups_data</samp> half of [​[​h​]​] are <a href="#grid-grid">laid out</a> in natural axis order,
i.e. a linear search through <samp>group_ranges[<var>outermost</var>][<var>middle</var>][<var>innermost</var>]</samp>
corresponds to a linear search through <samp>groups_data</samp>;
if we, for convenience, say that each cell contains exactly one point, we then know that
<!-- [​[​\forall x,y,z \in [0, G ) \cap \mathbb{Z} : \texttt{group_ranges}[x][y][z] = G^2x + Gy + z​]​] -->
[​[​\forall x,y,z \in \bar{G} : \texttt{group_ranges}[x][y][z] = G^2x + Gy + z​]​]
and cast the traversal order back onto the the grid thusly
</p>
<div class="singles continuing">
 <figure> <a href="/content/assets/blogn_t/018.34-gilbert-iterorder+default.png"><img alt="Point cloud ε overlaid with a section of a 20x20x20 grid, and highlighted straight lines through center of each grid cell across each axis" src="/content/assets/blogn_t/018.34-gilbert-iterorder+default.png" /></a> <figcaption>Effective look-up order (starts bottom-right) for image <samp style="color: #b57688;">ε</samp> with [​[​G=20, r=0.05​]​] around [​[​(13, 7, 16)​]​]</figcaption> </figure>
</div>
<p class="continuing">
where a discontinuity (long diagonal line) occurs after every extremum;
thus, locality is low, and on the CPU one'd<!--'--> expect this to have a significant effect on iteration speed.
The ideal iteration order [​[​l​]​] would, in all possible cases, maximally preserve locality
(such that geometrically close cells'<!--'--> data is memorically close in <samp>groups_data</samp>):
<!-- [​[​\forall x,y,z \in [0, G ) \cap \mathbb{Z} : \texttt{group_ranges}[x][y][z] = l(G^2x + Gy + z)​]​]. -->
[​[​\forall x,y,z \in \bar{G} : \texttt{group_ranges}[x][y][z] = l(G^2x + Gy + z)​]​].
</p>
<p class="indented continuing">
The Hilbert curve is the canonical solution for this, and <span id="googling">googling</span> "hilbert curve 3d" yields
<a href="//arxiv.org/pdf/2308.05673"><cite>Algorithms for Encoding and Decoding 3D Hilbert Orderings</cite>, David Walker, August 2023</a>
with the world's<!--'--> most obtuse pseudocode.
Unfortunately, Hilbert curves are only defined for square/cubic domains with side length [​[​2^n​]​], which [​[​G=100​]​] is not.
Maybe [​[​G \in \{64, 128\}​]​] could work:
</p>
<script>
{
 let googlings = ["googling", "DDGing", "baiduing", "kagiing", "startpaging"];
 googling.innerText = googlings[Math.floor(Math.random() * googlings.length)];
}
</script>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...assign_cell.hlsl, grouping</span>
<small style='display: block; line-height: initial;'>
</small><!--"-->	<!--"--><span class="token comment">// copying</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> known_rgbs_groups<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">_</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> dump <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>gr_z<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">GroupDesc</span><span class="token punctuation">,</span> ga_z<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token keyword">if</span> ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">let</span> start <span class="token operator">=</span> cur<span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token comment">// memcpy(known_rgbs_groups,<!--"-->               <!--"-->ga_z.as_ptr(), ga_z.len())</span>
<!--"-->			<!--"-->known_rgbs_groups<span class="token punctuation">.</span><span class="token function">copy_from_nonoverlapping</span><span class="token punctuation">(</span>ga_z<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"-->cur <span class="token operator">+=</span> ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"-->known_rgbs_groups <span class="token operator">=</span> known_rgbs_groups<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ga_z<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->			<!--"--><span class="token operator">*</span>gr_z <span class="token operator">=</span> <span class="token class-name">GroupDesc</span> <span class="token punctuation">{</span>
<!--"-->				<!--"-->start_idx<span class="token punctuation">:</span> start<span class="token punctuation">,</span>
<!--"-->				<!--"-->end_idx<span class="token punctuation">:</span> cur<span class="token punctuation">,</span>
<!--"-->			<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token constant">GRID_SIZE</span> <span class="token operator">*</span> <span class="token constant">GRID_SIZE</span> <span class="token operator">*</span> <span class="token constant">GRID_SIZE</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function"><a href="//paste.sr.ht/~nabijaczleweli/86c046d7743aab3af2044f5f1b4b30980bb7be01">decodeh</a></span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token function">dump</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->		     <!--"--><span class="token operator">&amp;</span><!--"-->    <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span>cur <span class="token operator">==</span> known_rgbs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
</small><!--"-->	<!--"--><span class="token comment">// memcpy(self.buffer_groups_data, self.buffer_outputs, known_rgbs * mem::size_of::&lt;u32>())...</span>
<span class="token punctuation">}</span>
</code></pre>

</div>
<p class="indented continuing">
However,
<a href="//github.com/jakubcerveny/gilbert"> <!-- TODO: paper link when it comes out! -->
 <cite>Generalized Hilbert ("gilbert") space-filling curve for rectangular domains of arbitrary (non-power of two) sizes.</cite>,
 Jakub Červený, 2019</a>
may, after <a href="//github.com/jakubcerveny/gilbert/pull/17">a quick port</a>, allow using a more optimal [​[​G​]​]:
</p>
<table class="perf" id="gilbert-straight">
 <tr><th colspan=2>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th></th></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">64<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">94.98ms</span></td> <td><span class="roboto-unscale math-font-normal">6.01s</span></td> <td><span class="roboto-unscale math-font-normal">97.67s</span></td> <td></td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">80<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">128.99ms</span></td> <td><span class="roboto-unscale math-font-normal">6.87s</span></td> <td><span class="roboto-unscale math-font-normal">83.75s</span></td> <td></td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">90<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">126.06ms</span></td> <td><span class="roboto-unscale math-font-normal">6.98s</span></td> <td><span class="roboto-unscale math-font-normal">128.76s</span></td> <td></td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">100<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">120.33ms</span></td> <td><span class="roboto-unscale math-font-normal">6.81s</span></td> <td><span class="roboto-unscale math-font-normal">119.00s</span></td> <td></td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">128<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">162.10ms</span></td> <td><span class="roboto-unscale math-font-normal">10.74s</span></td> <td><span class="roboto-unscale math-font-normal">129.18s</span></td> <td></td></tr>
 <tr class="hspc"></tr>
 <tr><th>gilbert </th> <th><span class="roboto-unscale math-font-normal">80<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">130.03ms</span></td> <td><span class="roboto-unscale math-font-normal">6.80s</span></td> <td><span class="roboto-unscale math-font-normal">96.04s</span></td> <td></td></tr>
 <tr><th>gilbert </th> <th><span class="roboto-unscale math-font-normal">90<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">125.51ms</span></td> <td><span class="roboto-unscale math-font-normal">6.80s</span></td> <td><span class="roboto-unscale math-font-normal">107.87s</span></td> <td></td></tr>
 <tr><th>gilbert </th> <th><span class="roboto-unscale math-font-normal">100<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">121.04ms</span></td> <td><span class="roboto-unscale math-font-normal">6.71s</span></td> <td><span class="roboto-unscale math-font-normal">112.36s</span></td> <td></td></tr>
 <tr class="hspc"></tr>
 <tr><th>hilbert </th> <th><span class="roboto-unscale math-font-normal">64<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">94.65ms</span></td> <td><span class="roboto-unscale math-font-normal">6.04s</span></td> <td><span class="roboto-unscale math-font-normal">101.08s</span></td> <td></td></tr>
 <tr><th>hilbert </th> <th><span class="roboto-unscale math-font-normal">128<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">157.09ms</span></td> <td><span class="roboto-unscale math-font-normal">10.52s</span></td> <td><span class="roboto-unscale math-font-normal">123.02s</span></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th colspan=2>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th></th></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">64<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.21s</span></td> <td><span class="roboto-unscale math-font-normal">129.69s</span></td> <td>—</td> <td>(driver timeout)</td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">80<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.27s</span></td> <td><span class="roboto-unscale math-font-normal">138.32s</span></td> <td><span class="roboto-unscale math-font-normal">66.48s</span></td> <td>(came within 200ms of a driver timeout)</td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">90<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.30s</span></td> <td><span class="roboto-unscale math-font-normal">143.71s</span></td> <td><span class="roboto-unscale math-font-normal">52.33s</span></td> <td></td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">100<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.78s</span></td> <td><span class="roboto-unscale math-font-normal">142.43s</span></td> <td><span class="roboto-unscale math-font-normal">49.49s</span></td> <td></td></tr>
 <tr><th>straight</th> <th><span class="roboto-unscale math-font-normal">128<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">2.11s</span></td> <td><span class="roboto-unscale math-font-normal">190.65s</span></td> <td><span class="roboto-unscale math-font-normal">67.33s</span></td> <td></td></tr>
 <tr class="hspc"></tr>
 <tr><th>gilbert </th> <th><span class="roboto-unscale math-font-normal">80<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.27s</span></td> <td><span class="roboto-unscale math-font-normal">148.03s</span></td> <td>—</td> <td>(driver timeout)</td></tr>
 <tr><th>gilbert </th> <th><span class="roboto-unscale math-font-normal">90<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.26s</span></td> <td><span class="roboto-unscale math-font-normal">139.38s</span></td> <td><span class="roboto-unscale math-font-normal">56.16s</span></td> <td></td></tr>
 <tr><th>gilbert </th> <th><span class="roboto-unscale math-font-normal">100<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.75s</span></td> <td><span class="roboto-unscale math-font-normal">131.85s</span></td> <td><span class="roboto-unscale math-font-normal">48.74s</span></td> <td></td></tr>
 <tr class="hspc"></tr>
 <tr><th>hilbert </th> <th><span class="roboto-unscale math-font-normal">64<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">1.23s</span></td> <td><span class="roboto-unscale math-font-normal">130.17s</span></td> <td>—</td> <td>(driver timeout)</td></tr>
 <tr><th>hilbert </th> <th><span class="roboto-unscale math-font-normal">128<sup>3</sup></span></th> <td><span class="roboto-unscale math-font-normal">2.16s</span></td> <td><span class="roboto-unscale math-font-normal">189.07s</span></td> <td><span class="roboto-unscale math-font-normal">67.86s</span></td> <td>(driver timeout the first time)</td></tr>
 <tfoot class="label"><tr><td colspan=6>(Measurement multiplicity diminished.)</td></tr></tfoot>
</table>
<style>
.perf#gilbert-straight td:nth-child(6) {
 text-align: left;
}
</style>
<!--
3.19899885s
3.155824037s
3.316008449s
3.837746635s
3.420269573s
3.337262149s
3.277641974s
3.194660509s
3.236108377s
3.217661679s
3.23462594s
3.346330945s
3.226232104s
3.269617313s
3.852769932s
Benchmark 1:
  Time (mean ± σ): 3341.450564 ms ± 208.373769 ms
  Range (min … max): 3155.824037 ms … 3852.769932 ms 15 runs
-->
<p class="indented continued">
[​[​G=100​]​] gilbert seems, like, kinda the best. Maybe. A little bit? This sucks.
Just <em>generating</em> all the values of <samp>decodeh</samp>
<!-- ([​[​l : [0, G^3 ) \cap \mathbb[Z] \to ([0, G ) \cap \mathbb{Z})^3​]​] takes <span class="roboto-unscale math-font-normal">3341.45ms ± 208ms</span>) -->
([​[​l : {\mkern 1.5mu\overline{\mkern-1.5mu{G^3}\mkern-1.5mu}\mkern 1.5mu} \to \bar{G}^3​]​] takes <span class="roboto-unscale math-font-normal">3341.45ms ± 208ms</span>)
which is untenable to do live but it's<!--'--> constant, so may be pre-computed in
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/build.rs#L42"><samp>build.rs</samp></a>,
conveniently in parallel to the shaders building
(but only if need be since they don't<!--'--> take that long):
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token macro property">include!</span><span class="token punctuation">(</span><span class="token string">"ext/gilbert/ports/gilbert.rs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">let</span> grid_size <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token string">"src/shader.h"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>l<span class="token closure-punctuation punctuation">|</span></span> l<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"#define GRID_SIZE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ... glslc</span>
<!--"-->	<!--"--><span class="token keyword">let</span> out_dir <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var_os</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> grid_size_rs <span class="token operator">=</span> out_dir<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"grid_size.rs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span> grid_size <span class="token operator">!=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">read_to_string</span><span class="token punctuation">(</span>grid_size_rs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span>grid_size_rs<span class="token punctuation">,</span> grid_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">let</span> grid_size <span class="token operator">=</span> grid_size<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> grid_gilbert <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>out_dir<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"grid_gilbert.xyz"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>grid_size <span class="token operator">*</span> grid_size <span class="token operator">*</span> grid_size <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">gilbert<span class="token punctuation">::</span></span><span class="token function">d2xyz</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">(</span>grid_size<span class="token punctuation">,</span> grid_size<span class="token punctuation">,</span> grid_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"-->grid_gilbert<span class="token punctuation">.</span><span class="token function">write_all</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token comment">// ... glslc collexion</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continued">
Why not generate <samp>[(1, 2, 3), (4, 5, 6), …]</samp> and <samp>include!("…/grid_gilbert.rs")</samp>?
Because that <samp>include!</samp> would be of a million-element array which takes <span class="roboto-unscale math-font-normal">~40s</span> (and <a href="#network-effect-rust">implies</a> like three compiler bugs).
Including [​[​3\text{MB}​]​] directly is functionally instant:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">static</span> <span class="token constant">GRID_GILBERT</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/grid_gilbert.xyz"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token constant">GRID_GILBERT</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">GRID_SIZE</span> <span class="token operator">*</span> <span class="token constant">GRID_SIZE</span> <span class="token operator">*</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token constant">GRID_GILBERT</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token function">dump</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->		     <!--"--><span class="token operator">&amp;</span><!--"-->    <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<div class="singles">
 <figure> <a href="/content/assets/blogn_t/018.35-gilbert-iterorder+gilbert.png"><img alt="Same point cloud ε and section of 20x20x20 grid, but the highlighted lines wind and turn at every possible point" src="/content/assets/blogn_t/018.35-gilbert-iterorder+gilbert.png" /></a> <figcaption>Effective gilbert look-up order (starts near the top-left corner) for image <samp style="color: #b57688;">ε</samp> with [​[​G=20, r=0.05​]​] around [​[​(13, 7, 16)​]​]; note the decreased amount of diagonal lines, corresponding to non-linearities</figcaption> </figure>
</div>
<!--
2.900276ms: 16755 copied iter
2.652449ms: 16755 copied iter
2.619244ms: 16755 copied iter
2.642186ms: 16755 copied iter
2.640676ms: 16755 copied iter
2.960648ms: 16755 copied iter
3.022529ms: 16755 copied iter
3.188854ms: 16755 copied iter
3.151123ms: 16755 copied iter
3.052716ms: 16755 copied iter
3.162593ms: 16755 copied iter
3.226285ms: 16755 copied iter
3.048188ms: 16755 copied iter
3.301449ms: 16755 copied iter
3.32439ms: 16755 copied iter
2.525064ms: 16755 copied iter
2.551929ms: 16755 copied iter
2.531101ms: 16755 copied iter
2.557664ms: 16755 copied iter
2.570946ms: 16755 copied iter
2.577285ms: 16755 copied iter
2.659693ms: 16755 copied iter
2.740894ms: 16755 copied iter
2.651241ms: 16755 copied iter
3.374801ms: 16755 copied iter
2.682634ms: 16755 copied iter
2.822396ms: 16755 copied iter
2.756591ms: 16755 copied iter
2.747837ms: 16755 copied iter
3.778993ms: 16755 copied iter
3.320466ms: 16755 copied iter
2.805794ms: 16755 copied iter
3.727676ms: 16755 copied iter
2.592378ms: 16755 copied iter
2.674182ms: 16755 copied iter
2.621055ms: 16755 copied iter
2.612905ms: 16755 copied iter
2.676295ms: 16755 copied iter
2.697124ms: 16755 copied iter
2.651241ms: 16755 copied iter
2.626187ms: 16755 copied iter
2.62015ms: 16755 copied iter
2.745723ms: 16755 copied iter
2.641883ms: 16755 copied iter
2.647619ms: 16755 copied iter
3.02585ms: 16755 copied iter
3.261ms: 16755 copied iter
2.794323ms: 16755 copied iter
2.551628ms: 16755 copied iter
2.549212ms: 16755 copied iter
2.559476ms: 16755 copied iter
3.019209ms: 16755 copied iter
2.659693ms: 16755 copied iter
2.691992ms: 16755 copied iter
2.622263ms: 16755 copied iter
2.662108ms: 16755 copied iter
3.318655ms: 16755 copied iter
3.079884ms: 16755 copied iter
2.729121ms: 16755 copied iter
2.555853ms: 16755 copied iter
2.533817ms: 16755 copied iter
2.607773ms: 16755 copied iter
2.960648ms: 16755 copied iter
2.638563ms: 16755 copied iter
2.648223ms: 16755 copied iter
2.668146ms: 16755 copied iter
2.681427ms: 16755 copied iter
2.735159ms: 16755 copied iter
2.693502ms: 16755 copied iter
2.663014ms: 16755 copied iter
2.678711ms: 16755 copied iter
2.680823ms: 16755 copied iter
2.623168ms: 16755 copied iter
2.681427ms: 16755 copied iter
2.658486ms: 16755 copied iter
2.637658ms: 16755 copied iter
2.640676ms: 16755 copied iter
2.643695ms: 16755 copied iter
2.63977ms: 16755 copied iter
2.632224ms: 16755 copied iter
2.616829ms: 16755 copied iter
2.950687ms: 16755 copied iter
2.588756ms: 16755 copied iter
2.692295ms: 16755 copied iter
2.727612ms: 16755 copied iter
2.741497ms: 16755 copied iter
2.963063ms: 16755 copied iter
2.811831ms: 16755 copied iter
3.232323ms: 16755 copied iter
3.399856ms: 16755 copied iter
3.176781ms: 16755 copied iter
3.011059ms: 16755 copied iter
3.835742ms: 16755 copied iter
2.548609ms: 16755 copied iter
2.538647ms: 16755 copied iter
2.54227ms: 16755 copied iter
2.52929ms: 16755 copied iter
2.575172ms: 16755 copied iter
2.718556ms: 16755 copied iter
2.636148ms: 16755 copied iter
2.666938ms: 16755 copied iter
2.656071ms: 16755 copied iter
2.72731ms: 16755 copied iter
2.664825ms: 16755 copied iter
2.667844ms: 16755 copied iter
2.679918ms: 16755 copied iter
2.580304ms: 16755 copied iter
2.616829ms: 16755 copied iter
2.715236ms: 16755 copied iter
2.69169ms: 16755 copied iter
2.853487ms: 16755 copied iter
2.9365ms: 16755 copied iter
3.330729ms: 16755 copied iter
2.989627ms: 16755 copied iter
7.455956ms: 1103347 copied iter
7.586057ms: 1103347 copied iter
7.479802ms: 1103347 copied iter
9.543925ms: 1103347 copied iter
8.757276ms: 1103347 copied iter
12.985135ms: 1103347 copied iter
8.825195ms: 1103347 copied iter
8.487715ms: 1103347 copied iter
7.818792ms: 1103347 copied iter
7.450824ms: 1103347 copied iter
7.499726ms: 1103347 copied iter
7.500631ms: 1103347 copied iter
8.062393ms: 1103347 copied iter
8.533598ms: 1103347 copied iter
7.913275ms: 1103347 copied iter
7.831772ms: 1103347 copied iter
7.541081ms: 1103347 copied iter
7.742723ms: 1103347 copied iter
7.548325ms: 1103347 copied iter
7.221712ms: 1103347 copied iter
8.161705ms: 1103347 copied iter
7.525383ms: 1103347 copied iter
8.180119ms: 1103347 copied iter
8.150235ms: 1103347 copied iter
8.093485ms: 1103347 copied iter
7.539269ms: 1103347 copied iter
7.697746ms: 1103347 copied iter
7.366303ms: 1103347 copied iter
8.066016ms: 1103347 copied iter
8.173176ms: 1103347 copied iter
7.579417ms: 1103347 copied iter
9.274967ms: 1103347 copied iter
7.853808ms: 1103347 copied iter
7.864372ms: 1103347 copied iter
10.101461ms: 1103347 copied iter
8.053639ms: 1103347 copied iter
7.555871ms: 1103347 copied iter
8.047904ms: 1103347 copied iter
8.347349ms: 1103347 copied iter
7.689293ms: 1103347 copied iter
7.510291ms: 1103347 copied iter
8.110993ms: 1103347 copied iter
7.608395ms: 1103347 copied iter
7.577907ms: 1103347 copied iter
7.757514ms: 1103347 copied iter
8.243811ms: 1103347 copied iter
7.462899ms: 1103347 copied iter
7.497612ms: 1103347 copied iter
8.472019ms: 1103347 copied iter
8.861418ms: 1103347 copied iter
8.280337ms: 1103347 copied iter
9.015367ms: 1103347 copied iter
9.286136ms: 1103347 copied iter
7.967609ms: 1103347 copied iter
12.92597ms: 16755 copied gilbert
10.305821ms: 16755 copied gilbert
12.271537ms: 16755 copied gilbert
24.773695ms: 16755 copied gilbert
11.266341ms: 16755 copied gilbert
10.561195ms: 16755 copied gilbert
10.780949ms: 16755 copied gilbert
10.290728ms: 16755 copied gilbert
10.399096ms: 16755 copied gilbert
10.644811ms: 16755 copied gilbert
10.413283ms: 16755 copied gilbert
10.228846ms: 16755 copied gilbert
11.141975ms: 16755 copied gilbert
10.434715ms: 16755 copied gilbert
10.60104ms: 16755 copied gilbert
10.032034ms: 16755 copied gilbert
10.475466ms: 16755 copied gilbert
10.010903ms: 16755 copied gilbert
10.388531ms: 16755 copied gilbert
9.85786ms: 16755 copied gilbert
10.377965ms: 16755 copied gilbert
9.889555ms: 16755 copied gilbert
10.325744ms: 16755 copied gilbert
9.840956ms: 16755 copied gilbert
10.324838ms: 16755 copied gilbert
10.206509ms: 16755 copied gilbert
10.30401ms: 16755 copied gilbert
9.825259ms: 16755 copied gilbert
10.817173ms: 16755 copied gilbert
10.202887ms: 16755 copied gilbert
11.35207ms: 16755 copied gilbert
10.477882ms: 16755 copied gilbert
9.95687ms: 16755 copied gilbert
10.723596ms: 16755 copied gilbert
10.048032ms: 16755 copied gilbert
10.524971ms: 16755 copied gilbert
9.965021ms: 16755 copied gilbert
10.396077ms: 16755 copied gilbert
9.889857ms: 16755 copied gilbert
10.319405ms: 16755 copied gilbert
10.395474ms: 16755 copied gilbert
10.350496ms: 16755 copied gilbert
10.316688ms: 16755 copied gilbert
10.488447ms: 16755 copied gilbert
10.145533ms: 16755 copied gilbert
10.53614ms: 16755 copied gilbert
10.225224ms: 16755 copied gilbert
10.914673ms: 16755 copied gilbert
10.458563ms: 16755 copied gilbert
10.894449ms: 16755 copied gilbert
13.295146ms: 16755 copied gilbert
10.872111ms: 16755 copied gilbert
11.085527ms: 16755 copied gilbert
13.994557ms: 16755 copied gilbert
11.541336ms: 16755 copied gilbert
10.557874ms: 16755 copied gilbert
11.226798ms: 16755 copied gilbert
12.705914ms: 16755 copied gilbert
10.703372ms: 16755 copied gilbert
10.291332ms: 16755 copied gilbert
10.501427ms: 16755 copied gilbert
10.050749ms: 16755 copied gilbert
11.457117ms: 16755 copied gilbert
11.349051ms: 16755 copied gilbert
11.246418ms: 16755 copied gilbert
11.068623ms: 16755 copied gilbert
13.998179ms: 16755 copied gilbert
10.322121ms: 16755 copied gilbert
14.075757ms: 16755 copied gilbert
13.361857ms: 16755 copied gilbert
11.227703ms: 16755 copied gilbert
11.756261ms: 16755 copied gilbert
11.889381ms: 16755 copied gilbert
10.943048ms: 16755 copied gilbert
15.674109ms: 16755 copied gilbert
9.835522ms: 16755 copied gilbert
11.012778ms: 16755 copied gilbert
9.772434ms: 16755 copied gilbert
10.426867ms: 16755 copied gilbert
9.779376ms: 16755 copied gilbert
10.771894ms: 16755 copied gilbert
9.852728ms: 16755 copied gilbert
10.572364ms: 16755 copied gilbert
9.819524ms: 16755 copied gilbert
10.298576ms: 16755 copied gilbert
9.802317ms: 16755 copied gilbert
10.505351ms: 16755 copied gilbert
10.426565ms: 16755 copied gilbert
10.628208ms: 16755 copied gilbert
10.296463ms: 16755 copied gilbert
10.45011ms: 16755 copied gilbert
11.158577ms: 16755 copied gilbert
10.518029ms: 16755 copied gilbert
10.444375ms: 16755 copied gilbert
10.552441ms: 16755 copied gilbert
10.342346ms: 16755 copied gilbert
9.757038ms: 16755 copied gilbert
10.373136ms: 16755 copied gilbert
9.878689ms: 16755 copied gilbert
10.616436ms: 16755 copied gilbert
9.717495ms: 16755 copied gilbert
10.443469ms: 16755 copied gilbert
10.046522ms: 16755 copied gilbert
10.319707ms: 16755 copied gilbert
9.807449ms: 16755 copied gilbert
10.298576ms: 16755 copied gilbert
9.910685ms: 16755 copied gilbert
10.344158ms: 16755 copied gilbert
9.752812ms: 16755 copied gilbert
10.800269ms: 16755 copied gilbert
9.832503ms: 16755 copied gilbert
10.307934ms: 16755 copied gilbert
9.765491ms: 16755 copied gilbert
10.809928ms: 16755 copied gilbert
9.777867ms: 16755 copied gilbert
10.579608ms: 16755 copied gilbert
9.923968ms: 16755 copied gilbert
10.340233ms: 16755 copied gilbert
9.861784ms: 16755 copied gilbert
11.361729ms: 16755 copied gilbert
9.830995ms: 16755 copied gilbert
10.322423ms: 16755 copied gilbert
10.337215ms: 16755 copied gilbert
10.498408ms: 16755 copied gilbert
10.87845ms: 16755 copied gilbert
13.964069ms: 16755 copied gilbert
11.117826ms: 16755 copied gilbert
11.733923ms: 16755 copied gilbert
12.095854ms: 16755 copied gilbert
11.977827ms: 16755 copied gilbert
11.542543ms: 16755 copied gilbert
14.112282ms: 16755 copied gilbert
11.178499ms: 16755 copied gilbert
11.961526ms: 16755 copied gilbert
11.605935ms: 16755 copied gilbert
10.775215ms: 16755 copied gilbert
11.200536ms: 16755 copied gilbert
12.065668ms: 16755 copied gilbert
11.714ms: 16755 copied gilbert
16.503018ms: 16755 copied gilbert
14.218236ms: 16755 copied gilbert
9.981622ms: 16755 copied gilbert
11.559448ms: 16755 copied gilbert
11.370785ms: 16755 copied gilbert
13.027698ms: 16755 copied gilbert
10.844943ms: 16755 copied gilbert
13.716544ms: 16755 copied gilbert
11.426026ms: 16755 copied gilbert
9.810166ms: 16755 copied gilbert
10.416604ms: 16755 copied gilbert
9.841559ms: 16755 copied gilbert
10.35442ms: 16755 copied gilbert
10.09965ms: 16755 copied gilbert
10.418114ms: 16755 copied gilbert
10.366797ms: 16755 copied gilbert
11.207177ms: 16755 copied gilbert
9.997018ms: 16755 copied gilbert
10.403322ms: 16755 copied gilbert
10.304915ms: 16755 copied gilbert
10.464902ms: 16755 copied gilbert
10.166663ms: 16755 copied gilbert
10.419924ms: 16755 copied gilbert
16.375633ms: 1103347 copied gilbert
16.774391ms: 1103347 copied gilbert
16.448684ms: 1103347 copied gilbert
16.393443ms: 1103347 copied gilbert
16.760505ms: 1103347 copied gilbert
19.323603ms: 1103347 copied gilbert
17.731289ms: 1103347 copied gilbert
20.767704ms: 1103347 copied gilbert
21.144124ms: 1103347 copied gilbert
16.40612ms: 1103347 copied gilbert
16.41578ms: 1103347 copied gilbert
16.614405ms: 1103347 copied gilbert
16.546788ms: 1103347 copied gilbert
16.872797ms: 1103347 copied gilbert
16.760806ms: 1103347 copied gilbert
16.963658ms: 1103347 copied gilbert
16.714622ms: 1103347 copied gilbert
16.93649ms: 1103347 copied gilbert
16.59267ms: 1103347 copied gilbert
16.790088ms: 1103347 copied gilbert
16.819066ms: 1103347 copied gilbert
17.026444ms: 1103347 copied gilbert
16.439627ms: 1103347 copied gilbert
16.897248ms: 1103347 copied gilbert
16.758392ms: 1103347 copied gilbert
16.312242ms: 1103347 copied gilbert
16.979354ms: 1103347 copied gilbert
16.669041ms: 1103347 copied gilbert
16.695304ms: 1103347 copied gilbert
16.234664ms: 1103347 copied gilbert
16.812123ms: 1103347 copied gilbert
16.743903ms: 1103347 copied gilbert
17.75272ms: 1103347 copied gilbert
17.293289ms: 1103347 copied gilbert
18.204002ms: 1103347 copied gilbert
23.439774ms: 1103347 copied gilbert
17.209976ms: 1103347 copied gilbert
16.510866ms: 1103347 copied gilbert
17.612959ms: 1103347 copied gilbert
16.968487ms: 1103347 copied gilbert
16.825707ms: 1103347 copied gilbert
17.206353ms: 1103347 copied gilbert
17.473802ms: 1103347 copied gilbert
18.319916ms: 1103347 copied gilbert
16.65425ms: 1103347 copied gilbert
16.812425ms: 1103347 copied gilbert
16.599312ms: 1103347 copied gilbert
16.768656ms: 1103347 copied gilbert
16.709189ms: 1103347 copied gilbert
17.059648ms: 1103347 copied gilbert
16.575163ms: 1103347 copied gilbert
16.729716ms: 1103347 copied gilbert
16.777107ms: 1103347 copied gilbert
16.82299ms: 1103347 copied gilbert
16.28598ms: 1103347 copied gilbert
16.875815ms: 1103347 copied gilbert
17.578849ms: 1103347 copied gilbert
17.164697ms: 1103347 copied gilbert
17.80132ms: 1103347 copied gilbert
21.575483ms: 1103347 copied gilbert
23.018678ms: 1103347 copied gilbert
22.066912ms: 1103347 copied gilbert
16.429062ms: 1103347 copied gilbert
16.42544ms: 1103347 copied gilbert
16.537732ms: 1103347 copied gilbert
16.76292ms: 1103347 copied gilbert
16.650024ms: 1103347 copied gilbert
16.925321ms: 1103347 copied gilbert
17.443313ms: 1103347 copied gilbert
18.293353ms: 1103347 copied gilbert
18.501636ms: 1103347 copied gilbert
16.535619ms: 1103347 copied gilbert
16.321298ms: 1103347 copied gilbert
17.523306ms: 1103347 copied gilbert
18.212454ms: 1103347 copied gilbert
17.829695ms: 1103347 copied gilbert
17.995115ms: 1103347 copied gilbert
17.698687ms: 1103347 copied gilbert
5.35561ms: 328666 copied iter
5.197435ms: 328666 copied iter
5.131327ms: 328666 copied iter
5.15608ms: 328666 copied iter
5.537934ms: 328666 copied iter
5.36376ms: 328666 copied iter
5.149137ms: 328666 copied iter
5.107783ms: 328666 copied iter
5.168758ms: 328666 copied iter
5.526162ms: 328666 copied iter
5.321198ms: 328666 copied iter
5.14159ms: 328666 copied iter
5.165739ms: 328666 copied iter
5.993743ms: 328666 copied iter
5.48873ms: 328666 copied iter
5.170871ms: 328666 copied iter
5.628492ms: 328666 copied iter
7.22805ms: 328666 copied iter
5.509559ms: 328666 copied iter
5.195926ms: 328666 copied iter
5.620644ms: 328666 copied iter
8.494658ms: 328666 copied iter
8.636834ms: 328666 copied iter
9.808958ms: 328666 copied iter
6.382237ms: 328666 copied iter
6.784617ms: 328666 copied iter
6.26421ms: 328666 copied iter
5.219169ms: 328666 copied iter
7.874334ms: 328666 copied iter
8.365462ms: 328666 copied iter
5.555743ms: 328666 copied iter
6.277794ms: 328666 copied iter
5.35561ms: 328666 copied iter
5.205283ms: 328666 copied iter
5.846435ms: 328666 copied iter
5.197737ms: 328666 copied iter
5.148232ms: 328666 copied iter
5.501106ms: 328666 copied iter
5.224602ms: 328666 copied iter
5.159099ms: 328666 copied iter
5.161212ms: 328666 copied iter
5.725087ms: 328666 copied iter
5.384286ms: 328666 copied iter
5.244224ms: 328666 copied iter
5.192605ms: 328666 copied iter
5.200454ms: 328666 copied iter
5.648717ms: 328666 copied iter
5.485712ms: 328666 copied iter
5.107783ms: 328666 copied iter
5.105971ms: 328666 copied iter
5.58442ms: 328666 copied iter
5.34112ms: 328666 copied iter
5.273202ms: 328666 copied iter
5.153967ms: 328666 copied iter
5.630906ms: 328666 copied iter
5.534311ms: 328666 copied iter
5.147628ms: 328666 copied iter
5.125592ms: 328666 copied iter
5.614003ms: 328666 copied iter
5.343536ms: 328666 copied iter
5.847945ms: 328666 copied iter
5.574156ms: 328666 copied iter
5.127403ms: 328666 copied iter
5.122573ms: 328666 copied iter
5.49839ms: 328666 copied iter
6.356277ms: 328666 copied iter
5.261429ms: 328666 copied iter
5.105971ms: 328666 copied iter
5.165135ms: 328666 copied iter
7.024294ms: 328666 copied iter
5.333876ms: 328666 copied iter
5.116838ms: 328666 copied iter
6.671118ms: 328666 copied iter
5.658678ms: 328666 copied iter
5.644491ms: 328666 copied iter
5.463978ms: 328666 copied iter
5.335687ms: 328666 copied iter
5.308217ms: 328666 copied iter
5.920994ms: 328666 copied iter
5.601928ms: 328666 copied iter
5.869678ms: 328666 copied iter
6.636102ms: 328666 copied iter
5.882659ms: 328666 copied iter
6.065586ms: 328666 copied iter
5.367382ms: 328666 copied iter
8.375725ms: 328666 copied iter
5.495372ms: 328666 copied iter
5.492956ms: 328666 copied iter
5.336291ms: 328666 copied iter
6.840462ms: 328666 copied iter
14.075154ms: 328666 copied gilbert
20.73782ms: 328666 copied gilbert
19.686137ms: 328666 copied gilbert
37.901611ms: 328666 copied gilbert
20.257258ms: 328666 copied gilbert
15.582947ms: 328666 copied gilbert
14.34713ms: 328666 copied gilbert
13.914866ms: 328666 copied gilbert
14.205859ms: 328666 copied gilbert
14.265628ms: 328666 copied gilbert
13.93177ms: 328666 copied gilbert
15.0885ms: 328666 copied gilbert
14.184125ms: 328666 copied gilbert
17.135718ms: 328666 copied gilbert
14.09085ms: 328666 copied gilbert
15.411491ms: 328666 copied gilbert
14.680082ms: 328666 copied gilbert
13.959843ms: 328666 copied gilbert
13.982784ms: 328666 copied gilbert
14.090247ms: 328666 copied gilbert
13.858115ms: 328666 copied gilbert
14.873877ms: 328666 copied gilbert
16.459852ms: 328666 copied gilbert
14.359204ms: 328666 copied gilbert
14.16209ms: 328666 copied gilbert
14.276495ms: 328666 copied gilbert
13.814347ms: 328666 copied gilbert
16.049623ms: 328666 copied gilbert
15.308556ms: 328666 copied gilbert
13.573763ms: 328666 copied gilbert
14.22699ms: 328666 copied gilbert
14.35679ms: 328666 copied gilbert
15.102989ms: 328666 copied gilbert
15.230676ms: 328666 copied gilbert
13.392043ms: 328666 copied gilbert
13.95622ms: 328666 copied gilbert
13.668547ms: 328666 copied gilbert
15.595927ms: 328666 copied gilbert
15.032655ms: 328666 copied gilbert
15.197169ms: 328666 copied gilbert
14.099906ms: 328666 copied gilbert
16.615612ms: 328666 copied gilbert
13.487129ms: 328666 copied gilbert
13.85721ms: 328666 copied gilbert
13.61391ms: 328666 copied gilbert
14.756754ms: 328666 copied gilbert
15.252409ms: 328666 copied gilbert
14.055231ms: 328666 copied gilbert
17.010143ms: 328666 copied gilbert
17.475311ms: 328666 copied gilbert
21.113033ms: 328666 copied gilbert
18.868397ms: 328666 copied gilbert
16.758996ms: 328666 copied gilbert
14.513455ms: 328666 copied gilbert
16.217458ms: 328666 copied gilbert
15.578419ms: 328666 copied gilbert
14.343206ms: 328666 copied gilbert
15.758027ms: 328666 copied gilbert
14.709664ms: 328666 copied gilbert
14.286758ms: 328666 copied gilbert
14.240573ms: 328666 copied gilbert
15.630339ms: 328666 copied gilbert
15.220412ms: 328666 copied gilbert
14.197407ms: 328666 copied gilbert
13.709601ms: 328666 copied gilbert
15.292255ms: 328666 copied gilbert
14.641746ms: 328666 copied gilbert
14.522813ms: 328666 copied gilbert
13.885887ms: 328666 copied gilbert
13.39476ms: 328666 copied gilbert
15.180868ms: 328666 copied gilbert
13.762427ms: 328666 copied gilbert
14.346526ms: 328666 copied gilbert
13.879548ms: 328666 copied gilbert
15.672902ms: 328666 copied gilbert
14.621823ms: 328666 copied gilbert
14.190464ms: 328666 copied gilbert
14.049194ms: 328666 copied gilbert
14.719928ms: 328666 copied gilbert
14.897422ms: 328666 copied gilbert
15.287124ms: 328666 copied gilbert
19.880234ms: 328666 copied gilbert
18.73739ms: 328666 copied gilbert
15.287728ms: 328666 copied gilbert
14.228197ms: 328666 copied gilbert
15.604379ms: 328666 copied gilbert
13.391137ms: 328666 copied gilbert
16.075886ms: 328666 copied gilbert
Benchmark 1: 16755 copied iter
  Time (mean ± σ): 2.799341 ms ± 279.027780 µs
  Range (min … max): 2.525064 ms … 3.835742 ms 114 runs
Benchmark 2: 328666 copied iter
  Time (mean ± σ): 5.744078 ms ± 904.469989 µs
  Range (min … max): 5.105971 ms … 9.808958 ms 90 runs
Benchmark 3: 1103347 copied iter
  Time (mean ± σ): 8.125180 ms ± 898.243020 µs
  Range (min … max): 7.221712 ms … 12.985135 ms 54 runs
Benchmark 4: 16755 copied gilbert
  Time (mean ± σ): 10.933469 ms ± 1.584172 ms
  Range (min … max): 9.717495 ms … 24.773695 ms 162 runs
Benchmark 5: 328666 copied gilbert
  Time (mean ± σ): 15.397111 ms ± 2.937021 ms
  Range (min … max): 13.391137 ms … 37.901611 ms 88 runs
Benchmark 6: 1103347 copied gilbert
  Time (mean ± σ): 17.391026 ms ± 1.480367 ms
  Range (min … max): 16.234664 ms … 23.439774 ms 78 runs
-->
<table class="perf">
 <tr><th>(colours) </th><th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th><q>copying</q> in axis order </th> <td><span class="roboto-unscale math-font-normal">2.799ms</span></td> <td><span class="roboto-unscale math-font-normal">5.744ms</span></td> <td><span class="roboto-unscale math-font-normal">8.125ms</span></td> <td><span class="roboto-unscale math-font-normal">279µs</span>/<span class="roboto-unscale math-font-normal">904µs</span>/<span class="roboto-unscale math-font-normal">898µs</span></td></tr>
 <tr><th><q>copying</q> with <samp>GRID_GILBERT</samp></th> <td><span class="roboto-unscale math-font-normal">10.933ms</span></td> <td><span class="roboto-unscale math-font-normal">15.397ms</span></td> <td><span class="roboto-unscale math-font-normal">17.391ms</span></td> <td><span class="roboto-unscale math-font-normal">1.58ms</span>/<span class="roboto-unscale math-font-normal">2.94ms</span>/<span class="roboto-unscale math-font-normal">1.48ms</span></td></tr>
</table>
<p class="continuing">
so, maybe,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/64024237ced1d8b13f52d8595d1f49ef7ae9dc4b/item/src/posterise_gpu.rs#L784">only use this order</a>
if it'll<!--'--> buy more than it takes:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token keyword">if</span> known_rgbs <span class="token operator">></span> <span class="token number">75_000</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token constant">GRID_GILBERT</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token function">dump</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->			     <!--"--><span class="token operator">&amp;</span><!--"-->    <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
</small><!--"-->	<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>gr_z<span class="token punctuation">,</span> ga_z<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		               <!--"--><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><!--"-->    <!--"--><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token function">dump</span><span class="token punctuation">(</span>gr_z<span class="token punctuation">,</span> ga_z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
</small><!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<!--
109.958741ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.894491ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.795719ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
106.697441ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.377103ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.830369ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.823426ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.631205ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.405047ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.402202ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.815276ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.420918ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.759066ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.262505ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.838821ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.401791ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.768424ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.243982ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.303988ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.343532ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.901371ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.842508ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.66719ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.683189ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.481053ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.733234ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.93173ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.144414ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.196288ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.21397ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.293725ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.054825ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.941929ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.59854ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.398169ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.54276ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.197843ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.663504ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.534976ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.485342ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
109.843129ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
107.744897ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
109.097231ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.312852ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.538168ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.253879ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.229602ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
1.571405113s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.567433232s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.570773017s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.55837017s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.555731306s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.5893471s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.550970059s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.564130273s: MSC 27868 RGBs @ r=0.02 => ~375 levels
6.022318965s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.995966539s: MSC 84860 RGBs @ r=0.02 => ~245 levels
6.005150345s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.999533324s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.982980196s: MSC 84860 RGBs @ r=0.02 => ~245 levels
105.06680506s: MSC 242931 RGBs @ r=0.02 => ~155 levels
108.011177595s: MSC 242931 RGBs @ r=0.02 => ~155 levels
105.621038231s: MSC 242931 RGBs @ r=0.02 => ~155 levels
115.997102139s: MSC 328666 RGBs @ r=0.02 => ~221 levels
117.976591016s: MSC 328666 RGBs @ r=0.02 => ~221 levels
117.382114401s: MSC 328666 RGBs @ r=0.02 => ~221 levels
51.824589741s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
48.887123172s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
47.763700545s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
47.987010035s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
88.986075ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
90.022664ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
89.695145ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.887412ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.231295ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.52035ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.402084ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.955633ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.669533ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.930276ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.089055ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
88.189766ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.733893ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
87.909942ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
87.402816ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
87.509071ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
90.66774ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.878421ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
89.686391ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.589841ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
87.90964ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.467222ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.785987ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.221938ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.707503ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.37317ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.550536ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.961368ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.457087ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.089357ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
83.980019ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.603187ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.278322ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
85.434685ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
90.189894ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.537382ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
86.160057ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.703277ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
84.753688ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
894.100981ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
536.320163ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
537.205218ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
539.637611ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
535.264858ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
543.904107ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
539.687417ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
534.397915ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
546.501919ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
539.14588ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
6.564402854s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
6.594032881s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
52.458754378s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
54.276337031s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
54.510249977s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
24.141740129s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
26.274052852s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
26.17244478s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
76.85392304s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
72.732101783s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
75.797390295s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 104.244689 ms ± 2.032154 ms
  Range (min … max): 101.144414 ms … 109.958741 ms 47 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 => ~245 levels
  Time (mean ± σ): 6001.189874 ms ± 12.835448 ms
  Range (min … max): 5982.980196 ms … 6022.318965 ms 5 runs
Benchmark 5: MSC 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 106233.006962 ms ± 1277.552791 ms
  Range (min … max): 105066.805060 ms … 108011.177595 ms 3 runs
Benchmark 2: MSC 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 1566.020034 ms ± 11.136597 ms
  Range (min … max): 1550.970059 ms … 1589.347100 ms 8 runs
Benchmark 6: MSC 328666 RGBs @ r=0.02 => ~221 levels
  Time (mean ± σ): 117118.602519 ms ± 829.326207 ms
  Range (min … max): 115997.102139 ms … 117976.591016 ms 3 runs
Benchmark 4: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
  Time (mean ± σ): 49115.605873 ms ± 1619.581313 ms
  Range (min … max): 47763.700545 ms … 51824.589741 ms 4 runs
Benchmark 1: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
  Time (mean ± σ): 86.387736 ms ± 1.816057 ms
  Range (min … max): 83.980019 ms … 90.667740 ms 39 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
  Time (mean ± σ): 6579.217868 ms ± 14.815014 ms
  Range (min … max): 6564.402854 ms … 6594.032881 ms 2 runs
Benchmark 5: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
  Time (mean ± σ): 53748.447129 ms ± 916.936697 ms
  Range (min … max): 52458.754378 ms … 54510.249977 ms 3 runs
Benchmark 2: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
  Time (mean ± σ): 574.616607 ms ± 106.554231 ms
  Range (min … max): 534.397915 ms … 894.100981 ms 10 runs
Benchmark 1: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
  Time (mean ± σ): 75127.805039 ms ± 1748.067682 ms
  Range (min … max): 72732.101783 ms … 76853.923040 ms 3 runs
Benchmark 4: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
  Time (mean ± σ): 25529.412587 ms ± 982.109019 ms
  Range (min … max): 24141.740129 ms … 26274.052852 ms 3 runs
-->
<p></p>
<table class="perf left">
 <caption><code>if true {</code></caption>
 <tr><th>(colours) </th><th>*<span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">104.245ms</span></td> <td><span class="roboto-unscale math-font-normal">6.001s</span></td> <td><span class="roboto-unscale math-font-normal">106.233s</span></td> <td><span class="roboto-unscale math-font-normal">2.03ms</span>/<span class="roboto-unscale math-font-normal">12.84ms</span>/<span class="roboto-unscale math-font-normal">1.277s</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">2.88%</span></td> <td><span class="roboto-unscale math-font-normal">1.17%</span></td> <td><span class="roboto-unscale math-font-normal">3.44%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">19.34%</span></td> <td><span class="roboto-unscale math-font-normal">9.16%</span></td> <td>—</td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">86.388ms</span></td> <td><span class="roboto-unscale math-font-normal">6.579s</span></td> <td><span class="roboto-unscale math-font-normal">53.748s</span></td> <td><span class="roboto-unscale math-font-normal">1.82ms</span>/<span class="roboto-unscale math-font-normal">14.82ms</span>/<span class="roboto-unscale math-font-normal">916.9ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">36.81%</span></td> <td><span class="roboto-unscale math-font-normal">1.35%</span></td> <td><span class="roboto-unscale math-font-normal">-1.05%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">28.67%</span></td> <td><span class="roboto-unscale math-font-normal">-51.02%</span></td> <td>—</td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th><th>*<span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">1.566s</span></td> <td><span class="roboto-unscale math-font-normal">117.119s</span></td> <td><span class="roboto-unscale math-font-normal">49.116s</span></td> <td><span class="roboto-unscale math-font-normal">11.14ms</span>/<span class="roboto-unscale math-font-normal">829.3ms</span>/<span class="roboto-unscale math-font-normal">1.62s</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">16.79%</span></td> <td><span class="roboto-unscale math-font-normal">4.76%</span></td> <td><span class="roboto-unscale math-font-normal">0.45%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-7.57%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">574.617ms</span></td> <td><span class="roboto-unscale math-font-normal">75.128s</span></td> <td><span class="roboto-unscale math-font-normal">25.529s</span></td> <td><span class="roboto-unscale math-font-normal">106.6ms</span>/<span class="roboto-unscale math-font-normal">1.748ms</span>/<span class="roboto-unscale math-font-normal">982ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-2.95%</span></td> <td><span class="roboto-unscale math-font-normal">3.32%</span></td> <td><span class="roboto-unscale math-font-normal">-5.71%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-53.88%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tfoot class="slowdown-didnt"><tr><td colspan=5><strong>*</strong>: slow-down doesn't<!--'--> apply (and subsequent measurement comparisons will ignore it)<br /> <strong>—</strong>: didn't<!--'--> complete before</td></tfoot>
</table>
<div class="one-by-each dark-invert">
 <figure> <a href="/content/assets/blogn_t/018.36-gilbert-index.png"><img alt="Plot with unlabelled x axis [0, 360] and y axis labelled index [0, 6200]; 'byaxis' looks piecewise-linear, starts around 4500 and climbs with a steady incline between x=0/x=66/x=150/x=220/x=270 but there are large jumps around those discontinuities; bygilbert stays much flatter between x=0/x=230, then jumps less, and this repeats at x=270 and x=340; adjacent_difference(byaxis) and adjacent_difference(bygilbert) are all flattened around y=0 but highlight the large discontinuities" src="/content/assets/blogn_t/018.36-gilbert-index.png" /></a> <figcaption></figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.37-gilbert-Δindex.png"><img alt="That same plot, with y axis truncated and labelled Δindex [0, 40]; byaxis and bygilbert are unseen; adjacent_difference(byaxis) is 1 with steady bumps up to y=13 every like 10, with larger jumps around the bigger discontinuities; adjacent_difference(bygilbert) stays around y=1 throughout, with smaller fluctuations to around y=4 sometimes and similar off-screen jumps around the big discontinuities" src="/content/assets/blogn_t/018.37-gilbert-Δindex.png" /></a> <figcaption></figcaption> </figure>
</div>
<p class="indented">
gilbert is distributed under the terms of <a href="//github.com/jakubcerveny/gilbert/blob/master/LICENSE"><cite>BSD-2-Clause</cite></a>.
This doesn't<!--'--> impact our overall <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/trunk/item/LICENSES/0BSD.txt"><cite>0BSD</cite></a>
since neither the code nor its binary form is re-distributed – just the indices, which, as just some data, are not beholden to copyright.
</p>
<h2 id="ellipsoid-vs-prism" ><a class="hash-link" href="#ellipsoid-vs-prism">#</a> Totally ellipsoidal, man!</h2>
<div class="singles">
 <figure>
  <video width="100%" autoplay controls loop><source src="/content/assets/blogn_t/018.38-ellipsoid-vs-prism.mp4" type="video/mp4" /></video>
  <figcaption>The prismatic bounds between [​[​g_{tm} \sim g_{tM}​]​] include <span class="roboto-unscale math-font-normal">~2.2×</span> more cells than just the cells that intersect the ellipsoid [​[​R​]​],
              even when it's<!--'--> like half-way out-of-bounds ([​[​r=0.1, G=20​]​]).</figcaption>
 </figure>
</div>
<p class="indented continued">
If, instead of iterating the cells intersecting the bounding box of the ellipsoid of interest,
only the cells that intersect <em>it</em> are inspected,
we can expect the upper bounds of the speed-up to be proportional to the volume of an ellipsoid vs that of its bounding box prism, so
[​[​\frac{V_p}{V_e}​]​] where heretofore [​[​V_p = 2R_x2R_y2R_z​]​]
but now [​[​V_e = \frac{4}{3}\pi R_xR_yR_z​]​], so
[​[​\frac{8}{\frac{4}{3}\pi} \approx 47.64%​]​].
(It will be lower because the, uh. "edges" are quantised outward to iterate the whole cell and evaluating the radius bounds themselves itself bears a cost.)
</p>
<p class="indented continuing">
Thus, we seek, for a given point [​[​q_t​]​] and radius [​[​r​]​],
cubic lattice cells that intersect [​[​r​]​] around [​[​q_t​]​] or are full contained therewithin,
which, it seemed natural to me, is equivalent, for cell [​[​C​]​] to finding
closest-to-[​[​q_t​]​] point [​[​C_c \in C​]​]
furthest-from-[​[​q_t​]​] point [​[​C_f \in C​]​]
such that at least one is inside the radius [​[​|\overrightarrow{C_cq_t}| \leq r \vee |\overrightarrow{C_fq_t}| \leq r​]​].
</p>
<p class="indented continuing">
<!-- Actually, they're<!--'-> in different coordinate spaces ([​[​q_t \in P\text{ & }C \in [0, G ) \cap \mathbb{Z}​]​]) -->
Actually, they're<!--'--> in different coordinate spaces ([​[​q_t \in P\text{ & }C \in \bar{G}​]​])
but we have an (almost) bijexion between them so actually
[​[​|\overrightarrow{g^{-1}(C_{c \vee f})q_t}| \leq r​]​].
[​[​C​]​]s laying on a cube lattice makes this computationally quite simple in… most cases,
since in those most cases the [​[​C_c​]​] and [​[​C_f​]​] are opposite corners, so for [​[​C=(x,y,z)​]​],
[​[​C_c=(x+[ \kappa],y+[ \lambda],z+[ \mu])​]​] and
[​[​C_c=(x+[\neg\kappa],y+[\neg\lambda],z+[\neg\mu])​]​],
with [​[​(\kappa, \lambda, \mu) = (C_x &lt; g(q_t)_x, \cdots)​]​]
and this seems natural and obvious.
Doing the comparison in [​[​P​]​] space frees us from the burden of figuring out how you'd<!--'--> do it on an ellipsoid post-uneven-[​[​B_r​]​] scaling.
</p>
<p class="indented continuing">
Please behold a hateful interactive javascript model of what this would look like in two dimensions.
The red point is [​[​q_t​]​], point — [​[​C_c​]​], blue — [​[​C_f​]​];
dark grey cells have neither [​[​C_{c \vee f}​]​] inside, yellow ones — one, green — both;
[​[​B_r = (1,1) \Rightarrow g(x) = g^{-1}(x) = x​]​]:
</p>
<iframe src="/content/assets/blogn_t/018.39-model-bad.html" width="100%">No iframe. Try <a href="/content/assets/blogn_t/018.39-model-bad.html">opening 018.39-model-bad.html directly.</a></iframe>
<script>
 function sizeiframes() {
  for(let ifr of document.querySelectorAll("iframe"))
   ifr.style.height = `calc(${ifr.clientWidth}px + 3em)`;
 }
 window .addEventListener("resize", sizeiframes);
 document.addEventListener("DOMContentLoaded", sizeiframes);
</script>
<p class="indented continued">
And just as obvious that this breaks down when one of the coordinates matches,
or when [​[​r​]​] doesn't<!--'--> include a corner,
or when it includes the wrong corner, or
</p>
<div class="three-by-each continuation">
 <figure> <a href="/content/assets/blogn_t/018.40-ellipsoid-vs-prism-badmodel-big.png"><img alt="" src="/content/assets/blogn_t/018.40-ellipsoid-vs-prism-badmodel-big.png" /></a> <figcaption><span class="roboto-unscale math-font-normal">(10,12)</span> and <span class="roboto-unscale math-font-normal">(10,13)</span> should both be yellow</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.41-ellipsoid-vs-prism-badmodel-mid.png"><img alt="" src="/content/assets/blogn_t/018.41-ellipsoid-vs-prism-badmodel-mid.png" /></a> <figcaption><span class="roboto-unscale math-font-normal">(8,9)</span> should be yellow</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.42-ellipsoid-vs-prism-badmodel-small.png"><img alt="" src="/content/assets/blogn_t/018.42-ellipsoid-vs-prism-badmodel-small.png" /></a> <figcaption><span class="roboto-unscale math-font-normal">(9,8)</span>, <span class="roboto-unscale math-font-normal">(9,9)</span>, and <span class="roboto-unscale math-font-normal">(10,8)</span> should all be yellow</figcaption> </figure>
</div>
<p class="indented continued">
While wrong, it's<!--'--> computationally simple to express
(keeping in mind that <code>&lt;</code> and <code>!</code> is element-wise):
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iter_limit<span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos<!--"-->      <!--"--><span class="token operator">=</span> <span class="token keyword">trunc</span><span class="token punctuation">(</span><span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_from <span class="token operator">=</span> gridpos <span class="token operator">-</span> <span class="token keyword">min</span><span class="token punctuation">(</span>grid_bothdirs<span class="token punctuation">,</span> gridpos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_to<!--"-->   <!--"--><span class="token operator">=</span> <span class="token keyword">min</span><span class="token punctuation">(</span>gridpos <span class="token operator">+</span> grid_bothdirs<span class="token punctuation">,</span> GRID_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> newcenter <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gx <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>x<span class="token punctuation">;</span> gx <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token operator">++</span>gx<span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gy <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>y<span class="token punctuation">;</span> gy <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token operator">++</span>gy<span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gz <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>z<span class="token punctuation">;</span> gz <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token operator">++</span>gz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gxyz <span class="token operator">=</span> <span class="token keyword">uint3</span><span class="token punctuation">(</span>gx<span class="token punctuation">,</span> gy<span class="token punctuation">,</span> gz<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">bool3</span> gxyz_close <span class="token operator">=</span> gxyz <span class="token operator">&lt;</span> gridpos<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> closest_corner<!--"-->  <!--"--><span class="token operator">=</span> <span class="token function">gridpos_to_lab</span><span class="token punctuation">(</span>gxyz <span class="token operator">+</span><!--"-->  <!--"-->gxyz_close<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> furthest_corner <span class="token operator">=</span> <span class="token function">gridpos_to_lab</span><span class="token punctuation">(</span>gxyz <span class="token operator">+</span> <span class="token operator">!</span>gxyz_close<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"-->closest_corner<!--"-->  <!--"--><span class="token operator">-=</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"-->furthest_corner <span class="token operator">-=</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float2</span> corners_squared <span class="token operator">=</span> <span class="token keyword">float2</span><span class="token punctuation">(</span><span class="token keyword">dot</span><span class="token punctuation">(</span>closest_corner<span class="token punctuation">,</span><!--"-->  <!--"-->closest_corner<span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		                                <!--"--><span class="token keyword">dot</span><span class="token punctuation">(</span>furthest_corner<span class="token punctuation">,</span> furthest_corner<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">bool2</span><!--"-->  <!--"-->corners_inrange <span class="token operator">=</span> corners_squared <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">any</span><span class="token punctuation">(</span>corners_inrange<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">continue</span><span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token class-name">groupdesc_t</span> group <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gx<span class="token punctuation">]</span><span class="token punctuation">[</span>gy<span class="token punctuation">]</span><span class="token punctuation">[</span>gz<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
(with [​[​g^{-1}​]​] as <samp>gridpos_to_lab</samp>)
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">float3</span> <span class="token function">gridpos_to_lab</span><span class="token punctuation">(</span><span class="token keyword">float3</span> pos<span class="token punctuation">,</span> <span class="token keyword">float3</span> bbox_min<span class="token punctuation">,</span> <span class="token keyword">float3</span> bbox_range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">return</span> <span class="token punctuation">(</span>pos <span class="token operator">/</span> GRID_SIZE<span class="token punctuation">)</span> <span class="token operator">*</span> bbox_range <span class="token operator">+</span> bbox_min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="indented continued">
For of us who <a href="//101010.pl/@nabijaczleweli/114067056129121805">have ever experienced 3D geometry</a> the solution may be obvious.
That's<!--'--> not me though.
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/f1751426d4f1039ee155f739c2878a4c4008b305/item/src/posterise_grid.kernel.hlsl.inc#L38">This</a>
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/f1751426d4f1039ee155f739c2878a4c4008b305/item/src/posterise_grid_oneshot.kernel.hlsl.inc#L32">solution</a>
is due to ratchetfreak
(keeping in mind that <code>?:</code> is <a href="//registry.khronos.org/SPIR-V/specs/unified1/SPIRV.html#OpSelect"><em>also</em></a> element-wise):
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> iter <span class="token operator">!=</span> iter_limit<span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> gridpos_f<!--"-->   <!--"--><span class="token operator">=</span> <span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos<!--"-->      <!--"--><span class="token operator">=</span> <span class="token keyword">trunc</span><span class="token punctuation">(</span>gridpos_f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_from <span class="token operator">=</span> gridpos <span class="token operator">-</span> <span class="token keyword">min</span><span class="token punctuation">(</span>grid_bothdirs<span class="token punctuation">,</span> gridpos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_to<!--"-->   <!--"--><span class="token operator">=</span> <span class="token keyword">min</span><span class="token punctuation">(</span>gridpos <span class="token operator">+</span> grid_bothdirs<span class="token punctuation">,</span> GRID_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> newcenter <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gx <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>x<span class="token punctuation">;</span> gx <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token operator">++</span>gx<span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gy <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>y<span class="token punctuation">;</span> gy <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token operator">++</span>gy<span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> gz <span class="token operator">=</span> gridpos_from<span class="token punctuation">.</span>z<span class="token punctuation">;</span> gz <span class="token operator">&lt;=</span> gridpos_to<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token operator">++</span>gz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gxyz<!--"-->      <!--"--><span class="token operator">=</span> <span class="token keyword">uint3</span><span class="token punctuation">(</span>gx<span class="token punctuation">,</span> gy<span class="token punctuation">,</span> gz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">bool3</span> gxyz_same <span class="token operator">=</span> gxyz <span class="token operator">==</span> gridpos<span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">bool3</span> gxyz_close <span class="token operator">=</span> gxyz <span class="token operator">&lt;</span> gridpos<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> closest_corner<!--"-->  <!--"--><span class="token operator">=</span> <span class="token function">gridpos_to_lab</span><span class="token punctuation">(</span>
<!--"-->			<!--"-->gxyz_same <span class="token operator">?</span> gridpos_f <span class="token operator">:</span> <span class="token punctuation">(</span>gxyz <span class="token operator">+</span> gxyz_close<span class="token punctuation">)</span><span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"-->gxyz_close <span class="token operator">=</span> gxyz_close <span class="token operator">||</span> <span class="token punctuation">(</span>gxyz_same <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">gridpos_to_lab</span><span class="token punctuation">(</span><span class="token keyword">float3</span><span class="token punctuation">(</span>gxyz<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span> <span class="token operator">&lt;</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> furthest_corner <span class="token operator">=</span> <span class="token function">gridpos_to_lab</span><span class="token punctuation">(</span>gxyz <span class="token operator">+</span> <span class="token operator">!</span>gxyz_close<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
<!--"-->		<!--"-->closest_corner<!--"-->  <!--"--><span class="token operator">-=</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"-->furthest_corner <span class="token operator">-=</span> center<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float2</span> corners_squared <span class="token operator">=</span> <span class="token keyword">float2</span><span class="token punctuation">(</span><span class="token keyword">dot</span><span class="token punctuation">(</span>closest_corner<span class="token punctuation">,</span><!--"-->  <!--"-->closest_corner<span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->		                                <!--"--><span class="token keyword">dot</span><span class="token punctuation">(</span>furthest_corner<span class="token punctuation">,</span> furthest_corner<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">bool2</span><!--"-->  <!--"-->corners_inrange <span class="token operator">=</span> corners_squared <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">any</span><span class="token punctuation">(</span>corners_inrange<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">continue</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token class-name">groupdesc_t</span> group <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gx<span class="token punctuation">]</span><span class="token punctuation">[</span>gy<span class="token punctuation">]</span><span class="token punctuation">[</span>gz<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>

<!--"-->	<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuation">
where we observe that [​[​C_c​]​] uses [​[​g(q_t)​]​]'s components, instead of the corners', on matching axes;
[​[​C_f​]​] is additionally discriminated, on matching axes, to always pick the corner <em>away</em> from [​[​q_t​]​].
</p>
<iframe src="/content/assets/blogn_t/018.43-model-good.html" width="100%">No iframe. Try <a href="/content/assets/blogn_t/018.43-model-good.html">opening 018.43-model-good.html directly.</a></iframe>
<div class="three-by-each">
 <figure> <a href="/content/assets/blogn_t/018.44-ellipsoid-vs-prism-goodmodel-left.png"><img alt="" src="/content/assets/blogn_t/018.44-ellipsoid-vs-prism-goodmodel-left.png" /></a> <figcaption>[​[​C = (8,8)​]​] [​[​C_y = \operatorname{trunc}(g(q_t)_y) \Rightarrow C_{cy} = g(q_t)_y​]​]</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.45-ellipsoid-vs-prism-goodmodel-up.png"><img alt="" src="/content/assets/blogn_t/018.45-ellipsoid-vs-prism-goodmodel-up.png" /></a> <figcaption>[​[​C = (9,7)​]​] [​[​C_x = \operatorname{trunc}(g(q_t)_x) \Rightarrow C_{cx} = g(q_t)_x​]​]</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.46-ellipsoid-vs-prism-goodmodel-mid.png"><img alt="" src="/content/assets/blogn_t/018.46-ellipsoid-vs-prism-goodmodel-mid.png" /></a> <figcaption>[​[​C = (9,8)​]​] [​[​C = \operatorname{trunc}(g(q_t)) \Rightarrow C_c = g(q_t)​]​]</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.47-ellipsoid-vs-prism-goodmodel-left-means-right.png"><img alt="" src="/content/assets/blogn_t/018.47-ellipsoid-vs-prism-goodmodel-left-means-right.png" /></a> <figcaption>[​[​C = (9, 7)\text{ & }g(q_t) = (9.3, 8.5)​]​] [​[​C_x + \frac{1}{2} > g(q_t)_x​]​]</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.48-ellipsoid-vs-prism-goodmodel-right-means-left.png"><img alt="" src="/content/assets/blogn_t/018.48-ellipsoid-vs-prism-goodmodel-right-means-left.png" /></a> <figcaption>[​[​C = (9, 7)\text{ & }g(q_t) = (9.7, 8.5)​]​] [​[​C_x + \frac{1}{2} &lt; g(q_t)_x​]​]</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.49-ellipsoid-vs-prism-goodmodel-right-means-centers.png"><img alt="" src="/content/assets/blogn_t/018.49-ellipsoid-vs-prism-goodmodel-right-means-centers.png" /></a> <figcaption>Both axes for [​[​C = \operatorname{trunc}(g(q_t)) = (0, 0)​]​]</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.50-ellipsoid-vs-prism-goodmodel-corner.png"><img alt="" src="/content/assets/blogn_t/018.50-ellipsoid-vs-prism-goodmodel-corner.png" /></a> <figcaption><span class="roboto-unscale math-font-normal">(10,12)</span> and <span class="roboto-unscale math-font-normal">(10,13)</span> are both yellow</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.51-ellipsoid-vs-prism-goodmodel-center.png"><img alt="" src="/content/assets/blogn_t/018.51-ellipsoid-vs-prism-goodmodel-center.png" /></a> <figcaption><span class="roboto-unscale math-font-normal">(8,9)</span> is yellow</figcaption> </figure>
 <figure> <a href="/content/assets/blogn_t/018.52-ellipsoid-vs-prism-goodmodel-corner.png"><img alt="" src="/content/assets/blogn_t/018.52-ellipsoid-vs-prism-goodmodel-corner.png" /></a> <figcaption><span class="roboto-unscale math-font-normal">(9,8)</span>, <span class="roboto-unscale math-font-normal">(9,9)</span>, and <span class="roboto-unscale math-font-normal">(10,8)</span> are all yellow</figcaption> </figure>
</div>
<!-- PREV DEGEN
111.001569ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.520376ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
108.892465ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
106.877241ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
109.359747ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
107.728791ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.478416ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
108.515743ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.414592ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.961027ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.07282ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.484086ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.53262ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.235287ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.513367ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.340505ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.138822ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.532016ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.401442ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.387254ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.128861ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.360494ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.570956ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.444306ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
105.54392ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.207883ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.350296ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.905419ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.408857ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.492473ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
104.731009ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.381256ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
103.377162ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
102.140437ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
139.004619ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
140.487059ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
138.653555ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
136.005025ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
133.226394ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
132.63867ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
133.49173ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.70008ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.796675ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.368334ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
132.784771ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.598957ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
136.422801ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
135.641282ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.055304ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
138.527075ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
136.666403ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
132.848162ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.213782ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
133.628775ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
135.526274ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
135.963368ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
133.096895ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
131.606607ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.32215ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
134.184501ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
133.404492ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
Benchmark 1: PREV DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 104.777398 ms ± 2.222235 ms
  Range (min … max): 101.340505 ms … 111.001569 ms 34 runs
Benchmark 2: PREV DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
  Time (mean ± σ): 134.994953 ms ± 2.132496 ms
  Range (min … max): 131.606607 ms … 140.487059 ms 27 runs
-->
<!-- DEGEN
102.559722ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
99.938662ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
97.931285ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
99.162577ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
100.361871ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
100.141513ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
100.214563ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
100.726821ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
99.429121ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
98.583306ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
101.423818ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
98.896939ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
98.957613ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
99.434856ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
97.029928ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.068067ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.756679ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.107913ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.326828ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.351213ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.683562ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.60672ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.192802ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.970934ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.624397ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.917268ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.404171ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
127.566196ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
128.756133ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
127.839985ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
121.879133ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
121.982672ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
126.540774ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
124.510155ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
121.973314ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
126.268496ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
125.439585ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
126.62771ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
123.219699ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
124.693686ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
124.4688ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
123.667057ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
123.155101ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
122.85173ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
123.287013ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
125.810271ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
124.462461ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
123.175627ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
129.153382ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
128.573809ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
126.935609ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
127.760897ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
124.415069ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
127.529671ms: MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
Benchmark 1: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 97.659376 ms ± 2.497993 ms
  Range (min … max): 94.068067 ms … 102.559722 ms 27 runs
Benchmark 2: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
  Time (mean ± σ): 125.279409 ms ± 2.197679 ms
  Range (min … max): 121.879133 ms … 129.153382 ms 27 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">95.878ms</span></td> <td><span class="roboto-unscale math-font-normal">78.837ms</span></td> <td><span class="roboto-unscale math-font-normal">82.23%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">10.67%</span></td> <td><span class="roboto-unscale math-font-normal">42.34%</span></td> <td><span class="roboto-unscale math-font-normal">-45.15 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">25.59%</span></td> <td><span class="roboto-unscale math-font-normal">33.67%</span></td> <td><span class="roboto-unscale math-font-normal">-10.02 p.p.</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">97.659ms</span></td> <td><span class="roboto-unscale math-font-normal">125.279ms</span></td> <td><span class="roboto-unscale math-font-normal">128.28%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">7.20%</span></td> <td><span class="roboto-unscale math-font-normal">6.79%</span></td> <td><span class="roboto-unscale math-font-normal">-0.55 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">4.35%</span></td> <td><span class="roboto-unscale math-font-normal">35.69%</span></td> <td><span class="roboto-unscale math-font-normal">12.33 p.p.</span></td></tr>
</table>
<p class="continuing">and</p>
<!--
102.662053ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
98.591757ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
98.560968ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
98.908108ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.497445ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.650423ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.404406ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.446129ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.394681ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.032212ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.95735ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.666658ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.801052ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
93.368957ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.643244ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.882856ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.273634ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.990857ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.141118ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
93.373485ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.591324ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.38304ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.524009ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.01893ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.254985ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.317103ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.227214ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.637745ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.712239ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
96.539102ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.905429ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.451733ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.342761ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
93.827484ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
95.749433ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.281483ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
94.123308ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
99.919041ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
1.172025506s: MSC 27868 RGBs @ r=0.02 => ~375 levels
2.156462454s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.127204265s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.149637073s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.727019164s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.261192556s: MSC 27868 RGBs @ r=0.02 => ~375 levels
2.152214966s: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.147287687s: MSC 27868 RGBs @ r=0.02 => ~375 levels
101.198932ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
5.097563015s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.095093792s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.0861421s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.057353004s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.090883735s: MSC 84860 RGBs @ r=0.02 => ~245 levels
5.085210859s: MSC 84860 RGBs @ r=0.02 => ~245 levels
45.034844732s: MSC 242931 RGBs @ r=0.02 => ~155 levels
43.524110551s: MSC 242931 RGBs @ r=0.02 => ~155 levels
44.907894332s: MSC 242931 RGBs @ r=0.02 => ~155 levels
43.860803398s: MSC 242931 RGBs @ r=0.02 => ~155 levels
43.635185774s: MSC 242931 RGBs @ r=0.02 => ~155 levels
61.729776665s: MSC 328666 RGBs @ r=0.02 => ~221 levels
63.636074152s: MSC 328666 RGBs @ r=0.02 => ~221 levels
59.724237816s: MSC 328666 RGBs @ r=0.02 => ~221 levels
61.759637066s: MSC 328666 RGBs @ r=0.02 => ~221 levels
62.804512643s: MSC 328666 RGBs @ r=0.02 => ~221 levels
27.579021801s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
27.572132425s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
27.659271875s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
28.649872524s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
26.548741813s: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
79.326983ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.570886ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.988059ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
77.906424ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.140971ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.66319ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.476338ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.773671ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
77.926649ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.557ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.78883ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.394534ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.357103ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.916452ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.878417ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.126481ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.557906ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.820761ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.255744ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.58447ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
77.916687ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.683414ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.755559ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
404.716338ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
401.056574ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
393.921181ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
394.070603ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
401.514497ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
404.102051ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
404.144915ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
401.00888ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
390.905891ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
77.968306ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
80.051751ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.787858ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.174477ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.670133ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
77.747343ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.704545ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.552775ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.478149ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.133122ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.350226ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
80.007378ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
78.617006ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
79.353849ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
402.05332ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
407.851467ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
433.604747ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
399.103231ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
399.466369ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
396.823878ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
400.516545ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
491.157281ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
399.467578ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
400.089411ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
407.142094ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
407.43822ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
403.584058ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
399.186545ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
5.888933833s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
5.858232446s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
5.94971779s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
5.909405448s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
5.937311903s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
5.874239235s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
5.910250358s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
38.683310583s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
37.703195985s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
43.696256802s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
38.6902066s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
37.598424225s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
53.156553616s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
52.123786593s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
52.190899974s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
53.055530971s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
51.035372686s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
16.866714139s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
16.834088086s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
16.863002153s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
16.864212918s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
16.875092294s: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 95.878274 ms ± 2.040409 ms
  Range (min … max): 93.368957 ms … 102.662053 ms 39 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 => ~245 levels
  Time (mean ± σ): 5085.374417 ms ± 13.286562 ms
  Range (min … max): 5057.353004 ms … 5097.563015 ms 6 runs
Benchmark 5: MSC 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 44192.567757 ms ± 646.328077 ms
  Range (min … max): 43524.110551 ms … 45034.844732 ms 5 runs
Benchmark 2: MSC 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 1486.630459 ms ± 426.785681 ms
  Range (min … max): 1127.204265 ms … 2156.462454 ms 8 runs
Benchmark 6: MSC 328666 RGBs @ r=0.02 => ~221 levels
  Time (mean ± σ): 61930.847668 ms ± 1312.246738 ms
  Range (min … max): 59724.237816 ms … 63636.074152 ms 5 runs
Benchmark 4: MSC 1103347 RGBs @ r=0.02 => ~11388 levels
  Time (mean ± σ): 27601.808088 ms ± 665.145035 ms
  Range (min … max): 26548.741813 ms … 28649.872524 ms 5 runs
Benchmark 1: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
  Time (mean ± σ): 78.836850 ms ± 656.181213 µs
  Range (min … max): 77.747343 ms … 80.051751 ms 37 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
  Time (mean ± σ): 5904.013002 ms ± 30.414859 ms
  Range (min … max): 5858.232446 ms … 5949.717790 ms 7 runs
Benchmark 5: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
  Time (mean ± σ): 39274.278839 ms ± 2259.250450 ms
  Range (min … max): 37598.424225 ms … 43696.256802 ms 5 runs
Benchmark 2: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
  Time (mean ± σ): 406.214160 ms ± 19.741479 ms
  Range (min … max): 390.905891 ms … 491.157281 ms 23 runs
Benchmark 6: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
  Time (mean ± σ): 52312.428768 ms ± 767.590385 ms
  Range (min … max): 51035.372686 ms … 53156.553616 ms 5 runs
Benchmark 4: MSC 1103347 RGBs @ r=0.02 * freq => ~8018 levels
  Time (mean ± σ): 16860.621918 ms ± 13.922011 ms
  Range (min … max): 16834.088086 ms … 16875.092294 ms 5 runs
-->
<table class="perf continued">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">95.878ms</span></td> <td><span class="roboto-unscale math-font-normal">5.085s</span></td> <td><span class="roboto-unscale math-font-normal">44.193s</span></td> <td><span class="roboto-unscale math-font-normal">2ms</span>/<span class="roboto-unscale math-font-normal">13ms</span>/<span class="roboto-unscale math-font-normal">646ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">10.67%</span></td> <td><span class="roboto-unscale math-font-normal">15.26%</span></td> <td><span class="roboto-unscale math-font-normal">58.40%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">25.59%</span></td> <td><span class="roboto-unscale math-font-normal">23.02%</span></td> <td>—</td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">78.837ms</span></td> <td><span class="roboto-unscale math-font-normal">5.904s</span></td> <td><span class="roboto-unscale math-font-normal">39.274s</span></td> <td><span class="roboto-unscale math-font-normal">656µs</span>/<span class="roboto-unscale math-font-normal">30ms</span>/<span class="roboto-unscale math-font-normal">2.26ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">42.34%</span></td> <td><span class="roboto-unscale math-font-normal">10.26%</span></td> <td><span class="roboto-unscale math-font-normal">26.93%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">33.67%</span></td> <td><span class="roboto-unscale math-font-normal">-35.52%</span></td> <td>—</td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">1.487s</span></td> <td><span class="roboto-unscale math-font-normal">61.931s</span></td> <td><span class="roboto-unscale math-font-normal">27.602s</span></td> <td><span class="roboto-unscale math-font-normal">426ms</span>/<span class="roboto-unscale math-font-normal">1.31s</span>/<span class="roboto-unscale math-font-normal">665ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">21.01%</span></td> <td><span class="roboto-unscale math-font-normal">47.12%</span></td> <td><span class="roboto-unscale math-font-normal">43.80%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-2.12%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">406.214ms</span></td> <td><span class="roboto-unscale math-font-normal">52.312s</span></td> <td><span class="roboto-unscale math-font-normal">16.861s</span></td> <td><span class="roboto-unscale math-font-normal">19ms</span>/<span class="roboto-unscale math-font-normal">767ms</span>/<span class="roboto-unscale math-font-normal">13ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">27.22%</span></td> <td><span class="roboto-unscale math-font-normal">30.37%</span></td> <td><span class="roboto-unscale math-font-normal">33.96%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">-8.78%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tfoot class="slowdown-didnt"><tr><td colspan=5><strong>—</strong>: didn't<!--'--> complete before</td></tfoot>
</table>
<p class="continuation">
so, around the predicted <span class="roboto-unscale math-font-normal">47%</span> peak. Cool.
</p>
<h2 id="sum_cells" ><a class="hash-link" href="#sum_cells">#</a> commutativity can be your angle....</h2>
<p class="indented continued">
As a side-effect we've<!--'--> classified cells into
"<!--"-->ones where no points are within [​[​r​]​]<!--"-->",
"<!--"-->ones where some points are within [​[​r​]​]<!--"-->", and
"<!--"-->ones where all points are within [​[​r​]​]<!--"-->".
In the previous sexion we got to
</p>
<div class="mathnospace">
[​![​
\begin{align}
<!--"-->M_t &= (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ D\\<!--"-->
&\Leftrightarrow\\
M_t &= (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ \left(\bigcup_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM}} h(x_g)\right)\\
&\Leftrightarrow\\
M_t &= \bigcup_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM}} (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ h(x_g)\\
&\Leftrightarrow\\
M_t &= \bigcup_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM} \wedge (\bigvee_{i \in \texttt{corners_inrange}}i)} (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ h(x_g)\\
\end{align}
​]!​]
</div>
<p class="continuing">
we can also observe that
</p>
<div class="mathnospace">
[​![​
\begin{align}
<!--"-->q_t &= \frac{\sum\limits_{k \in dom D} (M_{t-1} \odot D)_k}{\sum\limits_{k \in dom D} (M_{t-1})_k}\\<!--"-->
&\Leftrightarrow\text{ for }palette\\
<!--"-->M_{Dt} &= \{D_x | x \in dom D \wedge {M_t}_x = 1\}\\<!--"-->
<!--"-->q_t &= \frac{\sum M_{Dt}}{\overline{M_{Dt}}}\\<!--"-->
\end{align}
​]!​]
</div>
<p class="continuing">
but for "<!--"-->cells where all points are within [​[​r​]​]<!--"-->"
⇔ [​[​(\bigwedge_{i \in \texttt{corners_inrange}}i)​]​]
⇔ [​[​((x \mapsto [|\overrightarrow{xq_t}| \leq r]) = (x \mapsto 1))​]​]
a [​[​\sum​]​] is always the same, and, thus, can be pre-computed.
In the same way that skipping iterating the outside bit led to a significant speed-up,
this can allow us to skip iterating the <em>inside</em> green bit based on just knowing [​[​x_g​]​] (<samp>gxyz</samp>) if we pre-compute the sum, so.
</p>
<div class="mathnospace">
[​![​
\begin{align}
\cdots&\Leftrightarrow\\
<!--"-->M_t              &= \bigcup_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM} \wedge \sum_{i \in \texttt{corners_inrange}}[i] = 1} (x \mapsto [|\overrightarrow{xq_t}| \leq r]) \circ h(x_g)\\<!--"-->
<!--"-->N_{\sigma t}     &= \sum_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM} \wedge (\bigwedge_{i \in \texttt{corners_inrange}}i)} \sum      h(x_g) \\<!--"-->
<!--"-->N_{\overline{t}} &= \sum_{x_g \in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM} \wedge (\bigwedge_{i \in \texttt{corners_inrange}}i)} \overline{h(x_g)}\\<!--"-->
<!--"-->q_t &= \frac{\sum M_{Dt} + N_{\sigma t}}{\overline{M_{Dt}} + N_\overline{t}}\\<!--"-->
\end{align}
​]!​]
</div>
<p class="continuing">
where
[​[​\sum h(x_g)​]​]
and
[​[​\overline{h(x_g)}​]​]
can both be <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/shader.h#L7">memoised</a>
(and an analogous equivalency can be drawn for [​[​*freq​]​]):
</p>
<!--
g_{tf} &= g(q_t)
g_t &= \operatorname{trunc}(g(q_t)) \Leftrightarrow g_t = \operatorname{trunc}(g_{tf})
x_g &\in \mathbb{Z}^3 \wedge g_{tm} \leq x_g \leq g_{tM}
x_{gsame} &= ({x_g}_i = {g_t}_i)_i
x_{gclose} &= ({x_g}_i < {g_t}_i)_i
C_c &= g^{-1}( \left(\begin{cases}
 {g_{tf}}_i & \text{if}\ {x_{gsame}}_i
 {x_g}_i + [x_{gclose}]_i & \text{otherwise}
\end{cases}\right)_i )
x_{gcentral} &= (g^{-1}({x_g} + (\frac{1}{2} + \frac{1}{2} + \frac{1}{2}))_i < {q_t}_i)_i
x_{gfar} &= ({x_{gclose}}_i \vee ({x_{gsame}}_i \wedge {x_{gcentral}}_i))_i
C_f &= g^{-1} ( ( {x_g}_i + [\neg {x_{gfar}}_i ] )_i )
C_r &= [|\overrightarrow{C_cq_t}| \leq r] + [|\overrightarrow{C_fq_t}| \leq r]
-->
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">groupsum_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> labsum<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->   <!--"-->freqsum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
</small><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token class-name">groupdesc_t</span><!--"-->	<!--"-->group_ranges<!--"-->   <!--"--><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><!--"-->  <!--"--><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><!--"-->  <!--"--><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token class-name">groupsum_t</span><!--"-->	<!--"-->group_sums<!--"-->   <!--"--><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token class-name">groupsum_t</span><!--"-->	<!--"-->group_mulsums<span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">[</span>GRID_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuing">
as computed by
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/sum_cells.kernel.hlsl.inc"><samp>sum_cells.kernel.hlsl.inc</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">typedef</span> <span class="token keyword">float3</span> <span class="token class-name">point_t</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"shader.h"</span></span>

<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token class-name">RWStructuredBuffer</span><span class="token operator">&lt;</span><span class="token class-name">params_t</span><span class="token operator">></span><!--"-->        <!--"-->params<span class="token punctuation">;</span><!--"-->             <!--"--><span class="token comment">// DEVICE_LOCAL &amp; HOST_VISIBLE</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span>known_rgbs_pack<span class="token operator">></span> known_rgbs_bundle<span class="token punctuation">;</span><!--"-->  <!--"--><span class="token comment">// DEVICE_LOCAL</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->known_rgbs_freqs<span class="token punctuation">;</span><!--"-->   <!--"--><span class="token comment">// DEVICE_LOCAL</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>vk<span class="token operator">::</span><span class="token function">binding</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><!--"-->   <!--"--><span class="token class-name">StructuredBuffer</span><span class="token operator">&lt;</span><span class="token keyword">uint</span><span class="token operator">></span><!--"-->            <!--"-->groups_data<span class="token punctuation">;</span><!--"-->        <!--"--><span class="token comment">// DEVICE_LOCAL</span>

</small><span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GRID_SIZE<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">gridpos</span> <span class="token expression">DTid</span></span>

<!--"-->	<!--"--><span class="token class-name">groupsum_t</span><!--"-->    <!--"-->sum <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token class-name">groupsum_t</span> mulsum <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token class-name">groupdesc_t</span> group <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>start_idx <span class="token operator">!=</span> group<span class="token punctuation">.</span>end_idx<span class="token punctuation">;</span> <span class="token operator">++</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> i <span class="token operator">=</span> groups_data<span class="token punctuation">[</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">float3</span> lab<!--"-->  <!--"--><span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">uint</span><!--"-->   <!--"-->freq <span class="token operator">=</span> known_rgbs_freqs<span class="token punctuation">[</span>FREQ_I<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->sum<span class="token punctuation">.</span>labsum<!--"-->     <!--"--><span class="token operator">+=</span> lab<span class="token punctuation">;</span>
<!--"-->		<!--"-->sum<span class="token punctuation">.</span>freqsum<!--"-->    <!--"--><span class="token operator">+=</span><!--"-->       <!--"--><span class="token number">1</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->mulsum<span class="token punctuation">.</span>labsum<!--"-->  <!--"--><span class="token operator">+=</span> lab <span class="token operator">*</span> freq<span class="token punctuation">;</span>
<!--"-->		<!--"-->mulsum<span class="token punctuation">.</span>freqsum <span class="token operator">+=</span><!--"-->       <!--"-->freq<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>sum<span class="token punctuation">.</span>freqsum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_sums<!--"-->   <!--"--><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>z<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">;</span>
<!--"-->		<!--"-->params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_mulsums<span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gridpos<span class="token punctuation">.</span>z<span class="token punctuation">]</span> <span class="token operator">=</span> mulsum<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
and
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/sum_cells.straight.hlsl"><samp>sum_cells.straight.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_I</span> <span class="token expression">i</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"sum_cells.kernel.hlsl.inc"</span></span>
</code></pre>
</div>
<p class="continuing">
or
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/sum_cells.oneshot.hlsl"><samp>sum_cells.oneshot.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">FREQ_I</span> <span class="token expression">known_rgbs_bundle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rgb</span></span>
<span class="token macro property"><span class="token directive keyword">#include</span> <span class="token string">"sum_cells.kernel.hlsl.inc"</span></span>
</code></pre>
</div>
<p class="continuing">
as <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_gpu.rs#L863">driven by</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token constant">SUM_CELLS</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">ASSIGN_CELL</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SHADER_COUNT</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">SUM_CELLS</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token keyword">static</span> <span class="token constant">SHADER_DATA</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">SHADER_COUNT</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token comment">// ...</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/sum_cells.straight.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->                                              <!--"--><span class="token macro property">include_typed!</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token macro property">concat!</span><span class="token punctuation">(</span><span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"OUT_DIR"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/sum_cells.oneshot.spv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</small><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...up to assign_cell.hlsl + grouping + copying</span>

<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token comment">// memcpy(self.buffer_groups_data, self.buffer_outputs, known_rgbs * mem::size_of::&lt;u32>());</span>
</small><!--"-->	<!--"--><span class="token comment">// + sum_cells.straight.hlsl or sum_cells.oneshot.hlsl</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_copy_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_groups_data<span class="token punctuation">.</span>buffer<span class="token punctuation">,</span>
<!--"-->	                            <!--"--><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">BufferCopy</span> <span class="token punctuation">{</span>
<!--"-->	                              	<!--"-->src_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->	                              	<!--"-->dst_offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<!--"-->	                              	<!--"-->size<span class="token punctuation">:</span> known_rgbs <span class="token operator">*</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->	                              <!--"--><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_bind_pipeline</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PipelineBindPoint</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span>
<!--"-->	                              <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>compute_pipeline<span class="token punctuation">[</span><span class="token constant">SUM_CELLS</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>use_oneshot_driver<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">cmd_dispatch</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">,</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">,</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">submit_buffer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cmd_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
(note that the shader can be dispatched alongside the previous memcpy for convenience and speed).
This increases <samp>params</samp> from
[​[​G^3 \operatorname{sizeof}(\texttt{(uint, uint)}) + \varepsilon \approx 8\text{MB} \approx 3\%​]​]
to
[​[​G^3 (\operatorname{sizeof}(\texttt{(uint, uint)}) + 2 \operatorname{sizeof}(\texttt{(float3, uint)})) + \varepsilon \approx 40\text{MB} \approx 15\%​]​]
so it better be worth it!
(Even though the additional [​[​32\text{MB}​]​] doesn't<!--'--> need to be in <code>DEVICE_LOCAL & HOST_VISIBLE</code> at all.)
Time-wise this is immaterial:
</p>
<!--
237.565µs 16755 memcpy
229.112µs 16755 memcpy
251.752µs 16755 memcpy
160.288µs 16755 memcpy
278.618µs 16755 memcpy
243.3µs 16755 memcpy
244.507µs 16755 memcpy
152.44µs 16755 memcpy
125.273µs 16755 memcpy
236.056µs 16755 memcpy
270.769µs 16755 memcpy
245.413µs 16755 memcpy
158.477µs 16755 memcpy
253.563µs 16755 memcpy
220.962µs 16755 memcpy
238.168µs 16755 memcpy
238.169µs 16755 memcpy
110.481µs 16755 memcpy
252.356µs 16755 memcpy
243.3µs 16755 memcpy
242.092µs 16755 memcpy
240.885µs 16755 memcpy
121.65µs 16755 memcpy
267.449µs 16755 memcpy
154.251µs 16755 memcpy
242.394µs 16755 memcpy
302.767µs 16755 memcpy
261.714µs 16755 memcpy
227.604µs 16755 memcpy
240.281µs 16755 memcpy
116.821µs 16755 memcpy
114.708µs 16755 memcpy
215.227µs 16755 memcpy
255.978µs 16755 memcpy
265.638µs 16755 memcpy
228.811µs 16755 memcpy
225.792µs 16755 memcpy
174.778µs 16755 memcpy
371.591µs 16755 memcpy
226.999µs 16755 memcpy
93.276µs 16755 memcpy
237.263µs 16755 memcpy
232.735µs 16755 memcpy
212.51µs 16755 memcpy
249.337µs 16755 memcpy
244.809µs 16755 memcpy
264.128µs 16755 memcpy
251.752µs 16755 memcpy
132.215µs 16755 memcpy
304.577µs 16755 memcpy
132.517µs 16755 memcpy
124.367µs 27868 memcpy
248.734µs 27868 memcpy
249.941µs 27868 memcpy
256.582µs 27868 memcpy
261.713µs 27868 memcpy
258.393µs 27868 memcpy
242.697µs 27868 memcpy
250.544µs 27868 memcpy
250.243µs 27868 memcpy
265.939µs 27868 memcpy
259.299µs 27868 memcpy
276.505µs 27868 memcpy
258.695µs 27868 memcpy
250.243µs 27868 memcpy
255.677µs 27868 memcpy
252.96µs 27868 memcpy
255.073µs 27868 memcpy
252.356µs 27868 memcpy
256.28µs 27868 memcpy
248.13µs 27868 memcpy
249.337µs 27868 memcpy
246.923µs 27868 memcpy
243.3µs 27868 memcpy
314.842µs 84860 memcpy
324.501µs 84860 memcpy
152.741µs 84860 memcpy
171.457µs 84860 memcpy
308.502µs 84860 memcpy
163.307µs 84860 memcpy
307.898µs 84860 memcpy
288.277µs 84860 memcpy
309.71µs 84860 memcpy
216.434µs 84860 memcpy
308.2µs 84860 memcpy
265.034µs 84860 memcpy
302.767µs 84860 memcpy
160.59µs 84860 memcpy
268.959µs 84860 memcpy
264.129µs 84860 memcpy
294.919µs 84860 memcpy
276.202µs 84860 memcpy
263.223µs 84860 memcpy
283.447µs 84860 memcpy
228.207µs 84860 memcpy
418.077µs 84860 memcpy
318.161µs 84860 memcpy
337.179µs 84860 memcpy
162.099µs 84860 memcpy
277.41µs 84860 memcpy
346.537µs 242931 memcpy
221.264µs 242931 memcpy
373.704µs 242931 memcpy
415.059µs 242931 memcpy
236.659µs 242931 memcpy
397.551µs 242931 memcpy
378.836µs 242931 memcpy
372.496µs 242931 memcpy
384.269µs 242931 memcpy
313.634µs 242931 memcpy
373.704µs 242931 memcpy
370.686µs 242931 memcpy
248.734µs 242931 memcpy
403.89µs 242931 memcpy
312.124µs 328666 memcpy
405.399µs 328666 memcpy
525.842µs 328666 memcpy
383.967µs 328666 memcpy
437.396µs 328666 memcpy
319.671µs 328666 memcpy
384.571µs 328666 memcpy
350.46µs 328666 memcpy
360.422µs 328666 memcpy
439.811µs 328666 memcpy
443.434µs 328666 memcpy
550.595µs 328666 memcpy
912.224µs 1103347 memcpy
822.873µs 1103347 memcpy
854.267µs 1103347 memcpy
965.654µs 1103347 memcpy
902.262µs 1103347 memcpy
785.14µs 1103347 memcpy
885.057µs 1103347 memcpy
889.886µs 1103347 memcpy
784.839µs 1103347 memcpy
802.347µs 1103347 memcpy
928.524µs 1103347 memcpy
907.394µs 1103347 memcpy
935.468µs 1103347 memcpy
757.068µs 1103347 memcpy
984.37µs 1103347 memcpy
854.569µs 1103347 memcpy
890.189µs 1103347 memcpy
747.71µs 1103347 memcpy
952.673µs 1103347 memcpy
Benchmark 1: 16755 memcpy
  Time (mean ± σ): 220.453294 µs ± 57.099715 µs
  Range (min … max): 93.276000 µs … 371.591000 µs 51 runs
Benchmark 3: 84860 memcpy
  Time (mean ± σ): 268.702769 µs ± 63.589262 µs
  Range (min … max): 152.741000 µs … 418.077000 µs 26 runs
Benchmark 4: 242931 memcpy
  Time (mean ± σ): 345.501643 µs ± 62.213142 µs
  Range (min … max): 221.264000 µs … 415.059000 µs 14 runs
Benchmark 2: 27868 memcpy
  Time (mean ± σ): 248.431783 µs ± 27.443262 µs
  Range (min … max): 124.367000 µs … 276.505000 µs 23 runs
Benchmark 5: 328666 memcpy
  Time (mean ± σ): 409.474333 µs ± 71.313642 µs
  Range (min … max): 312.124000 µs … 550.595000 µs 12 runs
Benchmark 6: 1103347 memcpy
  Time (mean ± σ): 871.711263 µs ± 69.364743 µs
  Range (min … max): 747.710000 µs … 984.370000 µs 19 runs
-->
<!--
278.92µs memcpy+SUM_CELLS 16755
158.779µs memcpy+SUM_CELLS 16755
169.646µs memcpy+SUM_CELLS 16755
304.578µs memcpy+SUM_CELLS 16755
162.703µs memcpy+SUM_CELLS 16755
291.9µs memcpy+SUM_CELLS 16755
291.598µs memcpy+SUM_CELLS 16755
282.24µs memcpy+SUM_CELLS 16755
160.59µs memcpy+SUM_CELLS 16755
280.429µs memcpy+SUM_CELLS 16755
187.758µs memcpy+SUM_CELLS 16755
338.386µs memcpy+SUM_CELLS 16755
255.375µs memcpy+SUM_CELLS 16755
272.581µs memcpy+SUM_CELLS 16755
200.435µs memcpy+SUM_CELLS 16755
164.515µs memcpy+SUM_CELLS 16755
302.465µs memcpy+SUM_CELLS 16755
258.393µs memcpy+SUM_CELLS 16755
287.372µs memcpy+SUM_CELLS 16755
283.146µs memcpy+SUM_CELLS 16755
152.742µs memcpy+SUM_CELLS 16755
306.087µs memcpy+SUM_CELLS 16755
171.759µs memcpy+SUM_CELLS 16755
285.863µs memcpy+SUM_CELLS 16755
288.277µs memcpy+SUM_CELLS 16755
284.051µs memcpy+SUM_CELLS 16755
208.888µs memcpy+SUM_CELLS 16755
199.229µs memcpy+SUM_CELLS 16755
264.128µs memcpy+SUM_CELLS 16755
317.256µs memcpy+SUM_CELLS 27868
289.183µs memcpy+SUM_CELLS 27868
299.145µs memcpy+SUM_CELLS 27868
293.711µs memcpy+SUM_CELLS 27868
278.618µs memcpy+SUM_CELLS 27868
299.446µs memcpy+SUM_CELLS 27868
306.691µs memcpy+SUM_CELLS 27868
301.257µs memcpy+SUM_CELLS 27868
278.316µs memcpy+SUM_CELLS 27868
281.334µs memcpy+SUM_CELLS 27868
179.607µs memcpy+SUM_CELLS 27868
167.835µs memcpy+SUM_CELLS 27868
185.645µs memcpy+SUM_CELLS 27868
219.453µs memcpy+SUM_CELLS 27868
249.337µs memcpy+SUM_CELLS 27868
275.298µs memcpy+SUM_CELLS 27868
282.24µs memcpy+SUM_CELLS 27868
283.146µs memcpy+SUM_CELLS 27868
285.862µs memcpy+SUM_CELLS 27868
292.202µs memcpy+SUM_CELLS 27868
289.786µs memcpy+SUM_CELLS 27868
303.974µs memcpy+SUM_CELLS 27868
376.42µs memcpy+SUM_CELLS 84860
364.347µs memcpy+SUM_CELLS 84860
247.828µs memcpy+SUM_CELLS 84860
262.016µs memcpy+SUM_CELLS 84860
367.365µs memcpy+SUM_CELLS 84860
246.318µs memcpy+SUM_CELLS 84860
363.44µs memcpy+SUM_CELLS 84860
401.475µs memcpy+SUM_CELLS 84860
369.779µs memcpy+SUM_CELLS 84860
367.063µs memcpy+SUM_CELLS 84860
377.628µs memcpy+SUM_CELLS 84860
400.871µs memcpy+SUM_CELLS 84860
243.602µs memcpy+SUM_CELLS 84860
377.628µs memcpy+SUM_CELLS 84860
278.92µs memcpy+SUM_CELLS 84860
388.193µs memcpy+SUM_CELLS 84860
376.722µs memcpy+SUM_CELLS 84860
250.846µs memcpy+SUM_CELLS 84860
374.609µs memcpy+SUM_CELLS 84860
367.968µs memcpy+SUM_CELLS 84860
231.527µs memcpy+SUM_CELLS 84860
389.702µs memcpy+SUM_CELLS 84860
378.533µs memcpy+SUM_CELLS 84860
329.029µs memcpy+SUM_CELLS 84860
538.822µs memcpy+SUM_CELLS 242931
505.014µs memcpy+SUM_CELLS 242931
544.557µs memcpy+SUM_CELLS 242931
524.634µs memcpy+SUM_CELLS 242931
507.731µs memcpy+SUM_CELLS 242931
543.048µs memcpy+SUM_CELLS 242931
504.41µs memcpy+SUM_CELLS 242931
522.22µs memcpy+SUM_CELLS 242931
529.464µs memcpy+SUM_CELLS 242931
532.181µs memcpy+SUM_CELLS 242931
514.069µs memcpy+SUM_CELLS 242931
362.535µs memcpy+SUM_CELLS 242931
499.882µs memcpy+SUM_CELLS 242931
532.181µs memcpy+SUM_CELLS 242931
499.882µs memcpy+SUM_CELLS 242931
479.959µs memcpy+SUM_CELLS 242931
488.412µs memcpy+SUM_CELLS 242931
517.39µs memcpy+SUM_CELLS 242931
490.223µs memcpy+SUM_CELLS 242931
513.768µs memcpy+SUM_CELLS 242931
502.9µs memcpy+SUM_CELLS 242931
654.133µs memcpy+SUM_CELLS 328666
530.37µs memcpy+SUM_CELLS 328666
618.816µs memcpy+SUM_CELLS 328666
662.585µs memcpy+SUM_CELLS 328666
587.12µs memcpy+SUM_CELLS 328666
637.229µs memcpy+SUM_CELLS 328666
615.797µs memcpy+SUM_CELLS 328666
685.526µs memcpy+SUM_CELLS 328666
680.395µs memcpy+SUM_CELLS 328666
663.189µs memcpy+SUM_CELLS 328666
662.585µs memcpy+SUM_CELLS 328666
648.398µs memcpy+SUM_CELLS 328666
638.738µs memcpy+SUM_CELLS 328666
637.53µs memcpy+SUM_CELLS 328666
645.379µs memcpy+SUM_CELLS 328666
665.301µs memcpy+SUM_CELLS 328666
639.644µs memcpy+SUM_CELLS 328666
635.719µs memcpy+SUM_CELLS 328666
682.206µs memcpy+SUM_CELLS 328666
645.681µs memcpy+SUM_CELLS 328666
626.965µs memcpy+SUM_CELLS 328666
1.634276ms memcpy+SUM_CELLS 1103347
1.645143ms memcpy+SUM_CELLS 1103347
1.588695ms memcpy+SUM_CELLS 1103347
1.60892ms memcpy+SUM_CELLS 1103347
1.615561ms memcpy+SUM_CELLS 1103347
1.61224ms memcpy+SUM_CELLS 1103347
1.582658ms memcpy+SUM_CELLS 1103347
1.564547ms memcpy+SUM_CELLS 1103347
1.645445ms memcpy+SUM_CELLS 1103347
1.550359ms memcpy+SUM_CELLS 1103347
1.526209ms memcpy+SUM_CELLS 1103347
1.596846ms memcpy+SUM_CELLS 1103347
1.585072ms memcpy+SUM_CELLS 1103347
1.595034ms memcpy+SUM_CELLS 1103347
1.6219ms memcpy+SUM_CELLS 1103347
1.616164ms memcpy+SUM_CELLS 1103347
1.608316ms memcpy+SUM_CELLS 1103347
1.567564ms memcpy+SUM_CELLS 1103347
1.58145ms memcpy+SUM_CELLS 1103347
Benchmark 1: memcpy+SUM_CELLS 16755
  Time (mean ± σ): 244.580448 µs ± 56.696432 µs
  Range (min … max): 152.742000 µs … 338.386000 µs 29 runs
Benchmark 3: memcpy+SUM_CELLS 84860
  Time (mean ± σ): 338.826208 µs ± 58.072497 µs
  Range (min … max): 231.527000 µs … 401.475000 µs 24 runs
Benchmark 4: memcpy+SUM_CELLS 242931
  Time (mean ± σ): 507.299143 µs ± 36.902407 µs
  Range (min … max): 362.535000 µs … 544.557000 µs 21 runs
Benchmark 2: memcpy+SUM_CELLS 27868
  Time (mean ± σ): 270.879182 µs ± 41.998483 µs
  Range (min … max): 167.835000 µs … 317.256000 µs 22 runs
Benchmark 5: memcpy+SUM_CELLS 328666
  Time (mean ± σ): 641.109810 µs ± 33.836216 µs
  Range (min … max): 530.370000 µs … 685.526000 µs 21 runs
Benchmark 6: memcpy+SUM_CELLS 1103347
  Time (mean ± σ): 1.597179 ms ± 30.484502 µs
  Range (min … max): 1.526209 ms … 1.645445 ms 19 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>memcpy </th> <td><span class="roboto-unscale math-font-normal">220.5µs</span></td> <td><span class="roboto-unscale math-font-normal">268.7µs</span></td> <td><span class="roboto-unscale math-font-normal">345.5µs</span></td> <td><span class="roboto-unscale math-font-normal">57µs</span>/<span class="roboto-unscale math-font-normal">64µs</span>/<span class="roboto-unscale math-font-normal">62µs</span></td></tr>
 <tr><th>memcpy + <samp>sum_cells.hlsl</samp></th> <td><span class="roboto-unscale math-font-normal">244.6µs</span></td> <td><span class="roboto-unscale math-font-normal">338.8µs</span></td> <td><span class="roboto-unscale math-font-normal">507.3µs</span></td> <td><span class="roboto-unscale math-font-normal">56µs</span>/<span class="roboto-unscale math-font-normal">58µs</span>/<span class="roboto-unscale math-font-normal">37µs</span></td></tr>
 <tr><th>(cost) </th> <td><span class="roboto-unscale math-font-normal">24µs</span></td> <td><span class="roboto-unscale math-font-normal">70µs</span></td> <td><span class="roboto-unscale math-font-normal">162µs</span></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>memcpy </th> <td><span class="roboto-unscale math-font-normal">248.4µs</span></td> <td><span class="roboto-unscale math-font-normal">409.5µs</span></td> <td><span class="roboto-unscale math-font-normal">871.7µs</span></td> <td><span class="roboto-unscale math-font-normal">27µs</span>/<span class="roboto-unscale math-font-normal">71µs</span>/<span class="roboto-unscale math-font-normal">69µs</span></td></tr>
 <tr><th>memcpy + <samp>sum_cells.hlsl</samp></th> <td><span class="roboto-unscale math-font-normal">270.9µs</span></td> <td><span class="roboto-unscale math-font-normal">641.1µs</span></td> <td><span class="roboto-unscale math-font-normal">1.597ms</span></td> <td><span class="roboto-unscale math-font-normal">42µs</span>/<span class="roboto-unscale math-font-normal">34µs</span>/<span class="roboto-unscale math-font-normal">30µs</span></td></tr>
 <tr><th>(cost) </th> <td><span class="roboto-unscale math-font-normal">22µs</span></td> <td><span class="roboto-unscale math-font-normal">232µs</span></td> <td><span class="roboto-unscale math-font-normal">725µs</span></td> <td></td></tr>
</table>
<p class="continued">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_grid.kernel.hlsl.inc#L52">Utilised</a>
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_grid_oneshot.kernel.hlsl.inc#L55">as</a>
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">any</span><span class="token punctuation">(</span>corners_inrange<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token keyword">continue</span><span class="token punctuation">;</span>
</small><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>corners_inrange<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token class-name">groupsum_t</span> sums <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>SUMS_FIELD<span class="token punctuation">[</span>gx<span class="token punctuation">]</span><span class="token punctuation">[</span>gy<span class="token punctuation">]</span><span class="token punctuation">[</span>gz<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->newcenter_count <span class="token operator">+=</span> sums<span class="token punctuation">.</span>freqsum<span class="token punctuation">;</span>
<!--"-->	<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> sums<span class="token punctuation">.</span>labsum<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">continue</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
where, expectedly,
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_grid.hlsl"><samp>posterise_grid.hlsl</samp></a>/<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_grid_oneshot.hlsl"><samp>posterise_grid_oneshot.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">SUMS_FIELD</span> <span class="token expression">group_sums</span></span>
</code></pre>
</div>
<p class="continuing">
and
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_grid.mul.hlsl"><samp>posterise_grid.mul.hlsl</samp></a>/<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/180a7268c7d82d5b4ed1bc4d53488288d49f8c39/item/src/posterise_grid_oneshot.mul.hlsl"><samp>posterise_grid_oneshot.mul.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">SUMS_FIELD</span> <span class="token expression">group_mulsums</span></span>
</code></pre>
</div>
<p></p>
<!--
71.474368ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.064243ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
67.877693ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.577105ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
70.36533ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.075176ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.210947ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.818594ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.034661ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.542391ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.741318ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.286781ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.115862ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.997296ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.841903ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.037377ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.296072ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.202562ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.963553ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.04016ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
67.806453ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.842139ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.242945ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.766136ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.781833ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.385424ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.273735ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.75376ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.162112ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
67.47652ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.329645ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.150274ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.314552ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.097514ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
67.615074ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.219098ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.541551ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
68.310562ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
69.767042ms: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
81.145998ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
81.778094ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.489581ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.168834ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.671368ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.688573ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.488742ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.732041ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
81.55683ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.130131ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.643597ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.92245ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.408682ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.367931ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.078276ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.925836ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.818374ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.502693ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.731806ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.540124ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.341499ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.297296ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.741334ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
81.948345ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.866002ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.537039ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.250206ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.455537ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
84.331538ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
81.971588ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.990369ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.71876ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
82.77484ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.690988ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.821997ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
83.259327ms: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
Benchmark 1: DEGEN MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 68.856404 ms ± 835.083592 µs
  Range (min … max): 67.476520 ms … 71.474368 ms 39 runs
Benchmark 2: DEGEN MSC 16755 RGBs @ r=0.02 * freq => ~373 levels
  Time (mean ± σ): 83.216295 ms ± 902.483677 µs
  Range (min … max): 81.145998 ms … 84.731806 ms 36 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">68.781ms</span></td> <td><span class="roboto-unscale math-font-normal">53.958ms</span></td> <td><span class="roboto-unscale math-font-normal">78.45%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">39.40%</span></td> <td><span class="roboto-unscale math-font-normal">46.11%</span></td> <td><span class="roboto-unscale math-font-normal">-3.78 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">46.62%</span></td> <td><span class="roboto-unscale math-font-normal">54.60%</span></td> <td><span class="roboto-unscale math-font-normal">-13.80 p.p.</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​palette​]​]</th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755<sub>d</sub></span>, [​[​*freq​]​]</th> <th>([​[​*freq​]​]/[​[​palette​]​])</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">68.856ms</span></td> <td><span class="roboto-unscale math-font-normal">83.216ms</span></td> <td><span class="roboto-unscale math-font-normal">120.85%</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">29.49%</span></td> <td><span class="roboto-unscale math-font-normal">33.58%</span></td> <td><span class="roboto-unscale math-font-normal">-7.42 p.p.</span></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">47.43%</span></td> <td><span class="roboto-unscale math-font-normal">45.20%</span></td> <td><span class="roboto-unscale math-font-normal">-4.90 p.p.</span></td></tr>
</table>
<p class="continuing">&</p>
<!--
72.550805ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.922434ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
67.743667ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.066659ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.758222ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.493792ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
67.722838ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.558088ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.525251ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.149368ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.750742ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.718442ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.16181ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.0465ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.713244ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.316297ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.207627ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.350105ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.054584ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.115323ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
67.934744ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
67.478331ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.151546ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.53491ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.181064ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.851865ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.814067ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.571672ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.756477ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
67.828188ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.214032ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
68.024398ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
69.892918ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
972.1998ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.535440304s: MSC 27868 RGBs @ r=0.02 => ~375 levels
964.806619ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
970.124808ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
987.885711ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.367326917s: MSC 27868 RGBs @ r=0.02 => ~375 levels
967.297275ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.264765385s: MSC 27868 RGBs @ r=0.02 => ~375 levels
981.168999ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.72368692s: MSC 27868 RGBs @ r=0.02 => ~375 levels
971.440318ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
962.923912ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.454324795s: MSC 27868 RGBs @ r=0.02 => ~375 levels
959.432586ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
1.426709636s: MSC 27868 RGBs @ r=0.02 => ~375 levels
67.40196ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
962.348261ms: MSC 27868 RGBs @ r=0.02 => ~375 levels
3.2351347s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.229313912s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.245787378s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.243263517s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.245967588s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.237273687s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.25050939s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.24750225s: MSC 84860 RGBs @ r=0.02 => ~245 levels
29.78425414s: MSC 242931 RGBs @ r=0.02 => ~155 levels
29.540783848s: MSC 242931 RGBs @ r=0.02 => ~155 levels
29.67644596s: MSC 242931 RGBs @ r=0.02 => ~155 levels
29.460999245s: MSC 242931 RGBs @ r=0.02 => ~155 levels
29.362900124s: MSC 242931 RGBs @ r=0.02 => ~155 levels
29.920096161s: MSC 242931 RGBs @ r=0.02 => ~155 levels
38.401241917s: MSC 328666 RGBs @ r=0.02 => ~221 levels
38.412699054s: MSC 328666 RGBs @ r=0.02 => ~221 levels
37.381274409s: MSC 328666 RGBs @ r=0.02 => ~221 levels
38.377833193s: MSC 328666 RGBs @ r=0.02 => ~221 levels
38.224483832s: MSC 328666 RGBs @ r=0.02 => ~221 levels
23.791289315s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
23.752635097s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
23.82692281s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
20.823219276s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
21.82115364s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
21.814802181s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
53.807948ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.321649ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.655206ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.256513ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.016836ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.176218ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.493474ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.33795ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.903335ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.252287ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.790742ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.945898ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.079019ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.121883ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.002647ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.593324ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.11977ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.329563ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.165352ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.806438ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.025222ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.203688ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.777459ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.214554ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.900015ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.983932ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.748179ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.759348ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.989064ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.217573ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.104375ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.608115ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.20399ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.222403ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
53.964613ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
54.399898ms: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
300.490946ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
300.175804ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
301.220244ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
294.094813ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
296.061135ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
299.752896ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
298.888668ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
296.704703ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
302.735585ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
296.945287ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
297.099235ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
297.060296ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
302.156013ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
298.422293ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
304.82537ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
303.744104ms: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
3.475812172s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.504035581s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.482193817s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.473978668s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.475733085s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.455121406s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.455068278s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
19.821443729s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
18.903949611s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
19.90690785s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
18.896197215s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
18.919671744s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
19.023824085s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
30.117289637s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
31.169072399s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
30.221689505s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
30.104635319s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
30.164946562s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
30.143630037s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
11.547348724s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
12.496609195s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
13.53280717s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
13.51786746s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.536600959s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.51815604s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
12.466678459s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.495598261s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 68.781234 ms ± 968.018269 µs
  Range (min … max): 67.401960 ms … 72.550805 ms 34 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 => ~245 levels
  Time (mean ± σ): 3241.844053 ms ± 6.750737 ms
  Range (min … max): 3229.313912 ms … 3250.509390 ms 8 runs
Benchmark 5: MSC 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 29624.246580 ms ± 190.513280 ms
  Range (min … max): 29362.900124 ms … 29920.096161 ms 6 runs
Benchmark 2: MSC 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 1154.492640 ms ± 253.941653 ms
  Range (min … max): 959.432586 ms … 1723.686920 ms 16 runs
Benchmark 6: MSC 328666 RGBs @ r=0.02 => ~221 levels
  Time (mean ± σ): 38159.506481 ms ± 394.987662 ms
  Range (min … max): 37381.274409 ms … 38412.699054 ms 5 runs
Benchmark 4: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
  Time (mean ± σ): 22638.337053 ms ± 1198.912432 ms
  Range (min … max): 20823.219276 ms … 23826.922810 ms 6 runs
Benchmark 1: MSC 16755 RGBs @ r=0.02 * freq => ~325 levels
  Time (mean ± σ): 53.958291 ms ± 312.215180 µs
  Range (min … max): 53.025222 ms … 54.493474 ms 36 runs
Benchmark 3: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
  Time (mean ± σ): 3474.563287 ms ± 15.529480 ms
  Range (min … max): 3455.068278 ms … 3504.035581 ms 7 runs
Benchmark 5: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
  Time (mean ± σ): 19245.332372 ms ± 440.292464 ms
  Range (min … max): 18896.197215 ms … 19906.907850 ms 6 runs
Benchmark 2: MSC 27868 RGBs @ r=0.02 * freq => ~313 levels
  Time (mean ± σ): 299.398587 ms ± 2.924314 ms
  Range (min … max): 294.094813 ms … 304.825370 ms 16 runs
Benchmark 6: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
  Time (mean ± σ): 30320.210577 ms ± 381.490497 ms
  Range (min … max): 30104.635319 ms … 31169.072399 ms 6 runs
Benchmark 4: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
  Time (mean ± σ): 12263.958283 ms ± 826.639559 ms
  Range (min … max): 11495.598261 ms … 13532.807170 ms 8 runs
-->
<table class="perf continued">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">68.781ms</span></td> <td><span class="roboto-unscale math-font-normal">3.242s</span></td> <td><span class="roboto-unscale math-font-normal">29.624s</span></td> <td><span class="roboto-unscale math-font-normal">968µs</span>/<span class="roboto-unscale math-font-normal">6.8ms</span>/<span class="roboto-unscale math-font-normal">190ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">28.26%</span></td> <td><span class="roboto-unscale math-font-normal">46.82%</span></td> <td><span class="roboto-unscale math-font-normal">32.97%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">50.93%</span></td> <td><span class="roboto-unscale math-font-normal">23.02%</span></td> <td>—</td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">53.958ms</span></td> <td> <span class="roboto-unscale math-font-normal">3.475s</span></td> <td><span class="roboto-unscale math-font-normal">19.245s</span></td> <td><span class="roboto-unscale math-font-normal">312µs</span>/<span class="roboto-unscale math-font-normal">15ms</span>/<span class="roboto-unscale math-font-normal">440ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">31.56%</span></td> <td><span class="roboto-unscale math-font-normal">41.15%</span></td> <td><span class="roboto-unscale math-font-normal">51.00%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">55.45%</span></td> <td><span class="roboto-unscale math-font-normal">20.25%</span></td> <td>—</td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">1.154s</span></td> <td><span class="roboto-unscale math-font-normal">38.160s</span></td> <td><span class="roboto-unscale math-font-normal">22.638s</span></td> <td><span class="roboto-unscale math-font-normal">253ms</span>/<span class="roboto-unscale math-font-normal">394ms</span>/<span class="roboto-unscale math-font-normal">1198ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">22.34%</span></td> <td><span class="roboto-unscale math-font-normal">38.38%</span></td> <td><span class="roboto-unscale math-font-normal">17.98%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">20.70%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">299.399ms</span></td> <td><span class="roboto-unscale math-font-normal">30.320s</span></td> <td><span class="roboto-unscale math-font-normal">12.264s</span></td> <td><span class="roboto-unscale math-font-normal">2.9ms</span>/<span class="roboto-unscale math-font-normal">381ms</span>/<span class="roboto-unscale math-font-normal">826ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">26.30%</span></td> <td><span class="roboto-unscale math-font-normal">42.04%</span></td> <td><span class="roboto-unscale math-font-normal">27.26%</span></td> <td></td></tr>
 <tr><th>(speed-up vs base-line)</th> <td><span class="roboto-unscale math-font-normal">19.82%</span></td> <td>—</td> <td>—</td> <td></td></tr>
 <tfoot class="slowdown-didnt"><tr><td colspan=5><strong>—</strong>: didn't<!--'--> complete before</td></tfoot>
</table>
<div class="singles">
<figure> <a href="/content/assets/blogn_t/018.53-graphml-sum_cells.png"><img alt="" src="/content/assets/blogn_t/018.53-graphml-sum_cells.png" /></a> <figcaption></figcaption> </figure>
</div>
<h3 id="sum_cells+ulp" ><a class="hash-link" href="#sum_cells+ulp">#</a> or yuor devil</h3>
<p class="continued">
The individual values of
[​[​\sum h(x_g)​]​]
go quite a ways away from <span class="roboto-unscale math-font-normal">0</span>:
</p>
<table class="Ppop">
 <caption>[​[​G=100​]​]</caption>
 <tr><th></th> <th>most populous cell, [​[​palette​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td> <th>most populous cell, [​[​*freq​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td></tr>
 <tr><td style="color: #4b8494;">α</td> <td>(<span class="roboto-unscale math-font-normal">(44.041176, -0.31927294, -0.34573233)</span>, </td> <td><span class="roboto-unscale math-font-normal">45</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(9383.919, -65.55733, -20.474636)</span>, </td> <td><span class="roboto-unscale math-font-normal">9434</span>)</td></tr>
 <tr><td style="color: #94a088;">β</td> <td>(<span class="roboto-unscale math-font-normal">(58.839714, -0.22819409, -0.020030022)</span>,</td> <td><span class="roboto-unscale math-font-normal">60</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(10189.065, -0.47646168, -0.102591455)</span>, </td> <td><span class="roboto-unscale math-font-normal">10203</span>)</td></tr>
 <tr><td style="color: #735d56;">γ</td> <td>(<span class="roboto-unscale math-font-normal">(18.17284, 0.18759891, 0.18187594)</span>, </td> <td><span class="roboto-unscale math-font-normal">21</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(39128.875, -0.0036974102, -0.0036974102)</span>,</td> <td><span class="roboto-unscale math-font-normal">248129</span>)</td></tr>
 <tr><td style="color: #15090d;" class="dark-invert">δ</td> <td>(<span class="roboto-unscale math-font-normal">(3.2355795, 1.158621, 0.64843106)</span>, </td> <td><span class="roboto-unscale math-font-normal">6</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(0, 0, 0)</span>, </td> <td><span class="roboto-unscale math-font-normal">1716920</span>)</td></tr>
 <tr><td style="color: #b57688;">ε</td> <td>(<span class="roboto-unscale math-font-normal">(55.92771, -0.81256634, -0.09105891)</span>, </td> <td><span class="roboto-unscale math-font-normal">59</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(6374.0493, 2605.977, -906.254)</span>, </td> <td><span class="roboto-unscale math-font-normal">9462</span>)</td></tr>
 <tr style="height: 0.5em;"></tr>
 <tr><th></th> <th>cell with largest [​[​l​]​], [​[​palette​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td> <th>cell with largest [​[​l​]​], [​[​*freq​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td></tr>
 <tr><td style="color: #4b8494;">α</td> <td>(<span class="roboto-unscale math-font-normal">(44.041176, -0.31927294, -0.34573233)</span>, </td> <td><span class="roboto-unscale math-font-normal">45</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(9383.919, -65.55733, -20.474636)</span>, </td> <td><span class="roboto-unscale math-font-normal">9434</span>)</td></tr>
 <tr><td style="color: #94a088;">β</td> <td>(<span class="roboto-unscale math-font-normal">(58.839714, -0.22819409, -0.020030022)</span>,</td> <td><span class="roboto-unscale math-font-normal">60</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(10189.065, -0.47646168, -0.102591455)</span>, </td> <td><span class="roboto-unscale math-font-normal">10203</span>)</td></tr>
 <tr><td style="color: #735d56;">γ</td> <td>(<span class="roboto-unscale math-font-normal">(18.461334, 0.1365368, 0.25196123)</span>, </td> <td><span class="roboto-unscale math-font-normal">20</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(52687.547, -0.0033568442, 0.0033609867)</span>,</td> <td><span class="roboto-unscale math-font-normal">112776</span>)</td></tr>
 <tr><td style="color: #15090d;" class="dark-invert">δ</td> <td>(<span class="roboto-unscale math-font-normal">(3.2355795, 1.158621, 0.64843106)</span>, </td> <td><span class="roboto-unscale math-font-normal">6</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(20940.623, 7498.585, 4196.6367)</span>, </td> <td><span class="roboto-unscale math-font-normal">70065</span>)</td></tr>
 <tr><td style="color: #b57688;">ε</td> <td>(<span class="roboto-unscale math-font-normal">(55.92771, -0.81256634, -0.09105891)</span>, </td> <td><span class="roboto-unscale math-font-normal">59</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(6374.0493, 2605.977, -906.254)</span>, </td> <td><span class="roboto-unscale math-font-normal">9462</span>)</td></tr>
 <tr style="height: 0.5em;"></tr>
 <tr><th></th> <th>cell with largest [​[​a​]​], [​[​palette​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td> <th>cell with largest [​[​a​]​], [​[​*freq​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td></tr>
 <tr><td style="color: #4b8494;">α</td> <td>(<span class="roboto-unscale math-font-normal">(8.910748, -1.357208, -0.7054685)</span>, </td> <td><span class="roboto-unscale math-font-normal">13</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(6691.933, -82.91916, -29.420803)</span>, </td> <td><span class="roboto-unscale math-font-normal">6763</span>)</td></tr>
 <tr><td style="color: #94a088;">β</td> <td>(<span class="roboto-unscale math-font-normal">(2.79438, -0.4932925, 0.46539965)</span>,</td> <td><span class="roboto-unscale math-font-normal">4</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(823.4114, -1.3063359, -0.29277617)</span>,</td> <td><span class="roboto-unscale math-font-normal">826</span>)</td></tr>
 <tr><td style="color: #735d56;">γ</td> <td>(<span class="roboto-unscale math-font-normal">(10.627919, 0.5354426, 0.28728706)</span>,</td> <td><span class="roboto-unscale math-font-normal">13</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(2371.3867, 629.1607, -65.39355)</span>, </td> <td><span class="roboto-unscale math-font-normal">10809</span>)</td></tr>
 <tr><td style="color: #15090d;" class="dark-invert">δ</td> <td>(<span class="roboto-unscale math-font-normal">(3.2355795, 1.158621, 0.64843106)</span>,</td> <td><span class="roboto-unscale math-font-normal">6</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(20940.623, 7498.585, 4196.6367)</span>, </td> <td><span class="roboto-unscale math-font-normal">70065</span>)</td></tr>
 <tr><td style="color: #b57688;">ε</td> <td>(<span class="roboto-unscale math-font-normal">(3.4370112, 1.2792559, -0.44643825)</span>,</td> <td><span class="roboto-unscale math-font-normal">5</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(6374.0493, 2605.977, -906.254)</span>, </td> <td><span class="roboto-unscale math-font-normal">9462</span>)</td></tr>
 <tr style="height: 0.5em;"></tr>
 <tr><th></th> <th>cell with largest [​[​b​]​], [​[​palette​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td> <th>cell with largest [​[​b​]​], [​[​*freq​]​] ([​[​\sigma_{lab}​]​], </th> <td>[​[​\sigma_{freq}​]​])</td></tr>
 <tr><td style="color: #4b8494;">α</td> <td>(<span class="roboto-unscale math-font-normal">(31.815504, -0.57158244, -0.95032257)</span>, </td> <td><span class="roboto-unscale math-font-normal">34</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(680.8264, -66.88674, -58.81892)</span>, </td> <td><span class="roboto-unscale math-font-normal">982</span>)</td></tr>
 <tr><td style="color: #94a088;">β</td> <td>(<span class="roboto-unscale math-font-normal">(3.7039335, -0.46457234, 0.48276806)</span>, </td> <td><span class="roboto-unscale math-font-normal">5</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(107.945366, -0.42522368, 0.8002589)</span>, </td> <td><span class="roboto-unscale math-font-normal">117</span>)</td></tr>
 <tr><td style="color: #735d56;">γ</td> <td>(<span class="roboto-unscale math-font-normal">(8.998497, 0.1350762, 0.34426308)</span>, </td> <td><span class="roboto-unscale math-font-normal">11</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(21374.111, 178.88039, 555.86554)</span>, </td> <td><span class="roboto-unscale math-font-normal">24665</span>)</td></tr>
 <tr><td style="color: #15090d;" class="dark-invert">δ</td> <td>(<span class="roboto-unscale math-font-normal">(2.0014775, -0.1437166, -1.3794196)</span>, </td> <td><span class="roboto-unscale math-font-normal">6</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(7937.199, -569.93335, -5470.323)</span>, </td> <td><span class="roboto-unscale math-font-normal">42118</span>)</td></tr>
 <tr><td style="color: #b57688;">ε</td> <td>(<span class="roboto-unscale math-font-normal">(15.066136, 0.088873774, 2.2854338)</span>, </td> <td><span class="roboto-unscale math-font-normal">17</span>)</td> <td>(<span class="roboto-unscale math-font-normal">(6374.0493, 2605.977, -906.254)</span>, </td> <td><span class="roboto-unscale math-font-normal">9462</span>)</td></tr>
</table>
<p class="continuing">
and especially, since [​[​P​]​] is symmetric around <span class="roboto-unscale math-font-normal">0</span> in the other axes, in the [​[​l​]​] axis.
This wouldn't be an issue, except, <a href="//tom7.org/grad/">famously</a>, floats aren't actually commutative,
and they're<!--'--> less commutative the further away from <span class="roboto-unscale math-font-normal">0</span> they are.
</p>
<p class="indented continuing">
Thus, for the first time, we are bitten by rounding errors:
in certain cases, the loop termination condition(s)
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>newcenter <span class="token operator">==</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><span class="token comment">// and</span>
</small><!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>newcenter <span class="token operator">==</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack_r_g_b_to_rgb</span><span class="token punctuation">(</span><span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
never trigger, and, thus, [​[​O​]​] never converges.
Frankly, this should've<!--'--> happened earlier, but always adding small numbers is apparently more commutative than adding pre-computed sums of those numbers.
</p>
<p class="indented continuing">
Lightly instrumenting some cells with
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">printf</span><span class="token punctuation">(</span><span class="token string">"{%v3f} {%v3x} => {%v3f} {%v3x} * %d [%v3d]"</span><span class="token punctuation">,</span>
<!--"-->       <!--"-->center<span class="token punctuation">,</span> <span class="token keyword">asuint</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">,</span> newcenter<span class="token punctuation">,</span> <span class="token keyword">asuint</span><span class="token punctuation">(</span>newcenter<span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->       <!--"-->newcenter_count<span class="token punctuation">,</span><!--"-->        <!--"-->newcenter <span class="token operator">==</span> center<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuing">
yields
</p>
<div class="codecontinued">
<pre class="language-plaintext"><code class="language-plaintext">{0.447506249, -0.000645289, 0.023140611} {3ee51f8a, ba2928a2, 3cbd9161} => {0.447506309, -0.000645289, 0.023140611} {3ee51f8c, ba2928a2, 3cbd9161} * 266? {0, 1, 1}
{0.447506309, -0.000645289, 0.023140611} {3ee51f8c, ba2928a2, 3cbd9161} => {0.447506249, -0.000645289, 0.023140611} {3ee51f8a, ba2928a2, 3cbd9161} * 266? {0, 1, 1}
{0.447506249, -0.000645289, 0.023140611} {3ee51f8a, ba2928a2, 3cbd9161} => {0.447506309, -0.000645289, 0.023140611} {3ee51f8c, ba2928a2, 3cbd9161} * 266? {0, 1, 1}
{0.447506309, -0.000645289, 0.023140611} {3ee51f8c, ba2928a2, 3cbd9161} => {0.447506249, -0.000645289, 0.023140611} {3ee51f8a, ba2928a2, 3cbd9161} * 266? {0, 1, 1}
{0.447506249, -0.000645289, 0.023140611} {3ee51f8a, ba2928a2, 3cbd9161} => {0.447506309, -0.000645289, 0.023140611} {3ee51f8c, ba2928a2, 3cbd9161} * 266? {0, 1, 1}
{0.447506309, -0.000645289, 0.023140611} {3ee51f8c, ba2928a2, 3cbd9161} => {0.447506249, -0.000645289, 0.023140611} {3ee51f8a, ba2928a2, 3cbd9161} * 266? {0, 1, 1}</code></pre>
</div>
<p class="continuing">
where we observe a <span class="roboto-unscale math-font-normal">2</span>-long cycle, where <code>center.l == nextafter(nextafter(newcenter.l))</code> (2 ULPs off) and v.v..
This can be mitigated by upgrading the [​[​f​]​] condition:
</p>
<div class="mathnospace real">
[​![​
\begin{align}
<!--"-->f(c) &= p^{-1}(q_t)\\<!--"-->
<!--"-->\text{with}\ &q_0=p(c)\\<!--"-->
<!--"-->\text{find}\ &t=\text{the first iteration}\in \mathbb{N}_+\ \text{where}\ q_t = q_{t-1}\\<!--"-->
&\Leftrightarrow\\
<!--"-->\text{find}\ &t=\text{the first iteration}\in \mathbb{N}_+\ \text{where}\ q_t = q_{t-1} \vee q_t = q_{t-2}\\<!--"-->
 \end{align}
​]!​]
</div>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/e50f3e3f42fde2687e377ff5cd29f54231570962/item/src/msc_grid.kernel.hlsl.inc#L80">codified</a>
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/2bba342dce8e6c0fe21aa9db2ca0b0cfbd713a1d/item/src/posterise_grid_oneshot.kernel.hlsl.inc#L83">as</a>
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">float3</span> prevcenter <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>newcenter <span class="token operator">==</span> center<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">all</span><span class="token punctuation">(</span>newcenter <span class="token operator">==</span> prevcenter<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->prevcenter <span class="token operator">=</span> center<span class="token punctuation">;</span>
<!--"-->	<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p>
<small>
(FTR I know this is real from <a href="//101010.pl/@nabijaczleweli/114095551519019507">posting</a> and <span id="irc">IRC</span> logs,
 but I couldn't<!--'--> re-trigger it when writing the post.)
</small>
</p>
<script>
{
 let ircs = ["IRC", "Discord", "ICQ", "AIM", "Messenger"];
 irc.innerText = ircs[Math.floor(Math.random() * ircs.length)];
}
</script>
<p class="indented continued">
These speed-ups can be paid into
</p>
<h2 id="occupancy" class="continuing"><a class="hash-link" href="#occupancy">#</a> re-tuning the piece-meal iteration count</h2>
<p class="continuing">
since more than <a href="#oneshot">previously</a> can be done without exceeding <span class="roboto-unscale math-font-normal">8s</span>;
a doubling of
[​[​l \mapsto \begin{cases}10 &\text{if}\ l \in [100'000,  \infty<!--'--> )\\20 &\text{if}\ l \in [ 10'000, 100'000 )\\\infty &\text{if}\ l \in [ 0, 10'000<!--'--> )\\\end{cases}​]​]
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/b16eb919c0582eb2df27e100237719073845b150/item/src/posterise_gpu.rs#L897">seems reasonable</a>:
</p>
<!--
3.058283944s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.044477119s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.042544303s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.05445725s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.041298522s: MSC 84860 RGBs @ r=0.02 => ~245 levels
3.046635426s: MSC 84860 RGBs @ r=0.02 => ~245 levels
32.610714801s: MSC 242931 RGBs @ r=0.02 => ~155 levels
31.531525467s: MSC 242931 RGBs @ r=0.02 => ~155 levels
31.197283129s: MSC 242931 RGBs @ r=0.02 => ~155 levels
31.587192879s: MSC 242931 RGBs @ r=0.02 => ~155 levels
32.615022057s: MSC 242931 RGBs @ r=0.02 => ~155 levels
39.492659342s: MSC 328666 RGBs @ r=0.02 => ~221 levels
39.472536074s: MSC 328666 RGBs @ r=0.02 => ~221 levels
39.532669521s: MSC 328666 RGBs @ r=0.02 => ~221 levels
38.546530076s: MSC 328666 RGBs @ r=0.02 => ~221 levels
23.282637675s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
21.294352903s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
21.202300362s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
19.246066901s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
19.262675902s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
20.270337438s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
20.253000046s: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
3.245009482s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.252986161s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.279183779s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.272177584s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
3.271363162s: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
22.493070175s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
20.640387143s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
21.581486194s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
19.691003815s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
21.631612947s: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
29.166961182s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
29.112269386s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
30.064487793s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
30.14274498s: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
12.244885115s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.161871201s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.174508313s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.157223143s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.210518531s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
11.166963295s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
12.189313091s: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
Benchmark 1: MSC 84860 RGBs @ r=0.02 => ~245 levels
  Time (mean ± σ): 3047.949427 ms ± 6.276775 ms
  Range (min … max): 3041.298522 ms … 3058.283944 ms 6 runs
Benchmark 3: MSC 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 31908.347667 ms ± 590.500877 ms
  Range (min … max): 31197.283129 ms … 32615.022057 ms 5 runs
Benchmark 4: MSC 328666 RGBs @ r=0.02 => ~221 levels
  Time (mean ± σ): 39261.098753 ms ± 413.123808 ms
  Range (min … max): 38546.530076 ms … 39532.669521 ms 4 runs
Benchmark 2: MSC 1103347 RGBs @ r=0.02 => ~11375 levels
  Time (mean ± σ): 20687.338747 ms ± 1300.477777 ms
  Range (min … max): 19246.066901 ms … 23282.637675 ms 7 runs
Benchmark 1: MSC 84860 RGBs @ r=0.02 * freq => ~240 levels
  Time (mean ± σ): 3264.144034 ms ± 12.911056 ms
  Range (min … max): 3245.009482 ms … 3279.183779 ms 5 runs
Benchmark 3: MSC 242931 RGBs @ r=0.02 * freq => ~152 levels
  Time (mean ± σ): 21207.512055 ms ± 958.520298 ms
  Range (min … max): 19691.003815 ms … 22493.070175 ms 5 runs
Benchmark 4: MSC 328666 RGBs @ r=0.02 * freq => ~132 levels
  Time (mean ± σ): 29621.615835 ms ± 483.181078 ms
  Range (min … max): 29112.269386 ms … 30142.744980 ms 4 runs
Benchmark 2: MSC 1103347 RGBs @ r=0.02 * freq => ~8013 levels
  Time (mean ± σ): 11472.183241 ms ± 471.634670 ms
  Range (min … max): 11157.223143 ms … 12244.885115 ms 7 runs
-->
<table class="perf continuation">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">3.048s</span></td> <td><span class="roboto-unscale math-font-normal">31.908s</span></td> <td><span class="roboto-unscale math-font-normal">6.3ms</span>/<span class="roboto-unscale math-font-normal">591ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">5.98%</span></td> <td><span class="roboto-unscale math-font-normal">-7.71%</span></td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">3.264s</span></td> <td><span class="roboto-unscale math-font-normal">21.208s</span></td> <td><span class="roboto-unscale math-font-normal">12.9ms</span>/<span class="roboto-unscale math-font-normal">959ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">6.06%</span></td> <td><span class="roboto-unscale math-font-normal">-10.20%</span></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​palette​]​] </th> <td><span class="roboto-unscale math-font-normal">39.261s</span></td> <td><span class="roboto-unscale math-font-normal">20.687s</span></td> <td><span class="roboto-unscale math-font-normal">413ms</span>/<span class="roboto-unscale math-font-normal">1300ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">-2.89%</span></td> <td><span class="roboto-unscale math-font-normal">8.62%</span></td> <td></td></tr>
 <tr><th>5700 XT, [​[​*freq​]​] </th> <td><span class="roboto-unscale math-font-normal">29.622s</span></td> <td><span class="roboto-unscale math-font-normal">11.472s</span></td> <td><span class="roboto-unscale math-font-normal">483ms</span>/<span class="roboto-unscale math-font-normal">471ms</span></td></tr>
 <tr><th>(speed-up vs previous) </th> <td><span class="roboto-unscale math-font-normal">2.30%</span></td> <td><span class="roboto-unscale math-font-normal">6.46%</span></td> <td></td></tr>
</table>
<p>
Kind of a wash.
</p>
<h2 id="grid-size-again" class="continued"><a class="hash-link" href="#grid-size-again">#</a> Grid size re-evaluation</h2>
<p class="continuing">
is also <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/commit/614a5917d24da452c02b50c3c54ab9f08c93e0ce">natural</a>:
</p>
<!--
65.782173ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
62.470153ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
61.51597ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
62.694135ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
62.752696ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
62.08679ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.953707ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.790099ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
56.948511ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.33127ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.94103ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.877337ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
58.36605ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.929861ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.474051ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
58.380237ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
56.288642ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.940728ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.131438ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
58.291792ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
57.506651ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
56.799391ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
56.309772ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
56.885119ms: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
722.864046ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
726.463136ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
729.837339ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
899.693068ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
734.749223ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
736.048735ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
741.19124ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
730.226136ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
733.486538ms: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
11.206429823s: MSC G=64 84860 RGBs @ r=0.02 => ~248 levels TIMEOUT
38.366432503s: MSC G=64 242931 RGBs @ r=0.02 => ~155 levels
36.552790072s: MSC G=64 242931 RGBs @ r=0.02 => ~155 levels
38.556152805s: MSC G=64 242931 RGBs @ r=0.02 => ~155 levels
36.473751065s: MSC G=64 242931 RGBs @ r=0.02 => ~155 levels
37.611333012s: MSC G=64 242931 RGBs @ r=0.02 => ~155 levels
44.704895462s: MSC G=64 328666 RGBs @ r=0.02 => ~222 levels
45.693243624s: MSC G=64 328666 RGBs @ r=0.02 => ~222 levels
45.737871071s: MSC G=64 328666 RGBs @ r=0.02 => ~222 levels
45.847879215s: MSC G=64 328666 RGBs @ r=0.02 => ~222 levels
27.337211746s: MSC G=64 1103347 RGBs @ r=0.02 => ~11381 levels
27.221135892s: MSC G=64 1103347 RGBs @ r=0.02 => ~11381 levels
28.312476644s: MSC G=64 1103347 RGBs @ r=0.02 => ~11381 levels
69.806888ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
67.930821ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
68.047037ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
62.953434ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
64.778485ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
63.220278ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
63.698426ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
63.653147ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
65.110532ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
64.932133ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
63.732838ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
64.692757ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
63.124286ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
64.205854ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
64.296715ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
63.045199ms: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
850.104836ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
1.184158511s: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
1.84074835s: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
822.679246ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
836.30254ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
834.953221ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
822.574199ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
835.388505ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
864.622544ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
838.146911ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
814.923228ms: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
2.980357294s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
2.994957109s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
2.972965018s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
2.9724268s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
2.996235188s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
2.977727783s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
2.984694133s: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
33.574866985s: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
33.334512503s: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
35.284970759s: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
33.234214325s: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
33.438162245s: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
35.313871242s: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
42.493670879s: MSC G=80 328666 RGBs @ r=0.02 => ~222 levels
40.619206757s: MSC G=80 328666 RGBs @ r=0.02 => ~222 levels
41.602774043s: MSC G=80 328666 RGBs @ r=0.02 => ~222 levels
42.530259461s: MSC G=80 328666 RGBs @ r=0.02 => ~222 levels
42.550288851s: MSC G=80 328666 RGBs @ r=0.02 => ~222 levels
23.381726899s: MSC G=80 1103347 RGBs @ r=0.02 => ~11385 levels
25.280455219s: MSC G=80 1103347 RGBs @ r=0.02 => ~11385 levels
24.307193773s: MSC G=80 1103347 RGBs @ r=0.02 => ~11385 levels
23.409657804s: MSC G=80 1103347 RGBs @ r=0.02 => ~11385 levels
23.292847824s: MSC G=80 1103347 RGBs @ r=0.02 => ~11385 levels
71.005577ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.952121ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.202364ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.170301ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.186667ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
70.89238ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.727838ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.266358ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.022992ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.375028ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
69.010879ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.223731ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
64.717509ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.99408ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
64.008136ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
70.857364ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.933708ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.443853ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
64.893495ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
65.793644ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
69.123172ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.276018ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
64.659552ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
64.986468ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
66.520827ms: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
862.18743ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
872.958437ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
873.352669ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
864.964553ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
873.100916ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
868.787322ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
872.655068ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
864.506025ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
879.547462ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
866.320513ms: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
2.986034698s: MSC G=90 84860 RGBs @ r=0.02 => ~244 levels
2.980381444s: MSC G=90 84860 RGBs @ r=0.02 => ~244 levels
2.999336207s: MSC G=90 84860 RGBs @ r=0.02 => ~244 levels
3.030576416s: MSC G=90 84860 RGBs @ r=0.02 => ~244 levels
3.003408314s: MSC G=90 84860 RGBs @ r=0.02 => ~244 levels
32.299713051s: MSC G=90 242931 RGBs @ r=0.02 => ~155 levels
32.478436553s: MSC G=90 242931 RGBs @ r=0.02 => ~155 levels
32.556860367s: MSC G=90 242931 RGBs @ r=0.02 => ~155 levels
32.363975655s: MSC G=90 242931 RGBs @ r=0.02 => ~155 levels
32.51725106s: MSC G=90 242931 RGBs @ r=0.02 => ~155 levels
40.858824094s: MSC G=90 328666 RGBs @ r=0.02 => ~221 levels
40.91496573s: MSC G=90 328666 RGBs @ r=0.02 => ~221 levels
40.876432557s: MSC G=90 328666 RGBs @ r=0.02 => ~221 levels
40.812335674s: MSC G=90 328666 RGBs @ r=0.02 => ~221 levels
41.897390169s: MSC G=90 328666 RGBs @ r=0.02 => ~221 levels
30.203892982s: MSC G=90 1103347 RGBs @ r=0.02 => ~11379 levels TIMEOUT
88.024808ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
81.192786ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
80.487337ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
78.807781ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.762267ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
82.879888ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
80.271506ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
78.499581ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.406975ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.813885ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
82.188022ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
78.959919ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.613449ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
80.172797ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
78.819555ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
84.223472ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.779472ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
80.376554ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
78.252055ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.612241ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
82.85604ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
97.555468ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
78.750729ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
79.630655ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
80.515107ms: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
1.117228963s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
2.102089422s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
1.100203696s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
2.09234112s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
1.113529354s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
1.091556583s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
1.107744186s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
2.100821303s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
1.083556358s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
2.093059549s: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
3.130342715s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.109101957s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.114374565s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.124032913s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.122940779s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.129574479s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.111784596s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.135041786s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.122139941s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
3.121148328s: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
30.809998665s: MSC G=110 242931 RGBs @ r=0.02 => ~155 levels
31.961808534s: MSC G=110 242931 RGBs @ r=0.02 => ~155 levels
30.873064392s: MSC G=110 242931 RGBs @ r=0.02 => ~155 levels
29.865479829s: MSC G=110 242931 RGBs @ r=0.02 => ~155 levels
32.22171154s: MSC G=110 242931 RGBs @ r=0.02 => ~155 levels
37.94857585s: MSC G=110 328666 RGBs @ r=0.02 => ~221 levels
37.964660216s: MSC G=110 328666 RGBs @ r=0.02 => ~221 levels
36.941169687s: MSC G=110 328666 RGBs @ r=0.02 => ~221 levels
38.975116383s: MSC G=110 328666 RGBs @ r=0.02 => ~221 levels
38.91066602s: MSC G=110 328666 RGBs @ r=0.02 => ~221 levels
19.490539975s: MSC G=110 1103347 RGBs @ r=0.02 => ~11383 levels
18.500293107s: MSC G=110 1103347 RGBs @ r=0.02 => ~11383 levels
20.459719052s: MSC G=110 1103347 RGBs @ r=0.02 => ~11383 levels
19.541386665s: MSC G=110 1103347 RGBs @ r=0.02 => ~11383 levels
18.512882224s: MSC G=110 1103347 RGBs @ r=0.02 => ~11383 levels
100.324743ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.411349ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.530282ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
93.862802ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.506133ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
98.820568ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.087452ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
94.102781ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.264041ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.424631ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
99.455986ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.021948ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.703551ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
93.616182ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
95.143599ms: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
1.342878886s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
1.349893534s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
2.347683609s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
1.3578195s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
2.317340531s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
1.478834103s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
2.35231627s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
1.322643929s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
2.351722208s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
1.358099929s: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
3.860250992s: MSC G=128 84860 RGBs @ r=0.02 => ~246 levels
3.881047711s: MSC G=128 84860 RGBs @ r=0.02 => ~246 levels
3.845650272s: MSC G=128 84860 RGBs @ r=0.02 => ~246 levels
3.882151919s: MSC G=128 84860 RGBs @ r=0.02 => ~246 levels
3.878850767s: MSC G=128 84860 RGBs @ r=0.02 => ~246 levels
35.055712389s: MSC G=128 242931 RGBs @ r=0.02 => ~155 levels
35.439754563s: MSC G=128 242931 RGBs @ r=0.02 => ~155 levels
35.886529208s: MSC G=128 242931 RGBs @ r=0.02 => ~155 levels
35.352819775s: MSC G=128 242931 RGBs @ r=0.02 => ~155 levels
36.167358734s: MSC G=128 242931 RGBs @ r=0.02 => ~155 levels
43.977408414s: MSC G=128 328666 RGBs @ r=0.02 => ~222 levels
43.901172791s: MSC G=128 328666 RGBs @ r=0.02 => ~222 levels
45.981204619s: MSC G=128 328666 RGBs @ r=0.02 => ~222 levels
43.926094141s: MSC G=128 328666 RGBs @ r=0.02 => ~222 levels
44.919208689s: MSC G=128 328666 RGBs @ r=0.02 => ~222 levels
30.962086548s: MSC G=128 1103347 RGBs @ r=0.02 => ~11385 levels TIMEOUT
Benchmark 1: MSC G=64 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 58.851983 ms ± 2.487842 ms
  Range (min … max): 56.288642 ms … 65.782173 ms 24 runs
Benchmark 3: MSC G=64 84860 RGBs @ r=0.02 => ~248 levels TIMEOUT
  Time (mean ± σ): 11206.429823 ms ± 0.000000 ns
  Range (min … max): 11206.429823 ms … 11206.429823 ms 1 run
Benchmark 5: MSC G=64 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 37512.091891 ms ± 875.011031 ms
  Range (min … max): 36473.751065 ms … 38556.152805 ms 5 runs
Benchmark 2: MSC G=64 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 750.506607 ms ± 52.989622 ms
  Range (min … max): 722.864046 ms … 899.693068 ms 9 runs
Benchmark 6: MSC G=64 328666 RGBs @ r=0.02 => ~222 levels
  Time (mean ± σ): 45495.972343 ms ± 460.182581 ms
  Range (min … max): 44704.895462 ms … 45847.879215 ms 4 runs
Benchmark 4: MSC G=64 1103347 RGBs @ r=0.02 => ~11381 levels
  Time (mean ± σ): 27623.608094 ms ± 489.403249 ms
  Range (min … max): 27221.135892 ms … 28312.476644 ms 3 runs
Benchmark 1: MSC G=80 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 64.826802 ms ± 1.962064 ms
  Range (min … max): 62.953434 ms … 69.806888 ms 16 runs
Benchmark 3: MSC G=80 84860 RGBs @ r=0.02 => ~245 levels
  Time (mean ± σ): 2982.766189 ms ± 9.007169 ms
  Range (min … max): 2972.426800 ms … 2996.235188 ms 7 runs
Benchmark 5: MSC G=80 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 34030.099677 ms ± 903.481470 ms
  Range (min … max): 33234.214325 ms … 35313.871242 ms 6 runs
Benchmark 2: MSC G=80 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 958.600190 ms ± 296.528554 ms
  Range (min … max): 814.923228 ms … 1840.748350 ms 11 runs
Benchmark 6: MSC G=80 328666 RGBs @ r=0.02 => ~222 levels
  Time (mean ± σ): 41959.239998 ms ± 759.443929 ms
  Range (min … max): 40619.206757 ms … 42550.288851 ms 5 runs
Benchmark 4: MSC G=80 1103347 RGBs @ r=0.02 => ~11385 levels
  Time (mean ± σ): 23934.376304 ms ± 767.232816 ms
  Range (min … max): 23292.847824 ms … 25280.455219 ms 5 runs
Benchmark 1: MSC G=90 16755 RGBs @ r=0.02 => ~372 levels
  Time (mean ± σ): 66.529762 ms ± 1.972308 ms
  Range (min … max): 64.008136 ms … 71.005577 ms 25 runs
Benchmark 3: MSC G=90 84860 RGBs @ r=0.02 => ~244 levels
  Time (mean ± σ): 2999.947416 ms ± 17.474999 ms
  Range (min … max): 2980.381444 ms … 3030.576416 ms 5 runs
Benchmark 5: MSC G=90 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 32443.247337 ms ± 96.445677 ms
  Range (min … max): 32299.713051 ms … 32556.860367 ms 5 runs
Benchmark 2: MSC G=90 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 869.838039 ms ± 5.090525 ms
  Range (min … max): 862.187430 ms … 879.547462 ms 10 runs
Benchmark 6: MSC G=90 328666 RGBs @ r=0.02 => ~221 levels
  Time (mean ± σ): 41071.989645 ms ± 414.015663 ms
  Range (min … max): 40812.335674 ms … 41897.390169 ms 5 runs
Benchmark 4: MSC G=90 1103347 RGBs @ r=0.02 => ~11379 levels TIMEOUT
  Time (mean ± σ): 30203.892982 ms ± 0.000000 ns
  Range (min … max): 30203.892982 ms … 30203.892982 ms 1 run
Benchmark 1: MSC G=110 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 81.218094 ms ± 3.941759 ms
  Range (min … max): 78.252055 ms … 97.555468 ms 25 runs
Benchmark 3: MSC G=110 84860 RGBs @ r=0.02 => ~245 levels
  Time (mean ± σ): 3122.048206 ms ± 7.947720 ms
  Range (min … max): 3109.101957 ms … 3135.041786 ms 10 runs
Benchmark 5: MSC G=110 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 31146.412592 ms ± 854.379387 ms
  Range (min … max): 29865.479829 ms … 32221.711540 ms 5 runs
Benchmark 2: MSC G=110 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 1500.213053 ms ± 487.433211 ms
  Range (min … max): 1083.556358 ms … 2102.089422 ms 10 runs
Benchmark 6: MSC G=110 328666 RGBs @ r=0.02 => ~221 levels
  Time (mean ± σ): 38148.037631 ms ± 747.743784 ms
  Range (min … max): 36941.169687 ms … 38975.116383 ms 5 runs
Benchmark 4: MSC G=110 1103347 RGBs @ r=0.02 => ~11383 levels
  Time (mean ± σ): 19300.964205 ms ± 734.656674 ms
  Range (min … max): 18500.293107 ms … 20459.719052 ms 5 runs
Benchmark 1: MSC G=128 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 95.885070 ms ± 1.941627 ms
  Range (min … max): 93.616182 ms … 100.324743 ms 15 runs
Benchmark 3: MSC G=128 84860 RGBs @ r=0.02 => ~246 levels
  Time (mean ± σ): 3869.590332 ms ± 14.388679 ms
  Range (min … max): 3845.650272 ms … 3882.151919 ms 5 runs
Benchmark 5: MSC G=128 242931 RGBs @ r=0.02 => ~155 levels
  Time (mean ± σ): 35580.434934 ms ± 396.259165 ms
  Range (min … max): 35055.712389 ms … 36167.358734 ms 5 runs
Benchmark 2: MSC G=128 27868 RGBs @ r=0.02 => ~375 levels
  Time (mean ± σ): 1757.923250 ms ± 478.823125 ms
  Range (min … max): 1322.643929 ms … 2352.316270 ms 10 runs
Benchmark 6: MSC G=128 328666 RGBs @ r=0.02 => ~222 levels
  Time (mean ± σ): 44541.017731 ms ± 815.150870 ms
  Range (min … max): 43901.172791 ms … 45981.204619 ms 5 runs
Benchmark 4: MSC G=128 1103347 RGBs @ r=0.02 => ~11385 levels TIMEOUT
  Time (mean ± σ): 30962.086548 ms ± 0.000000 ns
  Range (min … max): 30962.086548 ms … 30962.086548 ms 1 run
-->
<table class="perf continuation">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​G = 64​]​]</th> <td><span class="roboto-unscale math-font-normal">58.852ms</span></td> <td>!</td> <td><span class="roboto-unscale math-font-normal">37.512s</span></td> <td><span class="roboto-unscale math-font-normal">2.49ms</span>/<span class="roboto-unscale math-font-normal">875ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 80​]​]</th> <td><span class="roboto-unscale math-font-normal">64.827ms</span></td> <td><span class="roboto-unscale math-font-normal">2.983s</span></td> <td><span class="roboto-unscale math-font-normal">34.030s</span></td> <td><span class="roboto-unscale math-font-normal">1.96ms</span>/<span class="roboto-unscale math-font-normal">9.01ms</span>/<span class="roboto-unscale math-font-normal">903ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 90​]​]</th> <td><span class="roboto-unscale math-font-normal">66.530ms</span></td> <td><span class="roboto-unscale math-font-normal">3.000s</span></td> <td><span class="roboto-unscale math-font-normal">32.443s</span></td> <td><span class="roboto-unscale math-font-normal">1.97ms</span>/<span class="roboto-unscale math-font-normal">17.5ms</span>/<span class="roboto-unscale math-font-normal">96.4ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 100​]​]</th> <td><span class="roboto-unscale math-font-normal">68.781ms</span></td> <td><span class="roboto-unscale math-font-normal">3.242s</span></td> <td><span class="roboto-unscale math-font-normal">29.624s</span></td> <td><span class="roboto-unscale math-font-normal">968µs</span>/<span class="roboto-unscale math-font-normal">6.8ms</span>/<span class="roboto-unscale math-font-normal">190ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 110​]​]</th> <td><span class="roboto-unscale math-font-normal">81.218ms</span></td> <td><span class="roboto-unscale math-font-normal">3.122s</span></td> <td><span class="roboto-unscale math-font-normal">31.146s</span></td> <td><span class="roboto-unscale math-font-normal">3.94ms</span>/<span class="roboto-unscale math-font-normal">7.95ms</span>/<span class="roboto-unscale math-font-normal">854ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 128​]​]</th> <td><span class="roboto-unscale math-font-normal">95.885ms</span></td> <td><span class="roboto-unscale math-font-normal">3.870s</span></td> <td><span class="roboto-unscale math-font-normal">35.580s</span></td> <td><span class="roboto-unscale math-font-normal">1.94ms</span>/<span class="roboto-unscale math-font-normal">14.39ms</span>/<span class="roboto-unscale math-font-normal">396ms</span></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, [​[​G = 64​]​]</th> <td><span class="roboto-unscale math-font-normal">750.507ms</span></td> <td><span class="roboto-unscale math-font-normal">45.496s</span></td> <td><span class="roboto-unscale math-font-normal">27.624s</span></td> <td><span class="roboto-unscale math-font-normal">52.99ms</span>/<span class="roboto-unscale math-font-normal">460ms</span>/<span class="roboto-unscale math-font-normal">489ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 80​]​]</th> <td><span class="roboto-unscale math-font-normal">958.600ms</span></td> <td><span class="roboto-unscale math-font-normal">41.959s</span></td> <td><span class="roboto-unscale math-font-normal">23.934s</span></td> <td><span class="roboto-unscale math-font-normal">296ms</span>/<span class="roboto-unscale math-font-normal">759ms</span>/<span class="roboto-unscale math-font-normal">767ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 90​]​]</th> <td><span class="roboto-unscale math-font-normal">869.838ms</span></td> <td><span class="roboto-unscale math-font-normal">41.072s</span></td> <td>!</td> <td><span class="roboto-unscale math-font-normal">5.09ms</span>/<span class="roboto-unscale math-font-normal">414ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 100​]​]</th> <td><span class="roboto-unscale math-font-normal">1.154s</span></td> <td><span class="roboto-unscale math-font-normal">38.160s</span></td> <td><span class="roboto-unscale math-font-normal">22.638s</span></td> <td><span class="roboto-unscale math-font-normal">253ms</span>/<span class="roboto-unscale math-font-normal">394ms</span>/<span class="roboto-unscale math-font-normal">1198ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 110​]​]</th> <td><span class="roboto-unscale math-font-normal">1.500s</span></td> <td><span class="roboto-unscale math-font-normal">38.148s</span></td> <td><span class="roboto-unscale math-font-normal">19.301s</span></td> <td><span class="roboto-unscale math-font-normal">487ms</span>/<span class="roboto-unscale math-font-normal">748ms</span>/<span class="roboto-unscale math-font-normal">735ms</span></td></tr>
 <tr><th>5700 XT, [​[​G = 128​]​]</th> <td><span class="roboto-unscale math-font-normal">1.758s</span></td> <td><span class="roboto-unscale math-font-normal">44.541s</span></td> <td>!</td> <td><span class="roboto-unscale math-font-normal">479ms</span>/<span class="roboto-unscale math-font-normal">815ms</span></td></tr>
 <tfoot class="slowdown-didnt"><tr><td colspan=5><strong>!</strong>: timed out</td></tfoot>
</table>
<p>
[​[​G = 100​]​] stays winning.
</p>
<h2 id="gxyz-unnest" class="continued"><a class="hash-link" href="#gxyz-unnest">#</a> Failure: un-nesting iteration of points-in-cell from iteration of cells-in-bounding-box</h2>
<!-- https://discord.com/channels/145079846832308224/150317232239542272/1345280142754189463 -->
<blockquote class="continuing"><date>[07:23]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: have you considered doing the rejig of the logic I mentioned above, splitting the looking for next shell cell and iterating a shell cell instead of one nested in the other?
<hr /><date>[20:50]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: i don't really see how this is different<!--'-->
<date>[20:51]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: or, rather, this seems to me like it's exactly the same loop but with two gotos except with the state spilled<!--'-->
<hr /><date>[21:02]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: it is the same loop but it means that in a warp if one thread is ready to iterate a set of points the rest doesn't have to wait until it's done to continue to the next set

instead all threads will continue until they find a cell they need to iterate over and then they together fall into the iteration logic
<date>[21:17]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: summerized the most expensive operation in your compute shader is iterating points,

so lets make sure that as much as possible no threads in a warp are set to idle when another is iterating their cell
</blockquote>
<p class="continuing">
In matters of taste, ye ask and
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/84d60233ed7fde570420392a388d7f7a8dd087cc/item/src/posterise_grid.kernel.hlsl.inc#L38">ye shall receive</a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> gridpos_f<!--"-->   <!--"--><span class="token operator">=</span> <span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos<!--"-->      <!--"--><span class="token operator">=</span> <span class="token keyword">trunc</span><span class="token punctuation">(</span>gridpos_f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_from <span class="token operator">=</span> gridpos <span class="token operator">-</span> <span class="token keyword">min</span><span class="token punctuation">(</span>grid_bothdirs<span class="token punctuation">,</span> gridpos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint3</span> gridpos_to<!--"-->   <!--"--><span class="token operator">=</span> <span class="token keyword">min</span><span class="token punctuation">(</span>gridpos <span class="token operator">+</span> grid_bothdirs<span class="token punctuation">,</span> GRID_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> newcenter <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">uint3</span> range <span class="token operator">=</span> gridpos_to <span class="token operator">-</span> gridpos_from <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span> need_to_see <span class="token operator">=</span> range<span class="token punctuation">.</span>x <span class="token operator">*</span> range<span class="token punctuation">.</span>y <span class="token operator">*</span> range<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span> seen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint3</span> gxyz<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">bool</span> iter <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">while</span><span class="token punctuation">(</span>seen <span class="token operator">&lt;</span> need_to_see<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"-->seen <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">uint</span> acc <span class="token operator">=</span> seen<span class="token punctuation">;</span>
<!--"-->			<!--"-->gxyz <span class="token operator">=</span> gridpos_from<span class="token punctuation">;</span>
<!--"-->			<!--"-->gxyz<span class="token punctuation">.</span>z <span class="token operator">+=</span> acc <span class="token operator">%</span> range<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
<!--"-->			<!--"-->acc <span class="token operator">/=</span> range<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
<!--"-->			<!--"-->gxyz<span class="token punctuation">.</span>y <span class="token operator">+=</span> acc <span class="token operator">%</span> range<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<!--"-->			<!--"-->acc <span class="token operator">/=</span> range<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<!--"-->			<!--"-->gxyz<span class="token punctuation">.</span>x <span class="token operator">+=</span> acc<span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->			<!--"--><span class="token keyword">const</span> <span class="token keyword">bool3</span> gxyz_same <span class="token operator">=</span> gxyz <span class="token operator">==</span> gridpos<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token comment">// ...</span>
<!--"-->			<!--"--><span class="token keyword">bool2</span><!--"-->  <!--"-->corners_inrange <span class="token operator">=</span> corners_squared <span class="token operator">&lt;=</span> radiussy_squared<span class="token punctuation">;</span>
</small><!--"-->			<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">any</span><span class="token punctuation">(</span>corners_inrange<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->				<!--"--><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>corners_inrange<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->				<!--"--><span class="token class-name">groupsum_t</span> sums <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>SUMS_FIELD<span class="token punctuation">[</span>gxyz<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gxyz<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gxyz<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->				<!--"-->newcenter_count <span class="token operator">+=</span> sums<span class="token punctuation">.</span>freqsum<span class="token punctuation">;</span>
<!--"-->				<!--"-->newcenter<!--"-->       <!--"--><span class="token operator">+=</span> sums<span class="token punctuation">.</span>labsum<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<!--"-->				<!--"-->iter <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<!--"-->				<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>iter<span class="token punctuation">)</span>
<!--"-->			<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token class-name">groupdesc_t</span> group <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>gxyz<span class="token punctuation">.</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>gxyz<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>gxyz<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> group<span class="token punctuation">.</span>start_idx <span class="token operator">!=</span> group<span class="token punctuation">.</span>end_idx<span class="token punctuation">;</span> <span class="token operator">++</span>group<span class="token punctuation">.</span>start_idx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token comment">// ...</span>
<!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"-->newcenter <span class="token operator">/=</span> newcenter_count<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>newcenter <span class="token operator">==</span> center<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->center <span class="token operator">=</span> newcenter<span class="token punctuation">;</span>
</small><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack_r_g_b_to_rgb</span><span class="token punctuation">(</span><span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small></code></pre>
</div>
<p class="continued">
This is significantly worse than <code>for(uint gx = gridpos_from.x; gx &lt;= gridpos_to.x; ++gx)</code> &c.:
</p>
<!--
400.784899ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.646213ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.180743ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.209119ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
394.683985ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.621461ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
394.198592ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
394.333826ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
395.003353ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.233569ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.376349ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
397.95948ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.324429ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
394.419856ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
394.127353ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
398.286395ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ± σ): 397.024351 ms ± 2.083761 ms
  Range (min … max): 394.127353 ms … 400.784899 ms 16 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">397.024ms</span></td> </tr>
 <tr><th>(speed-up vs previous) </th> <td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>5.772</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td> </tr>
 <tr><th>(speed-up vs base-line)</th> <td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>3.070</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td> </tr>
</table>
<blockquote class="continuing codecontinued" style="white-space: pre-wrap;"><date>[21:52]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: ah, was worth a shot...
<date>[21:53]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: no for sure
<date>[21:55]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: seen = dot(gxyz, uint3(10000, 100, 1))
<date>[21:56]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: hm yeah i suppose but only the inverse is of interest right
<date>[21:59]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: keeping gxyz and bumping .z and propagating overflow had more branches in it when i wrote it
<date>[21:59]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: but maybe im not branchlesspilled enough
<date>[22:02]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: hmm
<pre class="language-hlsl"><code class="language-hlsl"><span class="token comment">[diff for below]</span></code></pre><date>[22:04]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: zamn
<date>[22:06]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: only 1 branch and it's<!--'--> the branch you want to happen
<date>[22:08]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: bonus it also avoid the idiv that's<!--'--> typically pretty expensive
</blockquote>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/c2052178ae42cc852fa2440d77a60000882b6585/item/src/posterise_grid.kernel.hlsl.inc#L36">and indeed</a>
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">uint</span> newcenter_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">float3</span> newcenter <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">uint</span> seen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint3</span> gxyz <span class="token operator">=</span> gridpos_from <span class="token operator">-</span> <span class="token keyword">uint3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">bool</span> iter <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">bool3</span> wrap <span class="token operator">=</span> gxyz <span class="token operator">>=</span> gridpos_to<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">all</span><span class="token punctuation">(</span>wrap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!--"-->				<!--"--><span class="token keyword">break</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">bool</span> wrapz <span class="token operator">=</span> wrap<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">bool</span> wrapy <span class="token operator">=</span> wrap<span class="token punctuation">.</span>z <span class="token operator">&amp;&amp;</span> wrap<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token keyword">bool3</span> nil <span class="token operator">=</span> <span class="token keyword">bool3</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> wrapy<span class="token punctuation">,</span> wrapz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"-->gxyz <span class="token operator">=</span> nil <span class="token operator">?</span> gridpos_from <span class="token operator">:</span> <span class="token punctuation">(</span>gxyz <span class="token operator">+</span> <span class="token keyword">uint3</span><span class="token punctuation">(</span>wrapy<span class="token punctuation">,</span> wrapz<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->			<!--"--><span class="token keyword">const</span> <span class="token keyword">bool3</span> gxyz_same <span class="token operator">=</span> gxyz <span class="token operator">==</span> gridpos<span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token comment">// ...</span>
</small></code></pre>
</div>
<!--
266.977724ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.709842ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.150192ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.797986ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.602078ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.835718ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.073821ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.133589ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.663054ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
260.175587ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
259.853802ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
261.156937ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
261.32296ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
261.687307ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
260.982159ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
264.419753ms: MSC 16755 RGBs @ r=0.02 => ~373 levels
Benchmark 1: MSC 16755 RGBs @ r=0.02 => ~373 levels
  Time (mean ┬▒ ¤â): 263.283907 ms ┬▒ 2.016309 ms
  Range (min ÔÇª max): 259.853802 ms ÔÇª 266.977724 ms 16 runs
-->
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span>, [​[​palette​]​]</th></tr>
 <tr><th>5700 XT </th> <td><span class="roboto-unscale math-font-normal">397.024ms</span></td> </tr>
 <tr><th>(speed-up vs above) </th> <td> <span class="roboto-unscale math-font-normal">50.80%</span></td> </tr>
 <tr><th>(speed-up vs previous) </th> <td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>3.828</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td> </tr>
 <tr><th>(speed-up vs base-line)</th> <td><math class="roboto-unscale math-font-normal"><mrow><mfrac><mi>1</mi><mi>2.036</mi></mfrac></mrow></math><span class="roboto-unscale math-font-normal">×</span></td> </tr>
</table>
<blockquote class="continuing codecontinued"><date>[22:25]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: also funny, too me, that you've<!--'--> reimplemented wrapping addition combinatorially to solve what is otherwise a very mundane problem
<date>[22:26]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: wrapping addition with carry lookahead
</blockquote>
<h2 id="gxyz-xyz" class="continued"><a class="hash-link" href="#gxyz-xyz">#</a> Failure: [​[​l&lt;a&lt;b​]​]</h2>
<!--
https://discord.com/channels/145079846832308224/150317232239542272/1344307267536818267
https://discord.com/channels/145079846832308224/150317232239542272/1345832062019571764
-->
<blockquote class="continuing"><date>[14:54]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: for example a very flat in the z-axis data set (max_z - min_z < radius) will have a gr_z == 100 and always iterate the full depth of the grid on each particle
<hr /><date>[14:55]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: this will always be the case
<date>[14:56]</date> <strong style="color: rgb(228, 85, 182);">((наб *)(войд)())()</strong>: if you need to look at the whole z-axis then you need to look at the whole z-axis
<hr /><date>[14:56]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: but if it's<!--'--> flat in the x axis it will need to deal with 2 more inner loops
<date>[14:57]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: so a rotation of the data set might be in order so the flattest axis is always z
<date>[14:57]</date> <strong style="color: rgb(46, 204, 113);">ratchetfreak</strong>: that way the longest inner loop is inside</blockquote>
<p class="continuing">
so, <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/sorted-coords/item/src/posterise_gpu.rs#L703">obtusely</a>
(there <em>has</em> to be a better, perhaps even canonical, way of expressing this):
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...find_bbox.hlsl</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> bbox_min <span class="token operator">=</span> <span class="token function">become_float3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> bbox_range <span class="token operator">=</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> bbox_max <span class="token operator">=</span> <span class="token function">become_float3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token punctuation">[</span>bbox_max<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bbox_max<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bbox_max<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox_min<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<!--"-->	<!--"--><span class="token punctuation">}</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token comment">// Sort coordinates so the bounding box ranges are x>y>z</span>
<!--"-->	<!--"--><span class="token comment">// such that the grid radiussy bounding prism is x&lt;y&lt;z such that the innermost loop is the hottest</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span><!--"-->   <!--"-->swaps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> unswaps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span> bbox_range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> bbox_range<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->bbox_min<!--"-->  <!--"--><span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->bbox_range<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->swaps<!--"-->     <!--"--><span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">if</span> bbox_range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> bbox_range<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->bbox_min<!--"-->  <!--"--><span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->bbox_range<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->swaps<!--"-->     <!--"--><span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->unswaps<!--"-->   <!--"--><span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">if</span> swaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->unswaps<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_min<!--"-->   <!--"--><span class="token operator">=</span> bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>bbox_range <span class="token operator">=</span> bbox_range<span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>axis_swaps <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><!--"-->  <!--"-->swaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><!--"-->  <!--"-->swaps<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><!--"-->  <!--"-->swaps<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
<!--"-->	                                  <!--"--><span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>unswaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>unswaps<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>unswaps<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// assign_cell.hlsl...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/sorted-coords/item/src/shader.h#L20">where</a>
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token keyword">struct</span> <span class="token class-name">params_t</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token class-name">point_t</span> bbox_range<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint</span><!--"-->    <!--"-->axis_swaps<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">bbox_max</span> <span class="token expression">bbox_range</span></span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuing">
such that
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/sorted-coords/item/src/assign_cell.hlsl#L25"><samp>assign_cell.hlsl</samp></a>
can rotate the axes:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_min<!--"-->       <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">float3</span> bbox_range<!--"-->     <!--"--><span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_range<span class="token punctuation">;</span>
</small><!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span><!--"-->   <!--"-->axis_swaps<!--"-->     <!--"--><span class="token operator">=</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>axis_swaps <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

</small><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">TWOBITS</span> <span class="token expression"><span class="token number">3</span></span></span>
<!--"-->	<!--"--><span class="token keyword">float3</span> lab <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->	<!--"-->lab <span class="token operator">=</span> <span class="token keyword">float3</span><span class="token punctuation">(</span>lab<span class="token punctuation">[</span><span class="token punctuation">(</span>axis_swaps <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	             <!--"-->lab<span class="token punctuation">[</span><span class="token punctuation">(</span>axis_swaps <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> TWOBITS<span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->	             <!--"-->lab<span class="token punctuation">[</span><span class="token punctuation">(</span>axis_swaps <span class="token operator">>></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> TWOBITS<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>lab <span class="token operator">=</span> lab<span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'>
<!--"-->	<!--"--><span class="token keyword">uint3</span> gridpos <span class="token operator">=</span> <span class="token keyword">trunc</span><span class="token punctuation">(</span><span class="token function">lab_to_gridpos</span><span class="token punctuation">(</span>lab<span class="token punctuation">,</span> bbox_min<span class="token punctuation">,</span> bbox_range<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->outputs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	              <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<!--"-->	              <!--"--><span class="token punctuation">(</span>gridpos<span class="token punctuation">.</span>z <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
and
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/sorted-coords/item/src/posterise_grid.kernel.hlsl.inc#L87"><samp>posterise_grid.kernel.hlsl.inc</samp></a>/<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/sorted-coords/item/src/posterise_grid_oneshot.kernel.hlsl.inc#L86"><samp>posterise_grid_oneshot.kernel.hlsl.inc</samp></a>
can unrotate them when uploading <samp>outputs</samp>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><span class="token macro property"><span class="token directive keyword">#define</span> <span class="token macro-name">TWOBITS</span> <span class="token expression"><span class="token number">3</span></span></span>
outputs<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>rgb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">pack_r_g_b_to_rgb</span><span class="token punctuation">(</span><span class="token function">oklab_to_linear_srgb</span><span class="token punctuation">(</span>
<!--"-->	<!--"--><span class="token keyword">float3</span><span class="token punctuation">(</span>center<span class="token punctuation">[</span><span class="token punctuation">(</span>axis_unswaps <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->		   <!--"-->center<span class="token punctuation">[</span><span class="token punctuation">(</span>axis_unswaps <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> TWOBITS<span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->		   <!--"-->center<span class="token punctuation">[</span><span class="token punctuation">(</span>axis_unswaps <span class="token operator">>></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> TWOBITS<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<p class="continuation">
since everything else is [​[​P​]​]-agnostic.
</p>
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, natural </th> <td><span class="roboto-unscale math-font-normal">68.781ms</span></td> <td><span class="roboto-unscale math-font-normal">3.242s</span></td> <td><span class="roboto-unscale math-font-normal">29.624s</span></td> <td><span class="roboto-unscale math-font-normal">968µs</span>/<span class="roboto-unscale math-font-normal">6.8ms</span>/<span class="roboto-unscale math-font-normal">190ms</span></td></tr>
 <tr><th>5700 XT, <span class="roboto-unscale math-font-normal">l&lt;a&lt;b</span></th> <td><span class="roboto-unscale math-font-normal">69.741ms</span></td> <td><span class="roboto-unscale math-font-normal">3.057s</span></td> <td><span class="roboto-unscale math-font-normal">32.232s</span></td> <td><span class="roboto-unscale math-font-normal">2.17ms</span>/<span class="roboto-unscale math-font-normal">11.1ms</span>/<span class="roboto-unscale math-font-normal">780ms</span></td></tr>
 <tr><th>5700 XT, <span class="roboto-unscale math-font-normal">l&gt;a&gt;b</span></th> <td><span class="roboto-unscale math-font-normal">71.622ms</span></td> <td><span class="roboto-unscale math-font-normal">3.143s</span></td> <td><span class="roboto-unscale math-font-normal">34.152s</span></td> <td><span class="roboto-unscale math-font-normal">2.06ms</span>/<span class="roboto-unscale math-font-normal">7.73ms</span>/<span class="roboto-unscale math-font-normal">2.061s</span></td></tr>
 <tr></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, natural </th> <td><span class="roboto-unscale math-font-normal">1.154s</span></td> <td><span class="roboto-unscale math-font-normal">38.160s</span></td> <td><span class="roboto-unscale math-font-normal">22.638s</span></td> <td><span class="roboto-unscale math-font-normal">253ms</span>/<span class="roboto-unscale math-font-normal">394ms</span>/<span class="roboto-unscale math-font-normal">1198ms</span></td></tr>
 <tr><th>5700 XT, <span class="roboto-unscale math-font-normal">l&lt;a&lt;b</span></th> <td><span class="roboto-unscale math-font-normal">1.374s</span></td> <td><span class="roboto-unscale math-font-normal">39.296s</span></td> <td><span class="roboto-unscale math-font-normal">20.306s</span></td> <td><span class="roboto-unscale math-font-normal">487ms</span>/<span class="roboto-unscale math-font-normal">819ms</span>/<span class="roboto-unscale math-font-normal">641ms</span></td></tr>
 <tr><th>5700 XT, <span class="roboto-unscale math-font-normal">l&gt;a&gt;b</span></th> <td><span class="roboto-unscale math-font-normal">1.401s</span></td> <td><span class="roboto-unscale math-font-normal">39.200s</span></td> <td><span class="roboto-unscale math-font-normal">20.292s</span></td> <td><span class="roboto-unscale math-font-normal">487ms</span>/<span class="roboto-unscale math-font-normal">827ms</span>/<span class="roboto-unscale math-font-normal">768ms</span></td></tr>
</table>
<p class="indented continued">
Pretty much every operation that could be parallelised so far has been so how's<!--'--> about
</p>
<h2 id="groups_accumulator-mutex" class="continuing"><a class="hash-link" href="#groups_accumulator-mutex">#</a> parallelising is points-in-cell <samp>assign_cell.hlsl</samp> <q>grouping</q> post-processing</h2>
<p class="continuing">
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/caaff5a4bf5d8fffb7eb91c0743c1ee0591a1f33/item/src/posterise_gpu.rs#L762">like</a>
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"-->groups_accumulator<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token namespace">sync<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">>></span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token constant">GRID_SIZE</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">,</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"-->use_oneshot_driver<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</small><span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"-->ret<span class="token punctuation">.</span>groups_accumulator <span class="token operator">=</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token class-name">MaybeUninit</span><span class="token operator">&lt;</span><span class="token string">_</span><span class="token operator">>></span><span class="token punctuation">::</span><span class="token function">assume_init</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new_uninit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->	<!--"--><span class="token keyword">for</span> ga <span class="token keyword">in</span> ret<span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->		<!--"--><span class="token namespace">ptr<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span>ga <span class="token keyword">as</span> <span class="token operator">*</span><span class="token keyword">mut</span> <span class="token string">_</span><span class="token punctuation">,</span> <span class="token namespace">sync<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token punctuation">}</span>
</small><!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> known_rgbs_rgbs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> known_rgbs_freqs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...assign_cell.hlsl</span>
<!--"-->	<!--"--><span class="token comment">// grouping</span>
<!--"-->	<!--"--><span class="token keyword">let</span> known_rgbs_groupcoords<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>buffer_outputs_map<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>known_rgbs<span class="token punctuation">]</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> threads <span class="token operator">=</span> <span class="token namespace">num_cpus<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> setlen_default <span class="token operator">=</span> known_rgbs_groupcoords<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> threads<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> setlen_last<!--"-->    <!--"--><span class="token operator">=</span> known_rgbs_groupcoords<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> setlen_default <span class="token operator">*</span> <span class="token punctuation">(</span>threads <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">for</span> group <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"-->group<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> joins <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span>threads<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">for</span> subset <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>threads <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">let</span> setlen <span class="token operator">=</span> <span class="token keyword">if</span> subset <span class="token operator">==</span> threads <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">{</span> setlen_last<!--"-->    <!--"--><span class="token punctuation">}</span>
<!--"-->		             <!--"--><span class="token keyword">else</span><!--"-->                     <!--"--><span class="token punctuation">{</span> setlen_default <span class="token punctuation">}</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token keyword">let</span> known_rgbs_groupcoords<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token punctuation">[</span><span class="token string">_</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<!--"-->			<!--"--><span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts</span><!--"-->    <!--"--><span class="token punctuation">(</span>known_rgbs_groupcoords <span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><!--"-->     <!--"-->known_rgbs_groupcoords<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token keyword">let</span> groups_accumulator<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'<!--'-->static</span> <span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token string">_</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<!--"-->			<!--"--><span class="token namespace">slice<span class="token punctuation">::</span></span><span class="token function">from_raw_parts_mut</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_mut_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"-->joins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
<!--"-->			<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> groupcoord<span class="token punctuation">)</span> <span class="token keyword">in</span> known_rgbs_groupcoords<span class="token punctuation">[</span>subset <span class="token operator">*</span> setlen_default<span class="token punctuation">..</span>subset <span class="token operator">*</span> setlen_default <span class="token operator">+</span> setlen<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->				<!--"--><span class="token keyword">let</span> id <span class="token operator">=</span> id <span class="token operator">+</span> subset <span class="token operator">*</span> setlen_default<span class="token punctuation">;</span>

<small style='display: block; line-height: initial;'><!--"-->				<!--"--><span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>groupcoord <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<!--"-->				                 <!--"--><span class="token punctuation">(</span>groupcoord <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">,</span>
<!--"-->				                 <!--"--><span class="token punctuation">(</span>groupcoord <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</small><!--"-->				<!--"-->groups_accumulator<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->			<!--"--><span class="token punctuation">}</span>
<!--"-->		<!--"--><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"-->joins<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>jh<span class="token closure-punctuation punctuation">|</span></span> jh<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token comment">// copying</span>
<small style='display: block; line-height: initial;'><!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> dump <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span> known_rgbs <span class="token operator">></span> <span class="token number">75_000</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token constant">GRID_GILBERT</span> <span class="token punctuation">{</span>
</small><!--"-->			<!--"--><span class="token function">dump</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">,</span>
<!--"-->			     <!--"--><span class="token operator">&amp;</span><!--"-->    <!--"--><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token keyword">for</span> <span class="token punctuation">(</span>gr_z<span class="token punctuation">,</span> ga_z<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>buffer_params_map<span class="token punctuation">.</span>group_ranges<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<!--"-->		               <!--"--><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>groups_accumulator<!--"-->            <!--"--><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><!--"-->    <!--"--><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</small><!--"-->			<!--"--><span class="token function">dump</span><span class="token punctuation">(</span>gr_z<span class="token punctuation">,</span> ga_z<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<small style='display: block; line-height: initial;'><!--"-->		<!--"--><span class="token punctuation">}</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
</small><!--"-->	<!--"--><span class="token comment">// sum_cells.straight.hlsl or sum_cells.oneshot.hlsl...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<!--
4.659528ms: 16755 BEFORE grouping
2.669357ms: 16755 BEFORE copied
4.433132ms: 16755 BEFORE grouping
2.708297ms: 16755 BEFORE copied
4.191945ms: 16755 BEFORE grouping
3.541132ms: 16755 BEFORE copied
4.855737ms: 16755 BEFORE grouping
2.576083ms: 16755 BEFORE copied
4.878679ms: 16755 BEFORE grouping
2.574272ms: 16755 BEFORE copied
5.031119ms: 16755 BEFORE grouping
2.581214ms: 16755 BEFORE copied
4.814383ms: 16755 BEFORE grouping
2.614117ms: 16755 BEFORE copied
4.687903ms: 16755 BEFORE grouping
2.606269ms: 16755 BEFORE copied
4.661339ms: 16755 BEFORE grouping
2.582724ms: 16755 BEFORE copied
4.388457ms: 16755 BEFORE grouping
2.594798ms: 16755 BEFORE copied
4.475996ms: 16755 BEFORE grouping
2.58212ms: 16755 BEFORE copied
4.257751ms: 16755 BEFORE grouping
2.627701ms: 16755 BEFORE copied
4.140629ms: 16755 BEFORE grouping
2.66815ms: 16755 BEFORE copied
4.079653ms: 16755 BEFORE grouping
2.718561ms: 16755 BEFORE copied
4.500447ms: 16755 BEFORE grouping
2.623475ms: 16755 BEFORE copied
4.403248ms: 16755 BEFORE grouping
2.68596ms: 16755 BEFORE copied
4.519767ms: 16755 BEFORE grouping
2.621361ms: 16755 BEFORE copied
4.386947ms: 16755 BEFORE grouping
2.729126ms: 16755 BEFORE copied
4.325368ms: 16755 BEFORE grouping
2.69411ms: 16755 BEFORE copied
4.175645ms: 16755 BEFORE grouping
2.648831ms: 16755 BEFORE copied
4.331103ms: 16755 BEFORE grouping
2.657283ms: 16755 BEFORE copied
4.499239ms: 16755 BEFORE grouping
2.703468ms: 16755 BEFORE copied
4.121309ms: 16755 BEFORE grouping
2.669357ms: 16755 BEFORE copied
4.132479ms: 16755 BEFORE grouping
2.769575ms: 16755 BEFORE copied
4.078143ms: 16755 BEFORE grouping
2.673584ms: 16755 BEFORE copied
4.088105ms: 16755 BEFORE grouping
2.921412ms: 16755 BEFORE copied
4.179569ms: 16755 BEFORE grouping
2.970011ms: 16755 BEFORE copied
3.9088ms: 16755 BEFORE grouping
2.735163ms: 16755 BEFORE copied
4.309671ms: 16755 BEFORE grouping
2.821193ms: 16755 BEFORE copied
4.144553ms: 16755 BEFORE grouping
2.811233ms: 16755 BEFORE copied
4.121914ms: 16755 BEFORE grouping
2.938014ms: 16755 BEFORE copied
4.152401ms: 16755 BEFORE grouping
3.098906ms: 16755 BEFORE copied
4.207642ms: 16755 BEFORE grouping
3.130903ms: 16755 BEFORE copied
4.143647ms: 16755 BEFORE grouping
3.155354ms: 16755 BEFORE copied
4.349517ms: 16755 BEFORE grouping
3.043364ms: 16755 BEFORE copied
4.240545ms: 16755 BEFORE grouping
2.988123ms: 16755 BEFORE copied
5.249666ms: 16755 BEFORE grouping
2.622569ms: 16755 BEFORE copied
4.88532ms: 16755 BEFORE grouping
2.548312ms: 16755 BEFORE copied
4.848493ms: 16755 BEFORE grouping
2.589666ms: 16755 BEFORE copied
4.962295ms: 16755 BEFORE grouping
2.566725ms: 16755 BEFORE copied
4.918223ms: 16755 BEFORE grouping
2.593893ms: 16755 BEFORE copied
4.933316ms: 16755 BEFORE grouping
2.603854ms: 16755 BEFORE copied
4.872642ms: 16755 BEFORE grouping
2.612608ms: 16755 BEFORE copied
4.559612ms: 16755 BEFORE grouping
2.636454ms: 16755 BEFORE copied
4.618776ms: 16755 BEFORE grouping
2.640681ms: 16755 BEFORE copied
4.162664ms: 16755 BEFORE grouping
2.657585ms: 16755 BEFORE copied
4.178361ms: 16755 BEFORE grouping
2.652454ms: 16755 BEFORE copied
4.454564ms: 16755 BEFORE grouping
2.62438ms: 16755 BEFORE copied
4.165683ms: 16755 BEFORE grouping
2.671471ms: 16755 BEFORE copied
4.214283ms: 16755 BEFORE grouping
2.640077ms: 16755 BEFORE copied
4.258053ms: 16755 BEFORE grouping
2.645813ms: 16755 BEFORE copied
4.193455ms: 16755 BEFORE grouping
2.639474ms: 16755 BEFORE copied
4.229074ms: 16755 BEFORE grouping
2.662415ms: 16755 BEFORE copied
4.161457ms: 16755 BEFORE grouping
2.660604ms: 16755 BEFORE copied
4.133988ms: 16755 BEFORE grouping
2.69411ms: 16755 BEFORE copied
4.196473ms: 16755 BEFORE grouping
2.646416ms: 16755 BEFORE copied
4.265901ms: 16755 BEFORE grouping
2.670867ms: 16755 BEFORE copied
4.313595ms: 16755 BEFORE grouping
2.772595ms: 16755 BEFORE copied
4.029543ms: 16755 BEFORE grouping
2.620456ms: 16755 BEFORE copied
4.147873ms: 16755 BEFORE grouping
2.672376ms: 16755 BEFORE copied
4.83008ms: 16755 BEFORE grouping
2.62921ms: 16755 BEFORE copied
4.157533ms: 16755 BEFORE grouping
2.766859ms: 16755 BEFORE copied
4.120102ms: 16755 BEFORE grouping
2.80761ms: 16755 BEFORE copied
4.218508ms: 16755 BEFORE grouping
2.842324ms: 16755 BEFORE copied
4.275561ms: 16755 BEFORE grouping
2.950994ms: 16755 BEFORE copied
4.146063ms: 16755 BEFORE grouping
3.065701ms: 16755 BEFORE copied
4.163268ms: 16755 BEFORE grouping
3.262213ms: 16755 BEFORE copied
4.18621ms: 16755 BEFORE grouping
3.339489ms: 16755 BEFORE copied
4.260468ms: 16755 BEFORE grouping
2.996273ms: 16755 BEFORE copied
4.489278ms: 16755 BEFORE grouping
2.778933ms: 16755 BEFORE copied
4.921845ms: 16755 BEFORE grouping
2.5628ms: 16755 BEFORE copied
4.882603ms: 16755 BEFORE grouping
2.530502ms: 16755 BEFORE copied
5.278645ms: 16755 BEFORE grouping
2.723089ms: 16755 BEFORE copied
4.832494ms: 16755 BEFORE grouping
3.124564ms: 16755 BEFORE copied
4.239941ms: 16755 BEFORE grouping
2.782857ms: 16755 BEFORE copied
4.496523ms: 16755 BEFORE grouping
2.894244ms: 16755 BEFORE copied
4.496824ms: 16755 BEFORE grouping
2.697733ms: 16755 BEFORE copied
4.917619ms: 16755 BEFORE grouping
3.619012ms: 16755 BEFORE copied
5.349583ms: 16755 BEFORE grouping
2.76052ms: 16755 BEFORE copied
4.593722ms: 16755 BEFORE grouping
2.756898ms: 16755 BEFORE copied
4.688204ms: 16755 BEFORE grouping
2.725806ms: 16755 BEFORE copied
4.522483ms: 16755 BEFORE grouping
2.736672ms: 16755 BEFORE copied
4.556292ms: 16755 BEFORE grouping
2.96337ms: 16755 BEFORE copied
4.921544ms: 16755 BEFORE grouping
2.695016ms: 16755 BEFORE copied
5.017233ms: 16755 BEFORE grouping
2.746031ms: 16755 BEFORE copied
4.61606ms: 16755 BEFORE grouping
2.768971ms: 16755 BEFORE copied
4.449433ms: 16755 BEFORE grouping
2.810628ms: 16755 BEFORE copied
4.380004ms: 16755 BEFORE grouping
2.735163ms: 16755 BEFORE copied
8.606663ms: 27868 BEFORE grouping
3.245007ms: 27868 BEFORE copied
6.166116ms: 27868 BEFORE grouping
2.750559ms: 27868 BEFORE copied
6.539216ms: 27868 BEFORE grouping
3.502495ms: 27868 BEFORE copied
6.31916ms: 27868 BEFORE grouping
3.276703ms: 27868 BEFORE copied
6.43417ms: 27868 BEFORE grouping
3.107359ms: 27868 BEFORE copied
6.375306ms: 27868 BEFORE grouping
2.958843ms: 27868 BEFORE copied
6.264826ms: 27868 BEFORE grouping
2.793121ms: 27868 BEFORE copied
6.327008ms: 27868 BEFORE grouping
2.979973ms: 27868 BEFORE copied
6.255166ms: 27868 BEFORE grouping
3.059966ms: 27868 BEFORE copied
6.327009ms: 27868 BEFORE grouping
2.88217ms: 27868 BEFORE copied
6.494843ms: 27868 BEFORE grouping
2.800063ms: 27868 BEFORE copied
6.343309ms: 27868 BEFORE grouping
2.795837ms: 27868 BEFORE copied
6.266636ms: 27868 BEFORE grouping
2.83025ms: 27868 BEFORE copied
5.881461ms: 27868 BEFORE grouping
3.478949ms: 27868 BEFORE copied
6.693166ms: 27868 BEFORE grouping
3.38024ms: 27868 BEFORE copied
6.040542ms: 27868 BEFORE grouping
3.577054ms: 27868 BEFORE copied
7.373259ms: 27868 BEFORE grouping
3.376015ms: 27868 BEFORE copied
5.861237ms: 27868 BEFORE grouping
4.289446ms: 27868 BEFORE copied
8.621455ms: 27868 BEFORE grouping
4.38091ms: 27868 BEFORE copied
5.359845ms: 27868 BEFORE grouping
2.698336ms: 27868 BEFORE copied
6.099707ms: 27868 BEFORE grouping
2.765349ms: 27868 BEFORE copied
5.80992ms: 27868 BEFORE grouping
2.752068ms: 27868 BEFORE copied
5.288606ms: 27868 BEFORE grouping
3.237158ms: 27868 BEFORE copied
5.155184ms: 27868 BEFORE grouping
3.294512ms: 27868 BEFORE copied
5.11413ms: 27868 BEFORE grouping
2.746332ms: 27868 BEFORE copied
5.117753ms: 27868 BEFORE grouping
2.757501ms: 27868 BEFORE copied
5.291927ms: 27868 BEFORE grouping
3.02495ms: 27868 BEFORE copied
5.733248ms: 27868 BEFORE grouping
2.706185ms: 27868 BEFORE copied
5.697326ms: 27868 BEFORE grouping
2.616532ms: 27868 BEFORE copied
5.258118ms: 27868 BEFORE grouping
3.233536ms: 27868 BEFORE copied
5.022667ms: 27868 BEFORE grouping
2.985406ms: 27868 BEFORE copied
5.308529ms: 27868 BEFORE grouping
2.746634ms: 27868 BEFORE copied
5.115942ms: 27868 BEFORE grouping
2.780141ms: 27868 BEFORE copied
5.332376ms: 27868 BEFORE grouping
2.724599ms: 27868 BEFORE copied
5.98832ms: 27868 BEFORE grouping
2.738484ms: 27868 BEFORE copied
5.626087ms: 27868 BEFORE grouping
2.659396ms: 27868 BEFORE copied
5.118659ms: 27868 BEFORE grouping
3.167127ms: 27868 BEFORE copied
5.119564ms: 27868 BEFORE grouping
2.844136ms: 27868 BEFORE copied
5.089076ms: 27868 BEFORE grouping
2.768972ms: 27868 BEFORE copied
5.013309ms: 27868 BEFORE grouping
2.783462ms: 27868 BEFORE copied
5.853086ms: 27868 BEFORE grouping
2.736975ms: 27868 BEFORE copied
6.185436ms: 27868 BEFORE grouping
2.735465ms: 27868 BEFORE copied
5.726003ms: 27868 BEFORE grouping
2.682337ms: 27868 BEFORE copied
5.365883ms: 27868 BEFORE grouping
3.072342ms: 27868 BEFORE copied
5.110508ms: 27868 BEFORE grouping
3.330434ms: 27868 BEFORE copied
5.085755ms: 27868 BEFORE grouping
2.785876ms: 27868 BEFORE copied
4.868415ms: 27868 BEFORE grouping
2.849568ms: 27868 BEFORE copied
5.155787ms: 27868 BEFORE grouping
2.832664ms: 27868 BEFORE copied
5.979265ms: 27868 BEFORE grouping
2.698034ms: 27868 BEFORE copied
5.767056ms: 27868 BEFORE grouping
2.652454ms: 27868 BEFORE copied
5.350186ms: 27868 BEFORE grouping
2.995669ms: 27868 BEFORE copied
5.1253ms: 27868 BEFORE grouping
2.976954ms: 27868 BEFORE copied
5.105376ms: 27868 BEFORE grouping
2.777424ms: 27868 BEFORE copied
5.137676ms: 27868 BEFORE grouping
2.797649ms: 27868 BEFORE copied
5.34445ms: 27868 BEFORE grouping
2.764745ms: 27868 BEFORE copied
6.043259ms: 27868 BEFORE grouping
2.759916ms: 27868 BEFORE copied
5.748039ms: 27868 BEFORE grouping
2.714334ms: 27868 BEFORE copied
5.192011ms: 27868 BEFORE grouping
3.165013ms: 27868 BEFORE copied
5.110207ms: 27868 BEFORE grouping
2.801271ms: 27868 BEFORE copied
5.102962ms: 27868 BEFORE grouping
2.793724ms: 27868 BEFORE copied
5.215556ms: 27868 BEFORE grouping
2.781348ms: 27868 BEFORE copied
5.853388ms: 27868 BEFORE grouping
2.683243ms: 27868 BEFORE copied
6.024543ms: 27868 BEFORE grouping
2.672376ms: 27868 BEFORE copied
5.8552ms: 27868 BEFORE grouping
2.776217ms: 27868 BEFORE copied
5.272306ms: 27868 BEFORE grouping
3.143582ms: 27868 BEFORE copied
5.148543ms: 27868 BEFORE grouping
3.078681ms: 27868 BEFORE copied
5.161522ms: 27868 BEFORE grouping
2.733654ms: 27868 BEFORE copied
4.868114ms: 27868 BEFORE grouping
2.789801ms: 27868 BEFORE copied
5.841012ms: 27868 BEFORE grouping
2.723089ms: 27868 BEFORE copied
5.895347ms: 27868 BEFORE grouping
2.693205ms: 27868 BEFORE copied
6.124761ms: 27868 BEFORE grouping
2.778933ms: 27868 BEFORE copied
5.334791ms: 27868 BEFORE grouping
2.804592ms: 27868 BEFORE copied
5.112923ms: 27868 BEFORE grouping
3.15626ms: 27868 BEFORE copied
5.226121ms: 27868 BEFORE grouping
2.726409ms: 27868 BEFORE copied
5.197444ms: 27868 BEFORE grouping
2.806402ms: 27868 BEFORE copied
5.210726ms: 27868 BEFORE grouping
2.712825ms: 27868 BEFORE copied
5.823505ms: 27868 BEFORE grouping
2.71826ms: 27868 BEFORE copied
5.628804ms: 27868 BEFORE grouping
2.684451ms: 27868 BEFORE copied
5.181445ms: 27868 BEFORE grouping
3.173163ms: 27868 BEFORE copied
13.701173ms: 84860 BEFORE grouping
16.150474ms: 84860 BEFORE copied
10.33663ms: 84860 BEFORE grouping
10.868508ms: 84860 BEFORE copied
10.853114ms: 84860 BEFORE grouping
10.332101ms: 84860 BEFORE copied
10.935824ms: 84860 BEFORE grouping
10.323951ms: 84860 BEFORE copied
10.92556ms: 84860 BEFORE grouping
10.883904ms: 84860 BEFORE copied
10.79093ms: 84860 BEFORE grouping
10.815985ms: 84860 BEFORE copied
10.708523ms: 84860 BEFORE grouping
10.822324ms: 84860 BEFORE copied
10.900808ms: 84860 BEFORE grouping
11.24342ms: 84860 BEFORE copied
10.922844ms: 84860 BEFORE grouping
10.712447ms: 84860 BEFORE copied
11.00827ms: 84860 BEFORE grouping
10.814173ms: 84860 BEFORE copied
10.951521ms: 84860 BEFORE grouping
10.898996ms: 84860 BEFORE copied
11.012798ms: 84860 BEFORE grouping
10.840738ms: 84860 BEFORE copied
10.588683ms: 84860 BEFORE grouping
10.73901ms: 84860 BEFORE copied
10.198076ms: 84860 BEFORE grouping
10.864585ms: 84860 BEFORE copied
10.272333ms: 84860 BEFORE grouping
10.916504ms: 84860 BEFORE copied
10.262371ms: 84860 BEFORE grouping
11.322206ms: 84860 BEFORE copied
10.249392ms: 84860 BEFORE grouping
10.736595ms: 84860 BEFORE copied
10.284709ms: 84860 BEFORE grouping
10.933409ms: 84860 BEFORE copied
10.584155ms: 84860 BEFORE grouping
10.491786ms: 84860 BEFORE copied
10.785195ms: 84860 BEFORE grouping
10.341761ms: 84860 BEFORE copied
10.699768ms: 84860 BEFORE grouping
10.275352ms: 84860 BEFORE copied
11.001932ms: 84860 BEFORE grouping
10.941861ms: 84860 BEFORE copied
11.312546ms: 84860 BEFORE grouping
11.883064ms: 84860 BEFORE copied
11.463477ms: 84860 BEFORE grouping
10.689203ms: 84860 BEFORE copied
10.928881ms: 84860 BEFORE grouping
10.705504ms: 84860 BEFORE copied
10.708824ms: 84860 BEFORE grouping
10.780365ms: 84860 BEFORE copied
10.512313ms: 84860 BEFORE grouping
10.757122ms: 84860 BEFORE copied
11.428461ms: 84860 BEFORE grouping
12.288162ms: 84860 BEFORE copied
10.187208ms: 84860 BEFORE grouping
11.011591ms: 84860 BEFORE copied
10.224639ms: 84860 BEFORE grouping
11.583014ms: 84860 BEFORE copied
10.439262ms: 84860 BEFORE grouping
10.947898ms: 84860 BEFORE copied
10.317915ms: 84860 BEFORE grouping
11.183953ms: 84860 BEFORE copied
10.990461ms: 84860 BEFORE grouping
11.11694ms: 84860 BEFORE copied
10.73237ms: 84860 BEFORE grouping
10.311877ms: 84860 BEFORE copied
10.723314ms: 84860 BEFORE grouping
10.713051ms: 84860 BEFORE copied
10.668979ms: 84860 BEFORE grouping
10.325762ms: 84860 BEFORE copied
10.870924ms: 84860 BEFORE grouping
10.354137ms: 84860 BEFORE copied
10.641811ms: 84860 BEFORE grouping
10.741124ms: 84860 BEFORE copied
10.791232ms: 84860 BEFORE grouping
10.279275ms: 84860 BEFORE copied
10.720898ms: 84860 BEFORE grouping
10.355043ms: 84860 BEFORE copied
10.803005ms: 84860 BEFORE grouping
10.32546ms: 84860 BEFORE copied
10.732369ms: 84860 BEFORE grouping
10.424169ms: 84860 BEFORE copied
10.666865ms: 84860 BEFORE grouping
10.381305ms: 84860 BEFORE copied
10.670789ms: 84860 BEFORE grouping
10.416924ms: 84860 BEFORE copied
10.74052ms: 84860 BEFORE grouping
10.362288ms: 84860 BEFORE copied
10.626718ms: 84860 BEFORE grouping
10.48273ms: 84860 BEFORE copied
10.767989ms: 84860 BEFORE grouping
10.279578ms: 84860 BEFORE copied
11.084943ms: 84860 BEFORE grouping
12.463845ms: 84860 BEFORE copied
11.116035ms: 84860 BEFORE grouping
11.413066ms: 84860 BEFORE copied
11.301378ms: 84860 BEFORE grouping
11.490342ms: 84860 BEFORE copied
12.894903ms: 84860 BEFORE grouping
12.293293ms: 84860 BEFORE copied
11.826314ms: 84860 BEFORE grouping
11.639161ms: 84860 BEFORE copied
13.152692ms: 84860 BEFORE grouping
14.544875ms: 84860 BEFORE copied
11.41035ms: 84860 BEFORE grouping
11.101848ms: 84860 BEFORE copied
11.510265ms: 84860 BEFORE grouping
11.595088ms: 84860 BEFORE copied
11.534716ms: 84860 BEFORE grouping
15.39069ms: 84860 BEFORE copied
11.508756ms: 84860 BEFORE grouping
11.121468ms: 84860 BEFORE copied
11.344544ms: 84860 BEFORE grouping
12.045767ms: 84860 BEFORE copied
12.269446ms: 84860 BEFORE grouping
15.401255ms: 84860 BEFORE copied
11.383484ms: 84860 BEFORE grouping
11.075284ms: 84860 BEFORE copied
11.361146ms: 84860 BEFORE grouping
12.398944ms: 84860 BEFORE copied
11.338808ms: 84860 BEFORE grouping
14.483899ms: 84860 BEFORE copied
11.295038ms: 84860 BEFORE grouping
13.570769ms: 84860 BEFORE copied
11.418801ms: 84860 BEFORE grouping
11.607766ms: 84860 BEFORE copied
11.418499ms: 84860 BEFORE grouping
11.589051ms: 84860 BEFORE copied
11.512982ms: 84860 BEFORE grouping
11.682024ms: 84860 BEFORE copied
11.460156ms: 84860 BEFORE grouping
11.621048ms: 84860 BEFORE copied
11.706777ms: 84860 BEFORE grouping
11.837785ms: 84860 BEFORE copied
11.240703ms: 84860 BEFORE grouping
12.275181ms: 84860 BEFORE copied
11.312547ms: 84860 BEFORE grouping
12.080179ms: 84860 BEFORE copied
12.049088ms: 84860 BEFORE grouping
12.346421ms: 84860 BEFORE copied
11.503926ms: 84860 BEFORE grouping
11.729718ms: 84860 BEFORE copied
13.455156ms: 84860 BEFORE grouping
13.51583ms: 84860 BEFORE copied
11.637349ms: 84860 BEFORE grouping
11.849256ms: 84860 BEFORE copied
11.538943ms: 84860 BEFORE grouping
13.440667ms: 84860 BEFORE copied
11.075585ms: 84860 BEFORE grouping
12.289369ms: 84860 BEFORE copied
11.575467ms: 84860 BEFORE grouping
12.263711ms: 84860 BEFORE copied
35.099502ms: 242931 BEFORE grouping
16.636471ms: 242931 BEFORE copied
25.427873ms: 242931 BEFORE grouping
13.972848ms: 242931 BEFORE copied
22.817076ms: 242931 BEFORE grouping
12.225072ms: 242931 BEFORE copied
22.695426ms: 242931 BEFORE grouping
11.966378ms: 242931 BEFORE copied
23.156066ms: 242931 BEFORE grouping
11.83386ms: 242931 BEFORE copied
23.482378ms: 242931 BEFORE grouping
12.920862ms: 242931 BEFORE copied
22.698747ms: 242931 BEFORE grouping
11.861028ms: 242931 BEFORE copied
23.025964ms: 242931 BEFORE grouping
11.722776ms: 242931 BEFORE copied
22.722292ms: 242931 BEFORE grouping
12.152324ms: 242931 BEFORE copied
23.088148ms: 242931 BEFORE grouping
12.126363ms: 242931 BEFORE copied
22.656788ms: 242931 BEFORE grouping
11.95219ms: 242931 BEFORE copied
23.085732ms: 242931 BEFORE grouping
13.665855ms: 242931 BEFORE copied
22.914578ms: 242931 BEFORE grouping
12.092254ms: 242931 BEFORE copied
23.236664ms: 242931 BEFORE grouping
11.847142ms: 242931 BEFORE copied
23.048604ms: 242931 BEFORE grouping
11.813032ms: 242931 BEFORE copied
24.189639ms: 242931 BEFORE grouping
12.54263ms: 242931 BEFORE copied
22.583738ms: 242931 BEFORE grouping
12.110667ms: 242931 BEFORE copied
23.148822ms: 242931 BEFORE grouping
12.182209ms: 242931 BEFORE copied
22.796248ms: 242931 BEFORE grouping
12.71137ms: 242931 BEFORE copied
22.9019ms: 242931 BEFORE grouping
11.90842ms: 242931 BEFORE copied
23.211005ms: 242931 BEFORE grouping
12.03158ms: 242931 BEFORE copied
22.657995ms: 242931 BEFORE grouping
11.871895ms: 242931 BEFORE copied
22.769986ms: 242931 BEFORE grouping
11.74632ms: 242931 BEFORE copied
22.952914ms: 242931 BEFORE grouping
12.248617ms: 242931 BEFORE copied
23.343824ms: 242931 BEFORE grouping
11.727908ms: 242931 BEFORE copied
22.687578ms: 242931 BEFORE grouping
12.755744ms: 242931 BEFORE copied
23.493245ms: 242931 BEFORE grouping
12.053917ms: 242931 BEFORE copied
23.089657ms: 242931 BEFORE grouping
11.716739ms: 242931 BEFORE copied
22.857526ms: 242931 BEFORE grouping
12.245901ms: 242931 BEFORE copied
23.174782ms: 242931 BEFORE grouping
11.847444ms: 242931 BEFORE copied
23.053735ms: 242931 BEFORE grouping
11.79975ms: 242931 BEFORE copied
22.62298ms: 242931 BEFORE grouping
11.927437ms: 242931 BEFORE copied
23.602821ms: 242931 BEFORE grouping
12.058445ms: 242931 BEFORE copied
22.678824ms: 242931 BEFORE grouping
11.834766ms: 242931 BEFORE copied
22.71716ms: 242931 BEFORE grouping
11.873706ms: 242931 BEFORE copied
24.141945ms: 242931 BEFORE grouping
11.70557ms: 242931 BEFORE copied
22.66856ms: 242931 BEFORE grouping
12.202132ms: 242931 BEFORE copied
23.285867ms: 242931 BEFORE grouping
11.899062ms: 242931 BEFORE copied
22.709614ms: 242931 BEFORE grouping
13.235703ms: 242931 BEFORE copied
22.71384ms: 242931 BEFORE grouping
11.914457ms: 242931 BEFORE copied
23.028681ms: 242931 BEFORE grouping
12.032184ms: 242931 BEFORE copied
22.861752ms: 242931 BEFORE grouping
12.099196ms: 242931 BEFORE copied
22.540873ms: 242931 BEFORE grouping
11.808806ms: 242931 BEFORE copied
22.960159ms: 242931 BEFORE grouping
12.854755ms: 242931 BEFORE copied
23.867251ms: 242931 BEFORE grouping
12.644961ms: 242931 BEFORE copied
38.286854ms: 328666 BEFORE grouping
13.641405ms: 328666 BEFORE copied
31.053658ms: 328666 BEFORE grouping
13.350712ms: 328666 BEFORE copied
31.354312ms: 328666 BEFORE grouping
13.611521ms: 328666 BEFORE copied
30.798284ms: 328666 BEFORE grouping
13.638387ms: 328666 BEFORE copied
30.761155ms: 328666 BEFORE grouping
14.305499ms: 328666 BEFORE copied
30.861675ms: 328666 BEFORE grouping
13.826446ms: 328666 BEFORE copied
31.058186ms: 328666 BEFORE grouping
13.78992ms: 328666 BEFORE copied
31.331974ms: 328666 BEFORE grouping
14.96567ms: 328666 BEFORE copied
31.938111ms: 328666 BEFORE grouping
13.413801ms: 328666 BEFORE copied
30.523892ms: 328666 BEFORE grouping
13.514019ms: 328666 BEFORE copied
30.740025ms: 328666 BEFORE grouping
13.267399ms: 328666 BEFORE copied
32.673143ms: 328666 BEFORE grouping
16.813663ms: 328666 BEFORE copied
30.558606ms: 328666 BEFORE grouping
13.103488ms: 328666 BEFORE copied
30.569473ms: 328666 BEFORE grouping
13.831879ms: 328666 BEFORE copied
31.024378ms: 328666 BEFORE grouping
13.850594ms: 328666 BEFORE copied
30.929895ms: 328666 BEFORE grouping
13.694533ms: 328666 BEFORE copied
31.038867ms: 328666 BEFORE grouping
13.496209ms: 328666 BEFORE copied
31.059092ms: 328666 BEFORE grouping
13.803806ms: 328666 BEFORE copied
31.102258ms: 328666 BEFORE grouping
13.767884ms: 328666 BEFORE copied
30.926273ms: 328666 BEFORE grouping
13.37456ms: 328666 BEFORE copied
30.944083ms: 328666 BEFORE grouping
13.198876ms: 328666 BEFORE copied
32.849732ms: 328666 BEFORE grouping
16.679033ms: 328666 BEFORE copied
33.165176ms: 328666 BEFORE grouping
14.840096ms: 328666 BEFORE copied
32.709064ms: 328666 BEFORE grouping
15.665081ms: 328666 BEFORE copied
33.328483ms: 328666 BEFORE grouping
15.066189ms: 328666 BEFORE copied
33.207437ms: 328666 BEFORE grouping
15.072226ms: 328666 BEFORE copied
32.209484ms: 328666 BEFORE grouping
16.417923ms: 328666 BEFORE copied
33.1528ms: 328666 BEFORE grouping
15.090036ms: 328666 BEFORE copied
32.560851ms: 328666 BEFORE grouping
16.637074ms: 328666 BEFORE copied
33.260263ms: 328666 BEFORE grouping
15.306471ms: 328666 BEFORE copied
33.155517ms: 328666 BEFORE grouping
15.032079ms: 328666 BEFORE copied
124.045591ms: 1103347 BEFORE grouping
22.591284ms: 1103347 BEFORE copied
110.314231ms: 1103347 BEFORE grouping
16.299593ms: 1103347 BEFORE copied
90.705636ms: 1103347 BEFORE grouping
16.930483ms: 1103347 BEFORE copied
92.287388ms: 1103347 BEFORE grouping
16.380794ms: 1103347 BEFORE copied
90.515464ms: 1103347 BEFORE grouping
16.301706ms: 1103347 BEFORE copied
91.950512ms: 1103347 BEFORE grouping
16.285406ms: 1103347 BEFORE copied
91.065756ms: 1103347 BEFORE grouping
16.696842ms: 1103347 BEFORE copied
93.222856ms: 1103347 BEFORE grouping
16.907542ms: 1103347 BEFORE copied
91.390861ms: 1103347 BEFORE grouping
16.572778ms: 1103347 BEFORE copied
95.835766ms: 1103347 BEFORE grouping
17.106468ms: 1103347 BEFORE copied
95.622652ms: 1103347 BEFORE grouping
16.603266ms: 1103347 BEFORE copied
91.189822ms: 1103347 BEFORE grouping
16.645225ms: 1103347 BEFORE copied
90.840266ms: 1103347 BEFORE grouping
16.643413ms: 1103347 BEFORE copied
91.606088ms: 1103347 BEFORE grouping
16.880676ms: 1103347 BEFORE copied
91.532434ms: 1103347 BEFORE grouping
16.548327ms: 1103347 BEFORE copied
91.586165ms: 1103347 BEFORE grouping
16.752385ms: 1103347 BEFORE copied
91.245063ms: 1103347 BEFORE grouping
16.668166ms: 1103347 BEFORE copied
91.210952ms: 1103347 BEFORE grouping
16.733066ms: 1103347 BEFORE copied
90.808571ms: 1103347 BEFORE grouping
16.570061ms: 1103347 BEFORE copied
Benchmark 1: 16755 BEFORE grouping
  Time (mean ± σ): 4.452702 ms ± 327.072029 µs
  Range (min … max): 3.908800 ms … 5.349583 ms 88 runs
Benchmark 3: 84860 BEFORE grouping
  Time (mean ± σ): 11.115392 ms ± 686.018769 µs
  Range (min … max): 10.187208 ms … 13.701173 ms 77 runs
Benchmark 4: 242931 BEFORE grouping
  Time (mean ± σ): 23.343750 ms ± 1.846677 ms
  Range (min … max): 22.540873 ms … 35.099502 ms 45 runs
Benchmark 2: 27868 BEFORE grouping
  Time (mean ± σ): 5.698526 ms ± 698.973650 µs
  Range (min … max): 4.868114 ms … 8.621455 ms 79 runs
Benchmark 5: 328666 BEFORE grouping
  Time (mean ± σ): 31.907516 ms ± 1.523188 ms
  Range (min … max): 30.523892 ms … 38.286854 ms 31 runs
Benchmark 6: 1103347 BEFORE grouping
  Time (mean ± σ): 94.577688 ms ± 8.194300 ms
  Range (min … max): 90.515464 ms … 124.045591 ms 19 runs
Benchmark 1: 16755 BEFORE copied
  Time (mean ± σ): 2.763113 ms ± 209.341025 µs
  Range (min … max): 2.530502 ms … 3.619012 ms 88 runs
Benchmark 3: 84860 BEFORE copied
  Time (mean ± σ): 11.469185 ms ± 1.259967 ms
  Range (min … max): 10.275352 ms … 16.150474 ms 77 runs
Benchmark 4: 242931 BEFORE copied
  Time (mean ± σ): 12.275128 ms ± 825.397419 µs
  Range (min … max): 11.705570 ms … 16.636471 ms 45 runs
Benchmark 2: 27868 BEFORE copied
  Time (mean ± σ): 2.937407 ms ± 322.630253 µs
  Range (min … max): 2.616532 ms … 4.380910 ms 79 runs
Benchmark 5: 328666 BEFORE copied
  Time (mean ± σ): 14.389241 ms ± 1.111491 ms
  Range (min … max): 13.103488 ms … 16.813663 ms 31 runs
Benchmark 6: 1103347 BEFORE copied
  Time (mean ± σ): 16.953552 ms ± 1.346517 ms
  Range (min … max): 16.285406 ms … 22.591284 ms 19 runs
-->
<!--
4.744049ms: AFTER 16755 grouping
3.109773ms: AFTER 16755 copied
5.09783ms: AFTER 16755 grouping
4.153911ms: AFTER 16755 copied
5.160617ms: AFTER 16755 grouping
3.908799ms: AFTER 16755 copied
5.639671ms: AFTER 16755 grouping
3.417068ms: AFTER 16755 copied
5.696722ms: AFTER 16755 grouping
3.308096ms: AFTER 16755 copied
5.080322ms: AFTER 16755 grouping
3.300852ms: AFTER 16755 copied
5.110508ms: AFTER 16755 grouping
3.544755ms: AFTER 16755 copied
5.00697ms: AFTER 16755 grouping
3.963134ms: AFTER 16755 copied
5.662008ms: AFTER 16755 grouping
3.230517ms: AFTER 16755 copied
5.359544ms: AFTER 16755 grouping
3.306586ms: AFTER 16755 copied
6.285049ms: AFTER 16755 grouping
4.981009ms: AFTER 16755 copied
5.917383ms: AFTER 16755 grouping
3.843295ms: AFTER 16755 copied
5.665027ms: AFTER 16755 grouping
4.294276ms: AFTER 16755 copied
5.914968ms: AFTER 16755 grouping
3.153543ms: AFTER 16755 copied
5.00033ms: AFTER 16755 grouping
3.228102ms: AFTER 16755 copied
4.922147ms: AFTER 16755 grouping
3.373599ms: AFTER 16755 copied
5.09119ms: AFTER 16755 grouping
3.750926ms: AFTER 16755 copied
5.768867ms: AFTER 16755 grouping
3.213311ms: AFTER 16755 copied
4.969238ms: AFTER 16755 grouping
3.266137ms: AFTER 16755 copied
4.908865ms: AFTER 16755 grouping
3.27308ms: AFTER 16755 copied
5.100245ms: AFTER 16755 grouping
3.292399ms: AFTER 16755 copied
4.964106ms: AFTER 16755 grouping
3.720136ms: AFTER 16755 copied
5.526775ms: AFTER 16755 grouping
3.32168ms: AFTER 16755 copied
5.850068ms: AFTER 16755 grouping
3.154449ms: AFTER 16755 copied
5.084246ms: AFTER 16755 grouping
3.243799ms: AFTER 16755 copied
5.765547ms: AFTER 16755 grouping
6.170644ms: AFTER 16755 copied
6.35961ms: AFTER 16755 grouping
3.288474ms: AFTER 16755 copied
5.523454ms: AFTER 16755 grouping
3.499476ms: AFTER 16755 copied
5.203784ms: AFTER 16755 grouping
3.816128ms: AFTER 16755 copied
5.953002ms: AFTER 16755 grouping
3.578261ms: AFTER 16755 copied
5.693402ms: AFTER 16755 grouping
3.443028ms: AFTER 16755 copied
6.952767ms: AFTER 16755 grouping
3.748511ms: AFTER 16755 copied
5.694006ms: AFTER 16755 grouping
3.440612ms: AFTER 16755 copied
5.541868ms: AFTER 16755 grouping
3.81643ms: AFTER 16755 copied
8.529085ms: AFTER 16755 grouping
4.303634ms: AFTER 16755 copied
4.604891ms: AFTER 16755 grouping
3.097397ms: AFTER 16755 copied
4.637794ms: AFTER 16755 grouping
3.501588ms: AFTER 16755 copied
4.449735ms: AFTER 16755 grouping
3.565583ms: AFTER 16755 copied
6.348742ms: AFTER 16755 grouping
3.238668ms: AFTER 16755 copied
4.795365ms: AFTER 16755 grouping
3.222065ms: AFTER 16755 copied
5.123187ms: AFTER 16755 grouping
3.443933ms: AFTER 16755 copied
5.481797ms: AFTER 16755 grouping
3.651312ms: AFTER 16755 copied
5.209216ms: AFTER 16755 grouping
3.292097ms: AFTER 16755 copied
5.348677ms: AFTER 16755 grouping
3.027968ms: AFTER 16755 copied
5.287399ms: AFTER 16755 grouping
3.107056ms: AFTER 16755 copied
4.787215ms: AFTER 16755 grouping
3.167428ms: AFTER 16755 copied
4.616663ms: AFTER 16755 grouping
3.156562ms: AFTER 16755 copied
4.977689ms: AFTER 16755 grouping
3.199426ms: AFTER 16755 copied
4.632964ms: AFTER 16755 grouping
3.075965ms: AFTER 16755 copied
4.51554ms: AFTER 16755 grouping
3.134828ms: AFTER 16755 copied
4.79929ms: AFTER 16755 grouping
3.399559ms: AFTER 16755 copied
4.597344ms: AFTER 16755 grouping
3.519398ms: AFTER 16755 copied
4.671602ms: AFTER 16755 grouping
3.372392ms: AFTER 16755 copied
5.101452ms: AFTER 16755 grouping
3.23897ms: AFTER 16755 copied
5.403616ms: AFTER 16755 grouping
3.063588ms: AFTER 16755 copied
5.504739ms: AFTER 16755 grouping
3.076568ms: AFTER 16755 copied
4.8334ms: AFTER 16755 grouping
3.022837ms: AFTER 16755 copied
4.689714ms: AFTER 16755 grouping
3.113697ms: AFTER 16755 copied
4.608815ms: AFTER 16755 grouping
3.230819ms: AFTER 16755 copied
5.062814ms: AFTER 16755 grouping
3.602108ms: AFTER 16755 copied
4.853021ms: AFTER 16755 grouping
3.525436ms: AFTER 16755 copied
5.260231ms: AFTER 16755 grouping
3.696591ms: AFTER 16755 copied
5.367392ms: AFTER 16755 grouping
3.038836ms: AFTER 16755 copied
5.55364ms: AFTER 16755 grouping
3.022837ms: AFTER 16755 copied
4.924864ms: AFTER 16755 grouping
3.034006ms: AFTER 16755 copied
4.741332ms: AFTER 16755 grouping
3.206671ms: AFTER 16755 copied
5.091189ms: AFTER 16755 grouping
3.537208ms: AFTER 16755 copied
4.899507ms: AFTER 16755 grouping
3.486798ms: AFTER 16755 copied
4.660736ms: AFTER 16755 grouping
3.456611ms: AFTER 16755 copied
5.099641ms: AFTER 16755 grouping
3.258893ms: AFTER 16755 copied
5.059796ms: AFTER 27868 grouping
3.768132ms: AFTER 27868 copied
5.013912ms: AFTER 27868 grouping
3.451781ms: AFTER 27868 copied
6.343611ms: AFTER 27868 grouping
3.057853ms: AFTER 27868 copied
5.365279ms: AFTER 27868 grouping
3.329528ms: AFTER 27868 copied
4.724126ms: AFTER 27868 grouping
3.865633ms: AFTER 27868 copied
4.787819ms: AFTER 27868 grouping
3.596675ms: AFTER 27868 copied
5.064022ms: AFTER 27868 grouping
3.25044ms: AFTER 27868 copied
4.770009ms: AFTER 27868 grouping
3.204255ms: AFTER 27868 copied
4.767594ms: AFTER 27868 grouping
3.205765ms: AFTER 27868 copied
5.371618ms: AFTER 27868 grouping
3.164107ms: AFTER 27868 copied
6.423906ms: AFTER 27868 grouping
3.441216ms: AFTER 27868 copied
5.623673ms: AFTER 27868 grouping
3.274891ms: AFTER 27868 copied
5.218575ms: AFTER 27868 grouping
3.344922ms: AFTER 27868 copied
4.809251ms: AFTER 27868 grouping
3.699308ms: AFTER 27868 copied
4.598552ms: AFTER 27868 grouping
3.709269ms: AFTER 27868 copied
4.943881ms: AFTER 27868 grouping
3.228405ms: AFTER 27868 copied
4.833098ms: AFTER 27868 grouping
3.166523ms: AFTER 27868 copied
4.622097ms: AFTER 27868 grouping
3.224179ms: AFTER 27868 copied
5.246044ms: AFTER 27868 grouping
3.100415ms: AFTER 27868 copied
5.633935ms: AFTER 27868 grouping
3.135733ms: AFTER 27868 copied
5.973529ms: AFTER 27868 grouping
3.088643ms: AFTER 27868 copied
5.81807ms: AFTER 27868 grouping
3.406804ms: AFTER 27868 copied
5.394861ms: AFTER 27868 grouping
3.12879ms: AFTER 27868 copied
5.700345ms: AFTER 27868 grouping
3.119432ms: AFTER 27868 copied
5.58111ms: AFTER 27868 grouping
3.089548ms: AFTER 27868 copied
5.471836ms: AFTER 27868 grouping
3.204557ms: AFTER 27868 copied
5.034137ms: AFTER 27868 grouping
3.628069ms: AFTER 27868 copied
4.72624ms: AFTER 27868 grouping
3.752133ms: AFTER 27868 copied
4.702996ms: AFTER 27868 grouping
3.251346ms: AFTER 27868 copied
4.658623ms: AFTER 27868 grouping
3.321377ms: AFTER 27868 copied
4.775443ms: AFTER 27868 grouping
3.225386ms: AFTER 27868 copied
5.539151ms: AFTER 27868 grouping
3.090454ms: AFTER 27868 copied
6.45047ms: AFTER 27868 grouping
3.055137ms: AFTER 27868 copied
5.828032ms: AFTER 27868 grouping
3.146298ms: AFTER 27868 copied
5.515908ms: AFTER 27868 grouping
3.090454ms: AFTER 27868 copied
4.915506ms: AFTER 27868 grouping
3.727381ms: AFTER 27868 copied
4.973162ms: AFTER 27868 grouping
3.515474ms: AFTER 27868 copied
4.760954ms: AFTER 27868 grouping
3.682101ms: AFTER 27868 copied
4.686091ms: AFTER 27868 grouping
3.220858ms: AFTER 27868 copied
4.722314ms: AFTER 27868 grouping
3.223877ms: AFTER 27868 copied
4.715976ms: AFTER 27868 grouping
3.219046ms: AFTER 27868 copied
6.170946ms: AFTER 27868 grouping
3.432161ms: AFTER 27868 copied
5.711212ms: AFTER 27868 grouping
3.097397ms: AFTER 27868 copied
5.504135ms: AFTER 27868 grouping
3.335565ms: AFTER 27868 copied
4.616362ms: AFTER 27868 grouping
3.853559ms: AFTER 27868 copied
4.69394ms: AFTER 27868 grouping
3.503098ms: AFTER 27868 copied
4.704505ms: AFTER 27868 grouping
3.180107ms: AFTER 27868 copied
4.882905ms: AFTER 27868 grouping
3.155053ms: AFTER 27868 copied
4.700581ms: AFTER 27868 grouping
3.239573ms: AFTER 27868 copied
5.291927ms: AFTER 27868 grouping
3.150223ms: AFTER 27868 copied
5.000933ms: AFTER 27868 grouping
3.355488ms: AFTER 27868 copied
5.610994ms: AFTER 27868 grouping
3.176787ms: AFTER 27868 copied
5.137072ms: AFTER 27868 grouping
3.530568ms: AFTER 27868 copied
4.77031ms: AFTER 27868 grouping
3.523322ms: AFTER 27868 copied
4.682771ms: AFTER 27868 grouping
3.458422ms: AFTER 27868 copied
4.681262ms: AFTER 27868 grouping
3.253157ms: AFTER 27868 copied
4.81559ms: AFTER 27868 grouping
3.183427ms: AFTER 27868 copied
4.818005ms: AFTER 27868 grouping
3.232026ms: AFTER 27868 copied
5.660198ms: AFTER 27868 grouping
3.075965ms: AFTER 27868 copied
6.042656ms: AFTER 27868 grouping
3.491023ms: AFTER 27868 copied
7.402238ms: AFTER 84860 grouping
16.392567ms: AFTER 84860 copied
5.866972ms: AFTER 84860 grouping
13.6731ms: AFTER 84860 copied
5.819882ms: AFTER 84860 grouping
14.328138ms: AFTER 84860 copied
5.726305ms: AFTER 84860 grouping
13.569863ms: AFTER 84860 copied
7.198179ms: AFTER 84860 grouping
14.633019ms: AFTER 84860 copied
7.60871ms: AFTER 84860 grouping
13.86599ms: AFTER 84860 copied
7.8665ms: AFTER 84860 grouping
16.419735ms: AFTER 84860 copied
7.687799ms: AFTER 84860 grouping
17.458741ms: AFTER 84860 copied
7.645839ms: AFTER 84860 grouping
14.193509ms: AFTER 84860 copied
7.349412ms: AFTER 84860 grouping
14.083329ms: AFTER 84860 copied
7.881593ms: AFTER 84860 grouping
14.360437ms: AFTER 84860 copied
6.937372ms: AFTER 84860 grouping
13.8838ms: AFTER 84860 copied
6.988084ms: AFTER 84860 grouping
15.681986ms: AFTER 84860 copied
7.011026ms: AFTER 84860 grouping
20.559759ms: AFTER 84860 copied
6.954578ms: AFTER 84860 grouping
15.634292ms: AFTER 84860 copied
7.052985ms: AFTER 84860 grouping
16.104893ms: AFTER 84860 copied
7.52268ms: AFTER 84860 grouping
14.02658ms: AFTER 84860 copied
7.503663ms: AFTER 84860 grouping
14.063407ms: AFTER 84860 copied
7.09766ms: AFTER 84860 grouping
18.091139ms: AFTER 84860 copied
7.015855ms: AFTER 84860 grouping
13.852406ms: AFTER 84860 copied
7.264891ms: AFTER 84860 grouping
14.507142ms: AFTER 84860 copied
7.075624ms: AFTER 84860 grouping
14.694598ms: AFTER 84860 copied
7.654896ms: AFTER 84860 grouping
13.579825ms: AFTER 84860 copied
7.745453ms: AFTER 84860 grouping
14.447072ms: AFTER 84860 copied
6.46677ms: AFTER 84860 grouping
15.424196ms: AFTER 84860 copied
7.073813ms: AFTER 84860 grouping
14.403302ms: AFTER 84860 copied
6.850737ms: AFTER 84860 grouping
14.801457ms: AFTER 84860 copied
7.067474ms: AFTER 84860 grouping
14.704258ms: AFTER 84860 copied
7.284814ms: AFTER 84860 grouping
15.380728ms: AFTER 84860 copied
8.264353ms: AFTER 84860 grouping
16.105195ms: AFTER 84860 copied
6.789762ms: AFTER 84860 grouping
14.132532ms: AFTER 84860 copied
7.411897ms: AFTER 84860 grouping
13.50436ms: AFTER 84860 copied
7.515435ms: AFTER 84860 grouping
13.782374ms: AFTER 84860 copied
7.632859ms: AFTER 84860 grouping
19.021173ms: AFTER 84860 copied
6.845907ms: AFTER 84860 grouping
13.924249ms: AFTER 84860 copied
7.62169ms: AFTER 84860 grouping
16.76929ms: AFTER 84860 copied
7.572185ms: AFTER 84860 grouping
15.32428ms: AFTER 84860 copied
8.183756ms: AFTER 84860 grouping
15.883025ms: AFTER 84860 copied
7.748774ms: AFTER 84860 grouping
19.239721ms: AFTER 84860 copied
8.446375ms: AFTER 84860 grouping
14.674675ms: AFTER 84860 copied
7.254325ms: AFTER 84860 grouping
20.132324ms: AFTER 84860 copied
9.691552ms: AFTER 84860 grouping
16.057803ms: AFTER 84860 copied
7.186106ms: AFTER 84860 grouping
14.07367ms: AFTER 84860 copied
7.228366ms: AFTER 84860 grouping
13.892553ms: AFTER 84860 copied
5.780036ms: AFTER 84860 grouping
13.579221ms: AFTER 84860 copied
6.616795ms: AFTER 84860 grouping
13.48504ms: AFTER 84860 copied
5.758302ms: AFTER 84860 grouping
13.642914ms: AFTER 84860 copied
5.758906ms: AFTER 84860 grouping
13.289737ms: AFTER 84860 copied
5.815052ms: AFTER 84860 grouping
13.362787ms: AFTER 84860 copied
5.679818ms: AFTER 84860 grouping
13.370334ms: AFTER 84860 copied
5.758001ms: AFTER 84860 grouping
13.346486ms: AFTER 84860 copied
6.408209ms: AFTER 84860 grouping
13.308452ms: AFTER 84860 copied
6.654226ms: AFTER 84860 grouping
13.338035ms: AFTER 84860 copied
6.937372ms: AFTER 84860 grouping
12.777478ms: AFTER 84860 copied
6.463752ms: AFTER 84860 grouping
13.009006ms: AFTER 84860 copied
6.103329ms: AFTER 84860 grouping
13.015043ms: AFTER 84860 copied
10.127742ms: AFTER 242931 grouping
15.079169ms: AFTER 242931 copied
8.063012ms: AFTER 242931 grouping
14.664714ms: AFTER 242931 copied
8.703259ms: AFTER 242931 grouping
14.831643ms: AFTER 242931 copied
10.168191ms: AFTER 242931 grouping
15.650592ms: AFTER 242931 copied
11.532301ms: AFTER 242931 grouping
15.528338ms: AFTER 242931 copied
11.455327ms: AFTER 242931 grouping
16.507274ms: AFTER 242931 copied
8.417095ms: AFTER 242931 grouping
14.66894ms: AFTER 242931 copied
8.181039ms: AFTER 242931 grouping
14.747725ms: AFTER 242931 copied
8.703259ms: AFTER 242931 grouping
14.626981ms: AFTER 242931 copied
8.717145ms: AFTER 242931 grouping
14.52465ms: AFTER 242931 copied
9.046777ms: AFTER 242931 grouping
14.278331ms: AFTER 242931 copied
8.979764ms: AFTER 242931 grouping
14.262937ms: AFTER 242931 copied
9.202839ms: AFTER 242931 grouping
14.482088ms: AFTER 242931 copied
8.189189ms: AFTER 242931 grouping
14.765536ms: AFTER 242931 copied
7.935626ms: AFTER 242931 grouping
14.676185ms: AFTER 242931 copied
7.940154ms: AFTER 242931 grouping
14.675279ms: AFTER 242931 copied
8.0449ms: AFTER 242931 grouping
15.016985ms: AFTER 242931 copied
7.858652ms: AFTER 242931 grouping
14.90258ms: AFTER 242931 copied
7.741228ms: AFTER 242931 grouping
16.479201ms: AFTER 242931 copied
7.813373ms: AFTER 242931 grouping
14.794816ms: AFTER 242931 copied
7.938645ms: AFTER 242931 grouping
14.621849ms: AFTER 242931 copied
8.687562ms: AFTER 242931 grouping
14.528272ms: AFTER 242931 copied
8.305105ms: AFTER 242931 grouping
14.810211ms: AFTER 242931 copied
8.765141ms: AFTER 242931 grouping
14.592871ms: AFTER 242931 copied
8.069652ms: AFTER 242931 grouping
14.831643ms: AFTER 242931 copied
8.934787ms: AFTER 242931 grouping
14.721464ms: AFTER 242931 copied
10.150985ms: AFTER 242931 grouping
14.56027ms: AFTER 242931 copied
8.352195ms: AFTER 242931 grouping
15.048681ms: AFTER 242931 copied
9.112281ms: AFTER 242931 grouping
14.714823ms: AFTER 242931 copied
8.843927ms: AFTER 242931 grouping
14.681618ms: AFTER 242931 copied
8.729521ms: AFTER 242931 grouping
15.028154ms: AFTER 242931 copied
8.660697ms: AFTER 242931 grouping
14.550912ms: AFTER 242931 copied
10.835304ms: AFTER 242931 grouping
14.434997ms: AFTER 242931 copied
8.84121ms: AFTER 242931 grouping
14.620038ms: AFTER 242931 copied
8.73103ms: AFTER 242931 grouping
14.583212ms: AFTER 242931 copied
8.241713ms: AFTER 242931 grouping
14.435903ms: AFTER 242931 copied
11.032118ms: AFTER 242931 grouping
14.609171ms: AFTER 242931 copied
9.337771ms: AFTER 242931 grouping
14.823191ms: AFTER 242931 copied
9.166615ms: AFTER 242931 grouping
14.307915ms: AFTER 242931 copied
9.735322ms: AFTER 242931 grouping
14.358626ms: AFTER 242931 copied
8.909732ms: AFTER 242931 grouping
14.949671ms: AFTER 242931 copied
8.933579ms: AFTER 242931 grouping
14.413566ms: AFTER 242931 copied
10.86066ms: AFTER 242931 grouping
17.467796ms: AFTER 242931 copied
8.683035ms: AFTER 242931 grouping
14.771874ms: AFTER 242931 copied
11.758395ms: AFTER 242931 grouping
15.321262ms: AFTER 242931 copied
11.742397ms: AFTER 242931 grouping
15.904458ms: AFTER 242931 copied
11.039965ms: AFTER 242931 grouping
17.421611ms: AFTER 242931 copied
9.44312ms: AFTER 242931 grouping
16.841435ms: AFTER 242931 copied
11.432386ms: AFTER 242931 grouping
19.15701ms: AFTER 242931 copied
12.478334ms: AFTER 242931 grouping
17.310828ms: AFTER 242931 copied
11.288096ms: AFTER 242931 grouping
19.848575ms: AFTER 242931 copied
12.079576ms: AFTER 242931 grouping
15.355674ms: AFTER 242931 copied
11.625576ms: AFTER 242931 grouping
15.773449ms: AFTER 242931 copied
12.956482ms: AFTER 242931 grouping
17.326827ms: AFTER 242931 copied
12.553195ms: AFTER 242931 grouping
20.356305ms: AFTER 242931 copied
11.487022ms: AFTER 242931 grouping
18.694258ms: AFTER 242931 copied
12.032183ms: AFTER 242931 grouping
21.018588ms: AFTER 242931 copied
11.615917ms: AFTER 242931 grouping
15.940379ms: AFTER 242931 copied
11.417292ms: AFTER 242931 grouping
15.075547ms: AFTER 242931 copied
11.547998ms: AFTER 242931 grouping
18.996722ms: AFTER 242931 copied
15.839557ms: AFTER 242931 grouping
16.828152ms: AFTER 242931 copied
12.472297ms: AFTER 242931 grouping
17.337091ms: AFTER 242931 copied
16.815776ms: AFTER 242931 grouping
16.95101ms: AFTER 242931 copied
8.286992ms: AFTER 242931 grouping
14.44677ms: AFTER 242931 copied
8.312953ms: AFTER 242931 grouping
15.007628ms: AFTER 242931 copied
8.507653ms: AFTER 242931 grouping
14.738972ms: AFTER 242931 copied
8.137269ms: AFTER 242931 grouping
15.151313ms: AFTER 242931 copied
8.942937ms: AFTER 242931 grouping
15.050493ms: AFTER 242931 copied
9.004818ms: AFTER 242931 grouping
14.137664ms: AFTER 242931 copied
11.877027ms: AFTER 328666 grouping
16.283897ms: AFTER 328666 copied
11.253986ms: AFTER 328666 grouping
16.271823ms: AFTER 328666 copied
10.722408ms: AFTER 328666 grouping
16.765667ms: AFTER 328666 copied
11.081321ms: AFTER 328666 grouping
16.463504ms: AFTER 328666 copied
9.821353ms: AFTER 328666 grouping
16.43362ms: AFTER 328666 copied
9.736832ms: AFTER 328666 grouping
16.281482ms: AFTER 328666 copied
9.696986ms: AFTER 328666 grouping
16.46441ms: AFTER 328666 copied
10.78761ms: AFTER 328666 grouping
16.274841ms: AFTER 328666 copied
12.759669ms: AFTER 328666 grouping
16.603266ms: AFTER 328666 copied
9.663781ms: AFTER 328666 grouping
16.192735ms: AFTER 328666 copied
9.678572ms: AFTER 328666 grouping
16.579419ms: AFTER 328666 copied
11.004648ms: AFTER 328666 grouping
16.489162ms: AFTER 328666 copied
10.329083ms: AFTER 328666 grouping
16.353929ms: AFTER 328666 copied
10.464317ms: AFTER 328666 grouping
17.008967ms: AFTER 328666 copied
9.775772ms: AFTER 328666 grouping
16.313177ms: AFTER 328666 copied
9.589825ms: AFTER 328666 grouping
16.401622ms: AFTER 328666 copied
11.010987ms: AFTER 328666 grouping
16.312573ms: AFTER 328666 copied
10.247279ms: AFTER 328666 grouping
16.624698ms: AFTER 328666 copied
13.1379ms: AFTER 328666 grouping
16.525084ms: AFTER 328666 copied
9.884743ms: AFTER 328666 grouping
16.190924ms: AFTER 328666 copied
9.645669ms: AFTER 328666 grouping
16.634055ms: AFTER 328666 copied
10.162154ms: AFTER 328666 grouping
16.45626ms: AFTER 328666 copied
10.587778ms: AFTER 328666 grouping
16.230467ms: AFTER 328666 copied
10.355345ms: AFTER 328666 grouping
16.254012ms: AFTER 328666 copied
9.787243ms: AFTER 328666 grouping
16.303216ms: AFTER 328666 copied
13.835804ms: AFTER 328666 grouping
17.764828ms: AFTER 328666 copied
14.37372ms: AFTER 328666 grouping
19.149766ms: AFTER 328666 copied
9.557526ms: AFTER 328666 grouping
16.55044ms: AFTER 328666 copied
11.140787ms: AFTER 328666 grouping
16.322234ms: AFTER 328666 copied
10.429905ms: AFTER 328666 grouping
16.528404ms: AFTER 328666 copied
9.661064ms: AFTER 328666 grouping
16.365399ms: AFTER 328666 copied
9.893497ms: AFTER 328666 grouping
16.184886ms: AFTER 328666 copied
10.906242ms: AFTER 328666 grouping
16.207526ms: AFTER 328666 copied
10.687996ms: AFTER 328666 grouping
16.294462ms: AFTER 328666 copied
10.577213ms: AFTER 328666 grouping
16.308649ms: AFTER 328666 copied
10.074615ms: AFTER 328666 grouping
16.192131ms: AFTER 328666 copied
9.740755ms: AFTER 328666 grouping
16.327063ms: AFTER 328666 copied
9.836748ms: AFTER 328666 grouping
16.269106ms: AFTER 328666 copied
10.383418ms: AFTER 328666 grouping
16.445393ms: AFTER 328666 copied
10.333611ms: AFTER 328666 grouping
16.353023ms: AFTER 328666 copied
10.056804ms: AFTER 328666 grouping
16.350608ms: AFTER 328666 copied
10.862471ms: AFTER 328666 grouping
16.531121ms: AFTER 328666 copied
10.415717ms: AFTER 328666 grouping
17.537828ms: AFTER 328666 copied
9.643556ms: AFTER 328666 grouping
16.401019ms: AFTER 328666 copied
14.350778ms: AFTER 328666 grouping
16.653374ms: AFTER 328666 copied
14.288595ms: AFTER 328666 grouping
20.895731ms: AFTER 328666 copied
14.108082ms: AFTER 328666 grouping
20.052028ms: AFTER 328666 copied
14.681316ms: AFTER 328666 grouping
18.937256ms: AFTER 328666 copied
13.683363ms: AFTER 328666 grouping
17.839689ms: AFTER 328666 copied
10.630038ms: AFTER 328666 grouping
17.423725ms: AFTER 328666 copied
13.30815ms: AFTER 328666 grouping
17.933266ms: AFTER 328666 copied
14.292821ms: AFTER 328666 grouping
18.335647ms: AFTER 328666 copied
14.108686ms: AFTER 328666 grouping
17.282453ms: AFTER 328666 copied
14.316064ms: AFTER 328666 grouping
17.879535ms: AFTER 328666 copied
13.76879ms: AFTER 328666 grouping
20.693484ms: AFTER 328666 copied
14.044389ms: AFTER 328666 grouping
22.873223ms: AFTER 328666 copied
17.357919ms: AFTER 328666 grouping
19.5932ms: AFTER 328666 copied
42.322434ms: AFTER 1103347 grouping
21.8315ms: AFTER 1103347 copied
35.601498ms: AFTER 1103347 grouping
22.126418ms: AFTER 1103347 copied
24.493915ms: AFTER 1103347 grouping
19.72451ms: AFTER 1103347 copied
21.189441ms: AFTER 1103347 grouping
20.075876ms: AFTER 1103347 copied
21.867723ms: AFTER 1103347 grouping
19.667457ms: AFTER 1103347 copied
20.633413ms: AFTER 1103347 grouping
20.194206ms: AFTER 1103347 copied
22.828849ms: AFTER 1103347 grouping
22.966497ms: AFTER 1103347 copied
21.486472ms: AFTER 1103347 grouping
20.620433ms: AFTER 1103347 copied
20.929238ms: AFTER 1103347 grouping
19.887816ms: AFTER 1103347 copied
21.481643ms: AFTER 1103347 grouping
20.086139ms: AFTER 1103347 copied
21.026134ms: AFTER 1103347 grouping
20.18364ms: AFTER 1103347 copied
22.359455ms: AFTER 1103347 grouping
20.085234ms: AFTER 1103347 copied
21.25404ms: AFTER 1103347 grouping
19.728132ms: AFTER 1103347 copied
21.000174ms: AFTER 1103347 grouping
19.868497ms: AFTER 1103347 copied
28.419014ms: AFTER 1103347 grouping
20.072858ms: AFTER 1103347 copied
21.848102ms: AFTER 1103347 grouping
19.817483ms: AFTER 1103347 copied
21.567975ms: AFTER 1103347 grouping
19.918606ms: AFTER 1103347 copied
21.286942ms: AFTER 1103347 grouping
20.365965ms: AFTER 1103347 copied
24.471577ms: AFTER 1103347 grouping
19.757412ms: AFTER 1103347 copied
21.386255ms: AFTER 1103347 grouping
20.495765ms: AFTER 1103347 copied
21.86561ms: AFTER 1103347 grouping
19.642403ms: AFTER 1103347 copied
33.136198ms: AFTER 1103347 grouping
20.103043ms: AFTER 1103347 copied
20.97663ms: AFTER 1103347 grouping
19.736282ms: AFTER 1103347 copied
33.717583ms: AFTER 1103347 grouping
21.700191ms: AFTER 1103347 copied
21.881005ms: AFTER 1103347 grouping
19.700964ms: AFTER 1103347 copied
20.606246ms: AFTER 1103347 grouping
20.352682ms: AFTER 1103347 copied
21.72132ms: AFTER 1103347 grouping
19.970828ms: AFTER 1103347 copied
22.066046ms: AFTER 1103347 grouping
20.047199ms: AFTER 1103347 copied
20.910522ms: AFTER 1103347 grouping
19.714247ms: AFTER 1103347 copied
23.868157ms: AFTER 1103347 grouping
20.171868ms: AFTER 1103347 copied
22.893447ms: AFTER 1103347 grouping
19.783071ms: AFTER 1103347 copied
34.29293ms: AFTER 1103347 grouping
22.558985ms: AFTER 1103347 copied
24.289253ms: AFTER 1103347 grouping
20.590549ms: AFTER 1103347 copied
30.553776ms: AFTER 1103347 grouping
20.054746ms: AFTER 1103347 copied
22.729838ms: AFTER 1103347 grouping
19.996486ms: AFTER 1103347 copied
Benchmark 2: AFTER 16755 grouping
  Time (mean ± σ): 5.275493 ms ± 633.937194 µs
  Range (min … max): 4.449735 ms … 8.529085 ms 70 runs
Benchmark 3: AFTER 84860 grouping
  Time (mean ± σ): 7.066945 ms ± 788.327934 µs
  Range (min … max): 5.679818 ms … 9.691552 ms 56 runs
Benchmark 4: AFTER 242931 grouping
  Time (mean ± σ): 9.818806 ms ± 1.865016 ms
  Range (min … max): 7.741228 ms … 16.815776 ms 69 runs
Benchmark 1: AFTER 27868 grouping
  Time (mean ± σ): 5.177698 ms ± 507.015423 µs
  Range (min … max): 4.598552 ms … 6.450470 ms 60 runs
Benchmark 5: AFTER 328666 grouping
  Time (mean ± σ): 11.375662 ms ± 1.868803 ms
  Range (min … max): 9.557526 ms … 17.357919 ms 57 runs
Benchmark 6: AFTER 1103347 grouping
  Time (mean ± σ): 24.370367 ms ± 5.246688 ms
  Range (min … max): 20.606246 ms … 42.322434 ms 35 runs
Benchmark 2: AFTER 16755 copied
  Time (mean ± σ): 3.460630 ms ± 478.347340 µs
  Range (min … max): 3.022837 ms … 6.170644 ms 70 runs
Benchmark 3: AFTER 84860 copied
  Time (mean ± σ): 14.872518 ms ± 1.779625 ms
  Range (min … max): 12.777478 ms … 20.559759 ms 56 runs
Benchmark 4: AFTER 242931 copied
  Time (mean ± σ): 15.559749 ms ± 1.557003 ms
  Range (min … max): 14.137664 ms … 21.018588 ms 69 runs
Benchmark 1: AFTER 27868 copied
  Time (mean ± σ): 3.327219 ms ± 220.928183 µs
  Range (min … max): 3.055137 ms … 3.865633 ms 60 runs
Benchmark 5: AFTER 328666 copied
  Time (mean ± σ): 17.073497 ms ± 1.381677 ms
  Range (min … max): 16.184886 ms … 22.873223 ms 57 runs
Benchmark 6: AFTER 1103347 copied
  Time (mean ± σ): 20.331371 ms ± 835.939137 µs
  Range (min … max): 19.642403 ms … 22.966497 ms 35 runs
-->
<p></p>
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>i7-2600, <q>grouping</q>, serial </th> <td><span class="roboto-unscale math-font-normal">4.453ms</span></td> <td><span class="roboto-unscale math-font-normal">11.115ms</span></td> <td><span class="roboto-unscale math-font-normal">23.344ms</span></td> <td><span class="roboto-unscale math-font-normal">327µs</span>/<span class="roboto-unscale math-font-normal">686µs</span>/<span class="roboto-unscale math-font-normal">1.847ms</span></td></tr>
 <tr><th>i7-2600, <q>grouping</q>, <span class="roboto-unscale math-font-normal">8</span> threads</th> <td><span class="roboto-unscale math-font-normal">5.275ms</span></td> <td><span class="roboto-unscale math-font-normal">7.067ms</span></td> <td><span class="roboto-unscale math-font-normal">9.819ms</span></td> <td><span class="roboto-unscale math-font-normal">634µs</span>/<span class="roboto-unscale math-font-normal">788µs</span>/<span class="roboto-unscale math-font-normal">1.865ms</span></td></tr>
 <tr><th>i7-2600, <q>copying</q>, serial </th> <td><span class="roboto-unscale math-font-normal">2.763ms</span></td> <td><span class="roboto-unscale math-font-normal">11.469ms</span></td> <td><span class="roboto-unscale math-font-normal">12.275ms</span></td> <td><span class="roboto-unscale math-font-normal">209µs</span>/<span class="roboto-unscale math-font-normal">1.256ms</span>/<span class="roboto-unscale math-font-normal">825µs</span></td></tr>
 <tr><th>i7-2600, <q>copying</q>, <span class="roboto-unscale math-font-normal">8</span> threads</th> <td><span class="roboto-unscale math-font-normal">3.461ms</span></td> <td><span class="roboto-unscale math-font-normal">14.873ms</span></td> <td><span class="roboto-unscale math-font-normal">15.560ms</span></td> <td><span class="roboto-unscale math-font-normal">478µs</span>/<span class="roboto-unscale math-font-normal">1.780ms</span>/<span class="roboto-unscale math-font-normal">1.557ms</span></td></tr>
 <tr><th>(speed-up) </th> <td><span class="roboto-unscale math-font-normal">-21.07%</span></td> <td><span class="roboto-unscale math-font-normal">2.86%</span></td> <td><span class="roboto-unscale math-font-normal">28.75%</span></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>i7-2600, <q>grouping</q>, serial </th> <td><span class="roboto-unscale math-font-normal">5.699ms</span></td> <td><span class="roboto-unscale math-font-normal">31.908ms</span></td> <td><span class="roboto-unscale math-font-normal">94.578ms</span></td> <td><span class="roboto-unscale math-font-normal">699µs</span>/<span class="roboto-unscale math-font-normal">1.523ms</span>/<span class="roboto-unscale math-font-normal">8.194ms</span></td></tr>
 <tr><th>i7-2600, <q>grouping</q>, <span class="roboto-unscale math-font-normal">8</span> threads</th> <td><span class="roboto-unscale math-font-normal">5.178ms</span></td> <td><span class="roboto-unscale math-font-normal">11.376ms</span></td> <td><span class="roboto-unscale math-font-normal">24.370ms</span></td> <td><span class="roboto-unscale math-font-normal">507µs</span>/<span class="roboto-unscale math-font-normal">1.869ms</span>/<span class="roboto-unscale math-font-normal">5.247ms</span></td></tr>
 <tr><th>i7-2600, <q>copying</q>, serial </th> <td><span class="roboto-unscale math-font-normal">2.937ms</span></td> <td><span class="roboto-unscale math-font-normal">14.389ms</span></td> <td><span class="roboto-unscale math-font-normal">16.953ms</span></td> <td><span class="roboto-unscale math-font-normal">323µs</span>/<span class="roboto-unscale math-font-normal">1.111ms</span>/<span class="roboto-unscale math-font-normal">1.347ms</span></td></tr>
 <tr><th>i7-2600, <q>copying</q>, <span class="roboto-unscale math-font-normal">8</span> threads</th> <td><span class="roboto-unscale math-font-normal">3.327ms</span></td> <td><span class="roboto-unscale math-font-normal">17.073ms</span></td> <td><span class="roboto-unscale math-font-normal">20.331ms</span></td> <td><span class="roboto-unscale math-font-normal">221µs</span>/<span class="roboto-unscale math-font-normal">1.382ms</span>/<span class="roboto-unscale math-font-normal">836µs</span></td></tr>
 <tr><th>(speed-up) </th> <td><span class="roboto-unscale math-font-normal">1.52%</span></td> <td><span class="roboto-unscale math-font-normal">38.55%</span></td> <td><span class="roboto-unscale math-font-normal">59.92%</span></td> <td></td></tr>
</table>
<p class="continued">
That's<!--'--> a lot of locking and unwraps, and the threads holding the mutexes can never panick, so the unwraps are always successful, so maybe…
just assume the unwrap always succeeds?
</p>
<!--
5.658387ms: AFTER_unchecked 16755 grouping
4.587383ms: AFTER_unchecked 16755 grouping
4.964106ms: AFTER_unchecked 16755 grouping
4.830683ms: AFTER_unchecked 16755 grouping
5.235177ms: AFTER_unchecked 16755 grouping
5.874519ms: AFTER_unchecked 16755 grouping
6.524425ms: AFTER_unchecked 16755 grouping
5.731437ms: AFTER_unchecked 16755 grouping
5.064625ms: AFTER_unchecked 16755 grouping
4.853625ms: AFTER_unchecked 16755 grouping
4.616059ms: AFTER_unchecked 16755 grouping
4.51222ms: AFTER_unchecked 16755 grouping
4.602476ms: AFTER_unchecked 16755 grouping
4.617871ms: AFTER_unchecked 16755 grouping
4.458488ms: AFTER_unchecked 16755 grouping
4.631153ms: AFTER_unchecked 16755 grouping
4.527313ms: AFTER_unchecked 16755 grouping
4.958068ms: AFTER_unchecked 16755 grouping
4.58527ms: AFTER_unchecked 16755 grouping
5.15126ms: AFTER_unchecked 16755 grouping
5.53402ms: AFTER_unchecked 16755 grouping
5.576582ms: AFTER_unchecked 16755 grouping
5.133751ms: AFTER_unchecked 16755 grouping
4.835211ms: AFTER_unchecked 16755 grouping
4.617871ms: AFTER_unchecked 16755 grouping
4.627229ms: AFTER_unchecked 16755 grouping
4.608513ms: AFTER_unchecked 16755 grouping
4.529425ms: AFTER_unchecked 16755 grouping
4.587081ms: AFTER_unchecked 16755 grouping
4.579836ms: AFTER_unchecked 16755 grouping
4.55448ms: AFTER_unchecked 16755 grouping
4.666772ms: AFTER_unchecked 16755 grouping
4.863887ms: AFTER_unchecked 16755 grouping
5.068852ms: AFTER_unchecked 16755 grouping
4.719296ms: AFTER_unchecked 16755 grouping
5.365581ms: AFTER_unchecked 16755 grouping
5.344451ms: AFTER_unchecked 16755 grouping
5.423539ms: AFTER_unchecked 16755 grouping
5.821693ms: AFTER_unchecked 16755 grouping
4.803515ms: AFTER_unchecked 16755 grouping
5.185974ms: AFTER_unchecked 16755 grouping
5.752567ms: AFTER_unchecked 16755 grouping
5.789998ms: AFTER_unchecked 16755 grouping
4.891357ms: AFTER_unchecked 16755 grouping
4.837928ms: AFTER_unchecked 16755 grouping
5.084246ms: AFTER_unchecked 16755 grouping
5.535227ms: AFTER_unchecked 16755 grouping
5.631219ms: AFTER_unchecked 16755 grouping
5.700345ms: AFTER_unchecked 16755 grouping
5.776414ms: AFTER_unchecked 16755 grouping
5.738379ms: AFTER_unchecked 16755 grouping
6.275692ms: AFTER_unchecked 16755 grouping
4.918223ms: AFTER_unchecked 16755 grouping
4.769707ms: AFTER_unchecked 16755 grouping
5.139487ms: AFTER_unchecked 16755 grouping
5.3686ms: AFTER_unchecked 16755 grouping
5.627597ms: AFTER_unchecked 16755 grouping
4.893772ms: AFTER_unchecked 16755 grouping
4.809854ms: AFTER_unchecked 16755 grouping
5.534925ms: AFTER_unchecked 16755 grouping
5.435914ms: AFTER_unchecked 16755 grouping
5.921308ms: AFTER_unchecked 16755 grouping
4.876566ms: AFTER_unchecked 16755 grouping
4.90162ms: AFTER_unchecked 16755 grouping
5.146128ms: AFTER_unchecked 16755 grouping
5.452819ms: AFTER_unchecked 16755 grouping
5.423237ms: AFTER_unchecked 16755 grouping
5.112018ms: AFTER_unchecked 16755 grouping
5.010592ms: AFTER_unchecked 16755 grouping
4.93875ms: AFTER_unchecked 16755 grouping
5.344149ms: AFTER_unchecked 16755 grouping
5.961153ms: AFTER_unchecked 16755 grouping
5.671668ms: AFTER_unchecked 16755 grouping
5.154882ms: AFTER_unchecked 16755 grouping
6.235243ms: AFTER_unchecked 16755 grouping
6.253053ms: AFTER_unchecked 16755 grouping
5.467912ms: AFTER_unchecked 16755 grouping
5.609183ms: AFTER_unchecked 16755 grouping
5.782451ms: AFTER_unchecked 16755 grouping
5.422331ms: AFTER_unchecked 16755 grouping
4.950824ms: AFTER_unchecked 16755 grouping
4.808044ms: AFTER_unchecked 16755 grouping
4.796271ms: AFTER_unchecked 16755 grouping
5.112017ms: AFTER_unchecked 16755 grouping
6.44232ms: AFTER_unchecked 16755 grouping
5.006065ms: AFTER_unchecked 16755 grouping
4.914298ms: AFTER_unchecked 16755 grouping
7.694138ms: AFTER_unchecked 16755 grouping
5.294342ms: AFTER_unchecked 16755 grouping
5.336602ms: AFTER_unchecked 16755 grouping
5.863048ms: AFTER_unchecked 16755 grouping
5.77249ms: AFTER_unchecked 16755 grouping
5.399088ms: AFTER_unchecked 16755 grouping
5.620955ms: AFTER_unchecked 16755 grouping
5.604957ms: AFTER_unchecked 16755 grouping
5.927345ms: AFTER_unchecked 16755 grouping
4.881094ms: AFTER_unchecked 16755 grouping
5.962964ms: AFTER_unchecked 16755 grouping
5.873009ms: AFTER_unchecked 16755 grouping
4.50407ms: AFTER_unchecked 16755 grouping
4.558405ms: AFTER_unchecked 16755 grouping
4.938146ms: AFTER_unchecked 16755 grouping
4.563234ms: AFTER_unchecked 16755 grouping
4.725938ms: AFTER_unchecked 16755 grouping
4.926071ms: AFTER_unchecked 16755 grouping
5.717249ms: AFTER_unchecked 16755 grouping
5.4498ms: AFTER_unchecked 16755 grouping
4.914902ms: AFTER_unchecked 16755 grouping
4.694241ms: AFTER_unchecked 16755 grouping
4.621493ms: AFTER_unchecked 16755 grouping
4.578629ms: AFTER_unchecked 16755 grouping
4.692733ms: AFTER_unchecked 16755 grouping
4.686998ms: AFTER_unchecked 16755 grouping
4.789026ms: AFTER_unchecked 16755 grouping
5.03142ms: AFTER_unchecked 16755 grouping
5.247554ms: AFTER_unchecked 16755 grouping
5.253591ms: AFTER_unchecked 16755 grouping
5.266268ms: AFTER_unchecked 16755 grouping
4.614852ms: AFTER_unchecked 16755 grouping
4.530332ms: AFTER_unchecked 16755 grouping
4.714165ms: AFTER_unchecked 16755 grouping
4.649868ms: AFTER_unchecked 16755 grouping
4.57078ms: AFTER_unchecked 16755 grouping
4.565045ms: AFTER_unchecked 16755 grouping
4.57229ms: AFTER_unchecked 16755 grouping
4.508899ms: AFTER_unchecked 16755 grouping
5.529492ms: AFTER_unchecked 16755 grouping
5.191105ms: AFTER_unchecked 16755 grouping
4.851512ms: AFTER_unchecked 16755 grouping
4.569875ms: AFTER_unchecked 16755 grouping
4.727748ms: AFTER_unchecked 16755 grouping
4.418039ms: AFTER_unchecked 16755 grouping
4.642624ms: AFTER_unchecked 16755 grouping
4.584063ms: AFTER_unchecked 16755 grouping
4.559914ms: AFTER_unchecked 16755 grouping
4.557499ms: AFTER_unchecked 16755 grouping
4.668584ms: AFTER_unchecked 16755 grouping
4.541802ms: AFTER_unchecked 16755 grouping
4.850002ms: AFTER_unchecked 16755 grouping
4.899507ms: AFTER_unchecked 16755 grouping
5.153373ms: AFTER_unchecked 16755 grouping
5.583525ms: AFTER_unchecked 16755 grouping
5.14975ms: AFTER_unchecked 16755 grouping
4.71175ms: AFTER_unchecked 16755 grouping
4.62904ms: AFTER_unchecked 16755 grouping
4.572591ms: AFTER_unchecked 16755 grouping
4.860869ms: AFTER_unchecked 27868 grouping
5.604052ms: AFTER_unchecked 27868 grouping
5.569337ms: AFTER_unchecked 27868 grouping
5.447989ms: AFTER_unchecked 27868 grouping
4.685488ms: AFTER_unchecked 27868 grouping
4.649869ms: AFTER_unchecked 27868 grouping
4.861775ms: AFTER_unchecked 27868 grouping
4.704807ms: AFTER_unchecked 27868 grouping
5.263551ms: AFTER_unchecked 27868 grouping
5.924024ms: AFTER_unchecked 27868 grouping
5.307321ms: AFTER_unchecked 27868 grouping
4.785404ms: AFTER_unchecked 27868 grouping
4.745257ms: AFTER_unchecked 27868 grouping
4.774235ms: AFTER_unchecked 27868 grouping
4.776348ms: AFTER_unchecked 27868 grouping
4.642322ms: AFTER_unchecked 27868 grouping
5.642689ms: AFTER_unchecked 27868 grouping
6.10514ms: AFTER_unchecked 27868 grouping
5.689176ms: AFTER_unchecked 27868 grouping
5.469421ms: AFTER_unchecked 27868 grouping
5.541566ms: AFTER_unchecked 27868 grouping
4.725334ms: AFTER_unchecked 27868 grouping
4.662245ms: AFTER_unchecked 27868 grouping
4.680658ms: AFTER_unchecked 27868 grouping
4.790837ms: AFTER_unchecked 27868 grouping
5.627898ms: AFTER_unchecked 27868 grouping
5.580205ms: AFTER_unchecked 27868 grouping
5.203179ms: AFTER_unchecked 27868 grouping
4.826759ms: AFTER_unchecked 27868 grouping
4.674319ms: AFTER_unchecked 27868 grouping
4.781178ms: AFTER_unchecked 27868 grouping
5.512286ms: AFTER_unchecked 27868 grouping
4.602476ms: AFTER_unchecked 27868 grouping
5.192615ms: AFTER_unchecked 27868 grouping
5.82441ms: AFTER_unchecked 27868 grouping
5.4661ms: AFTER_unchecked 27868 grouping
4.802007ms: AFTER_unchecked 27868 grouping
4.712655ms: AFTER_unchecked 27868 grouping
4.665565ms: AFTER_unchecked 27868 grouping
4.651981ms: AFTER_unchecked 27868 grouping
4.806534ms: AFTER_unchecked 27868 grouping
6.159778ms: AFTER_unchecked 27868 grouping
5.585939ms: AFTER_unchecked 27868 grouping
5.495381ms: AFTER_unchecked 27868 grouping
4.822231ms: AFTER_unchecked 27868 grouping
5.536435ms: AFTER_unchecked 27868 grouping
5.062512ms: AFTER_unchecked 27868 grouping
4.85121ms: AFTER_unchecked 27868 grouping
4.868416ms: AFTER_unchecked 27868 grouping
5.309435ms: AFTER_unchecked 27868 grouping
4.734691ms: AFTER_unchecked 27868 grouping
5.033232ms: AFTER_unchecked 27868 grouping
5.095416ms: AFTER_unchecked 27868 grouping
5.634539ms: AFTER_unchecked 27868 grouping
5.396975ms: AFTER_unchecked 27868 grouping
5.170578ms: AFTER_unchecked 27868 grouping
4.761859ms: AFTER_unchecked 27868 grouping
5.223103ms: AFTER_unchecked 27868 grouping
5.458252ms: AFTER_unchecked 27868 grouping
5.034741ms: AFTER_unchecked 27868 grouping
5.729625ms: AFTER_unchecked 27868 grouping
5.54217ms: AFTER_unchecked 27868 grouping
6.449262ms: AFTER_unchecked 27868 grouping
5.58775ms: AFTER_unchecked 27868 grouping
5.455838ms: AFTER_unchecked 27868 grouping
4.971048ms: AFTER_unchecked 27868 grouping
4.65983ms: AFTER_unchecked 27868 grouping
4.739823ms: AFTER_unchecked 27868 grouping
4.778461ms: AFTER_unchecked 27868 grouping
4.773027ms: AFTER_unchecked 27868 grouping
5.754679ms: AFTER_unchecked 27868 grouping
5.887499ms: AFTER_unchecked 27868 grouping
5.315774ms: AFTER_unchecked 27868 grouping
4.596741ms: AFTER_unchecked 27868 grouping
4.594024ms: AFTER_unchecked 27868 grouping
4.810156ms: AFTER_unchecked 27868 grouping
4.707222ms: AFTER_unchecked 27868 grouping
6.307085ms: AFTER_unchecked 84860 grouping
7.078039ms: AFTER_unchecked 84860 grouping
7.80975ms: AFTER_unchecked 84860 grouping
7.621992ms: AFTER_unchecked 84860 grouping
7.466232ms: AFTER_unchecked 84860 grouping
7.64584ms: AFTER_unchecked 84860 grouping
7.06687ms: AFTER_unchecked 84860 grouping
6.960313ms: AFTER_unchecked 84860 grouping
6.947936ms: AFTER_unchecked 84860 grouping
6.875189ms: AFTER_unchecked 84860 grouping
6.969067ms: AFTER_unchecked 84860 grouping
6.929523ms: AFTER_unchecked 84860 grouping
7.010724ms: AFTER_unchecked 84860 grouping
7.464119ms: AFTER_unchecked 84860 grouping
7.960077ms: AFTER_unchecked 84860 grouping
7.462308ms: AFTER_unchecked 84860 grouping
8.029204ms: AFTER_unchecked 84860 grouping
7.068984ms: AFTER_unchecked 84860 grouping
7.322245ms: AFTER_unchecked 84860 grouping
7.523284ms: AFTER_unchecked 84860 grouping
7.642217ms: AFTER_unchecked 84860 grouping
7.562224ms: AFTER_unchecked 84860 grouping
6.825683ms: AFTER_unchecked 84860 grouping
7.186709ms: AFTER_unchecked 84860 grouping
8.072974ms: AFTER_unchecked 84860 grouping
8.020751ms: AFTER_unchecked 84860 grouping
8.258014ms: AFTER_unchecked 84860 grouping
7.437555ms: AFTER_unchecked 84860 grouping
9.707249ms: AFTER_unchecked 84860 grouping
5.768264ms: AFTER_unchecked 84860 grouping
5.668348ms: AFTER_unchecked 84860 grouping
5.760114ms: AFTER_unchecked 84860 grouping
6.66298ms: AFTER_unchecked 84860 grouping
7.064153ms: AFTER_unchecked 84860 grouping
6.470694ms: AFTER_unchecked 84860 grouping
5.79513ms: AFTER_unchecked 84860 grouping
5.78728ms: AFTER_unchecked 84860 grouping
5.689779ms: AFTER_unchecked 84860 grouping
5.754982ms: AFTER_unchecked 84860 grouping
6.337876ms: AFTER_unchecked 84860 grouping
6.789762ms: AFTER_unchecked 84860 grouping
7.413708ms: AFTER_unchecked 84860 grouping
7.354242ms: AFTER_unchecked 84860 grouping
6.638831ms: AFTER_unchecked 84860 grouping
5.851879ms: AFTER_unchecked 84860 grouping
5.802978ms: AFTER_unchecked 84860 grouping
5.665027ms: AFTER_unchecked 84860 grouping
5.823202ms: AFTER_unchecked 84860 grouping
6.386777ms: AFTER_unchecked 84860 grouping
6.650905ms: AFTER_unchecked 84860 grouping
6.941597ms: AFTER_unchecked 84860 grouping
6.799723ms: AFTER_unchecked 84860 grouping
6.993216ms: AFTER_unchecked 84860 grouping
5.649632ms: AFTER_unchecked 84860 grouping
5.711212ms: AFTER_unchecked 84860 grouping
5.654462ms: AFTER_unchecked 84860 grouping
6.281125ms: AFTER_unchecked 84860 grouping
6.636718ms: AFTER_unchecked 84860 grouping
7.231988ms: AFTER_unchecked 84860 grouping
7.969736ms: AFTER_unchecked 84860 grouping
7.163163ms: AFTER_unchecked 84860 grouping
6.923486ms: AFTER_unchecked 84860 grouping
7.21931ms: AFTER_unchecked 84860 grouping
5.732342ms: AFTER_unchecked 84860 grouping
5.890518ms: AFTER_unchecked 84860 grouping
5.739587ms: AFTER_unchecked 84860 grouping
5.785772ms: AFTER_unchecked 84860 grouping
6.268749ms: AFTER_unchecked 84860 grouping
6.729993ms: AFTER_unchecked 84860 grouping
7.21931ms: AFTER_unchecked 84860 grouping
5.709703ms: AFTER_unchecked 84860 grouping
5.752869ms: AFTER_unchecked 84860 grouping
6.039939ms: AFTER_unchecked 84860 grouping
6.936466ms: AFTER_unchecked 84860 grouping
7.279682ms: AFTER_unchecked 84860 grouping
5.662915ms: AFTER_unchecked 84860 grouping
5.718155ms: AFTER_unchecked 84860 grouping
6.586911ms: AFTER_unchecked 84860 grouping
7.209348ms: AFTER_unchecked 84860 grouping
7.459894ms: AFTER_unchecked 84860 grouping
7.717682ms: AFTER_unchecked 84860 grouping
5.971115ms: AFTER_unchecked 84860 grouping
5.823203ms: AFTER_unchecked 84860 grouping
5.663216ms: AFTER_unchecked 84860 grouping
5.684648ms: AFTER_unchecked 84860 grouping
6.449262ms: AFTER_unchecked 84860 grouping
6.740256ms: AFTER_unchecked 84860 grouping
7.617163ms: AFTER_unchecked 84860 grouping
7.012837ms: AFTER_unchecked 84860 grouping
6.164608ms: AFTER_unchecked 84860 grouping
5.701552ms: AFTER_unchecked 84860 grouping
5.742606ms: AFTER_unchecked 84860 grouping
5.696421ms: AFTER_unchecked 84860 grouping
10.067672ms: AFTER_unchecked 242931 grouping
7.758132ms: AFTER_unchecked 242931 grouping
7.7204ms: AFTER_unchecked 242931 grouping
7.802506ms: AFTER_unchecked 242931 grouping
8.768461ms: AFTER_unchecked 242931 grouping
9.124959ms: AFTER_unchecked 242931 grouping
7.972453ms: AFTER_unchecked 242931 grouping
7.881895ms: AFTER_unchecked 242931 grouping
11.532ms: AFTER_unchecked 242931 grouping
8.344044ms: AFTER_unchecked 242931 grouping
8.996668ms: AFTER_unchecked 242931 grouping
9.617898ms: AFTER_unchecked 242931 grouping
7.79345ms: AFTER_unchecked 242931 grouping
7.952229ms: AFTER_unchecked 242931 grouping
10.010921ms: AFTER_unchecked 242931 grouping
8.385399ms: AFTER_unchecked 242931 grouping
9.655631ms: AFTER_unchecked 242931 grouping
8.144514ms: AFTER_unchecked 242931 grouping
9.32781ms: AFTER_unchecked 242931 grouping
8.602437ms: AFTER_unchecked 242931 grouping
11.735454ms: AFTER_unchecked 242931 grouping
8.344648ms: AFTER_unchecked 242931 grouping
7.680856ms: AFTER_unchecked 242931 grouping
7.889441ms: AFTER_unchecked 242931 grouping
8.020148ms: AFTER_unchecked 242931 grouping
8.747632ms: AFTER_unchecked 242931 grouping
8.800458ms: AFTER_unchecked 242931 grouping
9.946927ms: AFTER_unchecked 242931 grouping
14.438017ms: AFTER_unchecked 328666 grouping
13.923042ms: AFTER_unchecked 328666 grouping
14.274407ms: AFTER_unchecked 328666 grouping
11.025476ms: AFTER_unchecked 328666 grouping
13.92938ms: AFTER_unchecked 328666 grouping
13.669478ms: AFTER_unchecked 328666 grouping
13.853915ms: AFTER_unchecked 328666 grouping
15.195386ms: AFTER_unchecked 328666 grouping
15.12475ms: AFTER_unchecked 328666 grouping
11.38137ms: AFTER_unchecked 328666 grouping
14.277426ms: AFTER_unchecked 328666 grouping
14.43047ms: AFTER_unchecked 328666 grouping
17.708681ms: AFTER_unchecked 328666 grouping
9.563865ms: AFTER_unchecked 328666 grouping
10.728143ms: AFTER_unchecked 328666 grouping
10.962388ms: AFTER_unchecked 328666 grouping
11.379559ms: AFTER_unchecked 328666 grouping
10.584759ms: AFTER_unchecked 328666 grouping
10.001564ms: AFTER_unchecked 328666 grouping
9.610955ms: AFTER_unchecked 328666 grouping
9.61337ms: AFTER_unchecked 328666 grouping
10.359873ms: AFTER_unchecked 328666 grouping
10.837115ms: AFTER_unchecked 328666 grouping
11.299567ms: AFTER_unchecked 328666 grouping
10.751387ms: AFTER_unchecked 328666 grouping
9.897422ms: AFTER_unchecked 328666 grouping
9.763094ms: AFTER_unchecked 328666 grouping
9.642047ms: AFTER_unchecked 328666 grouping
10.431715ms: AFTER_unchecked 328666 grouping
10.495408ms: AFTER_unchecked 328666 grouping
9.837049ms: AFTER_unchecked 328666 grouping
9.604919ms: AFTER_unchecked 328666 grouping
9.755849ms: AFTER_unchecked 328666 grouping
9.923381ms: AFTER_unchecked 328666 grouping
11.092792ms: AFTER_unchecked 328666 grouping
10.230978ms: AFTER_unchecked 328666 grouping
13.657403ms: AFTER_unchecked 328666 grouping
9.646273ms: AFTER_unchecked 328666 grouping
26.647694ms: AFTER_unchecked 1103347 grouping
20.916559ms: AFTER_unchecked 1103347 grouping
22.435222ms: AFTER_unchecked 1103347 grouping
21.10975ms: AFTER_unchecked 1103347 grouping
21.286943ms: AFTER_unchecked 1103347 grouping
32.64839ms: AFTER_unchecked 1103347 grouping
20.81453ms: AFTER_unchecked 1103347 grouping
20.866752ms: AFTER_unchecked 1103347 grouping
33.394289ms: AFTER_unchecked 1103347 grouping
20.594775ms: AFTER_unchecked 1103347 grouping
20.724877ms: AFTER_unchecked 1103347 grouping
21.462022ms: AFTER_unchecked 1103347 grouping
21.599972ms: AFTER_unchecked 1103347 grouping
20.649411ms: AFTER_unchecked 1103347 grouping
21.504283ms: AFTER_unchecked 1103347 grouping
20.928331ms: AFTER_unchecked 1103347 grouping
21.601482ms: AFTER_unchecked 1103347 grouping
21.757846ms: AFTER_unchecked 1103347 grouping
27.169008ms: AFTER_unchecked 1103347 grouping
34.152866ms: AFTER_unchecked 1103347 grouping
31.386913ms: AFTER_unchecked 1103347 grouping
34.073477ms: AFTER_unchecked 1103347 grouping
25.78256ms: AFTER_unchecked 1103347 grouping
39.678735ms: AFTER_unchecked 1103347 grouping
33.500846ms: AFTER_unchecked 1103347 grouping
3.036119ms: AFTER_unchecked 16755 copied
3.462649ms: AFTER_unchecked 16755 copied
3.551094ms: AFTER_unchecked 16755 copied
3.136035ms: AFTER_unchecked 16755 copied
3.651916ms: AFTER_unchecked 16755 copied
4.066975ms: AFTER_unchecked 16755 copied
4.891961ms: AFTER_unchecked 16755 copied
3.091058ms: AFTER_unchecked 16755 copied
3.021026ms: AFTER_unchecked 16755 copied
3.018611ms: AFTER_unchecked 16755 copied
3.188558ms: AFTER_unchecked 16755 copied
3.068116ms: AFTER_unchecked 16755 copied
3.08985ms: AFTER_unchecked 16755 copied
3.085624ms: AFTER_unchecked 16755 copied
3.105849ms: AFTER_unchecked 16755 copied
3.187351ms: AFTER_unchecked 16755 copied
3.21301ms: AFTER_unchecked 16755 copied
3.719533ms: AFTER_unchecked 16755 copied
3.564074ms: AFTER_unchecked 16755 copied
3.19188ms: AFTER_unchecked 16755 copied
3.003819ms: AFTER_unchecked 16755 copied
3.014686ms: AFTER_unchecked 16755 copied
3.016498ms: AFTER_unchecked 16755 copied
3.079285ms: AFTER_unchecked 16755 copied
3.031591ms: AFTER_unchecked 16755 copied
3.14811ms: AFTER_unchecked 16755 copied
3.091963ms: AFTER_unchecked 16755 copied
3.10283ms: AFTER_unchecked 16755 copied
3.163806ms: AFTER_unchecked 16755 copied
3.546566ms: AFTER_unchecked 16755 copied
3.634105ms: AFTER_unchecked 16755 copied
3.465366ms: AFTER_unchecked 16755 copied
3.426123ms: AFTER_unchecked 16755 copied
3.147204ms: AFTER_unchecked 16755 copied
3.045174ms: AFTER_unchecked 16755 copied
3.791677ms: AFTER_unchecked 16755 copied
3.927817ms: AFTER_unchecked 16755 copied
3.331038ms: AFTER_unchecked 16755 copied
3.252855ms: AFTER_unchecked 16755 copied
3.339188ms: AFTER_unchecked 16755 copied
3.050911ms: AFTER_unchecked 16755 copied
5.087869ms: AFTER_unchecked 16755 copied
3.265835ms: AFTER_unchecked 16755 copied
3.249837ms: AFTER_unchecked 16755 copied
3.606334ms: AFTER_unchecked 16755 copied
3.102529ms: AFTER_unchecked 16755 copied
3.515776ms: AFTER_unchecked 16755 copied
3.322887ms: AFTER_unchecked 16755 copied
3.445141ms: AFTER_unchecked 16755 copied
4.12131ms: AFTER_unchecked 16755 copied
3.370883ms: AFTER_unchecked 16755 copied
3.730098ms: AFTER_unchecked 16755 copied
3.24712ms: AFTER_unchecked 16755 copied
3.642557ms: AFTER_unchecked 16755 copied
3.713797ms: AFTER_unchecked 16755 copied
3.357601ms: AFTER_unchecked 16755 copied
3.283947ms: AFTER_unchecked 16755 copied
3.189464ms: AFTER_unchecked 16755 copied
3.942306ms: AFTER_unchecked 16755 copied
3.89763ms: AFTER_unchecked 16755 copied
3.587317ms: AFTER_unchecked 16755 copied
3.261308ms: AFTER_unchecked 16755 copied
3.301757ms: AFTER_unchecked 16755 copied
3.963436ms: AFTER_unchecked 16755 copied
3.768132ms: AFTER_unchecked 16755 copied
3.434576ms: AFTER_unchecked 16755 copied
3.409521ms: AFTER_unchecked 16755 copied
3.337075ms: AFTER_unchecked 16755 copied
3.137544ms: AFTER_unchecked 16755 copied
4.305143ms: AFTER_unchecked 16755 copied
3.656443ms: AFTER_unchecked 16755 copied
3.216933ms: AFTER_unchecked 16755 copied
3.338886ms: AFTER_unchecked 16755 copied
3.265534ms: AFTER_unchecked 16755 copied
4.566857ms: AFTER_unchecked 16755 copied
3.780508ms: AFTER_unchecked 16755 copied
3.69478ms: AFTER_unchecked 16755 copied
3.345828ms: AFTER_unchecked 16755 copied
3.165013ms: AFTER_unchecked 16755 copied
3.538416ms: AFTER_unchecked 16755 copied
3.245309ms: AFTER_unchecked 16755 copied
3.261006ms: AFTER_unchecked 16755 copied
3.740059ms: AFTER_unchecked 16755 copied
3.705948ms: AFTER_unchecked 16755 copied
3.519701ms: AFTER_unchecked 16755 copied
3.250742ms: AFTER_unchecked 16755 copied
3.258289ms: AFTER_unchecked 16755 copied
6.310104ms: AFTER_unchecked 16755 copied
3.694478ms: AFTER_unchecked 16755 copied
4.21217ms: AFTER_unchecked 16755 copied
3.836957ms: AFTER_unchecked 16755 copied
3.344319ms: AFTER_unchecked 16755 copied
3.507324ms: AFTER_unchecked 16755 copied
3.732513ms: AFTER_unchecked 16755 copied
3.800431ms: AFTER_unchecked 16755 copied
3.216632ms: AFTER_unchecked 16755 copied
3.539623ms: AFTER_unchecked 16755 copied
6.181512ms: AFTER_unchecked 16755 copied
3.904573ms: AFTER_unchecked 16755 copied
3.0168ms: AFTER_unchecked 16755 copied
3.249836ms: AFTER_unchecked 16755 copied
3.412539ms: AFTER_unchecked 16755 copied
3.57313ms: AFTER_unchecked 16755 copied
3.44182ms: AFTER_unchecked 16755 copied
3.441216ms: AFTER_unchecked 16755 copied
2.979671ms: AFTER_unchecked 16755 copied
3.045477ms: AFTER_unchecked 16755 copied
2.991142ms: AFTER_unchecked 16755 copied
3.076568ms: AFTER_unchecked 16755 copied
3.090152ms: AFTER_unchecked 16755 copied
3.094076ms: AFTER_unchecked 16755 copied
3.103132ms: AFTER_unchecked 16755 copied
3.228706ms: AFTER_unchecked 16755 copied
3.662782ms: AFTER_unchecked 16755 copied
3.443632ms: AFTER_unchecked 16755 copied
3.312925ms: AFTER_unchecked 16755 copied
3.306587ms: AFTER_unchecked 16755 copied
3.1143ms: AFTER_unchecked 16755 copied
3.060267ms: AFTER_unchecked 16755 copied
3.111886ms: AFTER_unchecked 16755 copied
3.108566ms: AFTER_unchecked 16755 copied
3.108264ms: AFTER_unchecked 16755 copied
3.111886ms: AFTER_unchecked 16755 copied
3.171353ms: AFTER_unchecked 16755 copied
3.367563ms: AFTER_unchecked 16755 copied
4.278881ms: AFTER_unchecked 16755 copied
2.98601ms: AFTER_unchecked 16755 copied
3.087737ms: AFTER_unchecked 16755 copied
3.138148ms: AFTER_unchecked 16755 copied
3.10283ms: AFTER_unchecked 16755 copied
3.356696ms: AFTER_unchecked 16755 copied
3.13211ms: AFTER_unchecked 16755 copied
3.120037ms: AFTER_unchecked 16755 copied
3.162297ms: AFTER_unchecked 16755 copied
3.106754ms: AFTER_unchecked 16755 copied
3.331641ms: AFTER_unchecked 16755 copied
3.648897ms: AFTER_unchecked 16755 copied
3.5034ms: AFTER_unchecked 16755 copied
3.533285ms: AFTER_unchecked 16755 copied
3.295116ms: AFTER_unchecked 16755 copied
3.233536ms: AFTER_unchecked 16755 copied
3.041854ms: AFTER_unchecked 16755 copied
3.085624ms: AFTER_unchecked 16755 copied
3.473214ms: AFTER_unchecked 16755 copied
3.124866ms: AFTER_unchecked 16755 copied
3.133016ms: AFTER_unchecked 16755 copied
3.587619ms: AFTER_unchecked 27868 copied
3.07355ms: AFTER_unchecked 27868 copied
3.187049ms: AFTER_unchecked 27868 copied
3.287569ms: AFTER_unchecked 27868 copied
3.718325ms: AFTER_unchecked 27868 copied
3.50672ms: AFTER_unchecked 27868 copied
3.148411ms: AFTER_unchecked 27868 copied
3.222066ms: AFTER_unchecked 27868 copied
3.066004ms: AFTER_unchecked 27868 copied
3.10615ms: AFTER_unchecked 27868 copied
3.312322ms: AFTER_unchecked 27868 copied
3.681196ms: AFTER_unchecked 27868 copied
3.470497ms: AFTER_unchecked 27868 copied
3.261005ms: AFTER_unchecked 27868 copied
3.160184ms: AFTER_unchecked 27868 copied
3.201539ms: AFTER_unchecked 27868 copied
3.148713ms: AFTER_unchecked 27868 copied
3.245913ms: AFTER_unchecked 27868 copied
3.092868ms: AFTER_unchecked 27868 copied
3.288173ms: AFTER_unchecked 27868 copied
3.369373ms: AFTER_unchecked 27868 copied
3.584299ms: AFTER_unchecked 27868 copied
3.178597ms: AFTER_unchecked 27868 copied
3.291796ms: AFTER_unchecked 27868 copied
3.15143ms: AFTER_unchecked 27868 copied
3.085926ms: AFTER_unchecked 27868 copied
3.074154ms: AFTER_unchecked 27868 copied
3.312322ms: AFTER_unchecked 27868 copied
3.903366ms: AFTER_unchecked 27868 copied
3.609655ms: AFTER_unchecked 27868 copied
3.168334ms: AFTER_unchecked 27868 copied
3.204255ms: AFTER_unchecked 27868 copied
3.193992ms: AFTER_unchecked 27868 copied
3.204255ms: AFTER_unchecked 27868 copied
3.134223ms: AFTER_unchecked 27868 copied
3.262515ms: AFTER_unchecked 27868 copied
3.709873ms: AFTER_unchecked 27868 copied
3.586109ms: AFTER_unchecked 27868 copied
3.203651ms: AFTER_unchecked 27868 copied
3.190069ms: AFTER_unchecked 27868 copied
3.207878ms: AFTER_unchecked 27868 copied
3.23263ms: AFTER_unchecked 27868 copied
3.110075ms: AFTER_unchecked 27868 copied
3.273382ms: AFTER_unchecked 27868 copied
5.917987ms: AFTER_unchecked 27868 copied
3.23414ms: AFTER_unchecked 27868 copied
3.52121ms: AFTER_unchecked 27868 copied
3.733117ms: AFTER_unchecked 27868 copied
3.364242ms: AFTER_unchecked 27868 copied
3.238366ms: AFTER_unchecked 27868 copied
3.19852ms: AFTER_unchecked 27868 copied
3.101019ms: AFTER_unchecked 27868 copied
3.167126ms: AFTER_unchecked 27868 copied
3.155052ms: AFTER_unchecked 27868 copied
3.256176ms: AFTER_unchecked 27868 copied
3.524228ms: AFTER_unchecked 27868 copied
3.614787ms: AFTER_unchecked 27868 copied
3.668518ms: AFTER_unchecked 27868 copied
3.62173ms: AFTER_unchecked 27868 copied
3.219047ms: AFTER_unchecked 27868 copied
3.179201ms: AFTER_unchecked 27868 copied
3.183125ms: AFTER_unchecked 27868 copied
3.529661ms: AFTER_unchecked 27868 copied
3.120942ms: AFTER_unchecked 27868 copied
3.278212ms: AFTER_unchecked 27868 copied
4.034373ms: AFTER_unchecked 27868 copied
3.814921ms: AFTER_unchecked 27868 copied
3.195803ms: AFTER_unchecked 27868 copied
3.166824ms: AFTER_unchecked 27868 copied
3.20003ms: AFTER_unchecked 27868 copied
3.127583ms: AFTER_unchecked 27868 copied
3.043968ms: AFTER_unchecked 27868 copied
3.300247ms: AFTER_unchecked 27868 copied
3.662782ms: AFTER_unchecked 27868 copied
3.43699ms: AFTER_unchecked 27868 copied
3.187351ms: AFTER_unchecked 27868 copied
3.181918ms: AFTER_unchecked 27868 copied
15.133203ms: AFTER_unchecked 84860 copied
12.394115ms: AFTER_unchecked 84860 copied
12.914825ms: AFTER_unchecked 84860 copied
12.846303ms: AFTER_unchecked 84860 copied
12.328912ms: AFTER_unchecked 84860 copied
15.671722ms: AFTER_unchecked 84860 copied
13.20431ms: AFTER_unchecked 84860 copied
13.102885ms: AFTER_unchecked 84860 copied
13.350712ms: AFTER_unchecked 84860 copied
13.095338ms: AFTER_unchecked 84860 copied
14.230335ms: AFTER_unchecked 84860 copied
13.254419ms: AFTER_unchecked 84860 copied
15.08249ms: AFTER_unchecked 84860 copied
13.392671ms: AFTER_unchecked 84860 copied
12.509727ms: AFTER_unchecked 84860 copied
15.319149ms: AFTER_unchecked 84860 copied
14.583815ms: AFTER_unchecked 84860 copied
14.149437ms: AFTER_unchecked 84860 copied
13.085678ms: AFTER_unchecked 84860 copied
12.413735ms: AFTER_unchecked 84860 copied
13.167785ms: AFTER_unchecked 84860 copied
15.482154ms: AFTER_unchecked 84860 copied
13.162955ms: AFTER_unchecked 84860 copied
14.723577ms: AFTER_unchecked 84860 copied
13.462703ms: AFTER_unchecked 84860 copied
13.563826ms: AFTER_unchecked 84860 copied
13.701475ms: AFTER_unchecked 84860 copied
13.72321ms: AFTER_unchecked 84860 copied
22.021673ms: AFTER_unchecked 84860 copied
12.542328ms: AFTER_unchecked 84860 copied
12.366645ms: AFTER_unchecked 84860 copied
12.413132ms: AFTER_unchecked 84860 copied
12.434564ms: AFTER_unchecked 84860 copied
11.933776ms: AFTER_unchecked 84860 copied
12.142061ms: AFTER_unchecked 84860 copied
12.566477ms: AFTER_unchecked 84860 copied
12.812796ms: AFTER_unchecked 84860 copied
12.494031ms: AFTER_unchecked 84860 copied
12.606927ms: AFTER_unchecked 84860 copied
12.299029ms: AFTER_unchecked 84860 copied
11.964567ms: AFTER_unchecked 84860 copied
12.56859ms: AFTER_unchecked 84860 copied
11.870687ms: AFTER_unchecked 84860 copied
12.055427ms: AFTER_unchecked 84860 copied
12.764197ms: AFTER_unchecked 84860 copied
12.372985ms: AFTER_unchecked 84860 copied
12.396228ms: AFTER_unchecked 84860 copied
12.305368ms: AFTER_unchecked 84860 copied
12.411924ms: AFTER_unchecked 84860 copied
11.955511ms: AFTER_unchecked 84860 copied
12.558025ms: AFTER_unchecked 84860 copied
12.021316ms: AFTER_unchecked 84860 copied
12.920258ms: AFTER_unchecked 84860 copied
12.806457ms: AFTER_unchecked 84860 copied
12.411623ms: AFTER_unchecked 84860 copied
12.360608ms: AFTER_unchecked 84860 copied
12.34944ms: AFTER_unchecked 84860 copied
12.117006ms: AFTER_unchecked 84860 copied
12.174662ms: AFTER_unchecked 84860 copied
12.291784ms: AFTER_unchecked 84860 copied
12.148702ms: AFTER_unchecked 84860 copied
11.920796ms: AFTER_unchecked 84860 copied
11.898157ms: AFTER_unchecked 84860 copied
12.41434ms: AFTER_unchecked 84860 copied
12.718917ms: AFTER_unchecked 84860 copied
12.559535ms: AFTER_unchecked 84860 copied
12.324687ms: AFTER_unchecked 84860 copied
12.316234ms: AFTER_unchecked 84860 copied
12.049993ms: AFTER_unchecked 84860 copied
11.88729ms: AFTER_unchecked 84860 copied
12.581571ms: AFTER_unchecked 84860 copied
12.427017ms: AFTER_unchecked 84860 copied
12.469882ms: AFTER_unchecked 84860 copied
13.379088ms: AFTER_unchecked 84860 copied
13.437649ms: AFTER_unchecked 84860 copied
12.334044ms: AFTER_unchecked 84860 copied
12.33827ms: AFTER_unchecked 84860 copied
12.24892ms: AFTER_unchecked 84860 copied
11.899968ms: AFTER_unchecked 84860 copied
12.479542ms: AFTER_unchecked 84860 copied
12.003507ms: AFTER_unchecked 84860 copied
12.407095ms: AFTER_unchecked 84860 copied
12.418565ms: AFTER_unchecked 84860 copied
12.437884ms: AFTER_unchecked 84860 copied
12.331026ms: AFTER_unchecked 84860 copied
12.363929ms: AFTER_unchecked 84860 copied
12.107648ms: AFTER_unchecked 84860 copied
12.017392ms: AFTER_unchecked 84860 copied
12.008034ms: AFTER_unchecked 84860 copied
12.23775ms: AFTER_unchecked 84860 copied
12.356986ms: AFTER_unchecked 84860 copied
12.276388ms: AFTER_unchecked 84860 copied
12.327706ms: AFTER_unchecked 84860 copied
13.970735ms: AFTER_unchecked 242931 copied
13.724718ms: AFTER_unchecked 242931 copied
13.907344ms: AFTER_unchecked 242931 copied
13.97466ms: AFTER_unchecked 242931 copied
13.625104ms: AFTER_unchecked 242931 copied
13.47357ms: AFTER_unchecked 242931 copied
13.792033ms: AFTER_unchecked 242931 copied
17.096507ms: AFTER_unchecked 242931 copied
13.843048ms: AFTER_unchecked 242931 copied
13.553261ms: AFTER_unchecked 242931 copied
13.373956ms: AFTER_unchecked 242931 copied
13.605785ms: AFTER_unchecked 242931 copied
13.691513ms: AFTER_unchecked 242931 copied
13.89195ms: AFTER_unchecked 242931 copied
13.771507ms: AFTER_unchecked 242931 copied
13.766677ms: AFTER_unchecked 242931 copied
13.843652ms: AFTER_unchecked 242931 copied
13.744642ms: AFTER_unchecked 242931 copied
13.683062ms: AFTER_unchecked 242931 copied
13.823728ms: AFTER_unchecked 242931 copied
13.94719ms: AFTER_unchecked 242931 copied
14.278634ms: AFTER_unchecked 242931 copied
13.768488ms: AFTER_unchecked 242931 copied
13.988847ms: AFTER_unchecked 242931 copied
13.72985ms: AFTER_unchecked 242931 copied
13.776035ms: AFTER_unchecked 242931 copied
13.804712ms: AFTER_unchecked 242931 copied
14.754064ms: AFTER_unchecked 242931 copied
18.907673ms: AFTER_unchecked 328666 copied
17.133032ms: AFTER_unchecked 328666 copied
17.620537ms: AFTER_unchecked 328666 copied
17.87229ms: AFTER_unchecked 328666 copied
16.349099ms: AFTER_unchecked 328666 copied
16.704993ms: AFTER_unchecked 328666 copied
17.57375ms: AFTER_unchecked 328666 copied
19.752884ms: AFTER_unchecked 328666 copied
16.271219ms: AFTER_unchecked 328666 copied
16.184283ms: AFTER_unchecked 328666 copied
16.224732ms: AFTER_unchecked 328666 copied
17.048813ms: AFTER_unchecked 328666 copied
24.559117ms: AFTER_unchecked 328666 copied
15.515359ms: AFTER_unchecked 328666 copied
15.134108ms: AFTER_unchecked 328666 copied
15.440497ms: AFTER_unchecked 328666 copied
15.300131ms: AFTER_unchecked 328666 copied
16.626811ms: AFTER_unchecked 328666 copied
15.349637ms: AFTER_unchecked 328666 copied
15.56426ms: AFTER_unchecked 328666 copied
15.600483ms: AFTER_unchecked 328666 copied
15.535281ms: AFTER_unchecked 328666 copied
15.295905ms: AFTER_unchecked 328666 copied
15.376804ms: AFTER_unchecked 328666 copied
15.333035ms: AFTER_unchecked 328666 copied
15.35175ms: AFTER_unchecked 328666 copied
15.543432ms: AFTER_unchecked 328666 copied
16.043314ms: AFTER_unchecked 328666 copied
15.110864ms: AFTER_unchecked 328666 copied
15.392199ms: AFTER_unchecked 328666 copied
15.23825ms: AFTER_unchecked 328666 copied
15.365031ms: AFTER_unchecked 328666 copied
15.78643ms: AFTER_unchecked 328666 copied
15.195385ms: AFTER_unchecked 328666 copied
15.294698ms: AFTER_unchecked 328666 copied
15.58539ms: AFTER_unchecked 328666 copied
16.216883ms: AFTER_unchecked 328666 copied
15.324884ms: AFTER_unchecked 328666 copied
19.116259ms: AFTER_unchecked 1103347 copied
18.944501ms: AFTER_unchecked 1103347 copied
18.993704ms: AFTER_unchecked 1103347 copied
22.790814ms: AFTER_unchecked 1103347 copied
19.870308ms: AFTER_unchecked 1103347 copied
19.634555ms: AFTER_unchecked 1103347 copied
18.960197ms: AFTER_unchecked 1103347 copied
18.848508ms: AFTER_unchecked 1103347 copied
22.098043ms: AFTER_unchecked 1103347 copied
19.11626ms: AFTER_unchecked 1103347 copied
18.702106ms: AFTER_unchecked 1103347 copied
18.662864ms: AFTER_unchecked 1103347 copied
19.125315ms: AFTER_unchecked 1103347 copied
19.983507ms: AFTER_unchecked 1103347 copied
19.116863ms: AFTER_unchecked 1103347 copied
19.033248ms: AFTER_unchecked 1103347 copied
19.426271ms: AFTER_unchecked 1103347 copied
20.945235ms: AFTER_unchecked 1103347 copied
23.230928ms: AFTER_unchecked 1103347 copied
21.270944ms: AFTER_unchecked 1103347 copied
24.638808ms: AFTER_unchecked 1103347 copied
20.389207ms: AFTER_unchecked 1103347 copied
20.289291ms: AFTER_unchecked 1103347 copied
23.000306ms: AFTER_unchecked 1103347 copied
19.960867ms: AFTER_unchecked 1103347 copied
Benchmark 1: AFTER_unchecked 16755 grouping
  Time (mean ± σ): 5.117577 ms ± 533.868359 µs
  Range (min … max): 4.418039 ms … 7.694138 ms 146 runs
Benchmark 3: AFTER_unchecked 84860 grouping
  Time (mean ± σ): 6.712378 ms ± 821.189829 µs
  Range (min … max): 5.649632 ms … 9.707249 ms 93 runs
Benchmark 4: AFTER_unchecked 242931 grouping
  Time (mean ± σ): 8.808037 ms ± 1.078136 ms
  Range (min … max): 7.680856 ms … 11.735454 ms 28 runs
Benchmark 2: AFTER_unchecked 27868 grouping
  Time (mean ± σ): 5.148410 ms ± 450.255644 µs
  Range (min … max): 4.594024 ms … 6.449262 ms 77 runs
Benchmark 5: AFTER_unchecked 328666 grouping
  Time (mean ± σ): 11.655333 ms ± 2.111709 ms
  Range (min … max): 9.563865 ms … 17.708681 ms 38 runs
Benchmark 6: AFTER_unchecked 1103347 grouping
  Time (mean ± σ): 25.467501 ms ± 5.811982 ms
  Range (min … max): 20.594775 ms … 39.678735 ms 25 runs
Benchmark 2: AFTER_unchecked 16755 copied
  Time (mean ± σ): 3.430697 ms ± 491.102754 µs
  Range (min … max): 2.979671 ms … 6.310104 ms 146 runs
Benchmark 3: AFTER_unchecked 84860 copied
  Time (mean ± σ): 12.854732 ms ± 1.278090 ms
  Range (min … max): 11.870687 ms … 22.021673 ms 93 runs
Benchmark 4: AFTER_unchecked 242931 copied
  Time (mean ± σ): 13.935903 ms ± 657.113682 µs
  Range (min … max): 13.373956 ms … 17.096507 ms 28 runs
Benchmark 1: AFTER_unchecked 27868 copied
  Time (mean ± σ): 3.353081 ms ± 368.159830 µs
  Range (min … max): 3.043968 ms … 5.917987 ms 77 runs
Benchmark 5: AFTER_unchecked 328666 copied
  Time (mean ± σ): 16.308506 ms ± 1.725097 ms
  Range (min … max): 15.110864 ms … 24.559117 ms 38 runs
Benchmark 6: AFTER_unchecked 1103347 copied
  Time (mean ± σ): 20.245956 ms ± 1.635977 ms
  Range (min … max): 18.662864 ms … 24.638808 ms 25 runs
-->
<table class="perf">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->84'860</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->242'931</span></th> <th>±σ</th></tr>
 <tr><th>i7-2600, <q>grouping</q>, <span class="roboto-unscale math-font-normal">8</span> threads, <code>.unwrap_unchecked()</code></th> <td><span class="roboto-unscale math-font-normal">5.118ms</span></td> <td><span class="roboto-unscale math-font-normal">6.712ms</span></td> <td><span class="roboto-unscale math-font-normal">8.808ms</span></td> <td><span class="roboto-unscale math-font-normal">534µs</span>/<span class="roboto-unscale math-font-normal">821µs</span>/<span class="roboto-unscale math-font-normal">1.078ms</span></td></tr>
 <tr><th>i7-2600, <q>copying</q>, <span class="roboto-unscale math-font-normal">8</span> threads, <code>.unwrap_unchecked()</code></th> <td><span class="roboto-unscale math-font-normal">3.431ms</span></td> <td><span class="roboto-unscale math-font-normal">12.855ms</span></td> <td><span class="roboto-unscale math-font-normal">13.936ms</span></td> <td><span class="roboto-unscale math-font-normal">491µs</span>/<span class="roboto-unscale math-font-normal">1.278ms</span>/<span class="roboto-unscale math-font-normal">657µs</span></td></tr>
 <tr><th>(speed-up vs serial) </th> <td><span class="roboto-unscale math-font-normal">-18.47%</span></td> <td><span class="roboto-unscale math-font-normal">13.36%</span></td> <td><span class="roboto-unscale math-font-normal">36.15%</span></td> <td></td></tr>
 <tr><th>(speed-up vs serial) </th> <td><span class="roboto-unscale math-font-normal">2.60 p.p.</span></td> <td><span class="roboto-unscale math-font-normal">10.50 p.p.</span></td> <td><span class="roboto-unscale math-font-normal">7.40 p.p.</span></td> <td></td></tr>
 <tr><th>(speed-up vs <span class="roboto-unscale math-font-normal">8</span> threads) </th> <td><span class="roboto-unscale math-font-normal">2.15%</span></td> <td><span class="roboto-unscale math-font-normal">10.81%</span></td> <td><span class="roboto-unscale math-font-normal">10.38%</span></td> <td></td></tr>
 <tr class="spc"></tr>
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->27'868</span></th> <th><span class="roboto-unscale math-font-normal"><!--'-->328'666</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>i7-2600, <q>grouping</q>, <span class="roboto-unscale math-font-normal">8</span> threads, <code>.unwrap_unchecked()</code></th> <td><span class="roboto-unscale math-font-normal">5.148ms</span></td> <td><span class="roboto-unscale math-font-normal">11.655ms</span></td> <td><span class="roboto-unscale math-font-normal">25.468ms</span></td> <td><span class="roboto-unscale math-font-normal">450µs</span>/<span class="roboto-unscale math-font-normal">2.112ms</span>/<span class="roboto-unscale math-font-normal">5.812ms</span></td></tr>
 <tr><th>i7-2600, <q>copying</q>, <span class="roboto-unscale math-font-normal">8</span> threads, <code>.unwrap_unchecked()</code></th> <td><span class="roboto-unscale math-font-normal">3.353ms</span></td> <td><span class="roboto-unscale math-font-normal">16.309ms</span></td> <td><span class="roboto-unscale math-font-normal">20.246ms</span></td> <td><span class="roboto-unscale math-font-normal">368µs</span>/<span class="roboto-unscale math-font-normal">1.725ms</span>/<span class="roboto-unscale math-font-normal">1.636ms</span></td></tr>
 <tr><th>(speed-up vs serial) </th> <td><span class="roboto-unscale math-font-normal">1.56%</span></td> <td><span class="roboto-unscale math-font-normal">39.60%</span></td> <td><span class="roboto-unscale math-font-normal">59.01%</span></td> <td></td></tr>
 <tr><th>(speed-up vs serial) </th> <td><span class="roboto-unscale math-font-normal">0.04 p.p.</span></td> <td><span class="roboto-unscale math-font-normal">1.05 p.p.</span></td> <td><span class="roboto-unscale math-font-normal">-0.91 p.p.</span></td> <td></td></tr>
 <tr><th>(speed-up vs <span class="roboto-unscale math-font-normal">8</span> threads) </th> <td><span class="roboto-unscale math-font-normal">0.04%</span></td> <td><span class="roboto-unscale math-font-normal">1.71%</span></td> <td><span class="roboto-unscale math-font-normal">-2.26%</span></td> <td></td></tr>
</table>
<p>
Not great, not terrible, for the cost of bumping <samp>groups_accumulator</samp> from is a similar size to the [​[​8\text{MB}​]​] —
[​[​G^3 \cdot \operatorname{sizeof}(\texttt{Mutex&lt;Vec&lt;_>>}) = G^3 \cdot (3 \operatorname{sizeof}(\texttt{usize}) + m) = 32\text{MB}_{\text{LP64}} \vee 20\text{MB}_{\text{ILP32}_\text{linux}} \vee 16\text{MB}_{\text{ILP32}_\text{Win32}}​]​]
(<a href="#grid-grid">from<!-- -->[​[​\ 24\text{MB}_\text{LP64} \vee 12\text{MB}_\text{ILP32}​]​]</a>).
</p>
<p class="indented continuing">
Conversely,
</p>
<h2 id="groupshared" class="continuing"><a class="hash-link" href="#groupshared">#</a> de-parallelising <samp>find_bbox.hlsl</samp></h2>
<p class="continuing">
was also in order.
I'd<!--'--> actually had it marked "TODO: groupshared?" in the original implementation but there is no documentation
<em>or</em> extant implementation using group-shared memory that makes sense.
One'd<!--'--> think that a reduction would be perfect for it, but… no?
</p>
<p class="indented continuing">
What would <em>also</em> have the desired effect of doing fewer atomics to real memory is
"<a href="//raw.githubusercontent.com/KhronosGroup/GLSL/refs/heads/main/extensions/khr/GL_KHR_shader_subgroup.txt">reducing</a><!--"-->
 across the subgroup and doing the atomic in the
 elected thread
 in a subgroup"<!--"-->
(Vulkan/GLSL nomenclature) or
"<a href="//learn.microsoft.com/en-us/windows/win32/direct3dhlsl/waveallmin">reducing</a><!--"-->
 across the wave and doing the atomic in the
 <a href="//learn.microsoft.com/en-us/windows/win32/direct3dhlsl/waveisfirstlane">first lane</a>
 in a wave"<!--"-->
(HLSL nomenclature).
I think it's the bit that's <span class="roboto-unscale math-font-normal">64</span> (or <span class="roboto-unscale math-font-normal">32</span> on n<span style="font-variant: small-caps;">vidia</span> cards)?
They also call it a warp sometimes?
Also the election always chooses the first "thread", so. Hardly an "election"?
So, <a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/04a6d34baa1ee5203a637184c32e0ecadba0f147/item/src/find_bbox.hlsl#L27"><samp>find_bbox.hlsl</samp></a>:
</p>
<div class="codecontinued">
<pre class="language-hlsl"><code class="language-hlsl"><small style='display: block; line-height: initial;'><span class="token punctuation">[</span><span class="token function">numthreads</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">uint3</span> DTid <span class="token operator">:</span> <span class="token keyword">SV_DispatchThreadID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> known_rgbs_len <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>known_rgbs_len<span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">const</span> <span class="token keyword">uint</span> id <span class="token operator">=</span> DTid<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">>=</span> known_rgbs_len<span class="token punctuation">)</span>
<!--"-->		<!--"--><span class="token keyword">return</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">uint3</span> tmp <span class="token operator">=</span> known_rgbs_bundle<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>lab<span class="token punctuation">;</span>
<!--"-->	<!--"-->tmp <span class="token operator">^=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>tmp <span class="token operator">>></span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80000000</span><span class="token punctuation">;</span>

</small><!--"-->	<!--"--><span class="token keyword">uint3</span> m <span class="token operator">=</span> <span class="token function">WaveActiveMin</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">uint3</span> M <span class="token operator">=</span> <span class="token function">WaveActiveMax</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WaveIsFirstLane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<!--"-->		<!--"--><span class="token function">InterlockedMin</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">.</span>x<span class="token punctuation">,</span> m<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token function">InterlockedMin</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">.</span>y<span class="token punctuation">,</span> m<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token function">InterlockedMin</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_min<span class="token punctuation">.</span>z<span class="token punctuation">,</span> m<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->		<!--"--><span class="token function">InterlockedMax</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_max<span class="token punctuation">.</span>x<span class="token punctuation">,</span> M<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token function">InterlockedMax</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_max<span class="token punctuation">.</span>y<span class="token punctuation">,</span> M<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->		<!--"--><span class="token function">InterlockedMax</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bbox_max<span class="token punctuation">.</span>z<span class="token punctuation">,</span> M<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token punctuation">}</span>
<small style='display: block; line-height: initial;'><span class="token punctuation">}</span>
</small></code></pre>
</div>
<p class="continuing">
but this fails to compile with
</p>
<blockquote class="continuation"><pre class="continuation" style="white-space: pre-wrap;"><!--"-->  shaderc: internal error: compilation succeeded but failed to optimize: Capability GroupNonUniform is not allowed by Vulkan 1.0 specification (or requires extension)<!--"-->
<!--"-->    OpCapability GroupNonUniform<!--"--></pre></blockquote>
<p class="indented continued">
This doesn't mean you need to enable an extension in your Vulkan run-time (since it's not even getting to that point).
It doesn't<!--'--> mean you need to enable an extension in glslc
(though those <em>are</em> a real thing! mostly in GLSL, but they're<!--'--> also part of the SPIR-V output.
 There may be some way to enable the SPIR-V ones if you find a mapping from the official <del>feature</del>extension name you want.
 I behoove the dear reader to find anything relevant to this in <a href="//manpages.debian.org/glslc.1">glslc(1)</a>,
 which uses "extension" mostly to mean the file-name suffix and also some-times to mean <code>GL_GOOGLE_cpp_style_line_directive</code>
 which is part of preprocessor support).
What it actually means is that you need to bump the base-line to a Vulkan version that has non-uniform/warp/wave/subgroup operations.
How do you do that?
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/04a6d34baa1ee5203a637184c32e0ecadba0f147/item/build.rs#L31">You guessed it!</a>:
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust">glslcs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span><span class="token class-name">Command</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"glslc"</span><span class="token punctuation">)</span>
<!--"-->	<!--"--><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><span class="token string">"--target-env=vulkan1.2"</span><span class="token punctuation">)</span>
</code></pre>
</div>
<p class="indented continued">
It may also be apt to validate this is supported (though it is likely also an over-abundance of caution),
which can only be queried by asking for the physical device properties… next <em><span class="roboto-unscale math-font-normal">2</span></em> the subgroup properties.
<a href="//git.sr.ht/~nabijaczleweli/mean-shift-clusterer/tree/04a6d34baa1ee5203a637184c32e0ecadba0f147/item/src/msc_gpu.rs#L275">🙄</a>
</p>
<div class="codecontinued">
<pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">PosteriseGpu</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">PosteriseGpu</span> <span class="token punctuation">{</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> physical_device_subgroup_properties <span class="token operator">=</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PhysicalDeviceSubgroupProperties</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> <span class="token keyword">mut</span> physical_device_properties2 <span class="token operator">=</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">PhysicalDeviceProperties2</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push_next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> physical_device_subgroup_properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"-->vk_instance<span class="token punctuation">.</span><span class="token function">get_physical_device_properties2</span><span class="token punctuation">(</span>physical_device<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> physical_device_properties2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> physical_device_properties <span class="token operator">=</span> physical_device_properties2<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>properties<span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token constant">SHADER_MAX_BINDING</span> <span class="token operator">&lt;</span> physical_device_properties<span class="token punctuation">.</span>limits<span class="token punctuation">.</span>max_bound_descriptor_sets<span class="token punctuation">)</span><span class="token punctuation">;</span>

<!--"-->	<!--"--><span class="token keyword">let</span> physical_device_subgroup_properties <span class="token operator">=</span> physical_device_subgroup_properties<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token keyword">let</span> need <span class="token operator">=</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">SubgroupFeatureFlags</span><span class="token punctuation">::</span><span class="token constant">BASIC</span> <span class="token operator">|</span> <span class="token namespace">vk<span class="token punctuation">::</span></span><span class="token class-name">SubgroupFeatureFlags</span><span class="token punctuation">::</span><span class="token constant">ARITHMETIC</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token macro property">assert!</span><span class="token punctuation">(</span>physical_device_subgroup_properties<span class="token punctuation">.</span>supported_operations <span class="token operator">&amp;</span> need <span class="token operator">==</span> need<span class="token punctuation">)</span><span class="token punctuation">;</span>
<!--"-->	<!--"--><span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p class="continuation">
<a href="//registry.khronos.org/vulkan/specs/latest/man/html/VkSubgroupFeatureFlagBits.html"><code>BASIC | ARITHMETIC</code></a>
are required by
<a href="//registry.khronos.org/SPIR-V/specs/unified1/SPIRV.html#OpGroupNonUniformElect"><code>OpGroupNonUniformElect</code></a>
and
<a href="//registry.khronos.org/SPIR-V/specs/unified1/SPIRV.html#OpGroupNonUniformUMin" ><code>OpGroupNonUniformUMin</code></a>/<a href="//registry.khronos.org/SPIR-V/specs/unified1/SPIRV.html#OpGroupNonUniformUMax" ><code>Max</code></a>,
respectively, and that's<!--'--> what <samp>spirv-dis</samp> says the shader compiles to.
</p>
<!--
46.789µs 16755 before
93.879µs 16755 before
52.523µs 16755 before
101.727µs 16755 before
101.728µs 16755 before
93.577µs 16755 before
87.238µs 16755 before
105.35µs 16755 before
94.483µs 16755 before
66.712µs 16755 before
55.844µs 16755 before
90.861µs 16755 before
90.256µs 16755 before
111.689µs 16755 before
108.972µs 16755 before
51.92µs 16755 before
63.994µs 16755 before
67.617µs 16755 before
67.617µs 16755 before
66.108µs 16755 before
65.806µs 16755 before
58.259µs 16755 before
52.826µs 16755 before
119.537µs 16755 before
97.199µs 16755 before
55.542µs 16755 before
91.464µs 16755 before
87.54µs 16755 before
101.124µs 16755 before
95.388µs 16755 before
62.485µs 16755 before
54.938µs 16755 before
51.619µs 16755 before
76.371µs 16755 before
82.408µs 16755 before
78.183µs 16755 before
54.939µs 16755 before
53.127µs 16755 before
54.939µs 16755 before
67.315µs 16755 before
51.316µs 16755 before
61.278µs 16755 before
107.161µs 16755 before
64.598µs 16755 before
53.128µs 16755 before
52.826µs 16755 before
61.881µs 16755 before
60.674µs 16755 before
78.182µs 16755 before
91.464µs 16755 before
57.353µs 16755 before
158.779µs 1103347 before
125.574µs 1103347 before
124.668µs 1103347 before
219.453µs 1103347 before
137.346µs 1103347 before
126.782µs 1103347 before
137.347µs 1103347 before
125.574µs 1103347 before
442.227µs 1103347 before
140.366µs 1103347 before
117.424µs 1103347 before
138.253µs 1103347 before
456.716µs 1103347 before
122.858µs 1103347 before
122.253µs 1103347 before
127.084µs 1103347 before
144.894µs 1103347 before
167.231µs 1103347 before
128.291µs 1103347 before
120.141µs 1103347 before
153.647µs 1103347 before
124.669µs 1103347 before
122.556µs 1103347 before
116.82µs 1103347 before
163.609µs 1103347 before
127.687µs 1103347 before
117.424µs 1103347 before
125.877µs 1103347 before
127.083µs 1103347 before
128.593µs 1103347 before
Benchmark 1: 16755 before
  Time (mean ± σ): 74.897137 µs ± 20.160142 µs
  Range (min … max): 46.789000 µs … 119.537000 µs 51 runs
Benchmark 2: 1103347 before
  Time (mean ± σ): 156.374200 µs ± 80.968245 µs
  Range (min … max): 116.820000 µs … 456.716000 µs 30 runs
-->
<!--
70.333µs 16755 after
73.654µs 16755 after
71.843µs 16755 after
54.033µs 16755 after
96.595µs 16755 after
49.505µs 16755 after
84.823µs 16755 after
101.425µs 16755 after
97.501µs 16755 after
72.446µs 16755 after
123.461µs 16755 after
67.617µs 16755 after
74.258µs 16755 after
72.748µs 16755 after
73.352µs 16755 after
50.109µs 16755 after
55.845µs 16755 after
59.467µs 16755 after
77.277µs 16755 after
70.937µs 16755 after
62.787µs 16755 after
57.656µs 16755 after
85.729µs 16755 after
71.542µs 16755 after
86.03µs 16755 after
81.805µs 16755 after
78.483µs 16755 after
68.22µs 16755 after
89.652µs 16755 after
92.067µs 16755 after
71.24µs 16755 after
68.22µs 16755 after
71.541µs 16755 after
90.558µs 16755 after
48.901µs 16755 after
176.287µs 16755 after
92.974µs 16755 after
68.22µs 16755 after
54.335µs 16755 after
73.956µs 16755 after
73.655µs 16755 after
88.747µs 16755 after
71.542µs 16755 after
89.049µs 16755 after
98.105µs 16755 after
70.635µs 16755 after
88.747µs 16755 after
106.858µs 16755 after
95.388µs 16755 after
48.298µs 16755 after
76.672µs 16755 after
80.597µs 16755 after
60.372µs 16755 after
53.128µs 16755 after
64.599µs 16755 after
68.522µs 16755 after
81.502µs 16755 after
49.505µs 16755 after
87.842µs 16755 after
71.843µs 16755 after
143.686µs 1103347 after
119.537µs 1103347 after
170.854µs 1103347 after
147.006µs 1103347 after
126.48µs 1103347 after
120.744µs 1103347 after
135.233µs 1103347 after
136.14µs 1103347 after
124.065µs 1103347 after
124.668µs 1103347 after
129.499µs 1103347 after
127.989µs 1103347 after
181.419µs 1103347 after
131.008µs 1103347 after
121.952µs 1103347 after
137.045µs 1103347 after
118.631µs 1103347 after
126.177µs 1103347 after
119.839µs 1103347 after
122.254µs 1103347 after
146.402µs 1103347 after
142.177µs 1103347 after
117.123µs 1103347 after
124.668µs 1103347 after
129.196µs 1103347 after
131.31µs 1103347 after
134.63µs 1103347 after
134.63µs 1103347 after
124.065µs 1103347 after
127.989µs 1103347 after
474.526µs 1103347 after
135.838µs 1103347 after
119.537µs 1103347 after
131.007µs 1103347 after
128.895µs 1103347 after
Benchmark 1: 16755 after
  Time (mean ± σ): 76.883967 µs ± 20.303881 µs
  Range (min … max): 48.298000 µs … 176.287000 µs 60 runs
Benchmark 2: 1103347 after
  Time (mean ± σ): 141.891971 µs ± 58.588865 µs
  Range (min … max): 117.123000 µs … 474.526000 µs 35 runs
-->
<table class="perf left">
 <tr><th>(colours) </th> <th><span class="roboto-unscale math-font-normal"><!--'-->16'755</span></th> <th><span class="roboto-unscale math-font-normal">1'103'347</span></th> <th>±σ</th></tr>
 <tr><th>5700 XT, natural</th> <td><span class="roboto-unscale math-font-normal">74.897µs</span></td> <td><span class="roboto-unscale math-font-normal">156.374µs</span></td> <td><span class="roboto-unscale math-font-normal">20µs</span>/<span class="roboto-unscale math-font-normal">81µs</span></td></tr>
 <tr><th>5700 XT, wavy </th> <td><span class="roboto-unscale math-font-normal">76.884µs</span></td> <td><span class="roboto-unscale math-font-normal">141.892µs</span></td> <td><span class="roboto-unscale math-font-normal">20µs</span>/<span class="roboto-unscale math-font-normal">59µs</span></td></tr>
 <tr><th>(speed-up) </th> <td><span class="roboto-unscale math-font-normal">-2.65%</span></td> <td><span class="roboto-unscale math-font-normal">9.26%</span></td> <td></td></tr>
</table>
<p>
Placebo optimisation. Maybe it's<!--'--> better on worse hardware.
</p>
<h2 id="moral" ><a class="hash-link" href="#moral">#</a> Moral</h2>
<p class="indented continued">
Don't develop software for the GPU. Don't try to create 3D models. Never attempt to use vaguely novel technology, implement a paper, or advance the field.
Avoid documenting or formalising anything, <em>especially</em> to describe or measure methodology.
Accd'g<!--'--> to <a href="//101010.pl/@nabijaczleweli/114017215974489591">the post I threaded under</a>,
I started around <date class="roboto-unscale math-font-normal" datetime="2025-02-17">2025-02-17</date>
and it's<!--'--> now <date class="roboto-unscale math-font-normal" datetime="2025-04-26">2025-04-26</date>.
It never gets better, it's never worth it, and it's <em>all</em> worse.
</p>
<h2 id="network-effect" ><a class="hash-link" href="#network-effect">#</a> Network effect</h2>
<ul style="padding-left: 0; list-style-type: none;">
 <li><a href="//github.com/gfx-rs/wgpu/pull/7164" ><date class="roboto-unscale math-font-normal" datetime="2025-02-17T13:24:49Z" title="2025-02-17T13:24:49Z">2025-02-17</date> <strong>gfx-rs/wgpu</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">7164</span></a>:<!--"--> Fix examples links in README<!--"--></li>
 <p></p>
 <li>
  <h4 id="network-effect-vulkanalia" class="continuing"><a class="hash-link" href="#network-effect-vulkanalia">#</a> KyleMayes/vulkanalia<span style="font-weight: initial;">:</span></h4>
  <ul style="padding-left: 1em;">
   <li><a href="//github.com/KyleMayes/vulkanalia/pull/311" ><date class="roboto-unscale math-font-normal" datetime="2025-02-17T17:42:18Z" title="2025-02-17T17:42:18Z">2025-02-17</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">311</span></a>:<!--"--> <samp>App:[:]create</samp><!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/issues/312"><date class="roboto-unscale math-font-normal" datetime="2025-02-22T17:15:41Z" title="2025-02-22T17:15:41Z">2025-02-22</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">312</span></a>:<!--"--> <samp>queue_wait_idle()</samp> returns <samp>Err(ErrorCode(2))</samp> which it doesn't know how to format and resorts to just "2". is this <samp>SuccessCode::TIMEOUT</samp> (2)?<!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/issues/313"><date class="roboto-unscale math-font-normal" datetime="2025-02-22T17:43:14Z" title="2025-02-22T17:43:14Z">2025-02-22</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">313</span></a>:<!--"--> All upstream documentation links are 404s<!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/pull/314" ><date class="roboto-unscale math-font-normal" datetime="2025-02-22T18:01:14Z" title="2025-02-22T18:01:14Z">2025-02-22</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">314</span></a>:<!--"--> Fix upstream links being 404s by linking to <samp class="path">/latest/</samp> instead of <samp class="path">/1.4-extensions/</samp><!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/issues/315"><date class="roboto-unscale math-font-normal" datetime="2025-02-23T20:25:56Z" title="2025-02-23T20:25:56Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">315</span></a>:<!--"--> <samp>ShaderModuleCreateInfoBuilder</samp> takes <samp>.code(&[u32])</samp> but then <samp>.code_size()</samp> in bytes, should probably just take <samp>.code(&[u32])</samp> and derive <samp>code_size</samp> automatically<!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/pull/316" ><date class="roboto-unscale math-font-normal" datetime="2025-02-23T23:42:53Z" title="2025-02-23T23:42:53Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">316</span></a>:<!--"--> Use <samp>Result</samp>'s <samp>Debug</samp> and <samp>Display</samp> implementations for <samp>SuccessCode</samp> and <samp>ErrorCode</samp><!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/pull/320" ><date class="roboto-unscale math-font-normal" datetime="2025-02-24T05:48:00Z" title="2025-02-24T05:48:00Z">2025-02-24</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">320</span></a>:<!--"--> <samp>ShaderModuleCreateInfoBuilder::code()</samp> sets both <samp>code</samp> and <samp>code_size</samp>, remove its <samp>::code_size()</samp><!--"--></li>
   <li><a href="//github.com/KyleMayes/vulkanalia/pull/321" ><date class="roboto-unscale math-font-normal" datetime="2025-02-24T05:58:51Z" title="2025-02-24T05:58:51Z">2025-02-24</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">321</span></a>:<!--"--> resetting command buffers, not pools<!--"--></li>
  </ul>
 </li>
 <p></p>
 <li><a href="//github.com/google/shaderc/issues/1484" ><date class="roboto-unscale math-font-normal" datetime="2025-02-25T11:28:24Z" title="2025-02-25T11:28:24Z">2025-02-25</date> <strong>google/shaderc</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1484</span></a>:<!--"--> Missed optimisation: doesn't elide <samp>&lt;&lt;0</samp>/<samp>-0</samp>/<samp>>>0</samp>/<samp>|0</samp> like it does <samp>+0</samp><!--"--></li>
 <li><a href="//github.com/KhronosGroup/SPIRV-Tools/pull/6013" ><date class="roboto-unscale math-font-normal" datetime="2025-02-25T15:18:23Z" title="2025-02-25T15:18:23Z">2025-02-25</date> <strong>KhronosGroup/SPIRV-Tools</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">6013</span></a>:<!--"--> optimiser: remove <samp>OpBitwiseOr</samp> <samp>OpBitwiseXor</samp> <samp>OpShiftRightLogical</samp> <samp>OpShiftRightArithmetic</samp> <samp>OpShiftLeftLogical</samp> <samp>OpIAdd</samp> <samp>OpFAdd</samp> <samp>OpISub</samp> <samp>OpFSub</samp> with 0 or vec[any](0) on rhs and <samp>OpBitwiseOr</samp> <samp>OpBitwiseXor</samp> <samp>OpIAdd</samp> <samp>OpFAdd</samp> on lhs<!--"--></li>
 <li><a href="//github.com/KhronosGroup/SPIRV-Tools/pull/6020" ><date class="roboto-unscale math-font-normal" datetime="2025-02-28T21:20:44Z" title="2025-02-28T21:20:44Z">2025-02-28</date> <strong>KhronosGroup/SPIRV-Tools</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">6020</span></a>:<!--"--> Fold <samp>0 &lt;&lt;,>>,/,% n</samp> to 0. Fold <samp>a / 1</samp> to <samp>a</samp>. Fold <samp>a % 1</samp> to <samp>0</samp>. Fold <samp>f % 1.0</samp> to <samp>0.0</samp>. Fold <samp>0.0 % f</samp> to <samp>0.0</samp><!--"--></li>
 <p></p>
 <li><a href="//github.com/jakubcerveny/gilbert/pull/17" ><date class="roboto-unscale math-font-normal" datetime="2025-02-26T17:22:28Z" title="2025-02-26T17:22:28Z">2025-02-26</date> <strong>jakubcerveny/gilbert</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">17</span></a>:<!--"--> Port to Rust<!--"--></li>
 <p></p>
 <li>
  <h4 id="network-effect-rust" class="continuing"><a class="hash-link" href="#network-effect-rust">#</a> rust-lang/rust<span style="font-weight: initial;">:</span></h4>
  <ul style="padding-left: 1em;">
   <li><a href="//github.com/rust-lang/rust/issues/137490" ><date class="roboto-unscale math-font-normal" datetime="2025-02-23T17:23:18Z" title="2025-02-23T17:23:18Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137490</span></a>:<!-- --> What does "before-main stdio file descriptors are not guaranteed to be open on unix platforms" mean?</li>
   <li><a href="//github.com/rust-lang/rust/pull/137492" ><date class="roboto-unscale math-font-normal" datetime="2025-02-23T17:59:26Z" title="2025-02-23T17:59:26Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137492</span></a>:<!--"--> libstd: rustdoc: correct note on fds 0/1/2 pre-main<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/pull/137493" ><date class="roboto-unscale math-font-normal" datetime="2025-02-23T18:15:27Z" title="2025-02-23T18:15:27Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137493</span></a>:<!--"--> configure.py: don't instruct user to run nonexistent program<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/pull/137494" ><date class="roboto-unscale math-font-normal" datetime="2025-02-23T18:44:53Z" title="2025-02-23T18:44:53Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137494</span></a>:<!--"--> libstd: init(): <samp>dup()</samp> subsequent <samp class="path">/dev/null</samp>s instead of opening them again<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/issues/137499" ><date class="roboto-unscale math-font-normal" datetime="2025-02-23T22:26:41Z" title="2025-02-23T22:26:41Z">2025-02-23</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137499</span></a>:<!--"--> nightly cargo can no longer build anything due to error: failed to create directory `<samp class="path">...\target</samp>` Caused by: Incorrect function. (os error 1)<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/pull/137547" ><date class="roboto-unscale math-font-normal" datetime="2025-02-24T16:19:37Z" title="2025-02-24T16:19:37Z">2025-02-24</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137547</span></a>:<!--"--> Revert 00bf74da6d1e8e49b18c0203e0cbd993fdac5663<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/issues/137678" ><date class="roboto-unscale math-font-normal" datetime="2025-02-26T14:57:06Z" title="2025-02-26T14:57:06Z">2025-02-26</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137678</span></a>:<!--"--> 1 million item array spends inordinate time on error path of typechecking<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/issues/137680" ><date class="roboto-unscale math-font-normal" datetime="2025-02-26T15:15:03Z" title="2025-02-26T15:15:03Z">2025-02-26</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137680</span></a>:<!--"--> Dumps unbounded amounts of data in diagnostics (27M in three lines for one error!) for large input lines (and thinks about them for minutes first)<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/issues/137681" ><date class="roboto-unscale math-font-normal" datetime="2025-02-26T15:24:24Z" title="2025-02-26T15:24:24Z">2025-02-26</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137681</span></a>:<!--"--> Deleting newlines from input makes it build 3% faster end-to-end<!--"--></li>
   <li><a href="//github.com/rust-lang/rust/issues/138953" ><date class="roboto-unscale math-font-normal" datetime="2025-03-25T23:45:43Z" title="2025-03-25T23:45:43Z">2025-03-25</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">138953</span></a>:<!--"--> <samp>f32 += f32 * u32</samp> is faster in a loop than <samp>f32 += f32</samp>; can be defeated (a little bit) with <samp>#[cold]</samp> annotation?<!--"--></li>
  </ul>
 </li>
 <p></p>
 <li>
  <h4 id="network-effect-sourcehut" class="continuing"><a class="hash-link" href="#network-effect-sourcehut">#</a> ~sircmpwn/sourcehut<span style="font-weight: initial;">:</span></h4>
  <ul style="padding-left: 1em;">
   <li><a href="//todo.sr.ht/~sircmpwn/git.sr.ht/380"><date class="roboto-unscale math-font-normal" datetime="2025-03-05T22:07:26Z" title="2025-03-05T22:07:26Z">2025-03-05</date> <strong>~sircmpwn/git.sr.ht</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">380</span></a>:<!--"--> Renaming private repository leaks old and new names into redirect table queriable at unlisted-equivalent visibility<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<5webr4rzb2eulturkipecdkwms6m7kk2yzafse4p7jybaoknzz@tarta.nabijaczleweli.xyz>" ><date class="roboto-unscale math-font-normal" datetime="2025-03-06T05:57:04+0100" title="2025-03-06T05:57:04+0100">2025-03-06</date><!--"-->	[PATCH <strong>   git.sr.ht</strong>]</a> Add git.sr.ht-http-clone to intercept git http-backend explicitly and provide redirections<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<qegljwzh2w5svuyfrajisowprqiv36ukvtomtvyas57roxuoki@tarta.nabijaczleweli.xyz>" ><date class="roboto-unscale math-font-normal" datetime="2025-03-06T05:57:08+0100" title="2025-03-06T05:57:08+0100">2025-03-06</date><!--"-->	[PATCH <strong>  sr.ht-docs</strong>]</a> git.sr.ht: use <samp>git.sr.ht-http-clone</samp><!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<tl3now4lhsxzx6qmordf7iemxnpbvcucypifh7lubwdax3f2ta@tarta.nabijaczleweli.xyz>" ><date class="roboto-unscale math-font-normal" datetime="2025-03-06T06:13:03+0100" title="2025-03-06T06:13:03+0100">2025-03-06</date><!--"-->	[PATCH <strong>   git.sr.ht</strong>]</a> shell: return "Access denied." for redirects to private repositories the pusher can't access<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<zwwyjz6ymcroboy2cenyuahicmp3q3p7hyjykar3qqfpoz6cbb@tarta.nabijaczleweli.xyz>" ><date class="roboto-unscale math-font-normal" datetime="2025-03-10T22:29:45+0100" title="2025-03-10T22:29:45+0100">2025-03-10</date><!--"-->	[PATCH <strong>     core-go</strong>]</a> client: make InternalAuth.Name omitempty to allow <samp>@anoninternal</samp> auth<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<xsxu6yn6m6khb77nkpnbmbtdskzflkcqooc4r5sqni36v3evdk@tarta.nabijaczleweli.xyz>" ><date class="roboto-unscale math-font-normal" datetime="2025-03-11T17:04:11+0100" title="2025-03-11T17:04:11+0100">2025-03-11</date><!--"-->	[PATCH <strong>builds.sr.ht</strong>]</a> Use <samp>git -C</samp>/<samp>hg --cwd</samp> instead of cd &&<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<f9ba09981669ba483564d69ae5c04b3df636d1e4.1744311239.git.nabijaczleweli@nabijaczleweli.xyz>"><date class="roboto-unscale math-font-normal" datetime="2025-04-10T20:54:23+0200" title="2025-04-10T20:54:23+0200">2025-04-10</date><!--"-->	[PATCH <strong>   git.sr.ht</strong> <!--"--><span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1</span>/<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">4</span><!--"-->]</a> commit: <samp>range(max(a, b))</samp>+<samp>if(i >= a || i >= b)break</samp> => <samp>range(min(a, b))</samp><!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<7703a13a8ee02f576549603dd5cd8d297906da94.1744311239.git.nabijaczleweli@nabijaczleweli.xyz>"><date class="roboto-unscale math-font-normal" datetime="2025-04-10T20:54:25+0200" title="2025-04-10T20:54:25+0200">2025-04-10</date><!--"-->	[PATCH <strong>   git.sr.ht</strong> <!--"--><span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">2</span>/<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">4</span><!--"-->]</a> commit: use saved variables for <samp>old_path</samp>/<samp>new_path</samp><!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<69e963880cef3e9cd3785064972a0a3271155a62.1744311239.git.nabijaczleweli@nabijaczleweli.xyz>"><date class="roboto-unscale math-font-normal" datetime="2025-04-10T20:54:27+0200" title="2025-04-10T20:54:27+0200">2025-04-10</date><!--"-->	[PATCH <strong>   git.sr.ht</strong> <!--"--><span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3</span>/<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">4</span><!--"-->]</a> commit: detect common suffix in addition to prefix<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<06e629292e656dc4ea766e6c2c4dde507772f60d.1744311239.git.nabijaczleweli@nabijaczleweli.xyz>"><date class="roboto-unscale math-font-normal" datetime="2025-04-10T20:54:29+0200" title="2025-04-10T20:54:29+0200">2025-04-10</date><!--"-->	[PATCH <strong>   git.sr.ht</strong> <!--"--><span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">4</span>/<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">4</span><!--"-->]</a> commit: also link renames<!--"--></li>
   <li><a href="//lists.sr.ht/~sircmpwn/sr.ht-dev/<rf5al4vxjppm6a7rxu6mumdnjol2hihgm3gzhmt3vqeoye3hti@tarta.nabijaczleweli.xyz>" ><date class="roboto-unscale math-font-normal" datetime="2025-04-10T21:28:38+0200" title="2025-04-10T21:28:38+0200">2025-04-10</date><!--"-->	[PATCH <strong>lists.sr.ht</strong>]</a> patchset: accumulate authors correctly instead of undecoded<!--"--></li>
  </ul>
 </li>
 <p></p>
 <li><del><a href="//github.com/Rust-SDL2/rust-sdl2/pull/1468" ><date class="roboto-unscale math-font-normal" datetime="2025-03-19T20:17:57Z" title="2025-03-19T20:17:57Z">2025-03-19</date> <strong>Rust-SDL2/rust-sdl2</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1468</span></a>:<!--"--> Fix <samp>SDL_PIXELFORMAT_{RGBA,ARGB,BGRA,ABGR}32</samp> being backward on big-endian targets<!--"--></del></li>
 <li><a href="//github.com/pygments/pygments/pull/2881" ><date class="roboto-unscale math-font-normal" datetime="2025-03-30T13:40:29Z" title="2025-03-30T13:40:29Z">2025-03-30</date> <strong>pygments/pygments</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">2881</span></a>:<!--"--> Guesses HLSL code as "tsql" instead of HLSL/C/C++ despite "tsql" yielding errors<!--"--></li>
 <p>Bonus bugs from writing the <em>post</em>:</p>
 <li>
  <h4 id="network-effect-mathjax" class="continuing"><a class="hash-link" href="#network-effect-mathjax">#</a> mathjax/MathJax<span style="font-weight: initial;">:</span></h4>
  <ul style="padding-left: 1em;">
   <li><a href="//github.com/mathjax/MathJax/issues/3342" ><date class="roboto-unscale math-font-normal" datetime="2025-03-16T00:33:04Z" title="2025-03-16T00:33:04Z">2025-03-16</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3342</span></a>:<!--"--> AsciiMath input partially explodes on matrices, TeX handles them fine<!--"--></li>
   <li><a href="//github.com/mathjax/MathJax/issues/3343" ><date class="roboto-unscale math-font-normal" datetime="2025-03-16T13:37:05Z" title="2025-03-16T13:37:05Z">2025-03-16</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3343</span></a>:<!--"--> AsciiMath turns <samp>f(\(a, b\))</samp> into <samp>f(a b)a, b)</samp>?<!--"--></li>
   <li><a href="//github.com/mathjax/MathJax/issues/3344" ><date class="roboto-unscale math-font-normal" datetime="2025-03-17T13:41:47Z" title="2025-03-17T13:41:47Z">2025-03-17</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3344</span></a>:<!--"--> Matrices render goofy in CHTML, fine with SVG<!--"--></li>
   <li><a href="//github.com/mathjax/MathJax/issues/3345" ><date class="roboto-unscale math-font-normal" datetime="2025-03-17T14:44:24Z" title="2025-03-17T14:44:24Z">2025-03-17</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3345</span></a>:<!--"--> Opening page with SVG renderer explodes the parser on <samp>\color</samp> statements; setting to CHTML and reloading works, and then setting to SVG draws mostly-correctly<!--"--></li>
   <li><a href="//github.com/mathjax/MathJax/issues/3354" ><date class="roboto-unscale math-font-normal" datetime="2025-04-06T14:24:21Z" title="2025-04-06T14:24:21Z">2025-04-06</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3354</span></a>:<!--"--> ^F search highlight broken<!--"--></li>
   <li><a href="//github.com/mathjax/MathJax/issues/3355" ><date class="roboto-unscale math-font-normal" datetime="2025-04-06T14:27:08Z" title="2025-04-06T14:27:08Z">2025-04-06</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3355</span></a>:<!--"--> ^F search "whole word" mode broken<!--"--></li>
   <li><a href="//github.com/mathjax/MathJax/issues/3357" ><date class="roboto-unscale math-font-normal" datetime="2025-04-08T21:59:53Z" title="2025-04-08T21:59:53Z">2025-04-08</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3357</span></a>:<!--"--> <samp>\overline</samp> displayed varyingly as an overline or as nothing depending on font size<!--"--></li>
  </ul>
 </li>
 <p></p>
 <li><a href="//bugs.debian.org/1101435" ><date class="roboto-unscale math-font-normal" datetime="2025-03-27T15:46:56+01:00" title="2025-03-27T15:46:56+01:00">2025-03-27</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1101435</span></a>:<!--"--> /usr/bin/<strong>pyftsubset</strong>: ModuleNotFoundError: No module named 'zopfli' with <samp>--flavor=woff</samp><!--"--></li>
 <li><a href="//bugzilla.mozilla.org/show_bug.cgi?id=1957125" ><date class="roboto-unscale math-font-normal" datetime="2025-03-28T11:17 PDT" title="2025-03-28T11:17 PDT">2025-03-28</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1957125</span></a>:<!--"--> Link/object bounding box no longer matches the reality of the link/object<!--"--></li>
 <li><a href="//bugzilla.mozilla.org/show_bug.cgi?id=1957298" ><date class="roboto-unscale math-font-normal" datetime="2025-03-30T09:34 PDT" title="2025-03-30T09:34 PDT">2025-03-30</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1957298</span></a>:<!--"--> When updating URL with <samp>#:~:text=</samp> anchor, highlight is added for the new referenced text, but it does not replace the previous ones<!--"--></li>
 <li><a href="//bugzilla.mozilla.org/show_bug.cgi?id=1960124" ><date class="roboto-unscale math-font-normal" datetime="2025-04-11T20:20 PDT" title="2025-04-11T20:20 PDT">2025-04-11</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1960124</span></a>:<!--"--> "<code>data:text/html,&lt;table>&lt;caption>a&lt;caption>b&lt;td>c&lt;/table></code>" renders only <samp>a\nc</samp> — more than 1 <code>display: table-caption;</code> element is eaten<!--"--></li>
 <li><a href="//bugzilla.mozilla.org/show_bug.cgi?id=1960952" ><date class="roboto-unscale math-font-normal" datetime="2025-04-16T09:31 PDT" title="2025-04-16T09:31 PDT">2025-04-16</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1960952</span></a>:<!--"--> Ctrl+H creates history menu, then Ctrl+H again doesn't make the menu go away<!--"--></li>
 <li><a href="//bugzilla.mozilla.org/show_bug.cgi?id=1961886" ><date class="roboto-unscale math-font-normal" datetime="2025-04-22T10:49 PDT" title="2025-04-22T10:49 PDT">2025-04-22</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">1961886</span></a>:<!--"--> Table &lt;caption> children aren't focusable with Tab<!--"--></li>
 <li><a href="//github.com/PrismJS/prism/pull/3881" ><date class="roboto-unscale math-font-normal" datetime="2025-03-30T13:24:36Z" title="2025-03-30T13:24:36Z">2025-03-30</date> <strong>PrismJS/prism</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">3881</span></a>:<!--"--> HLSL <samp>#define</samp> not highlighted right (... or indeed overhighlighted): uniform <samp>.token.property</samp> applies, washing out the expression<!--"--></li>
 <p></p>
 <li>
  <h4 id="network-effect-blender" class="continuing"><a class="hash-link" href="#network-effect-blender">#</a> blender/blender<span style="font-weight: initial;">:</span></h4>
  <ul style="padding-left: 1em;">
   <li><a href="//projects.blender.org/blender/blender/issues/136787"><date class="roboto-unscale math-font-normal" datetime="2025-03-31T18:33:53+02:00" title="2025-03-31T18:33:53+02:00">2025-03-31</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">136787</span></a>:<!--"--> Default EEVEE renderer crashes-to-desktop when opening Material or Shading tabs<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/issues/136788"><date class="roboto-unscale math-font-normal" datetime="2025-03-31T18:35:52+02:00" title="2025-03-31T18:35:52+02:00">2025-03-31</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">136788</span></a>:<!--"--> 4.4.0 doesn't start at all<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/pulls/136803" ><date class="roboto-unscale math-font-normal" datetime="2025-04-01T02:37:55+02:00" title="2025-04-01T02:37:55+02:00">2025-04-01</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">136803</span></a>:<!--"--> Partially parse AMD driver versions to determine if they require legacy work-arounds instead of spot-checking<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/pulls/136839" ><date class="roboto-unscale math-font-normal" datetime="2025-04-01T16:53:54+02:00" title="2025-04-01T16:53:54+02:00">2025-04-01</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">136839</span></a>:<!--"--> Fix Makefile error erroring without the error message on Win32<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/issues/137112"><date class="roboto-unscale math-font-normal" datetime="2025-04-07T21:10:58+02:00" title="2025-04-07T21:10:58+02:00">2025-04-07</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137112</span></a>:<!--"--> The input map at the bottom of the screen doesn't indicate you can write Δxyz directly in Move operation (nothing else does, either, but this is where you'd expect it)<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/issues/137113"><date class="roboto-unscale math-font-normal" datetime="2025-04-07T21:15:40+02:00" title="2025-04-07T21:15:40+02:00">2025-04-07</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137113</span></a>:<!--"--> Impossible to tab backward when writing Δxyz directly in Move operation<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/pulls/137124" ><date class="roboto-unscale math-font-normal" datetime="2025-04-08T05:24:43+02:00" title="2025-04-08T05:24:43+02:00">2025-04-08</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137124</span></a>:<!--"--> Fix #137113: bind universal Shift+Tab to go back instead of Ctrl+Tab<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/issues/137357"><date class="roboto-unscale math-font-normal" datetime="2025-04-11T17:52:21+02:00" title="2025-04-11T17:52:21+02:00">2025-04-11</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137357</span></a>:<!--"--> Minimum accepted OpenColorIO, wayland-protocols, libvulkan-dev, OpenImageIO versions too low?<!--"--></li>
   <li><a href="//projects.blender.org/blender/blender/issues/137749"><date class="roboto-unscale math-font-normal" datetime="2025-04-18T23:58:29+02:00" title="2025-04-18T23:58:29+02:00">2025-04-18</date> #<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">137749</span></a>:<!--"--> Keyframes appear and disappear in the Timeline window depending on where the scrub head is, no filters applied <!--"--></li>
  </ul>
 </li>
 <p></p>
 <li><a href="//github.com/servo/servo/issues/36480" ><date class="roboto-unscale math-font-normal" datetime="2025-04-12T02:53:08Z" title="2025-04-12T02:53:08Z">2025-04-12</date> <strong>servo/servo</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">36480</span></a>:<!--"--> Links stop being links when... big page? or maybe some javascript?<!--"--></li>
 <li><a href="//github.com/servo/servo/issues/36481" ><date class="roboto-unscale math-font-normal" datetime="2025-04-12T03:04:39Z" title="2025-04-12T03:04:39Z">2025-04-12</date> <strong>servo/servo</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">36481</span></a>:<!--"--> Crashes for a bit then segfaults on MathJax-heavy page (also cites min-/max-content size. idk)<!--"--></li>
 <li><a href="//github.com/servo/servo/issues/36650" ><date class="roboto-unscale math-font-normal" datetime="2025-04-22T12:26:17Z" title="2025-04-22T12:26:17Z">2025-04-22</date> <strong>servo/servo</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">36650</span></a>:<!--"--> Segfaults on exit based on page contents(?) on Win32<!--"--></li>
 <li><a href="//github.com/matplotlib/matplotlib/issues/29912" ><date class="roboto-unscale math-font-normal" datetime="2025-04-13T17:32:23Z" title="2025-04-13T17:32:23Z">2025-04-13</date> <strong>matplotlib/matplotlib</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">29912</span></a>:<!--"--> [Bug]: findfont: Font family '&lt;font>' not found. despite being present and queriable via fontconfig; never makes it to <samp class="path">~/.cache/matplotlib/fontlist-v330.json</samp> either<!--"--></li>
 <li><a href="//github.com/matplotlib/matplotlib/issues/29913" ><date class="roboto-unscale math-font-normal" datetime="2025-04-13T18:00:50Z" title="2025-04-13T18:00:50Z">2025-04-13</date> <strong>matplotlib/matplotlib</strong>#<span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">29913</span></a>:<!--"--> [Bug]: <code>plt.ticklabel_format(style='plain')</code> puts the y axis label out of frame<!--"--></li>
 <li><a href="//bugs.kde.org/show_bug.cgi?id=503481" ><date class="roboto-unscale math-font-normal" datetime="2025-04-28T15:20Z" title="2025-04-28T15:20Z">2025-04-28</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">503481</span></a>:<!--"--> Moving cursor around in-image WYSIWYG copies text colour under cursor to everything else<!--"--></li>
 <li><a href="//bugs.kde.org/show_bug.cgi?id=503482" ><date class="roboto-unscale math-font-normal" datetime="2025-04-28T15:26Z" title="2025-04-28T15:26Z">2025-04-28</date> Bug <span style="font-family: 'RobotoSlab-Regular+tabdig', 'Roboto Slab', serif;">503482</span></a>:<!--"--> Subscript doesn't render correctly<!--"--></li>
</ul>
<p> 
 <br /> 
 Nit-pick? Correction? Improvement? Annoying? Cute? Anything? 
 <a href="mailto:nabijaczleweli@nabijaczleweli.xyz?subject=Notes on src/blogn_t/018-mean-shift-clusterer.html.pp">Mail</a>, 
 <a href="//101010.pl/@nabijaczleweli">post</a>, or <a href="//github.com/nabijaczleweli/nabijaczleweli.github.io/issues/new">open</a>! 
 </p> 
 </div>
<!-- CTNT_END --> <span id="wordcount_wrapper" class="hidden"> 
 <hr /> 
 <span id="word_count">0</span> words, 
 
 <span id="character_count">0</span> characters. 
 </span>
<!-- CTNT_END --> <hr style="padding-top: 1em;" /> 
 Creative text licensed under <a href="/content/LICENSE-CREATIVE">CC-BY-SA 4.0</a>, 
 code licensed under <a href="/content/LICENSE-CODE">The MIT License</a>. 
 <hr /> 
 This page is open-source, you can find it at <a href="//github.com/nabijaczleweli/nabijaczleweli.github.io/tree/dev">GitHub</a>, 
 and contribute and/or yell at me there. 
 <hr /> 
 Like what you see? Consider giving me a follow over at social medias listed <a href="/">here</a>, or maybe even a sending a <a style="display: inline-block; position: relative;" id="liberapay-btn" href="https://liberapay.com/nabijaczleweli/donate"> <svg class="dark-invert" style="position: absolute; top: 3px; width: 1em; height: 1em;"><use xlink:href="/assets/liberapay-logo.svg#top"></use></svg> <span style="margin-left: 19px;">buck</span> <span style="font-size: 0;">liberapay donate</span> </a> or <a href="//patreon.com/nabijaczleweli">two<span style="font-size: 0;"> patreon</span></a> my way if my software helped you in some significant way? 
 <hr /> 
 Compiled with Clang 19's<!--'--> C preprocessor on 13.09.2025 14:09:37 UTC from 
 <a href="https://github.com/nabijaczleweli/nabijaczleweli.github.io/blob/dev/src/blogn_t/018-mean-shift-clusterer.html.pp">src/blogn_t/018-mean-shift-clusterer.html.pp</a>. 
 <br /><a href="https://builds.sr.ht/~nabijaczleweli/job/1568997">See job on builds.sr.ht</a>. 
 <hr /> 
 <a href="/content/feed.xml" type="application/rss+xml" rel="alternate">RSS feed</a> 
 </body> 
 </html>
