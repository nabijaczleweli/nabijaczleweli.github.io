<!--
nabijaczleweli.xyz (c) by nabijaczleweli@gmail.com (nabijaczleweli)
​
nabijaczleweli.xyz is licensed under a
Creative Commons Attribution 4.0 International License.
​
You should have received a copy of the license along with this
work. If not, see <https://creativecommons.org/licenses/by/4.0/>.
-->
 <!-- RSS_PUB_DATE: "Sat, 28 Aug 2021 18:36:44 +0200" -->
<!DOCTYPE html> 
 <html lang="en-GB"> 
 <head> 
 <meta charset="utf-8"> 
 <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
 <meta name="viewport" content="width=device-width,initial-scale=1"> 
 <meta name="author" content="nabijaczleweli"> 
 <meta name="description" content="007. Cleanly enabling Cyrillic and broad Unicode output in groff -Tps"> 
 <title>007. Cleanly enabling Cyrillic and broad Unicode output in groff -Tps — blognꞌt — nabijaczleweli</title> 
 
 <link href="/content/assets/common.css" rel="stylesheet" /> 
 <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-touch-icon-57x57.png"> 
 <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-touch-icon-60x60.png"> 
 <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-touch-icon-72x72.png"> 
 <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-touch-icon-76x76.png"> 
 <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-touch-icon-114x114.png"> 
 <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-touch-icon-120x120.png"> 
 <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-touch-icon-144x144.png"> 
 <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-touch-icon-152x152.png"> 
 <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon-180x180.png"> 
 <link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32"> 
 <link rel="icon" type="image/png" href="/assets/favicons/android-chrome-192x192.png" sizes="192x192"> 
 <link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96"> 
 <link rel="icon" type="image/png" href="/assets/favicons/favicon-16x16.png" sizes="16x16"> 
 <link rel="manifest" href="/assets/favicons/manifest.json"> 
 <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5"> 
 <link rel="shortcut icon" href="/assets/favicons/favicon.ico"> 
 <meta name="apple-mobile-web-app-title" content="nabijaczleweli"> 
 <meta name="application-name" content="nabijaczleweli"> 
 <meta name="msapplication-TileColor" content="#da532c"> 
 <meta name="msapplication-TileImage" content="/assets/favicons/mstile-144x144.png"> 
 <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml"> 
 <meta name="color-scheme" content="dark light"> 
 <script> 
 (function() { 
 let m = navigator.userAgent.match(/Firefox\/([0-9]+)/); 
 if(m && parseInt(m[1]) < 96) 
 document.addEventListener("DOMContentLoaded", function() { 
 Array.from(document.getElementsByClassName("dark-invert")).forEach(function(e) { e.classList.remove("dark-invert"); }); 
 Array.from(document.querySelectorAll('source[media="(prefers-color-scheme: dark)"]')).forEach(function(e) { e.remove(); }); 
 }); 
 })(); 
 </script> 
 <link href="/content/assets/heading.css" rel="stylesheet" /> 
 <link href="/kaschism/assets/column.css" rel="stylesheet" /> 
 <link href="/content/assets/blogn_t.css" rel="stylesheet" /> 
 <link href="/content/assets/contents.css" rel="stylesheet" /> 
 <link href="../writing/Roboto-font.css" rel="stylesheet" /> 
 <link href="../writing/the_taste_of_mi/Merriweather-font.css" rel="stylesheet" /> 
 <link href="//fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet"> 
 <link href="/content/assets/prism-twilight.min.css" rel="stylesheet" /> <script type="text/javascript" src="/content/assets/syllable.js"></script> 
 <script type="text/javascript" src="/content/assets/pluralize.js"></script> 
 <script type="text/javascript" src="/content/assets/word_count.js"></script> 
 </head> 
 <body>
<style>
.continued {
 margin-bottom: 0;
}
.continuing {
 margin-top: 0;
 margin-bottom: 0;
}
.continuation {
 margin-top: 0;
}
code, samp {
 font-family: "Droid Sans Mono", monospace;
}
h1, h2, h3, h4, h5, h6, summary {
 font-family: "Merriweather", serif;
}
h1:hover a.hash-link,
h2:hover a.hash-link,
h3:hover a.hash-link,
h4:hover a.hash-link,
h5:hover a.hash-link,
h6:hover a.hash-link,
summary:hover a.hash-link {
 visibility: visible;
 opacity: 1;
}
h1 a.hash-link,
h2 a.hash-link,
h3 a.hash-link,
h4 a.hash-link,
h5 a.hash-link,
h6 a.hash-link,
summary a.hash-link {
 float: left;
 visibility: hidden;
 opacity: 0;
 padding-right: calc(1em / 5.5);
 margin-left: calc(-1em / 1.1);
  transition: all 0.5s;
}
h1 a.hash-link, h2 a.hash-link, h3 a.hash-link, h4 a.hash-link, h5 a.hash-link, h6 a.hash-link, summary a.hash-link,
a .fa, a .far, a .fab, a [class*="icon"], a [class*="devicon"],
a.fa, a.far, a.fab, a[class*="icon"], a[class*="devicon"] {
 color: inherit;
 text-decoration: none;
}
.indented {
 text-indent: 1em;
}

.fragment {
 max-width: 100%;
}
.main-font {
 margin-top: 0.15em;
 margin-bottom: 0.15em;
 max-width: 100%;
}
ol.wide-explanation {
 padding-left: 1em; /* matches .indented  */
}
ol.wide-explanation > li {
 margin-bottom: 0.9em;
}
@media all and (min-device-width: 400px) {
 .main-font {
  width: 100%;
 }
}
@media all and (min-device-width: 800px) {
 .main-font {
  margin-left: 1em;
  min-width: 75%;
 }
}
</style>
<span class="roboto writing">
<p></p>
<h2 id="go-back" class="merriweather"><a class="go-back-link left" href=".">↩</a> <samp>007. Cleanly enabling Cyrillic and broad Unicode output in groff -Tps</samp> <a class="go-back-link right" href=".">↩</a></h2> 
 <h4 id="post-date"><span style="white-space: nowrap">Sat, 28 Aug 2021 18:36:44 +0200</span>, updated Thu, 02 Sep 2021 20:41:02 +0200, Wed, 22 Jun 2022 18:33:54 +0200, and Wed, 14 Jun 2023 14:46:03 +0200</h4> 
 <!--BLOGN_T_TOC_PLACEHOLDER-->
<div style='position: relative;'><details id='contents'><summary><h2>Contents</h2></summary><ol>
<ol>
<li><a href='#prior-art'>Prior art</a></li>
<li><a href='#current-art'>Current art</a></li>
<li><a href='#alternative-art'>Alternative art</a></li>
<ol>
<li><a href='#alternative-art-foreign-font'>A foreign font</a></li>
<li><a href='#alternative-art-distribution-font'>A distribution font</a></li>
</ol>
<li><a href='#jajco'><a style="color: inherit;" href="//web.archive.org/web/20210823140236/twitter.com/kgbcatboy/status/1429605955994533889">\nЯЙЦО</a></a></li>
</ol>
</details></div>
<p>
 (This produced favourable results pre-bookworm, with <a href="//packages.debian.org/bullseye/gsfonts"><tt>gsfonts</tt></a> fonts.
  Since, with <tt>fonts-urw-base35</tt> fonts, the font quality is drastically reduced –
  the metrics appear to be off for groff <code>.Bl</code> use, the arrows are horrific, <tt>*</tt> appears broken entirely, &c.;
  <tt>afmtodit</tt> complains even when compiling.
  I'<!--'-->m continuing to use the <a href="/content/assets/blogn_t/007.11-bullseye.tar.zst">bullseye fonts</a> for the bookworm release cycle.)
</p>
<!-- With manual corrections and welding the separately-highlit AWK bits:
for f in {C,T}{R,B,I,BI}; do
 in="$(awk '$1 == "internalname" {print $2; exit}' "/usr/share/groff/current/font/devps/$f")";
 echo $f: $in;
 src="$(awk -v cur="/$in" '   #"
  $1 ~ /^\// && $2 ~ /^[\/\(]/ {
   if($2 ~ /^\//)
    aliases[$1] = $2;
   else
    paths[$1] = $2;
  }
  END {
   while(cur in aliases)
    cur = aliases[cur];
   if(cur in paths) {
    sub(/^\(/, "", paths[cur]);
    sub(/(pfb|t1)?\)$/, "", paths[cur]);
    print paths[cur]
   } else {
    print "last: " cur > "/dev/stderr";
    exit 1
   }
  }' /var/lib/ghostscript/fonts/Fontmap)";  #'
 echo "${src}afm; $(expr "$f" : C > /dev/null && echo -nk)"
 afmtodit $([ "${f#C}" = "$f" ] || echo -nk) -cmi0 -d /usr/share/groff/current/font/devps/DESC -e /usr/share/groff/current/font/devps/text.enc "${src}afm" /usr/share/groff/current/font/devps/generate/textmap "$f";
done
-->
<div class="bigcode continued">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mkdir</span> devps</span><span class="token punctuation">;</span> <span class="token bash language-bash"><span class="token keyword">cd</span> devps</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>C,T<span class="token punctuation">}</span><span class="token punctuation">{</span>R,B,I,BI<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span></span></span>
<span class="token info punctuation"><!--"-->  	<!--"-->in="</span><span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash"><span class="token punctuation">(</span>awk <span class="token string">'</span><span class="language-awk">$1 == <span class="token string">"internalname"</span> {<span class="token builtin">print</span> $2; <span class="token keyword">exit</span>}</span><span class="token string">'</span> <span class="token string">"/usr/share/groff/current/font/devps/<span class="token variable">$f</span>"</span><span class="token punctuation">)</span><span class="token info punctuation">"</span><span class="token punctuation">;</span></span></span>
<!--"-->  	<!--"--><span class="token builtin class-name">echo</span> <span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash">f: <span class="token shell-symbol important">$</span>in<span class="token punctuation">;</span></span></span>
<span class="token info punctuation"><!--"-->  	<!--"-->src="</span><span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash"><span class="token punctuation">(</span>awk -v <span class="token assign-left variable">cur</span><span class="token operator">=</span><span class="token string">"/<span class="token variable">$in</span>"</span> <span class="token string">'</span><!--"--> <!--"--><!--"-->
<span class="language-awk"><!--"-->  		<!--"-->$1 ~ <span class="token regex">/^\//</span> &amp;&amp; $2 ~ <span class="token regex">/^[\/\(]/</span> {
<!--"-->  			<!--"--><span class="token keyword">if</span>($2 ~ <span class="token regex">/^\//</span>)
<!--"-->  				<!--"-->aliases[$1] = $2;
<!--"-->  			<!--"--><span class="token keyword">else</span>
<!--"-->  				<!--"-->paths[$1] = $2;
<!--"-->  		<!--"-->}
<!--"-->  		<!--"--><span class="token keyword">END</span> {
<!--"-->  			<!--"--><span class="token keyword">while</span>(cur <span class="token keyword">in</span> aliases)
<!--"-->  				<!--"-->cur = aliases[cur];
<!--"-->  			<!--"--><span class="token keyword">if</span>(cur <span class="token keyword">in</span> paths) {
<!--"-->  				<!--"--><span class="token builtin">sub</span>(<span class="token regex">/^\(/</span>, <span class="token string">""</span>, paths[cur]);
<!--"-->  				<!--"--><span class="token builtin">sub</span>(<span class="token regex">/(pfb|t1)?\)$/</span>, <span class="token string">""</span>, paths[cur]);
<!--"-->  				<!--"--><span class="token builtin">print</span> paths[cur]
<!--"-->  			<!--"-->} <span class="token keyword">else</span> {
<!--"-->  				<!--"--><span class="token builtin">print</span> <span class="token string">"last: "</span> cur > <span class="token string">"/dev/stderr"</span>;
<!--"-->  				<!--"--><span class="token keyword">exit</span> 1
<!--"-->  			<!--"-->}
<!--"-->  		<!--"-->}</span><span class="token string">'</span> /var/lib/ghostscript/fonts/Fontmap<span class="token punctuation">)</span><span class="token info punctuation">"</span><span class="token punctuation">;</span></span></span><!--"-->  <!--"--><!--'-->
<!--"-->  	<!--"--><span class="token builtin class-name">echo</span> <span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash"><span class="token punctuation">{</span>src<span class="token punctuation">}</span>afm<span class="token punctuation">;</span></span></span>
<!--"-->  	<!--"-->afmtodit <span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash"><span class="token punctuation">(</span><span class="token keyword">[</span> <span class="token string">"<span class="token variable">${f#C}</span>"</span> = <span class="token string">"<span class="token variable">$f</span>"</span> <span class="token keyword">]</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> -kn<span class="token punctuation">)</span> -cmi<span class="token number">0</span> \
<!--"-->  		<!--"-->-d /usr/share/groff/current/font/devps/DESC \
<!--"-->  		<!--"-->-e /usr/share/groff/current/font/devps/text.enc \
<!--"-->  		<!--"--><span class="token string">"<span class="token variable">${src}</span>afm"</span> /usr/share/groff/current/font/devps/generate/textmap <span class="token string">"<span class="token variable">$f</span>"</span><span class="token punctuation">;</span></span></span>
<!--"-->  <!--"--><span class="token keyword">done</span>
CR: Courier
/usr/share/fonts/type1/gsfonts/n022003l.afm
CB: Courier-Bold
/usr/share/fonts/type1/gsfonts/n022004l.afm
CI: Courier-Oblique
/usr/share/fonts/type1/gsfonts/n022023l.afm
CBI: Courier-BoldOblique
/usr/share/fonts/type1/gsfonts/n022024l.afm
TR: Times-Roman
/usr/share/fonts/type1/gsfonts/n021003l.afm
TB: Times-Bold
/usr/share/fonts/type1/gsfonts/n021004l.afm
TI: Times-Italic
/usr/share/fonts/type1/gsfonts/n021023l.afm
TBI: Times-BoldItalic
/usr/share/fonts/type1/gsfonts/n021024l.afm
</span><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token function">ln</span> -s /usr/local/share/groff/site-font /usr/share/groff</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token function">mkdir</span> -p /usr/local/share/groff/site-font</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token function">cp</span> -r ../devps /usr/local/share/groff/site-font</span></span>
</pre></code>
</div>
<p class="indented continuing">
That's it. Same exact fonts as groff was already using, but with the appropriate metrics;  <!--'-->
on Debian — where all of these are Nimbus variants — this includes Cyrillic and the extended Latin planes, among others,
because unlike <code>Times</code>, Nimbus is an actual font.
<a href="/content/assets/blogn_t/007.01-result.pdf">Render</a> with <code>groff -Kutf8 …</code>:
</p>
<!-- gs -d{Text,Graphics}AlphaBits=4 -dSAFER -dBATCH -dNOPAUSE -sDEVICE=pngmono -r600 -sOutputFile=976.png ~/PDF/job_976-stdin___jaczleweli_PDF.pdf -->
<a href="/content/assets/blogn_t/007.01-result.png"><img class="continuation main-font dark-invert" alt="Example manual page with Cyrillic and Polish characters" src="/content/assets/blogn_t/007.01-result.png" /></a>
<p class="indented">
Versions of this document prior to
Wed, 22 Jun 2022 18:33:54 +0200
didn't specify  <!--'-->
<kbd>-k</kbd>
to remove kerning on fixed-width fonts,
which <a href="//lfs.nabijaczleweli.xyz/0017-twitter-export#1539638664548044800">broke</a> alignment in space-delimited tables.
We apologise for the error.
</p>
<h2 id="prior-art" class="continued"><a class="hash-link" href="#prior-art">#</a> Prior art</h2>
<p class="indented continuing">
We've all been there, writing a manual that needs example text wider than US-ASCII, or to accredit a Russian.  <!--'-->
groff provides <samp>ć</samp> as <kbd>\['c]</kbd> and <samp>ł</samp> as <kbd>\[/l]</kbd>, gracefully noting that the latter is Polish, and that's about it.
It, of course, is rather tempting to, then, "just write something", as it is, after all, anno domini twenty twenty.
This yields:
</p>
<div class="bigcode continuing">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token info punctuation"><span class="token user">nabijaczleweli@tarta</span><span class="token punctuation">:</span><span class="token path">~/uwu</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">groff -Tps -mdoc -tp </span></span><span class="token output">&lt; frag.1 | lp -dPDF
pic:&lt;standard input>:10: invalid input character code 128
pic:&lt;standard input>:14: invalid input character code 128
pic:&lt;standard input>:52: invalid input character code 129
pic:&lt;standard input>:52: invalid input character code 132
pic:&lt;standard input>:52: invalid input character code 152
pic:&lt;standard input>:52: invalid input character code 134
pic:&lt;standard input>:52: invalid input character code 131
pic:&lt;standard input>:52: invalid input character code 130
pic:&lt;standard input>:52: invalid input character code 133
pic:&lt;standard input>:52: invalid input character code 153
pic:&lt;standard input>:52: invalid input character code 135
pic:&lt;standard input>:52: invalid input character code 132
pic:&lt;standard input>:54: invalid input character code 128
pic:&lt;standard input>:82: invalid input character code 143
pic:&lt;standard input>:82: invalid input character code 134
pic:&lt;standard input>:82: invalid input character code 153
pic:&lt;standard input>:82: invalid input character code 158
pic:&lt;standard input>:82: invalid input character code 143
pic:&lt;standard input>:82: invalid input character code 134
pic:&lt;standard input>:82: invalid input character code 153
pic:&lt;standard input>:82: invalid input character code 158
pic:&lt;standard input>:82: invalid input character code 143
pic:&lt;standard input>:82: invalid input character code 134
pic:&lt;standard input>:82: invalid input character code 153
pic:&lt;standard input>:82: invalid input character code 158
pic:&lt;standard input>:82: invalid input character code 143
pic:&lt;standard input>:82: invalid input character code 134
pic:&lt;standard input>:82: invalid input character code 153
pic:&lt;standard input>:82: invalid input character code 158
pic:&lt;standard input>:82: invalid input character code 143
pic:&lt;standard input>:82: invalid input character code 134
pic:&lt;standard input>:82: invalid input character code 153
pic:&lt;standard input>:82: invalid input character code 158
pic:&lt;standard input>:82: invalid input character code 143
pic:&lt;standard input>:82: invalid input character code 134
pic:&lt;standard input>:82: invalid input character code 153
pic:&lt;standard input>:82: invalid input character code 158
pic:&lt;standard input>:83: invalid input character code 143
pic:&lt;standard input>:83: invalid input character code 134
pic:&lt;standard input>:83: invalid input character code 143
pic:&lt;standard input>:83: invalid input character code 134
pic:&lt;standard input>:83: invalid input character code 143
pic:&lt;standard input>:83: invalid input character code 134
pic:&lt;standard input>:83: invalid input character code 143
pic:&lt;standard input>:83: invalid input character code 134
pic:&lt;standard input>:83: invalid input character code 143
pic:&lt;standard input>:83: invalid input character code 134
pic:&lt;standard input>:84: invalid input character code 158
pic:&lt;standard input>:84: invalid input character code 158
pic:&lt;standard input>:84: invalid input character code 158
pic:&lt;standard input>:84: invalid input character code 158
pic:&lt;standard input>:84: invalid input character code 158
pic:&lt;standard input>:100: invalid input character code 129
pic:&lt;standard input>:100: invalid input character code 132
pic:&lt;standard input>:100: invalid input character code 152
pic:&lt;standard input>:100: invalid input character code 134
pic:&lt;standard input>:100: invalid input character code 131
pic:&lt;standard input>:100: invalid input character code 130
pic:&lt;standard input>:100: invalid input character code 133
pic:&lt;standard input>:100: invalid input character code 153
pic:&lt;standard input>:100: invalid input character code 135
pic:&lt;standard input>:100: invalid input character code 132
request id is PDF-978 (0 file(s))
</span></pre></code>
</div>
<p class="continuing">
<a href="/content/assets/blogn_t/007.02-original.pdf">And</a>:
</p>
<a href="/content/assets/blogn_t/007.02-original.png"><img class="continuation main-font dark-invert" alt="Same page, but non-ASCII characters are replaced with garbage, usually variant on the 'Å'" src="/content/assets/blogn_t/007.02-original.png" /></a>
<p class="indented continued">
A great time!
The Arch Wiki says that to <a href="//wiki.archlinux.org/title/Groff#Correctly_display_Polish_diacritics">"Correctly display Polish diacritics"</a>,
you can <code>groff -Kutf8 -Tdvi -mec -ms test.ms > test.dvi</code>, so:
</p>
<div class="bigcode continuing">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token info punctuation"><span class="token user">nabijaczleweli@tarta</span><span class="token punctuation">:</span><span class="token path">~/uwu</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">groff -Kutf8 -Tps -mdoc -tp </span></span><span class="token output">&lt; frag.1 | lp -dPDF
troff: &lt;standard input>:52: warning: can't find special character 'u0041_0328'
troff: &lt;standard input>:52: warning: can't find special character 'u0045_0328'
troff: &lt;standard input>:52: warning: can't find special character 'u005A_0307'
troff: &lt;standard input>:52: warning: can't find special character 'u005A_0301'
troff: &lt;standard input>:52: warning: can't find special character 'u004E_0301'
troff: &lt;standard input>:52: warning: can't find special character 'u0061_0328'
troff: &lt;standard input>:52: warning: can't find special character 'u0065_0328'
troff: &lt;standard input>:52: warning: can't find special character 'u007A_0307'
troff: &lt;standard input>:52: warning: can't find special character 'u007A_0301'
troff: &lt;standard input>:52: warning: can't find special character 'u006E_0301'
troff: &lt;standard input>:82: warning: can't find special character 'u044F'
troff: &lt;standard input>:82: warning: can't find special character 'u0438_0306'
troff: &lt;standard input>:82: warning: can't find special character 'u0446'
troff: &lt;standard input>:82: warning: can't find special character 'u043E'
troff: &lt;standard input>:82: warning: can't find special character 'u042F'
troff: &lt;standard input>:82: warning: can't find special character 'u0418_0306'
troff: &lt;standard input>:82: warning: can't find special character 'u0426'
troff: &lt;standard input>:82: warning: can't find special character 'u041E'
request id is PDF-979 (0 file(s))
</span></pre></code>
</div>
<p class="continuing">
<a href="/content/assets/blogn_t/007.03-Kutf8.pdf">And</a>:
</p>
<a href="/content/assets/blogn_t/007.03-Kutf8.png"><img class="continuation main-font dark-invert" alt="Same page, the ellipsis is rendered, but non-ASCII characters apart from ŁĆ are entirely missing" src="/content/assets/blogn_t/007.03-Kutf8.png" /></a>
<p class="indented">
This is, arguably, not better – <kbd>ł</kbd>, <kbd>ć</kbd>, and the ellipsis have appeared, but everything else <em>dis</em>appeared.
It's unclear why exactly those three, considering the ellipsis can't be reached by a classic <samp>groff_char(7)</samp> escape,
and all three become <code>\[uXXXX]</code>-style escapes after passing through preconv.
</p>
<p class="indented continued">
The same Arch Wiki article says that as part of "Adding support for cyrillic fonts",
you can preprocess with <code>iconv -f utf-8 -t koi8-r</code>.
<!-- ftp://ftp.kapella.gpi.ru/pub/cyrillic/psfonts -->
This is preceded by downloading an unspecified font pack out of about 8 from a Russian FTP,
aided by the READMEs therein also being in KOI8-R (i.e. '<samp>�</samp>' in UTF-8),
and mangling the Ghostscript font map into pointing at that font for <samp>Times-Roman</samp>.
</p>
<p class="indented continuation">
It's impossible to tell how the author expects literally any other Times variant (<samp>TI</samp>, <samp>TB</samp>, <samp>TBI</samp>),  <!--'-->
or any of the four fixed-width fonts, to render Cyrillic.
And it ignores the obvious point that it <em>replaces the font</em>, which means the pages <em>will</em> look different.
</p>
<p class="indented continued">
It's only reasonable to expect the Russosphere to have some sort of answer to this, and,   <!--'-->
indeed, <a href="//linuxtravel.blogspot.com/2015/03/cygwin-groff-cyrillic-russian-fonts.html">a 2015 post</a> has a workable solution;
it rambles and arrives at its point round-aboutly, converting to <em>and</em> from KOI8-R, as well as requiring a <code>ru.tmac</code> package
(not included, but can be found on the groff mailing list, as can a plethora of other hacks of varying insanity) which isn't required at all; however:  <!--'-->
</p>
<blockquote class="continuing">
More formally, <b>groff</b> does not have metrics for russian fonts. But I do have! I have metrics for Times fonts and I need to put them into /usr/share/groff/current/font/devps, replacing already existing. My metrics are in <u>devps.tar</u> attach.
</blockquote>
<p class="continuing">
Indeed! <code>devps.tar</code> contains a perfectly serviceable set of <code>usr/share/groff/current/font/devps/T{R,B,I,BI}</code> metrics:
</p>
<div class="bigcode continuing">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token info punctuation"><span class="token user">nabijaczleweli@tarta</span><span class="token punctuation">:</span><span class="token path">~/uwu</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">groff -Kutf8 -Tps -mdoc -tp </span></span><span class="token output">&lt; frag.1 | lp -dPDF
troff: &lt;standard input>:82: warning: can't find special character 'u044F'
troff: &lt;standard input>:82: warning: can't find special character 'u0438_0306'
troff: &lt;standard input>:82: warning: can't find special character 'u0446'
troff: &lt;standard input>:82: warning: can't find special character 'u043E'
troff: &lt;standard input>:82: warning: can't find special character 'u042F'
troff: &lt;standard input>:82: warning: can't find special character 'u0418_0306'
troff: &lt;standard input>:82: warning: can't find special character 'u0426'
troff: &lt;standard input>:82: warning: can't find special character 'u041E'
troff: &lt;standard input>:100: warning: can't find special character 'u0041_0328'
troff: &lt;standard input>:100: warning: can't find special character 'u0045_0328'
troff: &lt;standard input>:100: warning: can't find special character 'u005A_0307'
troff: &lt;standard input>:100: warning: can't find special character 'u005A_0301'
troff: &lt;standard input>:100: warning: can't find special character 'u004E_0301'
troff: &lt;standard input>:100: warning: can't find special character 'u0061_0328'
troff: &lt;standard input>:100: warning: can't find special character 'u0065_0328'
troff: &lt;standard input>:100: warning: can't find special character 'u007A_0307'
troff: &lt;standard input>:100: warning: can't find special character 'u007A_0301'
troff: &lt;standard input>:100: warning: can't find special character 'u006E_0301'
request id is PDF-980 (0 file(s))
</span></pre></code>
</div>
<p class="continuing">
<a href="/content/assets/blogn_t/007.04-linuxtravels.pdf">Rendering to</a>:
</p>
<a href="/content/assets/blogn_t/007.04-linuxtravels.png"><img class="continuation main-font dark-invert" alt="Same page, proportional non-ASCII characters rendered, monospace ones missing" src="/content/assets/blogn_t/007.04-linuxtravels.png" /></a>
<p class="indented">
A cursory inspection of the metric reveals that they're for <code>internalname NimbusRomNo9L-Regu</code> and friends,  <!--'-->
generated Thu Aug 2 13:14:49 2007, as was the Nimbus in Buster;
a cursory correlation with the provided <code>Fontmap</code> reveals that the mappings are as today.
But it's still undistributable, still missing the Courier variants, and, regardless, still quite different from a metric generated with up-to-date groff.  <!--'-->
</p>
<h2 id="current-art" class="continued"><a class="hash-link" href="#current-art">#</a> Current art</h2>
<p class="continuing">
This is the bit where I vaguely explain how that big hunk at the top generates the unsolvable:
</p>
<ol class="wide-explanation continuation">
 <li><code>/usr/share/groff/current/font/devps/DESC</code> says that there's the usual four styles  <!--'-->
     (<code>R</code>, <code>B</code>, <code>I</code>, and <code>BI</code>),
     and that the default family is <code>T</code>; there's no point in getting cute and parsing this.</li>  <!--'-->
 <li>groff font metrics have an <code>internalname</code> directive, corresponding to the PostScript font requested
     (for <code>TI</code> it's <code>Times-Italic</code>, for <code>CI</code> it's <code>Courier-Oblique</code>, &amp;c.).</li>
 <li>The Ghostscript font map (<code>/var/lib/ghostscript/fonts/Fontmap</code> from <code>/etc/ghostscript/fontmap.d/*</code> by <code>update-gsfontmap</code>)
     is used to override font paths and alias fonts to others (well, it's arbitrary Ghostscript code that happens to match font names,  <!--'-->
     but doing anything besides name/alias/path mapping has thankfully <a href="//wiki.debian.org/gs-undefoma#line-254">died down</a> as a practice),
     with the interesting mappings being in the format:
   <div class="bigcode continuing">
<pre class="language-plaintext"><code class="language-plaintext">/NimbusRomNo9L-ReguItal (/usr/share/fonts/type1/gsfonts/n021023l.pfb) ;
/Times-Italic /NimbusRomNo9L-ReguItal ;
/NimbusMonL-ReguObli (/usr/share/fonts/type1/gsfonts/n022023l.pfb) ;
/Courier-Oblique /NimbusMonL-ReguObli ;
</pre></code>
 </div>
     This can be trivially walked by first exhausting all name/name mappings, then resolving the final name/path mapping.</li>
 <li>For each font in <code>/usr/share/fonts/type1/gsfonts/</code>, there are three files:
     <div class="bigcode continuing">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token info punctuation"><span class="token user">nabijaczleweli@tarta</span><span class="token punctuation">:</span><span class="token path">~/uwu/devps</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">file</span> /usr/share/fonts/type1/gsfonts/<span class="token punctuation">{</span>n022004l,n022023l<span class="token punctuation">}</span>.*</span></span>
<span class="token output">/usr/share/fonts/type1/gsfonts/n022004l.afm: ASCII font metrics
/usr/share/fonts/type1/gsfonts/n022004l.pfb: PostScript Type 1 font program data
/usr/share/fonts/type1/gsfonts/n022004l.pfm: Printer Font Metrics NimbusMonL-Bold, 2738 bytes, Nimbus Mono L bold

/usr/share/fonts/type1/gsfonts/n022023l.afm: ASCII font metrics
/usr/share/fonts/type1/gsfonts/n022023l.pfb: PostScript Type 1 font program data
/usr/share/fonts/type1/gsfonts/n022023l.pfm: Printer Font Metrics NimbusMonL-ReguObli, 2742 bytes, Nimbus Mono L italic
</span></pre></code>
 </div>
     The second is the actual font, the other two are metrics.</li>
 <li>These metrics must be converted to groff's internal format,  <!--'-->
     the flags gracefully provided by <code>/usr/share/groff/current/font/devps/generate/Makefile</code>;
     <code>-n</code>, disabling <code>ligature</code> output, only applies to monospace fonts, because ligaturised tables are nightmarish:
<a href="/content/assets/blogn_t/007.07-ligaturised.png"><img class="fragment dark-invert" alt="Tab-aligned /etc/passwd, one of the usernames is 'fifl', both pairs ligaturised throwing the second through fourth columns two columns left out of alignment, and the fifth four" src="/content/assets/blogn_t/007.07-ligaturised.png" /></a>
     ).</li>
 <li>groff searches for site-specific fonts in <code>/usr/share/groff/site-font/dev<em>DEV</em></code>.</li>
</ol>
<p class="continued">
This is not without its own delta from the original:
</p>
<a href="/content/assets/blogn_t/007.08-diff.png"><img class="continuing main-font dark-invert" alt="Visual diff between the page with no non-ASCII characters and the one with them; the differences stack up most toward the end of the line on about half of the lines, and are within antialiasing noise on the other half" src="/content/assets/blogn_t/007.08-diff.png" /></a>
<p class="continuing">
But these differences are not only minute even at their worst (1.92pt in the synopsis line, 0.96pt in the third description line),
but a result of the tighter kerning matching the font better.
</p>
<h2 id="alternative-art" class="continued"><a class="hash-link" href="#alternative-art">#</a> Alternative art</h2>
<p class="indented continuation">
In the three-day process of "printing a cyrillic document in 2020", I've also done what <code>grops(1)</code> says you can,  <!--'-->
but is clasically unhelpful in achieving, so:
</p>
<h3 id="alternative-art-foreign-font" class="continued"><a class="hash-link" href="#alternative-art-foreign-font">#</a> A foreign font</h3>
<p class="indented continuing">
In this case: <a href="//dimkanovikov.pro/courierprime/">Курьер Прайм</a>, a Courier Prime with Cyrillic characters, that, unlike the latter,
isn't in Debian (merging them is an <a href="//bugs.debian.org/992739">ongoing adventure</a>):  <!--'-->
</p>
<!-- This, but manually fixed:
$ unzip ../courierprime.zip
Archive: ../courierprime.zip
  inflating: Courier-Prime-Italic.ttf
  inflating: Courier-Prime-Bold.ttf
  inflating: Courier-Prime.ttf
  inflating: Courier-Prime-Bold-Italic.ttf
$ for v in "" -Bold -Italic -Bold-Italic; do
   for f in afm pfa; do
    fontforge -c 'import sys; fontforge.open(sys.argv[1]).generate(sys.argv[2])' Courier-Prime$v.ttf Courier-Prime$v.$f &
   done
  done
‌# ...
Warning: Mac and Windows entries in the 'name' table differ for the
 Fullname string in the language English (US)
 Mac String: Courier Prime Bold Italic
Windows String: CourierPrime-BoldItalic
‌# cp *.pfa /usr/local/share/groff/site-font/devps/
$ for v in "" -Bold -Italic -Bold-Italic; do
   afmtodit -ncmi0 -d /usr/share/groff/current/font/devps/DESC -e /usr/share/groff/current/font/devps/text.enc Courier-Prime$v.afm /usr/share/groff/current/font/devps/generate/textmap "C$(expr "$(echo $v | tr -d '[:lower:]-')" \| R)";
  done
‌# cp C{R,B,I,BI} /usr/local/share/groff/site-font/devps/
‌# {
   cat /usr/share/groff/current/font/devps/download; echo;
   for v in "" -Bold -Italic -Bold-Italic; do
    printf "%s\t%s\n" CourierPrime${v/d-I/dI} Courier-Prime$v.pfa;
   done;
  } | tee /usr/local/share/groff/site-font/devps/download
‌# List of downloadable fonts
‌# PostScript-name Filename
Symbol-Slanted symbolsl.pfa
ZapfDingbats-Reverse zapfdr.pfa
FreeEuro freeeuro.pfa
CourierPrime Courier-Prime.pfa
CourierPrime-Bold Courier-Prime-Bold.pfa
CourierPrime-Italic Courier-Prime-Italic.pfa
CourierPrime-BoldItalic Courier-Prime-Bold-Italic.pfa
-->
<div class="bigcode continuing">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">unzip</span> <span class="token punctuation">..</span>/courierprime.zip</span></span>
<span class="token output">Archive:<!--"-->  <!--"-->../courierprime.zip
<!--"-->  <!--"-->inflating: Courier-Prime-Italic.ttf
<!--"-->  <!--"-->inflating: Courier-Prime-Bold.ttf
<!--"-->  <!--"-->inflating: Courier-Prime.ttf
<!--"-->  <!--"-->inflating: Courier-Prime-Bold-Italic.ttf
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">v</span> <span class="token keyword">in</span> <span class="token string">""</span> -Bold -Italic -Bold-Italic<span class="token punctuation">;</span> <span class="token keyword">do</span></span></span>
<span class="token output"><!--"-->  	<!--"--><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> afm pfa<span class="token punctuation">;</span> <span class="token keyword">do</span></span></span>
</span><!--"-->  		<!--"--><span class="token bash language-bash">fontforge -c <span class="token string">'import sys; fontforge.open(sys.argv[1]).generate(sys.argv[2])'</span> </span></span><span class="token output">\
</span><!--"-->  			<!--"--><span class="token string">Courier-Prime$v.ttf</span> <span class="token string">Courier-Prime<span class="token variable">$v</span>.<span class="token variable">$f</span></span> <span class="token shell-symbol important">&amp;</span></span>
<span class="token output"><!--"-->  	<!--"--><span class="token keyword">done</span>
<!--"-->  <!--"--><span class="token keyword">done</span>
</span><span class="token output"><span class="token comment"># ...</span>
Warning: Mac and Windows entries in the 'name' table differ for the
 Fullname string in the language English (US)
 Mac String: Courier Prime Bold Italic
Windows String: CourierPrime-BoldItalic
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">cp *.pfa /usr/local/share/groff/site-font/devps/</span></span></code>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">v</span> <span class="token keyword">in</span> <span class="token string">""</span> -Bold -Italic -Bold-Italic<span class="token punctuation">;</span> <span class="token keyword">do</span></span></span>
<!--"-->  	<!--"-->afmtodit -ncmi<span class="token number">0</span> \
<!--"-->  		<!--"-->-d /usr/share/groff/current/font/devps/DESC \
<!--"-->  		<!--"-->-e /usr/share/groff/current/font/devps/text.enc \
<!--"-->  		<!--"--><span class="token string">Courier-Prime<span class="token variable">$v</span>.afm</span> /usr/share/groff/current/font/devps/generate/textmap <span class="token string">"C$(expr "<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $v <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'[:lower:]-'</span><span class="token variable">)</span></span>"</span> <span class="token punctuation">\</span><span class="token operator">|</span> R<span class="token punctuation">)</span><span class="token string">"</span><span class="token punctuation">;</span></span></span>
<!--"-->  <!--"--><span class="token keyword">done</span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">cp C{R,B,I,BI} /usr/local/share/groff/site-font/devps/</span></span></code>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token punctuation">{</span>
<!--"-->  	<!--"-->cat /usr/share/groff/current/font/devps/download<span class="token punctuation">;</span> <span class="token builtin">echo</span><span class="token punctuation">;</span>
<!--"-->  	<!--"--><span class="token keyword">for</span> <span class="token for-or-select variable">v</span> <span class="token keyword">in</span> <span class="token string">""</span> -Bold -Italic -Bold-Italic<span class="token punctuation">;</span> <span class="token keyword">do</span>
<!--"-->  		<!--"--><span class="token builtin class-name">printf</span> <span class="token string">"%s<span class="token entity" title="\t">\t</span>%s<span class="token entity" title="\n">\n</span>"</span> CourierPrime<span class="token variable">${v<span class="token operator">/</span>d-I<span class="token operator">/</span>dI}</span> Courier-Prime<span class="token variable">$v</span>.pfa<span class="token punctuation">;</span>
<span class="token output"><!--"-->  	<!--"--><span class="token keyword">done</span><span class="token punctuation">;</span>
<!--"-->  <!--"--><span class="token punctuation">}</span> <span class="token operator">|</span> tee /usr/local/share/groff/site-font/devps/download
</span><span class="token output"># List of downloadable fonts
‌# PostScript-name<!--"-->       <!--"-->Filename
Symbol-Slanted<!--"-->          <!--"-->symbolsl.pfa
ZapfDingbats-Reverse<!--"-->    <!--"-->zapfdr.pfa
FreeEuro<!--"-->                <!--"-->freeeuro.pfa
CourierPrime<!--"-->    <!--"-->Courier-Prime.pfa
CourierPrime-Bold<!--"-->       <!--"-->Courier-Prime-Bold.pfa
CourierPrime-Italic<!--"-->     <!--"-->Courier-Prime-Italic.pfa
CourierPrime-BoldItalic Courier-Prime-Bold-Italic.pfa
</span></pre></code>
</div>
<p class="continuing">
<a href="/content/assets/blogn_t/007.09-Курьер.pdf">Yielding</a>:
</p>
<a href="/content/assets/blogn_t/007.09-Курьер.png"><img class="continuation main-font dark-invert" alt="Same page, monospace non-ASCII characters rendered in a different, rounder, heavier font, with a long f, and proportional ones missing" src="/content/assets/blogn_t/007.09-Курьер.png" /></a>
<h3 id="alternative-art-distribution-font" class="continued"><a class="hash-link" href="#alternative-art-distribution-font">#</a> A distribution font</h3>
<p class="continuing indented">
GhostScript can directly load TrueType and OpenType fonts, so for a properly-packaged one all that's needed is:  <!--'-->
</p>
<div class="bigcode continuing">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token function">apt</span> <span class="token function">install</span> fonts-liberation2</span></span>

<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">v</span> <span class="token keyword">in</span> Regular Bold Italic BoldItalic<span class="token punctuation">;</span> <span class="token keyword">do</span></span></span>
<span class="token info punctuation"><!--"-->  	<!--"-->fontforge -c 'import sys; fontforge.open(sys.argv[1]).generate(sys.argv[2])' /usr/share/fonts/truetype/liberation2/LiberatSans-</span><span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash">v.ttf LiberatSans-<span class="token variable">$v</span>.afm<span class="token punctuation">;</span></span></span>
<span class="token output"><!--"-->  <!--"-->
<!--"-->  	<!--"-->afmtodit -cmi0 \
<!--"-->  		<!--"-->-d /usr/share/groff/current/font/devps/DESC \
<!--"-->  		<!--"-->-e /usr/share/groff/current/font/devps/text.enc \
</span><span class="token info punctuation"><!--"-->  		<!--"-->LiberationSans-</span><span class="token command"><span class="token shell-symbol important">$</span><span class="token bash language-bash">v.afm /usr/share/groff/current/font/devps/generate/textmap <span class="token string">"T<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $v <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'[:lower:]-'</span><span class="token variable">)</span></span>"</span><span class="token punctuation">;</span></span></span>
<span class="token output"><!--"-->  <!--"-->done
This font contains both a 'kern' table and a 'GPOS' table.
<!--"-->  <!--"-->The 'kern' table will only be read if there is no 'kern' feature in 'GPOS'.
The glyph named macron is mapped to U+02C9.
But its name indicates it should be mapped to U+00AF.
The glyph named Delta is mapped to U+0394.
But its name indicates it should be mapped to U+2206.
The glyph named Omega is mapped to U+03A9.
But its name indicates it should be mapped to U+2126.
The glyph named mu is mapped to U+03BC.
But its name indicates it should be mapped to U+00B5.
The glyph named periodcentered is mapped to U+2219.
But its name indicates it should be mapped to U+00B7.

both S_BE and S_PE map to u0053 at /bin/afmtodit line 6519.
both S_BE and S_TE map to u0053 at /bin/afmtodit line 6519.
both anoteleia and middot map to u00B7 at /bin/afmtodit line 6519.
both mu and mu1 map to mc at /bin/afmtodit line 6411.
both hookabovecomb and uni0309 map to u0309 at /bin/afmtodit line 6519.
both gravecomb and uni0340 map to u0300 at /bin/afmtodit line 6519.
both acutecomb and uni0341 map to u0301 at /bin/afmtodit line 6519.
both uni0313 and uni0343 map to u0313 at /bin/afmtodit line 6519.
both uni02B9 and uni0374 map to u02B9 at /bin/afmtodit line 6519.
both alphatonos and uni1F71 map to u03B1_0301 at /bin/afmtodit line 6519.
both epsilontonos and uni1F73 map to u03B5_0301 at /bin/afmtodit line 6519.
both etatonos and uni1F75 map to u03B7_0301 at /bin/afmtodit line 6519.
both iotatonos and uni1F77 map to u03B9_0301 at /bin/afmtodit line 6519.
both omicrontonos and uni1F79 map to u03BF_0301 at /bin/afmtodit line 6519.
both omegatonos and uni1F7D map to u03C9_0301 at /bin/afmtodit line 6519.
both Alphatonos and uni1FBB map to u0391_0301 at /bin/afmtodit line 6519.
both Epsilontonos and uni1FC9 map to u0395_0301 at /bin/afmtodit line 6519.
both Etatonos and uni1FCB map to u0397_0301 at /bin/afmtodit line 6519.
both iotadieresistonos and uni1FD3 map to u03B9_0308_0301 at /bin/afmtodit line 6519.
both Iotatonos and uni1FDB map to u0399_0301 at /bin/afmtodit line 6519.
both Upsilontonos and uni1FEB map to u03A5_0301 at /bin/afmtodit line 6519.
both dieresistonos and uni1FEE map to u00A8_0301 at /bin/afmtodit line 6519.
both Omicrontonos and uni1FF9 map to u039F_0301 at /bin/afmtodit line 6519.
both Omegatonos and uni1FFB map to u03A9_0301 at /bin/afmtodit line 6519.
both uni2000 and uni2002 map to u2002 at /bin/afmtodit line 6519.
both uni2001 and uni2003 map to u2003 at /bin/afmtodit line 6519.
both uni1FE3 and upsilondieresistonos map to u03C5_0308_0301 at /bin/afmtodit line 6519.
both uni1F7B and upsilontonos map to u03C5_0301 at /bin/afmtodit line 6519.
both patah and yodyod_patah map to u05B7 at /bin/afmtodit line 6519.

</span><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token function">cp</span> T* /usr/local/share/groff/site-font/devps/</span></span>
</pre></code>
</div>
<p class="continuing">
<a href="/content/assets/blogn_t/007.10-liberation2.pdf">And just like that</a>:
</p>
<a href="/content/assets/blogn_t/007.10-liberation2.png"><img class="continuation main-font dark-invert" alt="Same page, proportional non-ASCII characters rendered in a serifless font with busted kerning and regular and bold-italic cyrillic replaced by boxes, and monospace ones missing" src="/content/assets/blogn_t/007.10-liberation2.png" /></a>
<!-- https://lfs.nabijaczleweli.xyz/0017-twitter-export#1429503115947020297 -->
<h2 id="jajco" class="continued"><a class="hash-link" href="#jajco">#</a> <a style="color: inherit;" href="//web.archive.org/web/20210823140236/twitter.com/kgbcatboy/status/1429605955994533889">\nЯЙЦО</a></h2>
<!-- <h2 id="jajco" class="continued"><a class="hash-link" href="#jajco">#</a> \nЯЙЦО</h2> -->
<p class="continuing indented">
A <del>powerful</del> sufficient diagnostic tool can also be plainly piping groff into Ghostscript:
</p>
<div class="bigcode continuation">
<pre class="language-shell-session"><code class="language-shell-session"><span class="token info punctuation"><span class="token user">nabijaczleweli@tarta</span><span class="token punctuation">:</span><span class="token path">~/uwu</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">groff -Kutf8 -Tps -mdoc -tp </span></span><span class="token output">&lt; frag.1 | gs
GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS&lt;1>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;3>GS&lt;1>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS>GS&lt;2>GS&lt;5>GS&lt;13>GS&lt;22>GS&lt;31>GS&lt;40>GS&lt;48>GS&lt;61>GS&lt;82>GS&lt;97>GS&lt;124>GS&lt;132>GS&lt;139>GS&lt;150>GS&lt;159>GS&lt;168>GS&lt;174>GS&lt;181>GS&lt;188>GS&lt;193>GS&lt;201>GS&lt;209>GS&lt;217>GS&lt;225>GS&lt;234>GS&lt;242>GS&lt;251>GS>Querying operating system for font files...
Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/CourierPrime-BoldItalic.
Can't find (or can't open) font file CourierPrime-BoldItalic.
Didn't find this font on the system!
Substituting font Courier-BoldOblique for CourierPrime-BoldItalic.
Loading NimbusMonoPS-BoldItalic font from /usr/share/ghostscript/9.27/Resource/Font/NimbusMonoPS-BoldItalic... 4371456 2971386 7864932 6531275 1 done.
GS>Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/LiberationSans-Italic.
Can't find (or can't open) font file LiberationSans-Italic.
Loading LiberationSans-Italic font from /usr/share/fonts/truetype/liberation2/LiberationSans-Italic.ttf... 4572808 3202292 8735964 7377991 1 done.
GS&lt;1>Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/CourierPrime.
Can't find (or can't open) font file CourierPrime.
Didn't find this font on the system!
Substituting font Courier for CourierPrime.
Loading NimbusMonoPS-Regular font from /usr/share/ghostscript/9.27/Resource/Font/NimbusMonoPS-Regular... 4707152 3390954 8777444 7417724 1 done.
Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/CourierPrime-Italic.
Can't find (or can't open) font file CourierPrime-Italic.
Didn't find this font on the system!
Substituting font Courier-Oblique for CourierPrime-Italic.
Loading NimbusMonoPS-Italic font from /usr/share/ghostscript/9.27/Resource/Font/NimbusMonoPS-Italic... 4955064 3635291 8797644 7430341 1 done.
GS>Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/CourierPrime-Bold.
Can't find (or can't open) font file CourierPrime-Bold.
Didn't find this font on the system!
Substituting font Courier-Bold for CourierPrime-Bold.
Loading NimbusMonoPS-Bold font from /usr/share/ghostscript/9.27/Resource/Font/NimbusMonoPS-Bold... 5223176 3896909 8797644 7439279 1 done.
GS&lt;1>Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/LiberationSans-Bold.
Can't find (or can't open) font file LiberationSans-Bold.
Loading LiberationSans-Bold font from /usr/share/fonts/truetype/liberation2/LiberationSans-Bold.ttf... 5255944 3939182 9686752 8286341 1 done.
Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/LiberationSans.
Can't find (or can't open) font file LiberationSans.
Loading LiberationSans font from /usr/share/fonts/truetype/liberation/LiberationSans-Regular.ttf... 5313240 3985493 10080064 8668213 1 done.
GS>GS&lt;9>GS&lt;18>GS&lt;27>GS&lt;36>GS&lt;45>GS&lt;54>GS&lt;63>GS&lt;72>GS&lt;81>GS&lt;90>GS&lt;99>GS&lt;108>GS&lt;117>GS&lt;126>GS&lt;135>GS&lt;144>GS&lt;153>GS&lt;162>GS&lt;171>GS&lt;180>GS&lt;189>GS&lt;198>GS&lt;207>GS&lt;216>GS&lt;225>GS&lt;234>GS&lt;243>GS&lt;252>GS>Can't find (or can't open) font file /usr/share/ghostscript/9.27/Resource/Font/LiberationSans-BoldItalic.
Can't find (or can't open) font file LiberationSans-BoldItalic.
Loading LiberationSans-BoldItalic font from /usr/share/fonts/truetype/liberation/LiberationSans-BoldItalic.ttf... 5333440 4004198 10467904 9033893 1 done.
GS>GS&lt;9>GS&lt;18>GS&lt;27>GS&lt;36>GS&lt;45>GS&lt;54>GS&lt;63>GS&lt;72>GS&lt;81>GS&lt;90>GS&lt;99>GS&lt;108>GS&lt;117>GS&lt;126>GS&lt;135>GS&lt;144>GS&lt;153>GS&lt;162>GS&lt;171>GS&lt;180>GS&lt;189>GS&lt;198>GS&lt;207>GS&lt;216>GS&lt;225>GS&lt;234>GS&lt;243>GS&lt;252>GS>GS&lt;2>GS&lt;11>GS&lt;20>GS&lt;29>GS&lt;38>GS&lt;47>GS&lt;56>GS&lt;65>GS&lt;74>GS&lt;83>GS&lt;92>GS&lt;101>GS&lt;110>GS&lt;119>GS&lt;128>GS&lt;137>GS&lt;146>GS&lt;155>GS&lt;164>GS&lt;173>GS&lt;182>GS&lt;191>GS&lt;200>GS&lt;209>GS&lt;218>GS&lt;227>GS&lt;236>GS&lt;245>GS&lt;254>GS&lt;2>GS&lt;7>GS&lt;16>GS&lt;25>GS&lt;34>GS&lt;43>GS&lt;52>GS&lt;61>GS&lt;70>GS&lt;79>GS&lt;88>GS&lt;97>GS&lt;106>GS&lt;115>GS&lt;124>GS&lt;133>GS&lt;142>GS&lt;151>GS&lt;160>GS&lt;169>GS&lt;178>GS&lt;187>GS&lt;196>GS&lt;205>GS&lt;214>GS&lt;223>GS&lt;232>GS&lt;241>GS&lt;250>GS>GS&lt;4>GS&lt;13>GS&lt;22>GS&lt;31>GS&lt;40>GS&lt;49>GS&lt;58>GS&lt;67>GS&lt;76>GS&lt;84>GS&lt;92>GS&lt;100>GS&lt;108>GS&lt;117>GS&lt;125>GS&lt;133>GS&lt;141>GS&lt;149>GS&lt;158>GS&lt;167>GS&lt;176>GS&lt;185>GS&lt;194>GS&lt;203>GS&lt;212>GS&lt;221>GS&lt;230>GS&lt;239>GS&lt;248>GS&lt;257>GS&lt;3>GS&lt;9>GS&lt;18>GS&lt;27>GS&lt;36>GS&lt;45>GS&lt;54>GS&lt;63>GS&lt;72>GS&lt;80>GS&lt;88>GS&lt;96>GS&lt;104>GS&lt;113>GS&lt;122>GS&lt;130>GS&lt;138>GS&lt;146>GS&lt;154>GS&lt;163>GS&lt;172>GS&lt;181>GS&lt;190>GS&lt;199>GS&lt;208>GS&lt;217>GS&lt;226>GS&lt;235>GS&lt;244>GS&lt;253>GS&lt;1>GS&lt;6>GS&lt;15>GS&lt;24>GS&lt;33>GS&lt;42>GS&lt;51>GS&lt;60>GS&lt;69>GS&lt;78>GS&lt;86>GS&lt;94>GS&lt;102>GS&lt;111>GS&lt;120>GS&lt;128>GS&lt;136>GS&lt;144>GS&lt;152>GS&lt;161>GS&lt;170>GS&lt;179>GS&lt;188>GS&lt;197>GS&lt;206>GS&lt;215>GS&lt;224>GS&lt;233>GS&lt;242>GS&lt;251>GS>GS&lt;3>GS&lt;12>GS&lt;21>GS&lt;30>GS&lt;39>GS&lt;48>GS&lt;57>GS&lt;66>GS&lt;74>GS&lt;82>GS&lt;90>GS&lt;98>GS&lt;106>GS&lt;115>GS&lt;124>GS&lt;132>GS&lt;140>GS&lt;148>GS&lt;157>GS&lt;166>GS&lt;175>GS&lt;184>GS&lt;193>GS&lt;202>GS&lt;211>GS&lt;220>GS&lt;229>GS&lt;238>GS&lt;247>GS&lt;255>GS>GS&lt;9>GS&lt;18>GS&lt;27>GS&lt;36>GS&lt;45>GS&lt;54>GS&lt;63>GS&lt;72>GS&lt;81>GS&lt;90>GS&lt;99>GS&lt;108>GS&lt;117>GS&lt;126>GS&lt;135>GS&lt;144>GS&lt;153>GS&lt;162>GS&lt;171>GS&lt;180>GS&lt;189>GS&lt;198>GS&lt;207>GS&lt;216>GS&lt;225>GS&lt;234>GS&lt;243>GS&lt;252>GS&lt;1>GS&lt;6>GS&lt;15>GS&lt;24>GS&lt;33>GS&lt;42>GS&lt;51>GS&lt;60>GS&lt;68>GS&lt;77>GS&lt;86>GS&lt;95>GS&lt;104>GS&lt;113>GS&lt;122>GS&lt;131>GS&lt;140>GS&lt;149>GS&lt;158>GS&lt;167>GS&lt;176>GS&lt;185>GS&lt;194>GS&lt;203>GS&lt;212>GS&lt;221>GS&lt;230>GS&lt;239>GS&lt;248>GS&lt;257>GS>GS&lt;9>GS&lt;18>GS&lt;27>GS&lt;36>GS&lt;45>GS&lt;54>GS&lt;63>GS&lt;72>GS&lt;81>GS&lt;90>GS&lt;99>GS&lt;108>GS&lt;117>GS&lt;126>GS&lt;135>GS&lt;144>GS&lt;153>GS&lt;162>GS&lt;171>GS&lt;180>GS&lt;189>GS&lt;198>GS&lt;207>GS&lt;216>GS&lt;225>GS&lt;234>GS&lt;243>GS&lt;252>GS>GS&lt;3>GS&lt;12>GS&lt;21>GS&lt;30>GS&lt;39>GS&lt;48>GS&lt;57>GS&lt;66>GS&lt;75>GS&lt;84>GS&lt;93>GS&lt;102>GS&lt;111>GS&lt;120>GS&lt;129>GS&lt;138>GS&lt;147>GS&lt;155>GS&lt;164>GS&lt;173>GS&lt;182>GS&lt;191>GS&lt;200>GS&lt;209>GS&lt;218>GS&lt;227>GS&lt;236>GS&lt;245>GS&lt;254>GS&lt;2>GS&lt;7>GS&lt;16>GS&lt;25>GS&lt;33>GS&lt;42>GS&lt;51>GS&lt;60>GS&lt;69>GS&lt;78>GS&lt;87>GS&lt;96>GS&lt;104>GS&lt;113>GS&lt;122>GS&lt;131>GS&lt;140>GS&lt;149>GS&lt;158>GS&lt;167>GS&lt;176>GS&lt;185>GS&lt;194>GS&lt;203>GS&lt;212>GS&lt;221>GS&lt;230>GS&lt;239>GS&lt;248>GS&lt;257>GS>GS>GS>GS>GS>GS>GS>GS&lt;2>GS&lt;1>GS&lt;1>GS&lt;2>GS&lt;2>GS&lt;2>GS&lt;1>GS&lt;1>GS&lt;1>GS>GS>GS>GS&lt;2>GS&lt;1>GS>GS&lt;1>GS>GS>GS&lt;1>GS>GS&lt;1>GS>GS&lt;1>GS&lt;2>GS&lt;1>GS>GS>GS>GS&lt;2>GS>GS&lt;1>GS&lt;1>GS>GS&lt;2>GS>GS>GS>GS&lt;1>GS>GS&lt;1>GS&lt;2>GS>GS>GS&lt;1>GS&lt;1>GS>GS&lt;2>GS&lt;1>GS>GS&lt;1>GS&lt;1>GS>GS>GS&lt;2>GS>GS&lt;2>GS&lt;2>GS>GS&lt;1>GS>GS&lt;2>GS&lt;1>GS>GS>GS&lt;2>GS>GS&lt;1>GS&lt;4>GS&lt;2>GS>GS>GS&lt;1>GS&lt;1>GS&lt;1>GS>>>showpage, press &lt;return> to continue&lt;&lt;
GS>GS>GS>GS>
</span></pre></code>
</div>
<p class="continued indented">
<code>frag.1</code> in question, as minimised from <a href="//git.sr.ht/~nabijaczleweli/voreutils">voreutils</a>'  <!--'-->
<a href="//srhtcdn.githack.com/~nabijaczleweli/voreutils/blob/man/man1/cut.1.html"><code>cut.1</code></a>:
</p>
<div class="bigcode continuation">
<pre class="language-plaintext"><code class="language-plaintext">.Dd
.Dt CUT 1
.Os
.
.Sh NAME
.Nm cut
.Nd extract bytes, characters, or fields
.Sh SYNOPSIS
.Nm
.Fl f Ar range Ns Oo , Ns Ar range Oc Ns …
.Op Fl Czs
.Op Fl d Ar elimiter
.Op Fl O Ar out-delimiter
.Oo Ar file Oc Ns …
.
.Sh DESCRIPTION
Copies bytes, characters, or fieflds specified by
.Ar range Ns s
from each line of the input
.Ar file Ns s Pq standard input stream if none or Sq Ar -
to the standard output stream.
.Pp
.Ar range Ns s
can be separated by commas or spaces, and each can be in the format:
.Bl -tag -compact -offset Ds -width "from-to"
.It Ar number
.Brq Ar number
.It Ar from Ns Cm -
.Ar [ from , No \[if] )
.It Ar from Ns Cm - Ns Ar to
.Ar [ number , to ]
.It Li "<!--"--> <!--"-->" Cm - Ns Ar to
.Li [ 1 , Ar to ]
.El
Indices are
.Em 1 Ns -based ,
and a union is taken of all
.Ar range Ns s .
.Pp
With
.Fl b ,
bytes are extracted; with
.Fl n
characters are never interrupted mid-sequence, with rounding preferred down
.Pq see Sx EXAMPLES .
.Pp
The newline
.Pq NUL with Fl z
is never matched and always printed
.Pq unless the entire line was removed with Fl fs .
.
.Sh OPTIONS (ŁĄĘĆŻŹŃ łąęćżźń)
.Bl -tag -compact -width "-O, --output-delimiter=out-delim"
.It Fl b , -bytes Ns = Ns Ar range Ns Oo , Ns Ar range Oc Ns …
Extract bytes.
.It Fl n
Don't interrupt multi-byte character sequences.
.Pp
.It Fl C , -complement
Invert
.Ar range Ns s :
select all
.Em but
what they match
.Pq \&amp;[ Ns Sy 1 , No \[if] ) \- \[*S] Ns Ar range .
.\" TODO?: this should be a Big Union, but, well
For the purposes of
.Fl n ,
the most minimal set of
.Ar range Ns s
is constructed.
.El
.
.Sh EXAMPLES
.Bd -literal -compact
.Li $ Nm printf Li '\ex01\ex02\ex03\ex04\e0\ex05\ex06\ex07' \&amp;| Nm<!--"-->  <!--"-->Fl zb Ar 1,3- Li \&amp;| Nm hexdump Fl C
00000000<!--"-->  <!--"-->01 03 04 00 05 07 00<!--"-->                              <!--"-->|.......|
00000007
.Ed
.Pp
.Bd -literal -compact
.Li $ Nm printf Li 'яйцо\enЯЙЦО'\f(CB'яйцо\enЯЙЦО'\fP\f(CI'яйцо\enЯЙЦО'\fP\f[CBI]'яйцо\enЯЙЦО'\fP \&amp;| Nm<!--"-->  <!--"-->Fl c Ar 1,3-
яцо\fRяцо\fP\fBяцо\fP\fIяцо\fP\f(BIяцо\fP
ЯЦО\fRЯЦО\fP\fBЯЦО\fP\fIЯЦО\fP\f(BIЯЦО\fP
.Ed
.Pp
.Bd -literal -compact
# name, IDs, homedir, shell, ...
.Li $ Nm Fl f Ar 1,3-4,6- Fl d Ns Ar \&amp;: Fl O Ns Li \&amp;"$( Ns Nm printf Li '\et')" Pa /etc/passwd
root<!--"-->    <!--"-->0<!--"-->       <!--"-->0<!--"-->       <!--"-->/root<!--"-->   <!--"-->/bin/bash
bin<!--"-->     <!--"-->2<!--"-->       <!--"-->2<!--"-->       <!--"-->/bin<!--"-->    <!--"-->/usr/sbin/nologin
irc<!--"-->     <!--"-->39<!--"-->      <!--"-->39<!--"-->      <!--"-->/var/run/ircd<!--"-->   <!--"-->/usr/sbin/nologin
cicada<!--"-->  <!--"-->1000<!--"-->    <!--"-->100<!--"-->     <!--"-->/home/cicada<!--"-->    <!--"-->/bin/bash
nobody<!--"-->  <!--"-->65534<!--"-->   <!--"-->65534<!--"-->   <!--"-->/nonexistent<!--"-->    <!--"-->/usr/sbin/nologin
# Everything else: password and GNATS
.Li $ Nm Fl Cf Ar 1,3-4,6- Fl d Ns Ar \&amp;: Fl O Ns Li \&amp;"$( Ns Nm printf Li '\et')" Pa /etc/passwd
x<!--"-->       <!--"-->root
x<!--"-->       <!--"-->bin
x<!--"-->       <!--"-->ircd
x<!--"-->       <!--"-->ŁĄĘĆŻŹŃ łąęćżźń,,,
x<!--"-->       <!--"-->nobody
.Ed
<!--'--></pre></code>
</div>
<p> 
 <br /> 
 Nit-pick? Correction? Improvement? Annoying? Cute? Anything? 
 <a href="mailto:nabijaczleweli@nabijaczleweli.xyz?subject=Notes on src/blogn_t/007-groff-Tps-cyrillic-et-al.html.pp">Mail</a>, 
 <a href="//101010.pl/@nabijaczleweli">post</a>, or <a href="//github.com/nabijaczleweli/nabijaczleweli.github.io/issues/new">open</a>! 
 </p>
</span>
<!-- CTNT_END --> <span id="wordcount_wrapper" class="hidden"> 
 <hr /> 
 <span id="word_count">0</span> words, 
 <span id="syllable_count">0</span> syllables, 
 <span id="character_count">0</span> characters. 
 </span>
<!-- CTNT_END --> <hr style="padding-top: 1em;" /> 
 Creative text licensed under <a href="/content/LICENSE-CREATIVE">CC-BY-SA 4.0</a>, 
 code licensed under <a href="/content/LICENSE-CODE">The MIT License</a>. 
 <hr /> 
 This page is open-source, you can find it at <a href="//github.com/nabijaczleweli/nabijaczleweli.github.io/tree/dev">GitHub</a>, 
 and contribute and/or yell at me there. 
 <hr /> 
 Like what you see? Consider giving me a follow over at social medias listed <a href="/">here</a>, or maybe even a sending a <a style="display: inline-block; position: relative;" id="liberapay-btn" href="https://liberapay.com/nabijaczleweli/donate"> <svg class="dark-invert" style="position: absolute; top: 3px; width: 1em; height: 1em;"><use xlink:href="/assets/liberapay-logo.svg#top"></use></svg> <span style="margin-left: 19px;">buck</span> <span style="font-size: 0;">liberapay donate</span> </a> or <a href="//patreon.com/nabijaczleweli">two<span style="font-size: 0;"> patreon</span></a> my way if my software helped you in some significant way? 
 <hr /> 
 Compiled with Clang 16'<!--'-->s C preprocessor on 09.02.2024 21:20:36 UTC from 
 <a href="https://github.com/nabijaczleweli/nabijaczleweli.github.io/blob/dev/src/blogn_t/007-groff-Tps-cyrillic-et-al.html.pp">src/blogn_t/007-groff-Tps-cyrillic-et-al.html.pp</a>. 
 <br /><a href="https://builds.sr.ht/~nabijaczleweli/job/1146673">See job on builds.sr.ht</a>. 
 <hr /> 
 <a href="/content/feed.xml">RSS feed</a> 
 </body> 
 </html>
